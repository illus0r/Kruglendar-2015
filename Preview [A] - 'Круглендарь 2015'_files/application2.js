;(function(require,define,global,self,_,Backbone,ActiveXObject,require){ActiveXObject=window.ActiveXObject;;!function e(t,n,i){function o(r,s){if(!n[r]){if(!t[r]){var _="function"==typeof require&&require;if(!s&&_)return _(r,!0);if(a)return a(r,!0);throw new Error("Cannot find module '"+r+"'")}var l=n[r]={exports:{}};t[r][0].call(l.exports,function(e){var n=t[r][1][e];return o(n?n:e)},l,l.exports,e,t,n,i)}return n[r].exports}for(var a="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(e,t){!function(e,n){"undefined"!=typeof t&&t.exports?t.exports.browser=n():"function"==typeof define?define(n):this[e]=n()}("bowser",function(){function e(e){function n(t){var n=e.match(t);return n&&n.length>1&&n[1]||""}var i,o=n(/(ipod|iphone|ipad)/i).toLowerCase(),a=/like android/i.test(e),r=!a&&/android/i.test(e),s=n(/version\/(\d+(\.\d+)?)/i),_=/tablet/i.test(e),l=!_&&/[^-]mobi/i.test(e);/opera|opr/i.test(e)?i={name:"Opera",opera:t,version:s||n(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(e)?i={name:"Windows Phone",windowsphone:t,msie:t,version:n(/iemobile\/(\d+(\.\d+)?)/i)}:/msie|trident/i.test(e)?i={name:"Internet Explorer",msie:t,version:n(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:/chrome|crios|crmo/i.test(e)?i={name:"Chrome",chrome:t,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:o?(i={name:"iphone"==o?"iPhone":"ipad"==o?"iPad":"iPod"},s&&(i.version=s)):/sailfish/i.test(e)?i={name:"Sailfish",sailfish:t,version:n(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(e)?i={name:"SeaMonkey",seamonkey:t,version:n(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(e)?(i={name:"Firefox",firefox:t,version:n(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(e)&&(i.firefoxos=t)):/silk/i.test(e)?i={name:"Amazon Silk",silk:t,version:n(/silk\/(\d+(\.\d+)?)/i)}:r?i={name:"Android",version:s}:/phantom/i.test(e)?i={name:"PhantomJS",phantom:t,version:n(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(e)||/rim\stablet/i.test(e)?i={name:"BlackBerry",blackberry:t,version:s||n(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(e)?(i={name:"WebOS",webos:t,version:s||n(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(e)&&(i.touchpad=t)):i=/bada/i.test(e)?{name:"Bada",bada:t,version:n(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(e)?{name:"Tizen",tizen:t,version:n(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||s}:/safari/i.test(e)?{name:"Safari",safari:t,version:s}:{},/(apple)?webkit/i.test(e)?(i.name=i.name||"Webkit",i.webkit=t,!i.version&&s&&(i.version=s)):!i.opera&&/gecko\//i.test(e)&&(i.name=i.name||"Gecko",i.gecko=t,i.version=i.version||n(/gecko\/(\d+(\.\d+)?)/i)),r||i.silk?i.android=t:o&&(i[o]=t,i.ios=t);var c="";o?(c=n(/os (\d+([_\s]\d+)*) like mac os x/i),c=c.replace(/[_\s]/g,".")):r?c=n(/android[ \/-](\d+(\.\d+)*)/i):i.windowsphone?c=n(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):i.webos?c=n(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):i.blackberry?c=n(/rim\stablet\sos\s(\d+(\.\d+)*)/i):i.bada?c=n(/bada\/(\d+(\.\d+)*)/i):i.tizen&&(c=n(/tizen[\/\s](\d+(\.\d+)*)/i)),c&&(i.osversion=c);var u=c.split(".")[0];return _||"ipad"==o||r&&(3==u||4==u&&!l)||i.silk?i.tablet=t:(l||"iphone"==o||"ipod"==o||r||i.blackberry||i.webos||i.bada)&&(i.mobile=t),i.msie&&i.version>=10||i.chrome&&i.version>=20||i.firefox&&i.version>=20||i.safari&&i.version>=6||i.opera&&i.version>=10||i.ios&&i.osversion&&i.osversion.split(".")[0]>=6?i.a=t:i.msie&&i.version<10||i.chrome&&i.version<20||i.firefox&&i.version<20||i.safari&&i.version<6||i.opera&&i.version<10||i.ios&&i.osversion&&i.osversion.split(".")[0]<6?i.c=t:i.x=t,i}var t=!0,n=e("undefined"!=typeof navigator?navigator.userAgent:"");return n._detect=e,n})},{}],2:[function(e,t){(function(){function e(e){function t(){n._releasePrimary()}var n=this;e=e||{},this._win=e.window||window,this._doc=e.document||this._win.document,this._prefixes=["webkit","moz","ms","o"],this._localStorage=e.localStorage||this._win.localStorage,this._storageNamespace=e.storageNamespace||"_BrowserTabStorageNamespace",this._id=(""+Math.random()+Math.random()).replace(/\./g,""),this._listen(this._win,"unload",t),this._listen(this._win,"beforeunload",t),this._supportsVisibility()?this._initializeWithVisibility():this._initializeWithBlurring(),this.hidden()&&this._anyTabsPrimary()||this._makePrimary()}!function(t){var n;e.primary=function(){return n=n||new e,n.primary()},e.hidden=function(){return n=n||new e,n.hidden()},e.on=function(){return n=n||new e,n.on.apply(n,arguments)},t.primary=function(){if(arguments.length>0)throw new Error("'primary' property is not settable");return this._localStorage||window.console&&window.console.warn&&window.console.warn("localStorage is required to use the primary() property"),this._localStorage.getItem(this._storageNamespace)===this._id},t.hidden=function(){if(arguments.length>0)throw new Error("'hidden' property is not settable");return this._supportsVisibility()?this._getProperty(this._doc,"hidden"):this._blurred},t.on=function(e,t){e=e.split(/\s+/);for(var n=0;n<e.length;n++){var i=e[n];switch(i){case"change:hidden":this._listenForVisibilityChange(t);break;case"change:primary":this._listenForPrimaryChange(t);break;default:throw new Error("invalid event '"+i+"'")}}},t._getProperty=function(e,t){var n=t.charAt(0).toString().toUpperCase()+t.slice(1);if(t in e)return e[t];var i;return this._eachBrowserPrefix(function(t){var o=t+n;o in e&&(i=e[o])}),i},t._supportsVisibility=function(){var e=this._getProperty(this._doc,"visibilityState");return"undefined"!==e},t._eachBrowserPrefix=function(e){for(var t=0;t<this._prefixes.length;t++)e(this._prefixes[t])},t._listen=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},t._listenForVisibilityChange=function(e){var t=this;this._listen(this._doc,"visibilitychange",e),this._eachBrowserPrefix(function(n){t._listen(t._doc,n+"visibilitychange",e)}),this._blurChangeCallbacks&&this._blurChangeCallbacks.push(e)},t._listenForPrimaryChange=function(e){var t=this;this._localStorage&&this._listen(this._win,"storage",function(n){n=n||window.event,n.key===t._storageNamespace&&e()})},t._makePrimary=function(){this._localStorage&&this._localStorage.setItem(this._storageNamespace,this._id)},t._releasePrimary=function(){if(this._localStorage){var e=this._localStorage.getItem(this._storageNamespace);e===this._id&&this._localStorage.removeItem(this._storageNamespace)}},t._anyTabsPrimary=function(){if(this._localStorage){var e=this._localStorage.getItem(this._storageNamespace);return"undefined"!==e}return!1},t._initializeWithVisibility=function(){function e(){t._blurred=t.hidden(),t.hidden()||t._makePrimary()}var t=this;this._blurred=this.hidden(),this._uncertain=!1,e(),this._listenForVisibilityChange(e)},t._initializeWithBlurring=function(){function e(){for(var e=0;e<o.length;e++)setTimeout(o[e],0)}function t(){i._blurred=!0,i._uncertain=!1,e()}function n(){i._blurred=!1,i._uncertain=!1,i._makePrimary(),e()}var i=this;this._blurred=!1,this._uncertain=!0,this._blurChangeCallbacks=[];var o=this._blurChangeCallbacks;this._listen(this._doc,"focusin",n),this._listen(this._doc,"focusout",t),this._listen(this._win,"focus",n),this._listen(this._win,"blur",t),this._listen(this._doc,"scroll",n),this._listen(this._doc,"keydown",n),this._listen(this._doc,"mousemove",n),this._listen(this._doc,"select",n),this._listen(this._win,"scroll",n),this._listen(this._win,"keydown",n),this._listen(this._win,"mousemove",n),this._listen(this._win,"select",n),this._listenForPrimaryChange(function(){i.primary()||t()})}}(e.prototype),"undefined"!=typeof t?t.exports=e:this.define&&this.define.amd?this.define(function(){return e}):this.BrowserTab=e}).call(this)},{}],3:[function(e,t,n){(function(e){(function(){function i(e,t){function n(e){if(n[e]!==g)return n[e];var i;if("bug-string-char-index"==e)i="a"!="a"[0];else if("json"==e)i=n("json-stringify")&&n("json-parse");else{var a,s='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var _=t.stringify,c="function"==typeof _&&b;if(c){(a=function(){return 1}).toJSON=a;try{c="0"===_(0)&&"0"===_(new o)&&'""'==_(new r)&&_(v)===g&&_(g)===g&&_()===g&&"1"===_(a)&&"[1]"==_([a])&&"[null]"==_([g])&&"null"==_(null)&&"[null,null,null]"==_([g,v,null])&&_({a:[a,!0,!1,null,"\x00\b\n\f\r	"]})==s&&"1"===_(null,a)&&"[\n 1,\n 2\n]"==_([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==_(new l(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==_(new l(864e13))&&'"-000001-01-01T00:00:00.000Z"'==_(new l(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==_(new l(-1))}catch(u){c=!1}}i=c}if("json-parse"==e){var d=t.parse;if("function"==typeof d)try{if(0===d("0")&&!d(!1)){a=d(s);var h=5==a.a.length&&1===a.a[0];if(h){try{h=!d('"	"')}catch(u){}if(h)try{h=1!==d("01")}catch(u){}if(h)try{h=1!==d("1.")}catch(u){}}}}catch(u){h=!1}i=h}}return n[e]=!!i}e||(e=s.Object()),t||(t=s.Object());var o=e.Number||s.Number,r=e.String||s.String,_=e.Object||s.Object,l=e.Date||s.Date,c=e.SyntaxError||s.SyntaxError,u=e.TypeError||s.TypeError,d=e.Math||s.Math,h=e.JSON||s.JSON;"object"==typeof h&&h&&(t.stringify=h.stringify,t.parse=h.parse);var p,f,g,m=_.prototype,v=m.toString,b=new l(-0xc782b5b800cec);try{b=-109252==b.getUTCFullYear()&&0===b.getUTCMonth()&&1===b.getUTCDate()&&10==b.getUTCHours()&&37==b.getUTCMinutes()&&6==b.getUTCSeconds()&&708==b.getUTCMilliseconds()}catch(y){}if(!n("json")){var w="[object Function]",k="[object Date]",x="[object Number]",S="[object String]",C="[object Array]",I="[object Boolean]",T=n("bug-string-char-index");if(!b)var E=d.floor,P=[0,31,59,90,120,151,181,212,243,273,304,334],O=function(e,t){return P[t]+365*(e-1970)+E((e-1969+(t=+(t>1)))/4)-E((e-1901+t)/100)+E((e-1601+t)/400)};if((p=m.hasOwnProperty)||(p=function(e){var t,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=v?p=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,p=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,p.call(this,e)}),f=function(e,t){var n,i,o,r=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,i=new n;for(o in i)p.call(i,o)&&r++;return n=i=null,r?f=2==r?function(e,t){var n,i={},o=v.call(e)==w;for(n in e)o&&"prototype"==n||p.call(i,n)||!(i[n]=1)||!p.call(e,n)||t(n)}:function(e,t){var n,i,o=v.call(e)==w;for(n in e)o&&"prototype"==n||!p.call(e,n)||(i="constructor"===n)||t(n);(i||p.call(e,n="constructor"))&&t(n)}:(i=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],f=function(e,t){var n,o,r=v.call(e)==w,s=!r&&"function"!=typeof e.constructor&&a[typeof e.hasOwnProperty]&&e.hasOwnProperty||p;for(n in e)r&&"prototype"==n||!s.call(e,n)||t(n);for(o=i.length;n=i[--o];s.call(e,n)&&t(n));}),f(e,t)},!n("json-stringify")){var A={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},M="000000",N=function(e,t){return(M+(t||0)).slice(-e)},B="\\u00",F=function(e){for(var t='"',n=0,i=e.length,o=!T||i>10,a=o&&(T?e.split(""):e);i>n;n++){var r=e.charCodeAt(n);switch(r){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=A[r];break;default:if(32>r){t+=B+N(2,r.toString(16));break}t+=o?a[n]:e.charAt(n)}}return t+'"'},L=function(e,t,n,i,o,a,r){var s,_,l,c,d,h,m,b,y,w,T,P,A,M,B,j;try{s=t[e]}catch(V){}if("object"==typeof s&&s)if(_=v.call(s),_!=k||p.call(s,"toJSON"))"function"==typeof s.toJSON&&(_!=x&&_!=S&&_!=C||p.call(s,"toJSON"))&&(s=s.toJSON(e));else if(s>-1/0&&1/0>s){if(O){for(d=E(s/864e5),l=E(d/365.2425)+1970-1;O(l+1,0)<=d;l++);for(c=E((d-O(l,0))/30.42);O(l,c+1)<=d;c++);d=1+d-O(l,c),h=(s%864e5+864e5)%864e5,m=E(h/36e5)%24,b=E(h/6e4)%60,y=E(h/1e3)%60,w=h%1e3}else l=s.getUTCFullYear(),c=s.getUTCMonth(),d=s.getUTCDate(),m=s.getUTCHours(),b=s.getUTCMinutes(),y=s.getUTCSeconds(),w=s.getUTCMilliseconds();s=(0>=l||l>=1e4?(0>l?"-":"+")+N(6,0>l?-l:l):N(4,l))+"-"+N(2,c+1)+"-"+N(2,d)+"T"+N(2,m)+":"+N(2,b)+":"+N(2,y)+"."+N(3,w)+"Z"}else s=null;if(n&&(s=n.call(t,e,s)),null===s)return"null";if(_=v.call(s),_==I)return""+s;if(_==x)return s>-1/0&&1/0>s?""+s:"null";if(_==S)return F(""+s);if("object"==typeof s){for(M=r.length;M--;)if(r[M]===s)throw u();if(r.push(s),T=[],B=a,a+=o,_==C){for(A=0,M=s.length;M>A;A++)P=L(A,s,n,i,o,a,r),T.push(P===g?"null":P);j=T.length?o?"[\n"+a+T.join(",\n"+a)+"\n"+B+"]":"["+T.join(",")+"]":"[]"}else f(i||s,function(e){var t=L(e,s,n,i,o,a,r);t!==g&&T.push(F(e)+":"+(o?" ":"")+t)}),j=T.length?o?"{\n"+a+T.join(",\n"+a)+"\n"+B+"}":"{"+T.join(",")+"}":"{}";return r.pop(),j}};t.stringify=function(e,t,n){var i,o,r,s;if(a[typeof t]&&t)if((s=v.call(t))==w)o=t;else if(s==C){r={};for(var _,l=0,c=t.length;c>l;_=t[l++],s=v.call(_),(s==S||s==x)&&(r[_]=1));}if(n)if((s=v.call(n))==x){if((n-=n%1)>0)for(i="",n>10&&(n=10);i.length<n;i+=" ");}else s==S&&(i=n.length<=10?n:n.slice(0,10));return L("",(_={},_[""]=e,_),o,r,i,"",[])}}if(!n("json-parse")){var j,V,R=r.fromCharCode,D={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},H=function(){throw j=V=null,c()},q=function(){for(var e,t,n,i,o,a=V,r=a.length;r>j;)switch(o=a.charCodeAt(j)){case 9:case 10:case 13:case 32:j++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=T?a.charAt(j):a[j],j++,e;case 34:for(e="@",j++;r>j;)if(o=a.charCodeAt(j),32>o)H();else if(92==o)switch(o=a.charCodeAt(++j)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=D[o],j++;break;case 117:for(t=++j,n=j+4;n>j;j++)o=a.charCodeAt(j),o>=48&&57>=o||o>=97&&102>=o||o>=65&&70>=o||H();e+=R("0x"+a.slice(t,j));break;default:H()}else{if(34==o)break;for(o=a.charCodeAt(j),t=j;o>=32&&92!=o&&34!=o;)o=a.charCodeAt(++j);e+=a.slice(t,j)}if(34==a.charCodeAt(j))return j++,e;H();default:if(t=j,45==o&&(i=!0,o=a.charCodeAt(++j)),o>=48&&57>=o){for(48==o&&(o=a.charCodeAt(j+1),o>=48&&57>=o)&&H(),i=!1;r>j&&(o=a.charCodeAt(j),o>=48&&57>=o);j++);if(46==a.charCodeAt(j)){for(n=++j;r>n&&(o=a.charCodeAt(n),o>=48&&57>=o);n++);n==j&&H(),j=n}if(o=a.charCodeAt(j),101==o||69==o){for(o=a.charCodeAt(++j),(43==o||45==o)&&j++,n=j;r>n&&(o=a.charCodeAt(n),o>=48&&57>=o);n++);n==j&&H(),j=n}return+a.slice(t,j)}if(i&&H(),"true"==a.slice(j,j+4))return j+=4,!0;if("false"==a.slice(j,j+5))return j+=5,!1;if("null"==a.slice(j,j+4))return j+=4,null;H()}return"$"},U=function(e){var t,n;if("$"==e&&H(),"string"==typeof e){if("@"==(T?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];e=q(),"]"!=e;n||(n=!0))n&&(","==e?(e=q(),"]"==e&&H()):H()),","==e&&H(),t.push(U(e));return t}if("{"==e){for(t={};e=q(),"}"!=e;n||(n=!0))n&&(","==e?(e=q(),"}"==e&&H()):H()),(","==e||"string"!=typeof e||"@"!=(T?e.charAt(0):e[0])||":"!=q())&&H(),t[e.slice(1)]=U(q());return t}H()}return e},W=function(e,t,n){var i=$(e,t,n);i===g?delete e[t]:e[t]=i},$=function(e,t,n){var i,o=e[t];if("object"==typeof o&&o)if(v.call(o)==C)for(i=o.length;i--;)W(o,i,n);else f(o,function(e){W(o,e,n)});return n.call(e,t,o)};t.parse=function(e,t){var n,i;return j=0,V=""+e,n=U(q()),"$"!=q()&&H(),j=V=null,t&&v.call(t)==w?$((i={},i[""]=n,i),"",t):n}}}return t.runInContext=i,t}var o="function"==typeof define&&define.amd,a={"function":!0,object:!0},r=a[typeof n]&&n&&!n.nodeType&&n,s=a[typeof window]&&window||this,_=r&&a[typeof t]&&t&&!t.nodeType&&"object"==typeof e&&e;if(!_||_.global!==_&&_.window!==_&&_.self!==_||(s=_),r&&!o)i(s,r);else{var l=s.JSON,c=s.JSON3,u=!1,d=i(s,s.JSON3={noConflict:function(){return u||(u=!0,s.JSON=l,s.JSON3=c,l=c=null),d}});s.JSON={parse:d.parse,stringify:d.stringify}}o&&define(function(){return d})}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(e,t){t.exports={RE_EMAIL_PATTERN:"\\b[\\w.-]+\\+*[\\w.-]+@(?:(?:[\\w-]+\\.)+[A-Za-z]{2,6}|(?:\\d{1,3}\\.){3}\\d{1,3})",RE_URL_SCHEME:"(?:[\\w-]{2,}):/{1,3}",RE_TLD:"(?:aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|fi|fj|fk|fm|fo|fr|ga|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|qa|re|ro|ru|rw|sa|sb|sc|sd|se|sg|si|sj|sk|sl|sm|sn|so|sr|st|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)",RE_URL_MIDCHAR:"(?:[^\\s()]+|\\((\\S+)\\))",RE_URL_ENDCHAR:"(?:\\((\\S+)\\)|[^\\s`!()\\[\\]{};:'\".,<>?«»“”‘’])",add_wbrs:!0,truncate_length:null,link_target:"_blank",link_titles:!0,init:function(){this.RE_URL_ENDING||(this.RE_URL_ENDING="(?:"+this.RE_URL_MIDCHAR+"*"+this.RE_URL_ENDCHAR+")?",this.RE_FULL_URL=this.RE_URL_SCHEME+"\\w+(?:.\\w+)"+this.RE_URL_ENDING,this.RE_OTHER_URL="\\w[\\w_-]*(?:\\.\\w[\\w_-]*)*\\."+this.RE_TLD+"(?:[\\/\\?#]"+this.RE_URL_ENDING+")?\\b")},linkify:function(e,t){return this.init(),e=this.match_and_replace(this.RE_EMAIL_PATTERN,e,!0,!1,t),e=this.match_and_replace(this.RE_FULL_URL,e,!1,!1,t),e=this.match_and_replace(this.RE_OTHER_URL,e,!1,!0,t)},match_and_replace:function(e,t,n,i,o){for(var a=0,r=0,s=0,_=0,l=/<\/[aA]>/,c=new RegExp(e,"g"),u={},d=20,h=0;(u=c.exec(t))&&(h++,!(h>d));){a=u.index,s=u[0].length;var p=t.substring(r,a);if(p.search(/<[aA]/)>=0){l.lastIndex=r;var f=t.substring(r,t.length).search(l);if(0>f)return t;_=f+r,c.lastIndex=_+4,r=_+4}else{var g=t.substr(a,s),m=g;i&&(m="http://"+m);var v="<a";if(this.link_target&&(v+=' target="'+this.link_target+'"'),v+=' href="',n&&(v+="mailto:"),m=m.replace(/"/g,"%22"),v+=m+'"',this.link_titles){var b=n?"Email "+m:m;v+=' title="'+b+'"'}this.truncate_length&&g.length>this.truncate_length&&(g=g.substr(0,this.truncate_length)+"..."),this.add_wbrs&&(g=g.replace(new RegExp("([/=])","g"),"<wbr>$1")),v+=">"+g+"</a>",o&&o.push(m),t=t.slice(0,a)+v+t.slice(a+s,t.length),c.lastIndex=a+v.length,r=a+v.length}}return t}}},{}],5:[function(e,t,n){(function(){var e=this,i=e._,o={},a=Array.prototype,r=Object.prototype,s=Function.prototype,_=a.push,l=a.slice,c=a.concat,u=r.toString,d=r.hasOwnProperty,h=a.forEach,p=a.map,f=a.reduce,g=a.reduceRight,m=a.filter,v=a.every,b=a.some,y=a.indexOf,w=a.lastIndexOf,k=Array.isArray,x=Object.keys,S=s.bind,C=function(e){return e instanceof C?e:this instanceof C?void(this._wrapped=e):new C(e)};"undefined"!=typeof n?("undefined"!=typeof t&&t.exports&&(n=t.exports=C),n._=C):e._=C,C.VERSION="1.6.0";var I=C.each=C.forEach=function(e,t,n){if(null==e)return e;if(h&&e.forEach===h)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,a=e.length;a>i;i++)if(t.call(n,e[i],i,e)===o)return}else for(var r=C.keys(e),i=0,a=r.length;a>i;i++)if(t.call(n,e[r[i]],r[i],e)===o)return;return e};C.map=C.collect=function(e,t,n){var i=[];return null==e?i:p&&e.map===p?e.map(t,n):(I(e,function(e,o,a){i.push(t.call(n,e,o,a))}),i)};var T="Reduce of empty array with no initial value";C.reduce=C.foldl=C.inject=function(e,t,n,i){var o=arguments.length>2;if(null==e&&(e=[]),f&&e.reduce===f)return i&&(t=C.bind(t,i)),o?e.reduce(t,n):e.reduce(t);if(I(e,function(e,a,r){o?n=t.call(i,n,e,a,r):(n=e,o=!0)}),!o)throw new TypeError(T);return n},C.reduceRight=C.foldr=function(e,t,n,i){var o=arguments.length>2;if(null==e&&(e=[]),g&&e.reduceRight===g)return i&&(t=C.bind(t,i)),o?e.reduceRight(t,n):e.reduceRight(t);var a=e.length;if(a!==+a){var r=C.keys(e);a=r.length}if(I(e,function(s,_,l){_=r?r[--a]:--a,o?n=t.call(i,n,e[_],_,l):(n=e[_],o=!0)}),!o)throw new TypeError(T);return n},C.find=C.detect=function(e,t,n){var i;return E(e,function(e,o,a){return t.call(n,e,o,a)?(i=e,!0):void 0}),i},C.filter=C.select=function(e,t,n){var i=[];return null==e?i:m&&e.filter===m?e.filter(t,n):(I(e,function(e,o,a){t.call(n,e,o,a)&&i.push(e)}),i)},C.reject=function(e,t,n){return C.filter(e,function(e,i,o){return!t.call(n,e,i,o)},n)},C.every=C.all=function(e,t,n){t||(t=C.identity);var i=!0;return null==e?i:v&&e.every===v?e.every(t,n):(I(e,function(e,a,r){return(i=i&&t.call(n,e,a,r))?void 0:o}),!!i)};var E=C.some=C.any=function(e,t,n){t||(t=C.identity);var i=!1;return null==e?i:b&&e.some===b?e.some(t,n):(I(e,function(e,a,r){return i||(i=t.call(n,e,a,r))?o:void 0}),!!i)};C.contains=C.include=function(e,t){return null==e?!1:y&&e.indexOf===y?-1!=e.indexOf(t):E(e,function(e){return e===t})},C.invoke=function(e,t){var n=l.call(arguments,2),i=C.isFunction(t);return C.map(e,function(e){return(i?t:e[t]).apply(e,n)})},C.pluck=function(e,t){return C.map(e,C.property(t))},C.where=function(e,t){return C.filter(e,C.matches(t))},C.findWhere=function(e,t){return C.find(e,C.matches(t))},C.max=function(e,t,n){if(!t&&C.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var i=-1/0,o=-1/0;return I(e,function(e,a,r){var s=t?t.call(n,e,a,r):e;s>o&&(i=e,o=s)}),i},C.min=function(e,t,n){if(!t&&C.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var i=1/0,o=1/0;return I(e,function(e,a,r){var s=t?t.call(n,e,a,r):e;o>s&&(i=e,o=s)}),i},C.shuffle=function(e){var t,n=0,i=[];return I(e,function(e){t=C.random(n++),i[n-1]=i[t],i[t]=e}),i},C.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=C.values(e)),e[C.random(e.length-1)]):C.shuffle(e).slice(0,Math.max(0,t))};var P=function(e){return null==e?C.identity:C.isFunction(e)?e:C.property(e)};C.sortBy=function(e,t,n){return t=P(t),C.pluck(C.map(e,function(e,i,o){return{value:e,index:i,criteria:t.call(n,e,i,o)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return e.index-t.index}),"value")};var O=function(e){return function(t,n,i){var o={};return n=P(n),I(t,function(a,r){var s=n.call(i,a,r,t);e(o,s,a)}),o}};C.groupBy=O(function(e,t,n){C.has(e,t)?e[t].push(n):e[t]=[n]}),C.indexBy=O(function(e,t,n){e[t]=n}),C.countBy=O(function(e,t){C.has(e,t)?e[t]++:e[t]=1}),C.sortedIndex=function(e,t,n,i){n=P(n);for(var o=n.call(i,t),a=0,r=e.length;r>a;){var s=a+r>>>1;n.call(i,e[s])<o?a=s+1:r=s}return a},C.toArray=function(e){return e?C.isArray(e)?l.call(e):e.length===+e.length?C.map(e,C.identity):C.values(e):[]},C.size=function(e){return null==e?0:e.length===+e.length?e.length:C.keys(e).length},C.first=C.head=C.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:l.call(e,0,t)},C.initial=function(e,t,n){return l.call(e,0,e.length-(null==t||n?1:t))},C.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:l.call(e,Math.max(e.length-t,0))},C.rest=C.tail=C.drop=function(e,t,n){return l.call(e,null==t||n?1:t)},C.compact=function(e){return C.filter(e,C.identity)};var A=function(e,t,n){return t&&C.every(e,C.isArray)?c.apply(n,e):(I(e,function(e){C.isArray(e)||C.isArguments(e)?t?_.apply(n,e):A(e,t,n):n.push(e)}),n)};C.flatten=function(e,t){return A(e,t,[])},C.without=function(e){return C.difference(e,l.call(arguments,1))},C.partition=function(e,t){var n=[],i=[];return I(e,function(e){(t(e)?n:i).push(e)}),[n,i]},C.uniq=C.unique=function(e,t,n,i){C.isFunction(t)&&(i=n,n=t,t=!1);var o=n?C.map(e,n,i):e,a=[],r=[];return I(o,function(n,i){(t?i&&r[r.length-1]===n:C.contains(r,n))||(r.push(n),a.push(e[i]))}),a},C.union=function(){return C.uniq(C.flatten(arguments,!0))},C.intersection=function(e){var t=l.call(arguments,1);return C.filter(C.uniq(e),function(e){return C.every(t,function(t){return C.contains(t,e)})})},C.difference=function(e){var t=c.apply(a,l.call(arguments,1));return C.filter(e,function(e){return!C.contains(t,e)})},C.zip=function(){for(var e=C.max(C.pluck(arguments,"length").concat(0)),t=new Array(e),n=0;e>n;n++)t[n]=C.pluck(arguments,""+n);return t},C.object=function(e,t){if(null==e)return{};for(var n={},i=0,o=e.length;o>i;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},C.indexOf=function(e,t,n){if(null==e)return-1;var i=0,o=e.length;if(n){if("number"!=typeof n)return i=C.sortedIndex(e,t),e[i]===t?i:-1;i=0>n?Math.max(0,o+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;o>i;i++)if(e[i]===t)return i;return-1},C.lastIndexOf=function(e,t,n){if(null==e)return-1;var i=null!=n;if(w&&e.lastIndexOf===w)return i?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var o=i?n:e.length;o--;)if(e[o]===t)return o;return-1},C.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((t-e)/n),0),o=0,a=new Array(i);i>o;)a[o++]=e,e+=n;return a};var M=function(){};C.bind=function(e,t){var n,i;if(S&&e.bind===S)return S.apply(e,l.call(arguments,1));if(!C.isFunction(e))throw new TypeError;return n=l.call(arguments,2),i=function(){if(!(this instanceof i))return e.apply(t,n.concat(l.call(arguments)));M.prototype=e.prototype;var o=new M;M.prototype=null;var a=e.apply(o,n.concat(l.call(arguments)));return Object(a)===a?a:o}},C.partial=function(e){var t=l.call(arguments,1);return function(){for(var n=0,i=t.slice(),o=0,a=i.length;a>o;o++)i[o]===C&&(i[o]=arguments[n++]);for(;n<arguments.length;)i.push(arguments[n++]);return e.apply(this,i)}},C.bindAll=function(e){var t=l.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return I(t,function(t){e[t]=C.bind(e[t],e)}),e},C.memoize=function(e,t){var n={};return t||(t=C.identity),function(){var i=t.apply(this,arguments);return C.has(n,i)?n[i]:n[i]=e.apply(this,arguments)}},C.delay=function(e,t){var n=l.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},C.defer=function(e){return C.delay.apply(C,[e,1].concat(l.call(arguments,1)))},C.throttle=function(e,t,n){var i,o,a,r=null,s=0;n||(n={});var _=function(){s=n.leading===!1?0:C.now(),r=null,a=e.apply(i,o),i=o=null};return function(){var l=C.now();s||n.leading!==!1||(s=l);var c=t-(l-s);return i=this,o=arguments,0>=c?(clearTimeout(r),r=null,s=l,a=e.apply(i,o),i=o=null):r||n.trailing===!1||(r=setTimeout(_,c)),a}},C.debounce=function(e,t,n){var i,o,a,r,s,_=function(){var l=C.now()-r;t>l?i=setTimeout(_,t-l):(i=null,n||(s=e.apply(a,o),a=o=null))};return function(){a=this,o=arguments,r=C.now();var l=n&&!i;return i||(i=setTimeout(_,t)),l&&(s=e.apply(a,o),a=o=null),s}},C.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},C.wrap=function(e,t){return C.partial(t,e)},C.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},C.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},C.keys=function(e){if(!C.isObject(e))return[];if(x)return x(e);var t=[];for(var n in e)C.has(e,n)&&t.push(n);return t},C.values=function(e){for(var t=C.keys(e),n=t.length,i=new Array(n),o=0;n>o;o++)i[o]=e[t[o]];return i},C.pairs=function(e){for(var t=C.keys(e),n=t.length,i=new Array(n),o=0;n>o;o++)i[o]=[t[o],e[t[o]]];return i},C.invert=function(e){for(var t={},n=C.keys(e),i=0,o=n.length;o>i;i++)t[e[n[i]]]=n[i];return t},C.functions=C.methods=function(e){var t=[];for(var n in e)C.isFunction(e[n])&&t.push(n);return t.sort()},C.extend=function(e){return I(l.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},C.pick=function(e){var t={},n=c.apply(a,l.call(arguments,1));return I(n,function(n){n in e&&(t[n]=e[n])}),t},C.omit=function(e){var t={},n=c.apply(a,l.call(arguments,1));for(var i in e)C.contains(n,i)||(t[i]=e[i]);return t},C.defaults=function(e){return I(l.call(arguments,1),function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])}),e},C.clone=function(e){return C.isObject(e)?C.isArray(e)?e.slice():C.extend({},e):e},C.tap=function(e,t){return t(e),e};var N=function(e,t,n,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof C&&(e=e._wrapped),t instanceof C&&(t=t._wrapped);var o=u.call(e);if(o!=u.call(t))return!1;switch(o){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var a=n.length;a--;)if(n[a]==e)return i[a]==t;var r=e.constructor,s=t.constructor;if(r!==s&&!(C.isFunction(r)&&r instanceof r&&C.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1;n.push(e),i.push(t);var _=0,l=!0;if("[object Array]"==o){if(_=e.length,l=_==t.length)for(;_--&&(l=N(e[_],t[_],n,i)););}else{for(var c in e)if(C.has(e,c)&&(_++,!(l=C.has(t,c)&&N(e[c],t[c],n,i))))break;if(l){for(c in t)if(C.has(t,c)&&!_--)break;l=!_}}return n.pop(),i.pop(),l};C.isEqual=function(e,t){return N(e,t,[],[])},C.isEmpty=function(e){if(null==e)return!0;if(C.isArray(e)||C.isString(e))return 0===e.length;for(var t in e)if(C.has(e,t))return!1;return!0},C.isElement=function(e){return!(!e||1!==e.nodeType)},C.isArray=k||function(e){return"[object Array]"==u.call(e)},C.isObject=function(e){return e===Object(e)},I(["Arguments","Function","String","Number","Date","RegExp"],function(e){C["is"+e]=function(t){return u.call(t)=="[object "+e+"]"}}),C.isArguments(arguments)||(C.isArguments=function(e){return!(!e||!C.has(e,"callee"))}),"function"!=typeof/./&&(C.isFunction=function(e){return"function"==typeof e}),C.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},C.isNaN=function(e){return C.isNumber(e)&&e!=+e},C.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==u.call(e)},C.isNull=function(e){return null===e},C.isUndefined=function(e){return void 0===e},C.has=function(e,t){return d.call(e,t)},C.noConflict=function(){return e._=i,this},C.identity=function(e){return e},C.constant=function(e){return function(){return e}},C.property=function(e){return function(t){return t[e]}},C.matches=function(e){return function(t){if(t===e)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0}},C.times=function(e,t,n){for(var i=Array(Math.max(0,e)),o=0;e>o;o++)i[o]=t.call(n,o);return i},C.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},C.now=Date.now||function(){return(new Date).getTime()};var B={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};B.unescape=C.invert(B.escape);var F={escape:new RegExp("["+C.keys(B.escape).join("")+"]","g"),unescape:new RegExp("("+C.keys(B.unescape).join("|")+")","g")};C.each(["escape","unescape"],function(e){C[e]=function(t){return null==t?"":(""+t).replace(F[e],function(t){return B[e][t]})}}),C.result=function(e,t){if(null==e)return void 0;var n=e[t];return C.isFunction(n)?n.call(e):n},C.mixin=function(e){I(C.functions(e),function(t){var n=C[t]=e[t];C.prototype[t]=function(){var e=[this._wrapped];return _.apply(e,arguments),D.call(this,n.apply(C,e))}})};var L=0;C.uniqueId=function(e){var t=++L+"";return e?e+t:t},C.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var j=/(.)^/,V={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},R=/\\|'|\r|\n|\t|\u2028|\u2029/g;C.template=function(e,t,n){var i;n=C.defaults({},n,C.templateSettings);var o=new RegExp([(n.escape||j).source,(n.interpolate||j).source,(n.evaluate||j).source].join("|")+"|$","g"),a=0,r="__p+='";e.replace(o,function(t,n,i,o,s){return r+=e.slice(a,s).replace(R,function(e){return"\\"+V[e]}),n&&(r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),i&&(r+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),o&&(r+="';\n"+o+"\n__p+='"),a=s+t.length,t}),r+="';\n",n.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{i=new Function(n.variable||"obj","_",r)}catch(s){throw s.source=r,s}if(t)return i(t,C);var _=function(e){return i.call(this,e,C)};return _.source="function("+(n.variable||"obj")+"){\n"+r+"}",_},C.chain=function(e){return C(e).chain()};var D=function(e){return this._chain?C(e).chain():e};C.mixin(C),I(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=a[e];C.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],D.call(this,n)
}}),I(["concat","join","slice"],function(e){var t=a[e];C.prototype[e]=function(){return D.call(this,t.apply(this._wrapped,arguments))}}),C.extend(C.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return C})}).call(this)},{}],6:[function(e,t){function n(){}var i=t.exports={};i.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var i=n.shift();i()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.on=n,i.addListener=n,i.once=n,i.off=n,i.removeListener=n,i.removeAllListeners=n,i.emit=n,i.binding=function(){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(){throw new Error("process.chdir is not supported")}},{}],7:[function(e,t){var n=e("./logger"),i=e("./BrowserApi"),o=e("./ChatApi"),a=e("./BoxApi"),r=e("./data").DataApi,s=e("./VisitorApi"),_=e("./RulesApi"),l=e("./BrowserInfo"),c=function(e){e=e||{};var t=this,c=e.namespace;if("undefined"==typeof c)throw new Error("'namespace' is required");var u=e.conf;if("undefined"==typeof u)throw new Error("'conf' is required");var d=e.extension_name;if("undefined"==typeof d)throw new Error("'extension_name' is required");t.__SPI_browser=new i({namespace:c,conf:u}),t.chat=new o({conf:u,extension_name:d}),t.box=new a({conf:u,chat_api:t.chat}),t.data=new r({namespace:c}),t.visitor=new s({namespace:c,data:t.data,browser:t.__SPI_browser,olark:window.olark,browserinfo:new l({userAgent:window.navigator.userAgent,compatMode:document.compatMode})}),t.rules=new _({data:t.data,browser:t.__SPI_browser,olark:window.olark}),t.logger=n,t.boot={onIdentityReady:function(e){olark._.identityManager.triggerIfIdentityIsReady(e)},onWindowLoad:function(e){e()}}};t.exports=c},{"./BoxApi":8,"./BrowserApi":9,"./BrowserInfo":10,"./ChatApi":11,"./RulesApi":22,"./VisitorApi":26,"./data":29,"./logger":33}],8:[function(e,t){var n=e("./logger"),i=e("./data"),o=e("./corehelpers"),a=500,r=300,s=null,_=null,l=!1,c=!1,u=!1,d=function(e){var t=this;if(t.__conf=e.conf,"undefined"==typeof t.__conf)throw new Error("'conf' required");if(t.__chat_api=e.chat_api,"undefined"==typeof t.__chat_api)throw new Error("'chat_api' required");t.__initialize_legacy_event_handlers(),t.__setup_chat_history_handling(),t.__conf.box.behave_like_popout&&t.__setup_popout_behavior(),t.__keystore=new i.StorejsKeyStore,t.__renderWelcomeMessage(),t.__SPI_onPrechatWelcomeMessage(function(){t.__renderWelcomeMessage()}),t.__conf.system.offline_msg_mode||(t.__prevent_showing=!1,t.__pending_show=!1,t.__chat_api.__SPI_onOperatorGroupChanging(function(){t.__prevent_showing=!0}),t.__chat_api.__SPI_onOperatorGroupChanged(function(){t.__prevent_showing=!1,t.__chat_api.operatorsAreAvailable()&&t.__pending_show&&t.show()}))};d.prototype.listen=function(e,t){n.warn("[olark] api.box.listen is deprecated, please use api.box.on<METHOD> instead"),o.listen_for_event({namespace:"box",type:e,callback:t})},d.prototype.expand=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.expand()})},d.prototype.onExpand=function(e){window.olark.__legacy_shim.disable_input_focusing=!1,o.listen_for_event({namespace:"box",type:"expand",callback:e})},d.prototype.shrink=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.compress()})},d.prototype.onShrink=function(e){window.olark.__legacy_shim.disable_input_focusing=!1,o.listen_for_event({namespace:"box",type:"shrink",callback:e})},d.prototype.show=function(){var e=this;return e.__prevent_showing?void(e.__pending_show=!0):void e.__SPI_whenRendered(function(){habla_window.show()})},d.prototype.onShow=function(e){window.olark.__legacy_shim.disable_input_focusing=!1,o.listen_for_event({namespace:"box",type:"show",callback:e})},d.prototype.overlay=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.theme.setInline(0),habla_window.end_popout()})},d.prototype.onOverlay=function(e){window.olark.__legacy_shim.disable_input_focusing=!1,o.listen_for_event({namespace:"box",type:"overlay",callback:e})},d.prototype.hide=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.hide()})},d.prototype.onHide=function(e){window.olark.__legacy_shim.disable_input_focusing=!0,o.listen_for_event({namespace:"box",type:"hide",callback:e})},d.prototype.popout=function(){n.info("[olark] api.box.popout is no longer actively supported in our API, and may be removed in future versions"),habla_window.popout()},d.prototype.onPopout=function(e){window.olark.__legacy_shim.disable_input_focusing=!1,o.listen_for_event({namespace:"box",type:"popout",callback:e})},d.prototype.dismiss=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.close()})},d.prototype.onDismiss=function(e){window.olark.__legacy_shim.disable_input_focusing=!0,o.listen_for_event({namespace:"box",type:"dismiss",callback:e})},d.prototype.__SPI_disableUserInterface=function(){var e=document.getElementById("habla_beta_container_do_not_rely_on_div_classes_or_names");e.style.visibility="hidden",e.style.display="none"},d.prototype.__SPI_inline=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.theme.setInline(1)})},d.prototype.__SPI_onInline=function(e){window.olark.__legacy_shim.disable_input_focusing=!1,o.listen_for_event({namespace:"box",type:"inline",callback:e})},d.prototype.__SPI_injectStyleIntoPage=function(e){function t(){var t=document.getElementsByTagName("head")[0];t.insertBefore(e,t.firstChild)}/(Chrome)/.test(navigator.userAgent)?setTimeout(t,1e3):t()},d.prototype.__clear_message_history=function(){var e=this;e.__SPI_whenRendered(function(){o.run_legacy_code(function(e){e.habla_window.setBody("")})})},d.prototype.__renderWelcomeMessage=function(){function e(){return n.__keystore.get({key:"__box.welcomeMessage"})}function t(){var t=e();t&&n.__chat_api.sendMessageToVisitor({nickname:" ",body:t,__SPI_notification:!0}),n.__keystore.set({key:"__box.welcomeMessage",value:null,link_to_conversation:!0})}var n=this;e()&&(n.__chat_api.onReady(function(){hbl.config.vars.show_pre_chat?n.__chat_api.__SPI_onPrechatInfoReceived(t):t()}),n.__SPI_whenRendered(function(){var t=e();t&&(window.habla_window.theme.habla_pre_chat_span.innerHTML=t)}))},d.prototype.__SPI_setPrechatWelcomeMessage=function(e){var t=this;t.__keystore.set({key:"__box.welcomeMessage",value:e,link_to_conversation:!0}),o.trigger_event({namespace:"box",type:"prechatWelcomeMessage",body:e}),t.expand()},d.prototype.__SPI_onPrechatWelcomeMessage=function(e){o.listen_for_event({namespace:"box",type:"prechatWelcomeMessage",callback:e})},d.prototype.__SPI_showMessageHistory=function(){var e=this;e.__SPI_whenRendered(function(){return habla_window.config.vars.show_pre_chat?void(habla_window.theme.habla_offline_message_div.style.display="none"):(window.olark.__legacy_shim.ignore_prechat_status=!1,void e.__toggle_divs_by_id({show:["habla_chatform_form","habla_conversation_div"],hide:["olark-api-panel","habla_pre_chat_div","habla_offline_message_div"]}))})},d.prototype.__SPI_getLegacyState=function(e){var t=this.__keystore.get({key:"__box.legacyState"})||{box_open:!1,box_visible:!0};e(t)},d.prototype.__SPI_setLegacyState=function(e){this.__keystore.set({key:"__box.legacyState",value:e,link_to_conversation:!0})},d.prototype.__hide_dom=function(e){return"string"==typeof e&&(e=document.getElementById(e)),"object"==typeof e&&null!==e?(e.style.display="none",!0):!1},d.prototype.__show_dom=function(e){return"string"==typeof e&&(e=document.getElementById(e)),"object"==typeof e&&null!==e?(e.style.display="block",!0):!1},d.prototype.__toggle_divs_by_id=function(e){var t=this,n=e.show,i=e.hide;for(var o in n)if("function"!=typeof n[o]){var a=n[o];t.__show_dom(document.getElementById(a))}for(var r in i)if("function"!=typeof i[r]){var s=i[r];t.__hide_dom(document.getElementById(s))}},d.prototype.__SPI_whenRendered=function(e){olark("api.chat.onReady",e)},d.prototype.__SPI_hideForDuration=function(e){this.hide(),o.trigger_event({namespace:"box",type:"hideForDuration",duration:e})},d.prototype.__SPI_onHideForDuration=function(e){o.listen_for_event({namespace:"box",type:"hideForDuration",callback:e})},d.prototype.__SPI_hideBoxForThisPageOnly=function(){this.__SPI_whenRendered(function(){o.run_legacy_code(function(e){try{e.habla_window.theme.habla_window_div.style.visibility="hidden"}catch(t){n.warn("[olark] unable to hide the chatbox for this page",t)}})})},d.prototype.__SPI_setThemeTextField=function(e,t){t&&olark("api.chat.onReady",function(){o.run_legacy_code(function(n){var i=n.habla_window.theme[e];i.has_typed=!0,i.value=t})})},d.prototype.__setup_popout_behavior=function(){var e=this;window.onbeforeunload=function(){return!1};var t=function(){var t=r,n=a;parseInt(navigator.appVersion,10)>3&&(-1!=navigator.appName.indexOf("Microsoft")?(t=document.body.offsetWidth,n=document.body.offsetHeight):(t=window.innerWidth,n=window.innerHeight)),t&&n&&e.__SPI_whenRendered(function(){o.run_legacy_code(function(e){e.habla_window.config.setHeight(parseInt(n,10)-85),e.habla_window.setHeight(parseInt(n,10)-85),e.habla_window.setWidth(parseInt(t,10))})})};t(),window.onresize=t},d.prototype.__initialize_legacy_event_handlers=function(){function e(){habla_window.theme.habla_wcsend_input.disabled=!0,habla_window.theme.habla_wcsend_input.style.display="none",habla_window.theme.habla_wcsend_input.has_typed&&(habla_window.theme.habla_offline_body_input.value=habla_window.theme.habla_wcsend_input.value)}function t(){habla_window.theme.habla_wcsend_input.disabled=!1,habla_window.theme.habla_wcsend_input.style.display="block",habla_window.theme.habla_offline_body_input.has_typed&&(habla_window.theme.habla_wcsend_input.value=habla_window.theme.habla_offline_body_input.value)}var n=this;c||(c=!0,n.__chat_api.onOperatorsAway(e),n.__chat_api.onOperatorsBusy(e),n.__chat_api.onOperatorsAvailable(t),n.__SPI_whenRendered(function(){olark._.P("box")}),hbl.eventmgr.register("chat_loaded",function(){l=!0},0),hbl.eventmgr.register("habla_window_changed",function(e){if(l)switch(e.type){case"popout":o.trigger_event({namespace:"box",type:"popout"});break;case"endpop_out":o.trigger_event({namespace:"box",type:"popin"});break;case"show":_||(_=!0,o.trigger_event({namespace:"box",type:"show"}));break;case"hide":_=!1,o.trigger_event({namespace:"box",type:"hide"});break;case"compress":s=!1,o.trigger_event({namespace:"box",type:"shrink"});break;case"expand":s||(s=!0,o.trigger_event({namespace:"box",type:"expand"}))}},0),hbl.eventmgr.register("habla_closebutton_a_onclick",function(){o.trigger_event({namespace:"box",type:"dismiss"})},0))},d.prototype.__populate_message_history_from_chat_api=function(){var e=this;e.__SPI_whenRendered(function(){var t=e.__chat_api.__SPI_getMessageHistory(),n=0;for(t.length>0&&o.run_legacy_code(function(e){e.habla_window.theme.setBody("")});n<t.length;){var i=t[n++],a=i.nickname||"you",r=i.body;o.run_legacy_code(function(e){/^\s+$/.test(r)||e.habla_window.theme.appendNiceMessage(a,r,!0,!0)})}var s=function(){var e=window.habla_window.theme.habla_conversation_div;e.scrollHeight?e.scrollTop=e.scrollHeight:setTimeout(s,100)};s()})},d.prototype.__setup_chat_history_handling=function(){var e=this;u||(u=!0,e.__chat_api.onReady(function(){e.__populate_message_history_from_chat_api(),e.__chat_api.__SPI_populatedLocalChatHistoryFromRpcServer()&&e.expand()}),e.__chat_api.__SPI_onDeliveryOfMessageFromVisitor(function(e){o.run_legacy_code(function(t){var n=t.hbl.config.vars.myname||"you";t.habla_window.theme.appendNiceMessage(n,e.message.body,!0,!0)})}),e.__chat_api.__SPI_onDeliveryOfMessageFromOperator(function(e){o.run_legacy_code(function(t){t.habla_window.theme.appendNiceMessage(e.message.nickname,e.message.body,!0,!0)})}))},olark.declare({name:"__BoxApiHelper",startup:function(e,t){var n=e.data.getConversationObject({key:"visible",initialValue:t.box.start_hidden?!1:null}),i=e.data.getConversationObject({key:"state",initialValue:null}),a=e.data.getConversationObject({key:"close_hides_window",initialValue:!1}),r=e.data.getConversationObject({key:"hidden_for_visit",initialValue:!1}),s=e.data.getVisitorObject({key:"hidden_for_visitor",initialValue:!1}),_=e.data.getConversationObject({key:"auto_messages",initialValue:[]}),l=function(){window.olark.__legacy_shim.box_visible=n.get(),window.olark.__legacy_shim.box_state=i.get()},c=!t.system.hide_not_available||t.system.offline_msg_mode;c||e.chat.onOperatorsAway(function(){e.visitor.getDetails(function(t){t.isConversing||e.box.hide()})});var u=a.get()===!0&&"closed"===i.get()||r.get()===!0||s.get()===!0;u&&(e.box.hide(),l()),e.chat.onReady(function(){o.run_legacy_code(function(e){a.set(e.hbl.config.vars.close_hides_window?!0:!1)})}),e.box.onDismiss(function(){n.set(!1),i.set("closed"),l()}),e.box.onExpand(function(){n.set(!0),i.set("expanded"),l()}),e.box.onShrink(function(){n.set(!0),i.set("compressed"),l()}),e.box.onOverlay(function(){n.set(!0),l()}),e.box.onPopout(function(){n.set(!1),i.set("closed"),l()}),e.box.onHide(function(){n.set(!1),l()}),e.chat.onOperatorsAway(function(){t.system.hide_when_offline&&e.box.hide()}),e.chat.onOperatorsAvailable(function(){t.system.hide_when_offline&&e.box.show()}),e.box.__SPI_onInline(function(){n.set(!0),l()}),e.box.__SPI_onHideForDuration(function(e){var t=e.duration;t.forVisit?r.set(!0):t.forVisitor&&s.set(!0),n.set(!1),i.set("closed"),l()});var d=function(){r.set(!1),s.set(!1)};e.box.__SPI_whenRendered(function(){e.box.onShow(d),e.box.onExpand(d),e.box.onPopout(d),e.box.onOverlay(d)}),l(),e.chat.onMessageToVisitor(function(){e.box.expand()}),e.chat.onOperatorsAvailable(function(){e.box.__SPI_showMessageHistory()}),window.olark.__legacy_shim.populate_message_history_from_chat_api=function(){e.box.__populate_message_history_from_chat_api()},e.box.__SPI_onPrechatWelcomeMessage(function(e){var t=_.get();t.push(e.body),_.set(t)}),e.chat.onBeginConversation(function(t){var n=_.get().slice(0);n.length>0&&"visitor_msg"==t.__spi_message_type&&e.chat.sendNotificationToOperator({body:["visitor is replying to these automated messages:","  >> "+n.join("\n  >> ")].join("\n")})})}}),olark.extend("__BoxApiHelper"),t.exports=d},{"./corehelpers":28,"./data":29,"./logger":33}],9:[function(e,t){function n(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}function i(){return l=l||new o.StorejsKeyStore,{getItem:function(e){var t=l.get({key:_})||{};return t[e]||null},setItem:function(e,t){var n=l.get({key:_})||{};n[e]=t,l.set({key:_,value:n,link_to_conversation:!0})}}}var o=e("./data"),a=e("./corehelpers"),r=function(e){a.listen_for_event({namespace:"core",type:"extensionsActivated",callback:e})},s={encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var i=e.charCodeAt(n);128>i?t+=String.fromCharCode(i):i>127&&2048>i?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t},decode:function(e){var t,n,i,o,a="",r=0;for(t=n=i=0;r<e.length;)t=e.charCodeAt(r),128>t?(a+=String.fromCharCode(t),r++):t>191&&224>t?(i=e.charCodeAt(r+1),a+=String.fromCharCode((31&t)<<6|63&i),r+=2):(i=e.charCodeAt(r+1),o=e.charCodeAt(r+2),a+=String.fromCharCode((15&t)<<12|(63&i)<<6|63&o),r+=3);return a}},_="sessconn",l=null,c=!1,u=function(e){var t=this;if(t.__namespace=e.namespace,t.__conf=e.conf,"undefined"==typeof t.__namespace)throw new Error("'namespace' required");var o=function(){var e=i().getItem("BrowserApi::last_page_visited"),t=olark._.overrideWindowHref||document.location.href.toString();e!==t&&(a.trigger_event({namespace:"BrowserApi",type:"locationChange",previousUrl:e,currentUrl:t}),i().setItem("BrowserApi::last_page_visited",t))};if(!c){if(c=!0,r(o),t.__conf.system.hashchange_events_trigger_page_change)try{n(window,"hashchange",o)}catch(s){}var _=window.history&&window.history.pushState;if(t.__conf.system.history_events_trigger_page_change!==!1&&_)try{var l=window.history.pushState;window.history.pushState=function(){l.apply(window.history,arguments),a.trigger_event({namespace:"BrowserApi",type:"pushstateChanged"})};var u=window.history.replaceState;window.history.replaceState=function(){u.apply(window.history,arguments),a.trigger_event({namespace:"BrowserApi",type:"pushstateChanged"})},a.listen_for_event({namespace:"BrowserApi",type:"pushstateChanged",callback:o}),n(window.history,"popstate",o)}catch(s){}}};u.prototype.onPageChange=function(e){a.listen_for_event({namespace:"BrowserApi",type:"locationChange",callback:function(t){e({newPage:t.currentUrl,oldPage:t.previousUrl})}})},u.prototype.__SPI_getSafeUrl=function(e){return/webkit/.test(navigator.userAgent.toString().toLowerCase())&&(e=s.decode(unescape(e))),e.replace(/ /g,"%20")},t.exports=u},{"./corehelpers":28,"./data":29}],10:[function(e,t){var n,i;i=e("bowser"),n=function(){function e(e){var t;this._browser=(null!=e?e.browser:void 0)||i.browser,this._browser.userAgent=e.userAgent,this._browser.needsSubmit=(null!=e?e.needsSubmit:void 0)||(null!=(t=this._browser.userAgent)?t.toLowerCase().indexOf("wii"):void 0)>-1,this._browser.compatMode=(null!=e?e.compatMode:void 0)||!1}return e.prototype.getBrowser=function(){return this._browser},e.prototype.isMobile=function(){return null!=this._browser.mobile||null!=this._browser.tablet},e.prototype.isTablet=function(){return null!=this._browser.tablet},e.prototype.getVersion=function(){return this._browser.version||"Unknown"},e.prototype.getTridentVersion=function(){var e,t;return e=null!=(t=this._browser.userAgent)?t.match(/Trident\/(\d+)/):void 0,e?e[1]:!1},e.prototype.getBrowserName=function(){return this._browser.name||"Unknown"},e.prototype.getMobileOS=function(){return this.isMobile()?null!=this._browser.ios?"iOS":null!=this._browser.android?"Android":null!=this._browser.blackberry?"Blackberry":null!=this._browser.firefoxos?"Firefox":null!=this._browser.webos?"WebOS":null!=this._browser.bada?"Bada":null!=this._browser.tizen?"Tizen":null!=this._browser.sailfish?"Sailfish":null!=this._browser.windowsphone?"Windows Phone":"Other":!1},e.prototype.getOSVersion=function(){return this._browser.osversion},e.prototype.isCompatMode=function(){return"BackCompat"===this._browser.compatMode},e.prototype.maxHeightIsSet=function(){var e;return"undefined"!=typeof(null!=(e=document.body)?e.style.maxHeight:void 0)},e.prototype.shouldUsePositionAbsolute=function(){return this._browser.msie?this.getVersion>=10||this.getTridentVersion()>=6||(this.getVersion>=7||this.maxHeightIsSet())&&!this.isCompatMode()?!1:!0:!1},e.prototype.needsSubmitButton=function(){return this._browser.needsSubmit},e}(),t.exports=n},{bowser:1}],11:[function(e,t){function n(e){function t(e){var t=typeof e;return"object"===t&&(e?"number"!=typeof e.length||e.propertyIsEnumerable("length")||"function"!=typeof e.splice||(t="array"):t="null"),t}return"array"==t(e)}var i=e("json3"),o=e("./logger"),a=e("./corehelpers"),r=e("./legacyglobals"),s=e("./data"),_=e("./ExtensionManager"),l=.25,c=/^\s*\!\s*([^\s]+)\s*((.*)\s*)?/,u=1001,d=9999,h=250,p=260,f=270,g=300,m="INTERNAL_NOTIFICATION",v=1e3,b=3e3,y=120,w=600,k=["VisitorInsight","Shopify","CartSaver"],x=" | ",S="\n| ",C=!1,I=!1,T=!1,E=null,P=!1,O=!1,A=!1,M=!1,N={},B=function(e){_.get_instance().for_each_extension_spec(function(t){e(t.get_name())})},F=function(){var e=this;e.__message_sending_failsafe_timeout=null,e.__nickname_update_pending=!1,e.__status_update_pending=!1,e.__message_queue=[],e.__notification_queue=[],e.__keystore=new s.StorejsKeyStore,e.__connection_wrapper=null,e.__all_extensions_have_run_their_startup_method=!1,e.__sync_pipeline=[],e.__sync_pipeline_is_draining=!1};!function(e){var t=null;F.get_instance=function(){return t||(t=new F),t};var n=!1,r=function(e){n?e():a.listen_for_event({namespace:"SessionConnection",type:"afterReady",callback:function(){n=!0,e()}})};e.get_local_data=function(e){var t=this;return t.__local_get(e)},e.put_local_data=function(e){var t=this;return t.__local_set(e)},e.send_message=function(e){var t=this;if("undefined"==typeof e.body)throw new Error("[olark] 'body' required");t.__message_queue.push(e.body),1==t.__message_queue.length&&a.do_async_call({delay:f},function(){t.__synchronize_with_jabber()})},e.send_notification=function(e){var t=this;if("undefined"==typeof e.body)throw new Error("[olark] 'body' required");t.__notification_queue.push(e.body),1==t.__notification_queue.length&&a.do_async_call({delay:g},function(){t.__synchronize_with_jabber()})},e.update_nickname_for_extension=function(e){var t=this;if("undefined"==typeof e.extension_name)throw new Error("[olark] 'extension_name' required");if("undefined"==typeof e.snippet)throw new Error("[olark] 'snippet' required");var n=e.extension_name,i=e.snippet,o=e.hides_default_nickname,a=t.__local_get({key:"nickname_lookup"})||{};a[n]={snippet:i,hides_default_nickname:o,secureTimestamp:e.secureTimestamp,secureSignature:e.secureSignature},t.__local_set({key:"nickname_lookup",value:a}),t.__mark_nickname_update_pending()},e.__mark_nickname_update_pending=function(e){var t=this;t.__nickname_update_pending||(t.__nickname_update_pending=!0,a.do_async_call({delay:h},function(){t.__synchronize_with_jabber(e)})),t.__mark_status_update_pending(!0)},e.update_status_for_extension=function(e){var t=this;if("undefined"==typeof e.extension_name)throw new Error("[olark] 'extension_name' required");if("undefined"==typeof e.snippet)throw new Error("[olark] 'snippet' required");var n=t.__local_get({key:"status_lookup"})||{};n[e.extension_name]={snippet:e.snippet,secureTimestamp:e.secureTimestamp,secureSignature:e.secureSignature},t.__local_set({key:"status_lookup",value:n}),t.__mark_status_update_pending()},e.__mark_status_update_pending=function(e){var t=this;t.__status_update_pending||(t.__status_update_pending=!0,a.do_async_call({delay:p},function(){t.__synchronize_with_jabber(void 0,e)}))},e.disconnect=function(){var e=this;a.run_legacy_code(function(t){t.hbl.client.sendcommand&&t.hbl.client.sendcommand("disconnectchat",e.__enableMessageToBeRoutedToGroupIfNecessary(""))})},e.getGroupForThisPage=function(){return this.__groupIdString},e.lockToGroupForThisPage=function(e){var t=this;olark.__legacy_shim.currentGroupIdstring=t.__groupIdString=e},e.unlockFromGroupForThisPage=function(){var e=this;olark.__legacy_shim.currentGroupIdstring=e.__groupIdString={}.undefinedValue},e.__TMP_set_connection_wrapper=function(e){var t=this;t.__connection_wrapper=e,t.__with_open_connection(function(){t.__all_extensions_have_run_their_startup_method=!0,t.__synchronize_with_jabber()})},e.__TMP_get_current_combined_nickname=function(){var e=this,t=e.__local_get({key:"nickname_lookup"})||{},n=[],o=!0,a=function(e){return{v:e.snippet,t:e.secureTimestamp,s:e.secureSignature}};return B(function(e){var i=t[e],r=function(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return!0;return!1},s=function(t){r(k,e)?n.unshift(t):n.push(t)};i&&"function"!=typeof i&&i.snippet&&i.snippet.length>0&&(i.hides_default_nickname&&(o=!1),s(a(i)))}),(o||0===n.length)&&n.push(a({snippet:e.__get_default_nickname_snippet()})),i.stringify(n)},e.__TMP_get_current_combined_status=function(){var e=this,t=e.__local_get({key:"status_lookup"})||{},n=[],a=function(e){return{v:e.snippet,t:e.secureTimestamp,s:e.secureSignature}};return B(function(e){try{var i=t[e];i&&"function"!=typeof i&&n.unshift(a(i))}catch(r){o.error("[olark] problem setting status: "+r.toString()),o.showErrorBacktrace(r)}}),0===n.length&&(n=[{v:"There is no status information available right now.\n Add custom information using the Javascript API (www.olark.com/docs)."}]),n.unshift({v:"{{nickname}}"}),i.stringify(n)},e.__enableMessageToBeRoutedToGroupIfNecessary=function(e){if("string"!=typeof e)throw new Error("[olark] message must be a string");return e},e.__get_default_nickname_snippet=function(){var e=this,t=e.__local_get({key:"default_nickname"})||null;return t||(t="{{geolocation}} #"+Math.floor(1e4*Math.random()).toString(),e.__local_set({key:"default_nickname",value:t})),t},e.__local_get=function(e){var t=this;if("undefined"==typeof e.key)throw new Error("'key' required");var n=t.__keystore.get({key:"sessconn"})||{};return n[e.key]||null},e.__local_set=function(e){var t=this;if("undefined"==typeof e.key)throw new Error("'key' required");var n=t.__keystore.get({key:"sessconn"})||{};n[e.key]=e.value,t.__keystore.set({key:"sessconn",value:n,link_to_conversation:!0})},e.__update_nickname_in_jabber=function(e){var t=this;r(function(){t.__local_set({key:"has_sent_initial_nickname",value:!0}),t.__nickname_update_pending=!1;var n=t.__TMP_get_current_combined_nickname(),i=t.__local_get({key:"previous_nickname"})!=n;t.__local_set({key:"previous_nickname",value:n}),(i||e)&&a.run_legacy_code(function(e){e.hbl.client.setnickname(t.__enableMessageToBeRoutedToGroupIfNecessary(n))})})},e.__update_status_in_jabber=function(e){var t=this;r(function(){t.__local_set({key:"has_sent_initial_status",value:!0}),t.__status_update_pending=!1;var n=t.__TMP_get_current_combined_status(),i=t.__local_get({key:"previous_status"})!=n;t.__local_set({key:"previous_status",value:n}),(i||e)&&a.run_legacy_code(function(e){var i="chat";e.hbl.client.sendpresence(t.__enableMessageToBeRoutedToGroupIfNecessary(n),i)})})};var s=function(e){if("undefined"==typeof e.list)throw new Error("'list' required");for(var t={},n=e.list,i=[],o=0;o<n.length;o++){var a=n[o];t[a]||(t[a]=!0,i.push(a))}return i};e.__dequeue_messages_into_jabber=function(){var e=this;r(function(){var t=e.__message_queue;e.__message_queue=[];var n=s({list:t});n.length!=t.length&&o.warn("[olark] message batch contains",t.length-n.length,"duplicate messages");var i=null;t.length>0&&(i=a.join_string_list({list:n,separator:"\n"})),i&&e.__sendmessage(i,!1)})},e.__dequeue_notifications_into_jabber=function(){var e=this,t=e.__notification_queue;e.__notification_queue=[],a.run_legacy_code(function(){var n=s({list:t});n.length!=t.length&&o.warn("[olark] notification batch contains",t.length-n.length,"duplicate notifications");var i=null;t.length>1?i="[info]\n  - "+a.join_string_list({list:n,separator:"\n  - "}):1==t.length&&(i="[info] "+t[0]),i&&e.__sendmessage(i,!0)})},e.__sendmessage=function(e,t){var n=this,i=n.__local_get({key:"sentmessage"})?!1:!0;a.run_legacy_code(function(o){o.hbl.client.sendmessage(n.__enableMessageToBeRoutedToGroupIfNecessary(e),t?!0:!1,t?!0:{}.undefinedValue,i,n.__TMP_get_current_combined_nickname(),n.__TMP_get_current_combined_status())}),n.__local_set({key:"sentmessage",value:!0})},e.__synchronize_with_jabber=function(e,t){var n=this,i=n.__nickname_update_pending,o=n.__status_update_pending,a=n.__notification_queue.length>0?!0:!1,r=n.__message_queue.length>0?!0:!1,s=n.__local_get({key:"has_sent_initial_nickname"}),_=n.__local_get({key:"has_sent_initial_status"});n.__all_extensions_have_run_their_startup_method&&(s||(i=!0),_||(o=!0));var l=s,c=_;n.__force_nickname_update=n.__force_nickname_update||e,n.__force_status_update=n.__force_status_update||t;var u=n.__sync_pipeline;i&&!n.__nickname_update_queued&&(l=!0,n.__nickname_update_queued=!0,u.push(function(){var e=n.__force_nickname_update;n.__nickname_update_queued=!1,n.__force_nickname_update=!1,n.__update_nickname_in_jabber(e)})),o&&!n.__status_update_queued&&(l?(c=!0,n.__status_update_queued=!0,u.push(function(){var e=n.__force_status_update;n.__status_update_queued=!1,n.__force_status_update=!1,n.__update_status_in_jabber(e)})):n.__trigger_message_sending_failsafe()),a&&(c?u.push(function(){n.__dequeue_notifications_into_jabber()}):n.__trigger_message_sending_failsafe()),r&&(c?u.push(function(){n.__dequeue_messages_into_jabber()}):n.__trigger_message_sending_failsafe()),n.__drain_sync_pipeline()},e.__drain_sync_pipeline=function(){var e=this,t=e.__sync_pipeline,n=function(){if(t.length>0){var i=t.shift();a.try_and_optionally_catch(function(){i()},function(e){o.error("[olark] problem servicing SessionConnection pipeline: "+e.toString()),o.showErrorBacktrace(e)})}t.length>0?a.do_async_call({delay:v},n):e.__sync_pipeline_is_draining=!1};e.__sync_pipeline_is_draining===!1&&(e.__sync_pipeline_is_draining=!0,n())},e.__with_open_connection=function(e){var t=this;t.__connection_wrapper(e)},e.__trigger_message_sending_failsafe=function(){var e=this,t=e.__local_get({key:"has_sent_initial_nickname"}),n=e.__local_get({key:"has_sent_initial_status"});e.__message_sending_failsafe_timeout||(e.__message_sending_failsafe_timeout=a.do_async_call({delay:b},function(){t&&n||(t=!0,n=!0,e.__synchronize_with_jabber())}))}}(F.prototype);var L=function(e){var t=this;if(t.__legacy_message_tuple=e.legacy_message_tuple,"undefined"==typeof t.__legacy_message_tuple)throw new Error("'legacy_message_tuple' required");if("undefined"==typeof e.send_event_type)throw new Error("'send_event_type' required");if("undefined"==typeof e.deliver_event_type)throw new Error("'send_event_type' required");if("undefined"==typeof e.final_delivery_action)throw new Error("'final_delivery_action' required");t.__send_event_type=e.send_event_type,t.__deliver_event_type=e.deliver_event_type,t.__final_delivery_action=e.final_delivery_action,t.__delivered=!1,t.__predelivery_actions=[],t.__new_body=null,t.__SPI_notification=e.__SPI_notification,t.__message_event={namespace:"chat",type:t.__send_event_type,automated:e.is_automated?!0:!1,__SPI_notification:e.__SPI_notification,nickname:t.__legacy_message_tuple[0],body:t.__legacy_message_tuple[1],__legacy_sequence_id:parseFloat(t.__legacy_message_tuple[2]),__SPI_deferMessageDelivery:function(e){t.__predelivery_actions.push(e)},updateBody:function(e){t.__new_body&&o.warn("[olark] two handlers tried to modify the body of the same message, allowing the second one to override"),t.__new_body=e}},t.__original_body=a.clone_object(t.__message_event.body)};!function(e){e.get_processed_body=function(){var e=this;return e.__new_body||e.__message_event.body},e.send=function(){var e=this;a.trigger_event(e.__message_event)},e.deliver=function(){for(var e=this,t=[],n=function(){t[i]=!0;for(var n=t.length,o=!0;n--;)t[n]||(o=!1);o&&e.__trigger_delivery()},i=e.__predelivery_actions.length;i--;)t.push(!1);for(i=e.__predelivery_actions.length,a.listen_for_event({namespace:"chat::Message",type:"doneDeferringMessageDelivery",callback:n});i--;)!function(e,n){n({deliverMessage:function(){t[e]=!0,a.trigger_event({namespace:"chat::Message",type:"doneDeferringMessageDelivery"})}})}(i,e.__predelivery_actions[i]);n()},e.__trigger_delivery=function(){var e=this;e.__delivered||(e.__delivered=!0,e.__original_body!=e.__message_event.body&&o.warn("[olark] you cannot modify the 'body' attribute of messages directly, please use message.updateBody() to modify the body"),a.trigger_event({namespace:"chat",type:e.__deliver_event_type,automated:e.__message_event.automated,nickname:e.__message_event.nickname,body:e.get_processed_body(),__legacy_sequence_id:parseFloat(e.__message_event.__legacy_sequence_id)}),e.__final_delivery_action())}}(L.prototype);var j=function(e){function t(e){return"true"==e?!0:!1}function n(e){return"null"==e?null:e}var i=this;if(i.__conf=e.conf,"undefined"==typeof i.__conf)throw new Error("'conf' required");if(i.__extension_name=e.extension_name,"undefined"==typeof i.__extension_name)throw new Error("'extension_name' required");i.__data=new s.DataApi({namespace:"__chatd"}),i.__last_incr_seq_id=i.__data.getConversationObject({key:"last_incr_seq_id",initialValue:0,backup:"cd1",backupTransform:parseFloat}),i.__last_leg_seq_id=i.__data.getConversationObject({key:"last_leg_seq_id",initialValue:0,backup:"cd2",backupTransform:parseFloat}),i.__is_conversing=i.__data.getConversationObject({key:"is_conversing",initialValue:!1,backup:"cd3",backupTransform:t}),i.__hasconnected=i.__data.getConversationObject({key:"hasconnected",initialValue:!1,backup:"cd4",backupTransform:t}),i.__data_history=i.__data.getConversationObject({key:"data_history",initialValue:!1}),i.__last_op_presence=i.__data.getConversationObject({key:"last_op_presence",initialValue:"away",backup:"cd5",backupTransform:n}),i.__last_cmd_seq_id=i.__data.getConversationObject({key:"last_cmd_seq_id",initialValue:0,backup:"cd6",backupTransform:parseFloat}),i.__last_presence=i.__data.getConversationObject({key:"last_presence",initialValue:"chat",backup:"cd8",backupTransform:n}),i.__is_connection_upgraded=i.__data.getConversationObject({key:"is_connection_upgraded",initialValue:!1}),i.__is_ended=i.__data.getConversationObject({key:"is_ended",initialValue:!1}),i.__next_conversation_id=i.__data.getConversationObject({key:"next_conversation_id",initialValue:null}),i.__needsToDoPrechat=i.__data.getConversationObject({key:"needs_prechat",initialValue:null}),i.__SPI_onPrechatInfoReceived(function(){i.__needsToDoPrechat.set(!1)
}),i.onReady(function(){null===i.__needsToDoPrechat.get()&&i.__needsToDoPrechat.set(hbl.config.vars.show_pre_chat?!0:!1)}),i.onBeginConversation(function(){i.__needsToDoPrechat.set(!1)}),i.__initialize_legacy_connection_and_messaging_handlers(),i.__initialize_legacy_history_tracking(),i.__initialize_conversation_tracking(),i.__has_local_history=!0,i.__conversation_message_history=[],i.__session_connection=F.get_instance(),i.__session_connection.__TMP_set_connection_wrapper(function(e){i.__wait_for_chat_to_connect(e)})};!function(){var e=j.prototype;j.prototype.listen=function(e,t){o.warn("[olark] api.chat.listen is deprecated, please use api.chat.on<METHOD> instead"),a.listen_for_event({namespace:"chat",type:e,callback:t})},e.onMessageFromVisitor=function(e){var t=this;return o.warn("[olark] api.chat.onMessageFromVisitor is deprecated, please use api.chat.onMessageToOperator instead"),t.onMessageToOperator(e)},e.onMessageFromOperator=function(e){var t=this;return o.warn("[olark] api.chat.onMessageFromOperator is deprecated, please use api.chat.onMessageToVisitor instead"),t.onMessageToVisitor(e)},e.getNickname=function(){var e=this;return o.warn("[olark] api.chat.getNickname is deprecated, please use api.chat.getVisitorNickname instead"),e.getVisitorNickname()},e.sendAutomatedMessageToVisitor=function(e){var t=this;return o.warn("[olark] api.chat.sendAutomatedMessageToVisitor is deprecated, please use api.chat.sendMessageToVisitor instead"),t.sendMessageToVisitor(e)},e.updateNickname=function(e){var t=this;return o.warn("[olark] api.chat.updateNickname is deprecated, please use api.chat.updateVisitorNickname instead"),t.updateVisitorNickname(e)},e.onConnectComplete=function(e){var t=this;return o.warn("[olark] api.chat.onConnectComplete is deprecated, please use api.chat.onReady instead"),t.onReady(e)}}(),j.prototype.updateVisitorNickname=function(e){e=e||{};var t=this;if(e.nickname&&(e.snippet=e.nickname,o.warn("[olark] giving 'nickname' as an argument to updateVisitorNickname is now deprecated, use 'snippet' instead")),"string"==typeof e&&(e={snippet:e}),"undefined"==typeof e.snippet)return o.warn("[olark] 'snippet' required"),!1;if(n(e.snippet)){if(e.secureTimestamp||e.secureSignature)throw new Error("[olark] you cannot give a list of snippets and also security information, please join the snippets yourself before signing them");e.snippet=e.snippet.join(x)}t.__session_connection.update_nickname_for_extension({extension_name:e.source||t.__extension_name,snippet:e.snippet,hides_default_nickname:e.hidesDefault?!0:!1,secureTimestamp:e.secureTimestamp,secureSignature:e.secureSignature})},j.prototype.getVisitorNickname=function(e){e=e||{};var t=this;e.other&&o.warn("[olark] giving 'other' as an argument to getVisitorNickname is now deprecated, this method only returns the entire nickname"),e.combined&&o.warn("[olark] giving 'combined' as an argument to getVisitorNickname is now deprecated, this method only returns the entire nickname");for(var n=t.__session_connection.__TMP_get_current_combined_nickname(),a=i.parse(n),r=[],s=0;s<a.length;s++)r.push(a[s].v);return r.length?r.join(x):null},j.prototype.updateVisitorStatus=function(e){e=e||{};var t=this;if(e.status&&(e.snippet=e.status,o.warn("[olark] giving 'status' as an argument to updateVisitorStatus is now deprecated, use 'snippet' instead")),"string"==typeof e&&(e={snippet:e}),"undefined"==typeof e.snippet)throw new Error("[olark] 'snippet' required");if(n(e.snippet)){if(e.secureTimestamp||e.secureSignature)throw new Error("[olark] you cannot give a list of snippets and also security information, please join the snippets yourself before signing them");e.snippet=e.snippet.join(S)}t.__session_connection.update_status_for_extension({extension_name:t.__extension_name,snippet:e.snippet,secureTimestamp:e.secureTimestamp,secureSignature:e.secureSignature})},j.prototype.getVisitorStatus=function(e){e=e||{};var t=this;e.other&&o.warn("[olark] giving 'other' as an argument to getVisitorStatus is now deprecated, this method only returns the entire status"),e.combined&&o.warn("[olark] giving 'combined' as an argument to getVisitorStatus is now deprecated, this method only returns the entire status");for(var n=t.__session_connection.__TMP_get_current_combined_status(),a=i.parse(n),r=[],s=0;s<a.length;s++)r.push(a[s].v);return r.length?r.join(S):null},j.prototype.sendNotificationToOperator=function(e){var t=this,n=null;if(n="string"==typeof e?e:e.body,!n)throw new Error("body required");t.__wait_for_chat_to_connect(function(){a.trigger_event({namespace:"chat",type:"notificationToOperator",body:n,after:function(){t.__session_connection.send_notification({body:n})}})})},j.prototype.sendMessageFromVisitor=function(e){var t=this,n=null;if(n="string"==typeof e?e:e.body,!n)throw new Error("body required");t.__wait_for_chat_to_connect(function(){a.trigger_event({namespace:"chat",type:"messageFromVisitor",body:n,after:function(){t.__session_connection.send_message({body:n})}})})},j.prototype.onNotificationToOperator=function(e){a.listen_for_event({namespace:"chat",type:"notificationToOperator",callback:function(t){e({notification:{body:t.body}})}})},j.prototype.sendNotificationToVisitor=function(e){var t=this;t.sendMessageToVisitor({nickname:m,body:e.body,__SPI_notification:!0})},j.prototype.__SPI_sendInterfaceElementToVisitor=function(e){var t=this,n=m+"-"+t.__extension_name+"-"+e.key;t.sendMessageToVisitor({nickname:n,body:"...",__SPI_notification:!0})},j.prototype.__SPI_onInterfaceElementReady=function(e){var t=this;a.listen_for_event({namespace:"chat",type:"interfaceElementReady",callback:function(n){n.extensionName===t.__extension_name&&e({key:n.key,dom:n.dom})}})},j.prototype.__get_next_message_sequence_id_that_is_server_safe=function(){var e=this,t=e.__last_leg_seq_id.get(),n=parseFloat(t),i=e.__last_incr_seq_id.get(),o=parseFloat(i),a=null;return t!=n&&(olark._.hlog("last_legacy_sequence_id was not a float:",t,"#non_int_legseq_id #warn"),t=n||0),i!=o&&(olark._.hlog("last_incremented_sequence_id was not a float:",i,"#non_int_incrseq_id #warn"),i=o||0),a=t>=i?t+l:i+l,e.__last_incr_seq_id.set(a),a},j.prototype.onNotificationToVisitor=function(e){a.listen_for_event({namespace:"chat",type:"messageFromOperator",callback:function(t){t.nickname==m&&e({notification:{body:t.body}})}})},j.prototype.sendMessageToVisitor=function(e){var t=this,n=e.nickname,i=e.body,o=e.skipPrechatSurvey?!0:!1;if(!i)throw new Error("body required");var r=e.automated===!1?!1:!0;o||t.__needsToDoPrechat.get()!==!0?t.__wait_for_chat_to_connect(function(){a.run_legacy_code(function(o){n||(n=o.hbl.client.current_operator()||" "),t.__send_and_deliver_message_from_operator({legacy_message_tuple:[n,i,t.__get_next_message_sequence_id_that_is_server_safe()],is_automated:r,__SPI_notification:e.__SPI_notification})})}):olark("api.box.__SPI_setPrechatWelcomeMessage",i)},j.prototype.onMessageToVisitor=function(e){a.listen_for_event({namespace:"chat",type:"messageFromOperator",callback:function(t){e({message:{nickname:t.nickname,body:t.body,updateBody:function(e){t.updateBody(e)},__SPI_deferMessageDelivery:function(e){t.__SPI_deferMessageDelivery(e)},automated:t.automated,__SPI_notification:t.__SPI_notification}})}})},j.prototype.onMessageToOperator=function(e){a.listen_for_event({namespace:"chat",type:"messageFromVisitor",callback:function(t){e({message:{nickname:t.nickname,body:t.body,updateBody:function(e){t.updateBody(e)},__SPI_deferMessageDelivery:function(e){t.__SPI_deferMessageDelivery(e)}}})}})},j.prototype.onOfflineMessageToOperator=function(e){a.listen_for_event({namespace:"chat",type:"offlineMessageToOperator",callback:function(t){e({message:{nickname:t.message.nickname,body:t.message.body}})}})},j.prototype.onCommandFromOperator=function(e){a.listen_for_event({namespace:"chat",type:"commandFromOperator",callback:function(t){e({command:{name:t.name,body:t.body,nickname:t.nickname}})}})},j.prototype.__SPI_onDeliveryOfMessageFromVisitor=function(e){a.listen_for_event({namespace:"chat",type:"deliveryOfMessageFromVisitor",callback:function(t){e({__legacy_sequence_id:parseFloat(t.__legacy_sequence_id),message:{nickname:t.nickname,body:t.body}})}})},j.prototype.__SPI_onDeliveryOfMessageFromOperator=function(e){a.listen_for_event({namespace:"chat",type:"deliveryOfMessageFromOperator",callback:function(t){e({__legacy_sequence_id:parseFloat(t.__legacy_sequence_id),message:{nickname:t.nickname,body:t.body}})}})},j.prototype.operatorsAreAvailable=function(){return"available"==E},j.prototype.onOperatorsAvailable=function(e){a.listen_for_event({namespace:"chat",type:"operatorsAvailable",callback:e})},j.prototype.operatorsAreBusy=function(){return"busy"==E},j.prototype.onOperatorsBusy=function(e){a.listen_for_event({namespace:"chat",type:"operatorsBusy",callback:e})},j.prototype.operatorsAreAway=function(){return"away"==E},j.prototype.onOperatorsAway=function(e){a.listen_for_event({namespace:"chat",type:"operatorsAway",callback:e})},j.prototype.__SPI_onConnectBegin=function(e){a.listen_for_event({namespace:"chat",type:"connectBegin",callback:e})},j.prototype.setOperatorGroup=function(e){this.__SPI_lockToOperatorGroup(e.group||e),a.trigger_event({namespace:"chat",type:"operatorGroupChanging"}),this.onReady(function(){hbl.client.eventmgr.register("handled_nrpc_response",function(){a.trigger_event({namespace:"chat",type:"operatorGroupChanged"}),hbl.client.eventmgr.unregister_all("handled_nrpc_response")}),hbl.client.sendcommand("return_long_poll_now","")})},j.prototype.__SPI_onOperatorGroupChanging=function(e){a.listen_for_event({namespace:"chat",type:"operatorGroupChanging",callback:e})},j.prototype.__SPI_onOperatorGroupChanged=function(e){a.listen_for_event({namespace:"chat",type:"operatorGroupChanged",callback:e})},j.prototype.__SPI_lockToOperatorGroup=function(e){olark._.cookieManager.setAllowingNullAndUndefinedAndEmptyString("_okgid",e),this.__session_connection.lockToGroupForThisPage(e)},j.prototype.__SPI_lockToExistingOperatorGroupIfGiven=function(e){var t=olark._.cookieManager.getAllowingNullAndUndefinedAndEmptyString("_okgid");this.__session_connection.lockToGroupForThisPage(t||null===t?t:e)},j.prototype.__SPI_unlockFromCurrentGroup=function(){olark._.cookieManager.erase("_okgid"),this.__session_connection.unlockFromGroupForThisPage()},j.prototype.onReady=function(e){this.__wait_for_chat_to_connect(e)},j.prototype.whenDataReady=function(e){P?e():a.listen_for_event({namespace:"chat",type:"dataReady",callback:e})},j.prototype.connect=function(){var e=this;e.__SPI_connectToRpcServers()},j.prototype.__SPI_onConnectFailure=function(e){a.listen_for_event({namespace:"chat",type:"connectFailure",callback:e})},j.prototype.__wait_for_chat_to_connect=function(e){if(I)e();else{var t=a.create_idempotent_callback(e);a.listen_for_event({namespace:"chat",type:"onReady",callback:t})}},j.prototype.__SPI_visitorIsAvailable=function(){var e=this,t=e.__last_presence.get();return"chat"==t},j.prototype.__SPI_visitorIsBusy=function(){var e=this,t=e.__last_presence.get();return"dnd"==t},j.prototype.__SPI_visitorIsAway=function(){var e=this,t=e.__last_presence.get();return"away"==t},j.prototype.__SPI_isConversing=function(){var e=this;return e.__is_conversing.get()===!0?!0:!1},j.prototype.__SPI_beginConversation=function(e){var t=this;t.__is_conversing.get()!==!0&&(t.__is_conversing.set(!0),a.trigger_event({namespace:"chat",type:"beginConversation",__spi_message_type:e}))},j.prototype.__SPI_onConversationBegin=function(e){a.listen_for_event({namespace:"chat",type:"beginConversation",callback:e})},j.prototype.__SPI_endConversation=function(){var e=this;e.__is_conversing.set(!1)},j.prototype.__SPI_onConversationEnd=function(e){a.listen_for_event({namespace:"chat",type:"endConversation",callback:e})},j.prototype.__SPI_onEndedStateChanged=function(e){var t=this;a.listen_for_event({namespace:"chat",type:"endedStateChange",callback:function(){t.__SPI_getEndedState(e)}})},j.prototype.__SPI_getEndedState=function(e){e({is_ended:this.__is_ended.get(),next_conversation_id:this.__next_conversation_id.get(),is_conversing:this.__SPI_isConversing()})},j.prototype.onBeginConversation=function(e){a.listen_for_event({namespace:"chat",type:"beginConversation",callback:e})},j.prototype.__initialize_conversation_tracking=function(){var e=this;e.onMessageToOperator(function(t){t.message.__SPI_notification!==!0&&e.__SPI_beginConversation("visitor_msg")}),e.onMessageToVisitor(function(t){t.message.__SPI_notification!==!0&&e.__SPI_beginConversation("operator_msg")})},j.prototype.__SPI_getConversationUUID=function(){return olark._.identityManager.getConversationId()},j.prototype.__SPI_getVisitorUUID=function(){return olark._.identityManager.getVisitorId()},j.prototype.__SPI_getLegacyConfig=function(){return a.run_legacy_code(function(e){return e.hbl.config})},j.prototype.__SPI_queryCurrentGroup=function(e){e({group:this.__session_connection.getGroupForThisPage()})},j.prototype.__SPI_disableEventConnection=function(){M=!0},j.prototype.__SPI_enableEventConnection=function(){M=!1},j.prototype.__SPI_getLegacySiteId=function(){return olark._.identityManager.getSiteId()},j.prototype.__SPI_sendRawMessageToVisitor=function(e){var t=this,n=e.body,i=e.nickname,o=[i,n,t.__get_next_message_sequence_id_that_is_server_safe()];a.run_legacy_code(function(e){e.hbl.client.incoming_pipeline.run(o)})},j.prototype.__SPI_sendRawMessageToOperator=function(e){var t=this,n=e.body;t.__send_and_deliver_message_from_visitor({legacy_message_tuple:[null,n,0]})},j.prototype.__handleHighTrafficConfiguration=function(e){var t=this;if(t.__is_connection_upgraded.get()!==!0&&e.system&&e.system.forced_polling_in_seconds_when_online_but_not_chatting){var n=e.system.forced_polling_in_seconds_when_online_but_not_chatting,i=hbl.client.pollingmanager.getMinAvailablePollTime();hbl.client.pollingmanager.setMinAvailablePollTime(1e3*n);var o=function(){t.__is_connection_upgraded.get()||(t.__is_connection_upgraded.set(!0),hbl.client.pollingmanager.setMinAvailablePollTime(i),hbl.client.pollingmanager.startNextPollNow())};hbl.eventmgr.register("habla_window_changed",function(e){"expand"===e.type&&o()}),olark("api.box.onExpand",o)}},j.prototype.__SPI_connectToRpcServers=function(e){e=e||{};var t=this,n=t.__conf;if(T!==!0)if(T=!0,t.__hasconnected.set(!0),olark._.P("getconnection"),t.onReady(function(){olark._.P("connection")}),M);else{r.hblJavaScriptVersion="api-1.2.1",r.hbl_hostname=n.system.legacy_rpc_server||r.hbl_hostname||"olark.com/rpc",hbl.config=wc_config();var i=hbl.config;i.vars.no_system_messages=!0,i.vars.disable_rpc_state=!0,"chatting"==n.system.show_in_buddy_list&&"undefined"==typeof n.system.forced_polling_in_seconds_when_online_but_not_chatting&&(n.system.forced_polling_in_seconds_when_online_but_not_chatting=300),t.__handleHighTrafficConfiguration(n),n.system.path&&(i.vars.cookie_path=n.system.path,i.vars.hbl_cookie_path=n.system.path),n.system.disable_offline_messaging_fallback&&olark._.hlog("used #disable_offline_messaging_fallback flag");for(var a in n.system)"function"!=typeof n.system[a]&&(i.vars[a]=n.system[a]);for(var s in n.box)"function"!=typeof n.box[s]&&(i.vars[s]=n.box[s]);if(/AppleWebKit/.test(navigator.appVersion))for(var _=document.getElementsByTagName("object"),l=0;l<_.length;l++){var c=_[l].data||"";if(/\.swf/.test(c)){i.vars.disable_expand_text_input=!0;break}}var u=function(e,t){return"undefined"==typeof e?t:e};i.vars.top_margin=u(n.box.vertical_offset,i.vars.top_margin),i.vars.bottom_margin=u(n.box.vertical_offset,i.vars.bottom_margin),i.vars.right_margin=u(n.box.horizontal_offset,i.vars.right_margin),i.vars.left_margin=u(n.box.horizontal_offset,i.vars.left_margin);var d=function(e,t){i.vars[e]=t||n.system[e]};if(d("before_chat_text",n.locale.welcome_title||n.box.welcome_title),d("in_chat_text",n.locale.chatting_title),d("not_available_text",n.locale.unavailable_title||n.box.unavailable_title),d("busy_text",n.locale.busy_title),d("away_text",n.locale.unavailable_title),d("offline_message",n.locale.away_message),d("welcome_msg",n.locale.welcome_message||n.box.welcome_message),d("busy_message",n.locale.busy_message),d("say_text",n.locale.chat_input_text),d("habla_name_input_text",n.locale.name_input_text||n.system.field_text_for_name),d("habla_offline_email_text",n.locale.email_input_text||n.system.field_text_for_email),d("habla_offline_phone_text",n.locale.phone_input_text),d("habla_offline_body_text",n.locale.offline_note_message||n.system.field_for_offline_message_body||n.system.information_text_when_offline),d("habla_offline_submit_value",n.locale.send_button_text||n.system.button_text_for_send),d("habla_offline_sent_text",n.locale.offline_note_thankyou_text||n.system.offline_message_thankyou_text),d("email_body_error_text",n.locale.offline_note_error_text||n.system.offline_message_validation_error_text),d("sending_text",n.locale.offline_note_sending_text||n.system.offline_message_sending_text),d("operator_is_typing_text",n.locale.operator_is_typing_text),d("operator_has_stopped_typing_text",n.locale.operator_has_stopped_typing_text),d("pre_chat_error_text",n.locale.introduction_error_text),d("pre_chat_message",n.locale.introduction_messages),d("pre_chat_submit",n.locale.introduction_submit_button_text),d("check_for_status",n.locale.loading_title),d("send_text",n.locale.send_button_text),n.system.always_create_new_session&&(i.vars.disable_set_cookies=!0,i.vars.disable_get_cookies=!0),i.vars.start_passive&&o.warn("[olark] start_passive mode is not enabled in the new Javascript"),i.vars.max_milliseconds_conversation_can_be_idle=i.vars.max_milliseconds_conversation_can_be_idle||olark._.maxMillisecondsConversationCanBeIdle,n.box.inline){i.setInline(1),i.vars.start_expanded="undefined"==typeof n.box.start_expanded?1:n.box.start_expanded,i.vars.enable_buttons=!1;var h=document.getElementById("olark-box-container");h&&(h.id="habla_window_div")}var p=function(){function o(e,t){n.locale[e]=n.locale[e]||t}var a=function(){var e=olark._.identityManager.getSiteId(),i=olark._.cookieManager.get("_ok"),o=t.__SPI_isConversing(),a=n.system.high_priority_site?!0:!1;i?i!=e&&(o&&!a||(hbl.config.vars.disable_get_cookies=!0,olark._.cookieManager.set("_ok",e))):olark._.cookieManager.set("_ok",e)},s=e.__legacy_site_id||t.__conf.system.olark_key;r.hblHasinit=1,hbl.post_started=void 0,s&&olark._.identityManager.setSiteId(s),hbl.config=hbl.config||wc_config();var _=["expand_on_receive_message"];n.Notify&&_.push("incoming_notification"),(n.StatusElements||n.CalloutBubble)&&_.push("away_div_handler"),a(),wc_init_post(_),o("ended_chat_message",i.vars.ended_chat_message),o("in_chat_text",i.vars.in_chat_text)};t.__conf.system.disable_visitor_composing&&(olark.__legacy_shim.disableComposing=!0),C||I?t.__wait_for_chat_to_connect(function(){t.__SPI_disconnect(),p()}):p()}},j.prototype.__get_message_history=function(){var e=this;return e.__data_history.get()||e.__conversation_message_history},j.prototype.__SPI_setMessageHistory=function(e){var t=this;t.__conversation_message_history=e,a.run_legacy_code(function(e){0===e.hbl.client.buffer.length&&(e.hbl.client.buffer=[[null,"",.2]])}),t.__data_history.set(e)},j.prototype.__SPI_disableChatConnection=function(){hbl.util.append_script=function(){},hbl.client.jsonproxy.prototype.do_nrpc_call=function(){}},j.prototype.__SPI_disconnect=function(){var e=this;e.__session_connection.disconnect(),e.__SPI_setMessageHistory([]),r.hblHasinit=void 0,hbl.client.messageq=[],hbl.client.jsonthrottle_locked=!1,olark._.identityManager.deleteConversationId(),hbl.client.pollingmanager.stop(),hbl.client.pollingmanager.reset(),hbl.config=wc_config(),hbl.config.merge({vars:{habla_sizebutton_text_expanded:"_",habla_sizebutton_text_compressed:"^",habla_closebutton_text:"x",habla_popout_text:">",habla_end_popout_text:"&lt;&lt;",corner_position:"BR",bottom_margin:10,right_margin:10,left_margin:10,top_margin:10}}),hbl.config.vars.poll=!0,habla_window.config=hbl.config,habla_window.theme.config=hbl.config,C=!1,I=!1,a.trigger_event({namespace:"chat",type:"disconnect"})},j.prototype.__SPI_getVisitorGeolocation=function(){return N.geolocation||null},j.prototype.__SPI_getVisitorIP=function(){return N.browser_ip||null},j.prototype.__SPI_isPremiumUser=function(){return hbl.client.ssl?!0:!1},j.prototype.__SPI_hasConnectedAlready=function(){var e=this;return e.__hasconnected.get()?!0:!1},j.prototype.__SPI_getLastOperatorPresence=function(e){var t=this;t.whenDataReady(function(){var n=t.__last_op_presence.get();e(n)})},j.prototype.__send_and_deliver_message_from_visitor=function(e){var t=this,n=e.legacy_message_tuple;if("undefined"==typeof n)throw new Error("'legacy_message_tuple' required");n[2]=n[2]||t.__get_next_message_sequence_id_that_is_server_safe();var i=new L({legacy_message_tuple:n,send_event_type:"messageFromVisitor",deliver_event_type:"deliveryOfMessageFromVisitor",final_delivery_action:function(){t.__session_connection.send_message({body:i.get_processed_body()})}});i.send(),i.deliver()},j.prototype.__send_and_deliver_message_from_operator=function(e){var t=this,n=e.legacy_message_tuple,i=e.is_automated,o=n&&n[1]&&/^\s*$/.test(n[1])?!0:!1;if("undefined"==typeof n)throw new Error("'legacy_message_tuple' required");if("undefined"==typeof i)throw new Error("'is_automated' required");if(!o){n[2]=n[2]||t.__get_next_message_sequence_id_that_is_server_safe();var r=new L({legacy_message_tuple:n,is_automated:i,__SPI_notification:e.__SPI_notification,send_event_type:"messageFromOperator",deliver_event_type:"deliveryOfMessageFromOperator",final_delivery_action:function(){a.run_legacy_code(function(e){var t=[n[0],r.get_processed_body(),n[2]];e.hbl.client.append([t])})}});r.send(),r.deliver()}},j.prototype.__determine_presence_from_nrpc_event=function(e){var t=e.opavailable?!0:!1,n=null;if(t)switch(e.status){case"available":case"chat":n="available";break;case"busy":case"dnd":case"offline":case"away":case"xa":n="away";break;default:n="away"}else n="away";return n},j.prototype.__initialize_legacy_connection_and_messaging_handlers=function(){var e=this;if(!A){E=e.__last_op_presence.get()||"away",A=!0,hbl.eventmgr.register("chat_started",function(e){C=!0,a.trigger_event({namespace:"chat",type:"connectBegin"}),N={browser_ip:e.browser_ip,geolocation:e.geolocation}},0),hbl.eventmgr.register("resend_nickname",function(){e.__session_connection.__mark_nickname_update_pending(!0)},0),hbl.eventmgr.register("resend_status",function(){e.__session_connection.__mark_status_update_pending(!0)},0),hbl.eventmgr.register("offlineMessageToOperator",function(e){a.trigger_event({namespace:"chat",type:"offlineMessageToOperator",message:e})});var t=e.__is_ended.get();hbl.eventmgr.register("conversation_ended",function(n){t||(t=!0,e.__is_ended.set(!0),e.__next_conversation_id.set(n.next_conversation_id),a.trigger_event({namespace:"chat",type:"endedStateChange"}))},0),hbl.eventmgr.register("operator_composing",function(t){function n(e){this.composingMessage&&i();var t=document.createElement("p");t.className="habla_conversation_p_item hbl_pal_main_fg",t.innerHTML='<span class="olark-composing-message habla_conversation_person2 hbl_pal_local_fg">'+e+"</span>",t.children&&(t.children[0].style.color="rgb(200,200,200)",this.composingMessage=t,o.appendChild(this.composingMessage)),o.scrollTop=o.scrollHeight}function i(){if(this.composingMessage){clearTimeout(this.composingMessageRemovalTimeout);var e=this.composingMessage.parentNode||this.composingMessage.parent;e&&e.removeChild(this.composingMessage),this.composingMessage=!1}}var o=document.getElementById("habla_conversation_div");this.composingMessage=this.composingMessage||!1,(this.composingMessageRemovalHandlerSet?1:0)||(e.__SPI_onDeliveryOfMessageFromOperator(function(){i()}),this.composingMessageRemovalHandlerSet=!0),e.__SPI_onEndedStateChanged(function(e){e.is_ended&&i()});var a=hbl.config.vars.local_name_override||t.operator_nickname||"operator",r={active:function(){i()},composing:function(){n(a+" "+hbl.config.vars.operator_is_typing_text)},paused:function(){n(a+" "+hbl.config.vars.operator_has_stopped_typing_text),this.composingMessageRemovalTimeout=setTimeout(i,3e4)}};r.hasOwnProperty(t.composing_type)&&(clearTimeout(this.composingMessageRemovalTimeout),r[t.composing_type]())}),hbl.eventmgr.register("nrpc_data_ready",function(t){var n=e.__determine_presence_from_nrpc_event(t);e.__last_op_presence.set(n),P=!0,a.trigger_event({namespace:"chat",type:"dataReady"})}),hbl.eventmgr.register("operator_status_change",function(t){var n=e.__determine_presence_from_nrpc_event(t);switch(n){case"available":a.trigger_event({namespace:"chat",type:"operatorsAvailable",previously:E});break;case"away":a.trigger_event({namespace:"chat",type:"operatorsAway",previously:E})}E=n,e.__last_op_presence.set(E),I||(C=!1,I=!0,a.trigger_event({namespace:"chat",type:"onReady",after:function(){a.trigger_event({namespace:"SessionConnection",type:"afterReady"})}}))},d),e.__wait_for_chat_to_connect(function(){a.run_legacy_code(function(){habla_window.send_pipeline.add(function(t){return void e.__send_and_deliver_message_from_visitor({legacy_message_tuple:[null,t,null]})},u)})}),olark.__legacy_shim.pipeline_disabler=function(){return void 0},e.__wait_for_chat_to_connect(function(){hbl.client.incoming_pipeline.add(function(t){var n=t[0],i=t[1],o=parseFloat(t[2]||-1),r=e.__last_cmd_seq_id.get(),s=c.exec(i);if(s)if(parseFloat(r)!=r&&(olark._.hlog("resetting last_command_index to 0, found a string instead #reset_string_command_index #warn"),r=0,e.__last_cmd_seq_id.set(r)),o>r){e.__last_cmd_seq_id.set(o);var _=s[1],l=s[2];l&&0===l.length&&(l=null),a.trigger_event({namespace:"chat",type:"commandFromOperator",nickname:n,name:_,body:l})}else olark._.hlog("dropping command",s[1],"due to sequence ID mismatch",o,"<=",r,"#warn #dropped_command");else e.__send_and_deliver_message_from_operator({legacy_message_tuple:t,is_automated:!1});return t},u)})}},j.prototype.__SPI_getMessageHistory=function(e){var t=this.__get_message_history();return e&&e(t),t},j.prototype.__SPI_populatedLocalChatHistoryFromRpcServer=function(){var e=this;return!e.__has_local_history},j.prototype.__SPI_onPrechatInfoReceived=function(e){a.listen_for_event({namespace:"chat",type:"prechatInfoReceived",callback:e})},j.prototype.__initialize_legacy_history_tracking=function(){var e=this;if(!O){O=!0;var t=function(t){var i=parseFloat(e.__last_leg_seq_id.get());if(t.__legacy_sequence_id||(t.__legacy_sequence_id=e.__get_next_message_sequence_id_that_is_server_safe()),i<t.__legacy_sequence_id){e.__last_leg_seq_id.set(t.__legacy_sequence_id);var a=e.__get_message_history();n(a)||(o.error("[olark] expected message_history to be a list:",a),a=[]),c.test(t.message.body)||a.push({nickname:t.message.nickname,body:t.message.body});var r=function(){a=a.slice(1,a.length),o.warn("[olark] trying to shrink message history, now has",a.length,"entries"),a.length>0?e.__SPI_setMessageHistory(a,r):e.__SPI_setMessageHistory([])};e.__SPI_setMessageHistory(a,r)}};e.__SPI_onDeliveryOfMessageFromOperator(t),e.__SPI_onDeliveryOfMessageFromVisitor(t),hbl.eventmgr.register("chat_loaded",a.create_idempotent_callback(function(){a.trigger_event({namespace:"chat",type:"legacyChatLoaded"})}));olark.__legacy_shim.load_missed_messages=a.create_idempotent_callback(function(n){e.__has_local_history=0!==n.length&&e.__last_leg_seq_id.get();for(var i=0;i<n.length;){var o=n[i],a=o[0],r=o[1],s=o[2],_=e.__last_leg_seq_id.get(),l=c.test(o[1]);l||(e.__has_local_history?s>_&&e.__send_and_deliver_message_from_operator({legacy_message_tuple:o,is_automated:!1}):t({__legacy_sequence_id:parseFloat(s),message:{nickname:a,body:r}})),i++}});var i=e.__SPI_getMessageHistory();olark.__legacy_shim.has_messages_in_history=i&&i.length>0?!0:!1}},olark.declare({name:"__ChatApiHelper",startup:function(e,t){function n(){setTimeout(function(){try{var e=hbl.client.buffer.length>0,n=habla_window.getHeader()==t.system.before_chat_text;e&&n&&habla_window.setHeader(t.locale.in_chat_text)}catch(i){}},900)}var i=!1;olark.__legacy_shim.send_prechat_info=function(t){if(!i){i=!0;var n="";t.name&&t.name.length&&"undefined"!=t.name&&(e.visitor.addFullName(t.name),n+="\n    name: "+t.name),t.email&&t.email.length&&"undefined"!=t.email&&(e.visitor.addEmailAddress(t.email),n+="\n    email: "+t.email),t.phone&&t.phone.length&&"undefined"!=t.phone&&(e.visitor.updatePhoneNumber(t.phone),n+="\n    phone: "+t.phone),n||(n="Prechat survey left blank."),e.chat.sendNotificationToOperator({body:n}),a.trigger_event({namespace:"chat",type:"prechatInfoReceived"})}},e.chat.onMessageToVisitor(n),e.chat.onMessageToOperator(n);var o=e.data.getConversationObject({key:"lock",initialValue:!1}),s=null,_=null,l=e.data.getConversationObject({key:"isFirstBusyCommand",initialValue:!0}),c=function(){s||(s=setInterval(function(){d()},1e3*y),_=setInterval(function(){e.chat.sendNotificationToOperator({body:"this visitor is still locked into chat, to unlock this visitor type !unlock"})},1e3*w))},u=function(){s&&(clearInterval(s),clearInterval(_),s=null,_=null)},d=function(){a.run_legacy_code(function(e){e.hbl.client.sendcommand("return_long_poll_now","")})};e.chat.onReady(function(){o.get()===!0?c():u()}),e.chat.onCommandFromOperator(function(n){switch(n.command.name.toLowerCase()){case"lock":o.set(!0),e.chat.sendNotificationToOperator({body:"visitor has been locked into this chat, to unlock this visitor type !unlock"}),c();break;case"unlock":o.set(!1),e.chat.sendNotificationToOperator({body:"visitor has been unlocked from this chat"}),u();break;case"busy":var i=t.locale.operator_busy_message_update||"Just checking in - I'm still busy chatting with {{ active_conversation_count }} other customers. I'll be with you as soon as I can.";l.get()&&(i=t.locale.operator_busy_message||"Sorry, I'm currently a bit busy at the moment with {{ active_conversation_count }} other customers. I'll be with you as soon as I can.",e.chat.sendNotificationToOperator({body:"Visitor has been queued. Simply send a message to start chatting and remove them from the queue."}),l.set(!1));var r=parseInt(n.command.body,10)||"";e.chat.sendNotificationToVisitor({body:i.replace(/\{\{\s*active_conversation_count\s*\}\}/g,r)}),a.trigger_event({namespace:"chat",type:"operatorIsBusy"});break;case"transfer":e.chat.__SPI_unlockFromCurrentGroup();break;case"name":var s=n.command.body;e.visitor.updateFullName({fullName:s}),e.chat.sendNotificationToOperator({body:"remembering visitor name as "+s});break;case"email":var _=n.command.body;e.visitor.updateEmailAddress({emailAddress:_}),e.chat.sendNotificationToOperator({body:"remembering visitor email as "+_});break;case"phone":var d=n.command.body;e.visitor.updatePhoneNumber({phoneNumber:d}),e.chat.sendNotificationToOperator({body:"remembering visitor phone number as "+d});break;case"end":olark("api.visitor.getDetails",function(n){var i=n.messageCountForThisVisit>0;i&&(e.chat.sendNotificationToVisitor({body:t.locale.ended_chat_message}),a.trigger_event({namespace:"chat",type:"endConversation"}))});break;case"help":e.chat.sendNotificationToOperator({body:["quick reference for the commands you can type at any time...","\n!tag","     tag this conversation, like '!tag followup' or '!tag important'","\n!transfer","     transfer this visitor to another operator.  Optionally give a note, like '!transfer This guy needs help with billing'","\n!unfollow","     stop receiving page-change notifications for this visitor","\n!push","     push this visitor to a URL, like '!push www.google.com'","\n!block","     block this visitor","For more commands, check out http://www.olark.com/help/olark-commands",""].join("\n")})}}),e.box.onDismiss(function(){e.chat.__SPI_endConversation()}),e.chat.onBeginConversation(function(){e.chat.__SPI_lockToOperatorGroup(t.system.group||t.system.olark_group||null)}),e.chat.__SPI_lockToExistingOperatorGroupIfGiven(t.system.group||t.system.olark_group||null),t.system.forced_rpc_server&&(r.hbl_hostname=t.system.forced_rpc_server,r.hblrpcTrick=0)
}}),olark.extend("__ChatApiHelper"),t.exports=j},{"./ExtensionManager":15,"./corehelpers":28,"./data":29,"./legacyglobals":32,"./logger":33,json3:3}],12:[function(e,t){var n,i;i=e("underscore"),n=function(){function e(e){this._client=e.client,this._visitorName=this._client.myname}return e.prototype.didBegin=function(){return this._client.chatting||this.hasMessages()},e.prototype.hasMessages=function(){return this._client.buffer.length>0},e.prototype.hasMessagesFromVisitor=function(){var e,t=this;return e=i.any(this._client.buffer,function(e){var n;return n=e[0],n===t._visitorName})},e.prototype.hasMessagesFromOperator=function(){var e,t=this;return e=i.any(this._client.buffer,function(e){var n;return n=e[0],n!==t._visitorName})},e.prototype.needsPrechat=function(){return(!this.didBegin()||this.hasMessagesFromOperator())&&!this.hasMessagesFromVisitor()},e}(),t.exports=n},{underscore:5}],13:[function(e,t){function n(e){function t(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}function n(){var e=document.location.href,t=e.split("#"),n="__olarkpg__="+Math.random(),i=/__olarkpg__=[^&]+/;return i.test(e)?e.replace(i,n):/\?/.test(e)?t[0]+"&"+n+(t[1]||""):t[0]+"?"+n+(t[1]||"")}function i(e){var n=document.createElement("a");return n.style.display="block",n.id="olark-inspector-"+e.id,n.href=e.href||"#",t(n,"click",e.onclick),n.innerHTML=e.content,n}function o(e,t){var n=document.createElement("div");return n.id="olark-inspector-"+e,n.innerHTML=t,n}function a(){s("api.visitor.__SPI_setIsInspecting",!1),_.style.display="none",_=null}function r(){function e(){r(function(e){l.innerHTML="";for(var n=0;n<e.length;n++)l.appendChild(e[n]);var i=document.createElement("a");i.innerHTML="close",function(e){e.display="block",e.position="absolute",e.top="0px",e.right="0px",e["text-decoration"]="none",e.color="#ccc"}(i.style),i.href="#",t(i,"click",function(){return a(),!1}),l.appendChild(i)})}function r(e){s("api.visitor.getDetails",function(t){e([o("olark-header","<strong style='color: #aaa'>OLARK INSPECTOR</strong>"),o("olark-page-count",["visitor from <strong>"+t.city+", "+t.region+", "+t.country+"</strong>","viewed <strong>"+t.pageCountForThisVisit+"</strong> pages","in <strong>"+t.secondsSpentForThisVisit+"</strong> seconds,","and has chatted <strong>"+t.conversationCount+"</strong> times in the past,","and <strong>"+(t.isConversing?"is conversing now":"has not conversed")+"</strong>"].join(" ")),i({id:"start-new-visitor",content:"pretend to be a brand-new visitor",href:n(),onclick:function(){s._.cookieManager.erase("hblid"),s._.cookieManager.erase("olfsk"),s._.cookieManager.erase("wcsid"),s._.cookieManager.erase("_okgid")}}),i({id:"start-new-conversation",content:"pretend this is a new visit to the site",href:n(),onclick:function(){s._.cookieManager.erase("wcsid"),s._.cookieManager.erase("_okgid")}}),i({id:"visit-another-page",content:"pretend to change pages",href:n()})])})}if(!_){_=document.createElement("div");var l=document.createElement("ul");!function(e){e.position="relative",e.width="400px",e.margin="0px",e.marginLeft=e.marginRight="auto",e.padding="10px",e.fontFamily="monospace",e.color="black",e.background="white",e.opacity="0.90",e["list-style-type"]="none",e["-moz-box-shadow"]=e["-webkit-box-shadow"]=e["box-shadow"]="0px 2px 25px #999"}(l.style),function(e){e.position="fixed",e.bottom="0px",e.width="98%"}(_.style),_.appendChild(l),document.body.appendChild(_),e(),s("api.visitor.onChange",e)}}var s=e.olark,_=null;s("api.visitor.__SPI_getIsInspecting",function(e){e?r():s("api.chat.onCommandFromOperator",function(e){"develop"==e.command.name.toLowerCase()&&(s("api.visitor.__SPI_setIsInspecting",!0),r())})})}t.exports=n},{}],14:[function(e,t){function n(){return olark.__core.api.ApiInstance}var i=e("./corehelpers"),o=function(e){var t=this;if(t.__name=e.name,t.__startup=e.startup,"undefined"==typeof t.__name)throw new Error("[olark] 'name' required");if("undefined"==typeof t.__startup)throw new Error("[olark] 'startup' required");t.__version=e.version||null,t.__source=e.source||null};!function(e){e.get_name=function(){var e=this;return e.__name},e.get_version=function(){var e=this;return e.__version},e.get_source=function(){var e=this;return e.__source},e.get_pretty_string=function(){var e=this,t=e.__name;return e.__version&&e.__source?t+=" (version "+e.__version+", from "+e.__source+")":e.__version&&(t+=" (version "+e.__version+")"),t},e.activate=function(e){var t=this,o=e.configuration;if("undefined"==typeof o)throw new Error("[olark] 'configuration' required");var a=/__.+/.test(t.__name),r=a?"__inline":t.__name;if(o[r]&&o[r].enabled===!1);else{var s=n(),_=new s({conf:o,namespace:r,extension_name:t.__name});t.__startup(_,o),i.trigger_event({namespace:"Extension",type:"extensionActivated"})}}}(o.prototype),t.exports=o},{"./corehelpers":28}],15:[function(e,t){function n(){return olark._&&olark._.plugins?olark._.plugins:window.olark.__buildinfo.jshost+"/javascript/plugins"}var i=e("./logger"),o=e("./corehelpers"),a=/^\s*(__Extension0\..+|__ChatApiHelper|__BoxApiHelper|[A-Z]\w+)\s*$/,r=/^\s*(api|box|browser|chat|data|extensions|system|olark|.*olark.*)\s*$/,s=6,_=function(){var e=this;e.__extension_specs=[],e.__extension_specs_by_name={},e.__extensions_by_name={},e.__extensions_by_source={},e.__extensions_by_name_and_version={},e.__extensions_by_name_and_source={},e.__extensions_by_name_and_version_and_source={},e.__disabled_extension_lookup={}};!function(e){var t=null;_.get_instance=function(){return t=t||new _};var l=0;_.get_next_extension_name=function(){return l+=1,"__Extension0."+l},e.__lazy_load_data_structures=function(e){var t=this,n=e.name,i=e.version,o=e.source;t.__extensions_by_name[n]=t.__extensions_by_name[n]||[],t.__extensions_by_source[o]=t.__extensions_by_name[o]||[],t.__extensions_by_name_and_version[n]=t.__extensions_by_name_and_version[n]||{},t.__extensions_by_name_and_version[n][i]=t.__extensions_by_name_and_version[n][i]||[],t.__extensions_by_name_and_source[n]=t.__extensions_by_name_and_source[n]||{},t.__extensions_by_name_and_source[n][o]=t.__extensions_by_name_and_source[n][o]||[],t.__extensions_by_name_and_version_and_source[n]=t.__extensions_by_name_and_version_and_source[n]||{},t.__extensions_by_name_and_version_and_source[n][i]=t.__extensions_by_name_and_version_and_source[n][i]||{},t.__extensions_by_name_and_version_and_source[n][i][o]=t.__extensions_by_name_and_version_and_source[n][i][o]||[]},e.enable_extension=function(e){this.__disabled_extension_lookup[e]=!1},e.disable_extension=function(e){this.__disabled_extension_lookup[e]=!0},e.get_expected_source_for_extension=function(e){var t=this;if("undefined"==typeof e.name)throw new Error("[olark] 'name' required for extension source lookup");var i=e.name,o=a.test(i)?!1:!0;o=o||r.test(i.toLowerCase()),o=o||/.*_.*/.test(i);var s=!!t.__extensions_by_name[i],_=t.__disabled_extension_lookup[i];if(s||_)return null;if(o)return null;for(var l="",c=0;c<i.length;c++){var u=i[c]||i.slice(c,c+1);/[ABCDEFGHIJKLMNOPQRSTUVWXYZ]/.test(u)?(l.length>0&&(l+="-"),l+=u.toLowerCase()):l+=u}var d=n(),h=d+"/"+l+".js?v=1411749984876";return h},e.register_declared_extension=function(e){var t=this,n=e.extension;if("undefined"==typeof n)throw new Error("[olark] 'extension' required");var i=n.get_name(),a=n.get_version(),r=n.get_source();r&&o.is_relative_url({url:r})&&(r=null),t.__lazy_load_data_structures({name:i,version:a,source:r}),t.__extensions_by_name[i].push(n),t.__extensions_by_source[r].push(n),t.__extensions_by_name_and_version[i][a].push(n),t.__extensions_by_name_and_source[i][r].push(n),t.__extensions_by_name_and_version_and_source[i][a][r].push(n),o.trigger_event({namespace:"ExtensionManager",type:"registeredExtension"})},e.for_each_extension_spec=function(e){for(var t=this,n=t.__extension_specs.length,a=t.__extension_specs,r=0;n>r;)!function(t){o.try_and_optionally_catch(function(){e(t,a)},function(e){i.error("[olark] error while iterating over required extension spec:",t,"error was: "+e.toString()),i.showErrorBacktrace(e)})}(t.__extension_specs[r]),r++},e.register_extension_spec=function(e){var t=this,n=e.extension_spec;if("undefined"==typeof n)throw new Error("[olark] 'extension_spec' required");var a=n.get_name(),r=n.get_version(),s=n.get_source();s&&o.is_relative_url({url:s})&&(s=null);var _=t.__disabled_extension_lookup[a];if(!_){var l=t.__extension_specs_by_name[a];if(!l||l.get_source()!==n.get_source()){if(l){var c=l.get_version(),u=l.get_source();r&&s&&c&&u?(r!=c||s!=u)&&i.warn("[olark] conflicting extensions:",n.get_pretty_string(),"and",l.get_pretty_string()):r&&c?r!=c&&i.warn("[olark] conflicting extensions:",n.get_pretty_string(),"and",l.get_pretty_string()):s&&u&&s!=u&&i.warn("[olark] conflicting extensions:",n.get_pretty_string(),"and",l.get_pretty_string())}n.begin_download(),t.__extension_specs.unshift(n),t.__extension_specs_by_name[a]=n,o.trigger_event({namespace:"ExtensionManager",type:"registeredExtensionSpec"})}}},e.search_for_extension=function(e){var t=this,n=e.name,i=e.version,a=e.source,r=e.extension_spec;if(r&&(n=r.get_name(),i=r.get_version(),a=r.get_source()),a&&o.is_relative_url({url:a})&&(a=null),a=null,t.__lazy_load_data_structures({name:n,version:i,source:a}),n&&i&&a)return t.__extensions_by_name_and_version_and_source[n][i][a];if(n&&i)return t.__extensions_by_name_and_version[n][i];if(n&&a)return t.__extensions_by_name_and_source[n][a];if(i&&a)throw new Error("[olark] cannot search by version and source");if(n)return t.__extensions_by_name[n];if(a)return t.__extensions_by_source[a];throw new Error(i?"[olark] cannot search by version":"[olark] missing search criteria")},e.assert_extension_name_is_valid=function(e){if(e.length<s)throw new Error("[olark] extensions cannot be named '"+e+"', names must be more than "+s+" letters long");if(!a.test(e))throw new Error("[olark] extensions cannot be named '"+e+"', names must start with a capital alphabetic letter and contain only alpha characters");if(r.test(e.toLowerCase()))throw new Error("[olark] extensions cannot be named '"+e+"', that name is protected for internal use")}}(_.prototype),t.exports=_},{"./corehelpers":28,"./logger":33}],16:[function(e,t){var n=e("./corehelpers"),i=e("./ExtensionManager"),o=function(e){var t=this;if(t.__name=e.name,"undefined"==typeof t.__name)throw new Error("[olark] 'name' required");t.__version=e.version||null,t.__source=e.source||i.get_instance().get_expected_source_for_extension({name:t.__name})};!function(e){e.get_name=function(){var e=this;return e.__name},e.get_version=function(){var e=this;return e.__version},e.get_source=function(){var e=this;return e.__source},e.get_pretty_string=function(){var e=this;return e.__name&&e.__version&&e.__source?e.__name+" (version "+e.__version+", from "+e.__source+")":e.__name&&e.__version?e.__name+" (version "+e.__version+")":e.__name&&e.__source?e.__name+" (from "+e.__source+")":e.__name},e.begin_download=function(){var e=this;e.__source&&n.async_script_load({url:e.__source})},e.is_downloaded=function(){var e=this,t=i.get_instance().search_for_extension({extension_spec:e});return t.length>0?!0:!1},e.when_downloaded=function(e){var t=this,i=!1,o=function(){t.is_downloaded()&&!i&&(i=!0,e())};o(),n.listen_for_event({namespace:"ExtensionManager",type:"registeredExtension",callback:o})}}(o.prototype),t.exports=o},{"./ExtensionManager":15,"./corehelpers":28}],17:[function(e,t){function n(e){var t=0,n=0,i=e.dom_element.offsetWidth,o=e.dom_element.offsetHeight,a=window.innerWidth||(document.documentElement.clientWidth?document.documentElement.clientWidth:document.body.clientWidth),r=window.innerHeight||(document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight),s=document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft,_=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop;return t=e.corner.match("R")?a+s-e.right-i:e.left+s,n=e.corner.match("B")?r+_-e.bottom-o:e.top+_,{x:t,y:n}}function i(){var e=this;e.__moving=!1,e.__need_to_move=function(){var t=e.__with_complete_habla_window(function(e){var t=e.config.vars,i=n({dom_element:e.theme.habla_window_div,top:t.top_margin,bottom:t.bottom_margin,left:t.left_margin,right:t.right_margin,corner:t.corner_position});if(e.theme){var o={x:e.theme.getX(),y:e.theme.getY()},a=i.x-o.x,r=i.y-o.y,s=Math.max(Math.abs(a),Math.abs(r));return{x:a,y:r,max_diff:s}}return{x:0,y:0,max_diff:0}});return t?t:{x:0,y:0,max_diff:0}},e.__with_complete_habla_window=function(e){var t=window.habla_window;return t&&t.config&&t.config.vars&&t.config.vars.corner_position?e(t):void 0},e.__move_window=function(t,i){e.__with_complete_habla_window(function(e){var o=e.config.vars,a=n({dom_element:e.theme.habla_window_div,top:o.top_margin,bottom:o.bottom_margin,left:o.left_margin,right:o.right_margin,corner:o.corner_position});e.theme.setXY(a.x-t,a.y-i)})},e.__check_location=function(){e.__move_to_correct_location(),setTimeout(function(){e.__check_location()},500)},e.__move_to_correct_location=function(t){var n=e.__need_to_move();!t&&n.max_diff<2||(t||n.max_diff<15?e.__move_window(0,0):(e.__move_window(0,.5*n.y),setTimeout(function(){e.__move_to_correct_location()},40)))},e.stop=function(){e.__timeout&&clearTimeout(e.__timeout),e.__timeout=void 0},e.start=function(){e.stop(),e.__timeout=setTimeout(function(){e.__check_location()},500)},e.__move_to_correct_location(!0),e.start()}function o(){this.vars={input_width_offset_normal:16,input_width_offset_ie:16,input_width_offset_compat:8,theme_url:"../theme.js"},this.palette={},this.style={},this.plugins=new r,this.style_id={},this.style_classes={},this.style_classes_map={}}var a=e("./legacyglobals"),r=e("./LegacyPluginList"),s=e("./BrowserInfo"),_=new s({userAgent:window.navigator.userAgent,compatMode:document.compatMode});o.prototype.setMargin=function(e){this.setMargins(e,e,e,e)},o.prototype.setMargins=function(e,t,n,i){this.vars.bottom_margin=i,this.vars.right_margin=n,this.vars.left_margin=e,this.vars.top_margin=t},o.prototype.setPosition=function(e){this.vars.corner_position=e},o.prototype.setDirectionRtl=function(e){this.vars.rtl=e,this.style_classes.habla_conversation_div='height: $vars["convo_height_px"]; overflow: auto; border-bottom: 1px dotted $palette["control"]; background: transparent; line-height: 1.5em; padding: 3px 23px 3px 3px; border: 1px solid',this.style_classes.habla_window_div="z-index:3000; direction: rtl",this.style_classes.habla_conversation_message_off="margin: 0; padding: 3px 23px 3px 3px;",this.style_classes.habla_conversation_p_item='color: $palette["main_fg"]; margin: 0; padding: 0; text-indent: -20px; background: transparent; text-align: right;',this.style_classes.habla_conversation_person1='color: $palette["local"]; padding-left: 5px; float: right;',this.style_classes.habla_conversation_person2='color: $palette["remote"]; padding-left: 5px; float: right;'},o.prototype.setInline=function(e){e?(this.vars.is_inline=1,this.vars.disableFocus=1):(this.vars.is_inline=0,this.vars.disableFocus=0)},o.prototype.setHeight=function(e){this.vars.convo_height=e},o.prototype.setWidth=function(e){this.vars.width=e},o.prototype.merge=function(e,t){if(this.copy_hash(this.vars,e.vars,t),this.copy_hash(this.style,e.style,t),this.copy_hash(this.palette,e.palette,t),this.copy_hash(this.style_id,e.style_id,t),this.copy_hash(this.style_classes,e.style_classes,t),this.copy_hash(this.style_classes_map,e.style_classes_map,t),e.plugins&&e.plugins.todo)for(var n in e.plugins.todo)e.plugins.todo.hasOwnProperty(n)&&this.plugins.add(e.plugins.todo.handler,e.plugins.todo.priority)},o.prototype.copy_hash=function(e,t,n){if(t)for(var i in t)t.hasOwnProperty(i)&&(n||void 0==e[i])&&(e[i]=t[i])},o.prototype.up=function(e){this.merge(e,!0)},o.prototype.render_all_styles=function(e){for(var t in this.style_classes_map)this.style_classes_map.hasOwnProperty(t)&&"string"==typeof t&&e[t]&&this.render_element_classes(e,t)},o.prototype.render_stylesheet=function(){hbl.util.css.create_css_class("div#habla_window_div p","padding:0;");for(var e in this.style_classes)if(this.style_classes.hasOwnProperty(e)){var t=this.render_part(this.style_classes[e]);hbl.util.css.create_css_class("."+e,t)}},o.prototype.smart_join=function(e,t){var n="";for(var i in e)e.hasOwnProperty(i)&&"string"==typeof e[i]&&(n+=e[i]+t);return n},o.prototype.render_element_classes=function(e,t){this.set_element_classes(e[t],t)},o.prototype.set_element_classes=function(e,t){e&&this.style_classes_map[t]&&this.style_classes_map[t].join&&(e.className=this.smart_join(this.style_classes_map[t]," "))},o.prototype.render_element=function(e,t){this.render_element_classes(e,t)},o.prototype.render_class=function(e,t,n){if(e&&e.className){var i=e.className.split(" "),o=[];for(var a in i)i.hasOwnProperty(a)&&"string"==typeof a&&i[a]!=n&&i[a]!=t&&o.push(i[a]);o.push(t),e.className=this.smart_join(o," ")}},o.prototype.render_ie_hacks=function(){(_.shouldUsePositionAbsolute()&&this.vars.disableJSStyles&&!this.vars.is_inline||this.vars.yahoo_ui)&&(hbl.__ie6_floating_div_monitor||(hbl.__ie6_floating_div_monitor=new i))},o.prototype.remap_palette=function(){var e={mainbg:"main_bg",mainfg:"main_fg",titlebg:"title_bg",titlefg:"title_fg",buttonbg:"button_bg",buttonfg:"button_fg",buttonhi:"button_bg_highlight",titlebg_highlight:"title_bg_highlight",titlefg_highlight:"title_fg_highlight",control:"control_border",control_highlight:"control_highlight_border",local:"local_fg",remote:"remote_fg",border:"panel_border"};for(var t in e)if(e.hasOwnProperty(t)){if("string"!=typeof t)continue;this.palette[t]&&(this.palette[e[t]]=this.palette[t])}this.palette.buttonfg&&(this.palette.button_fg_highlight=this.palette.buttonfg)},o.prototype.init_from_config=function(e){e.setWidth(this.vars.width),e.setHeight(this.vars.height),this.vars.is_inline?e.setInline(this.vars.is_inline):e.setPosition(this.vars.corner_position),e.setMargins(this.vars.left_margin,this.vars.top_margin,this.vars.right_margin,this.vars.bottom_margin),e.setInputHeight(this.vars.input_height),e.setFormInputHeight(this.vars.input_height),"Opera"==_.getBrowserName()&&(this.vars.poll=!0)},o.prototype.load_defaults=function(){this.plugins=new r,this.vars=[],this.palette={},this.palette.link="#e75917",this.vars.line_length=21,this.vars.bottom_margin=10,this.vars.right_margin=10,this.vars.left_margin=10,this.vars.top_margin=10,this.vars.width=260,this.vars.height=155,this.vars.panel_offset=20,this.vars.resize_input_height=60,this.vars.input_height=20,this.vars.corner_position="BR",this.vars.offline_msg_mode=!0,this.vars.rtl=!1,this.vars.resize_length=25,this.vars.myname="you",this.vars.say_text="Type here and hit enter to chat",this.vars.send_text="Send",this.vars.check_for_status=a.hblName+" (startup)",this.vars.disable_expand_text_input=!1,this.vars.disable_set_cookies=!1,this.vars.disable_get_cookies=!1,this.vars.cookie_path="/",this.vars.hbl_cookie_path="/",this.vars.session_expire=void 0,this.vars.local_user_display_name="&rarr;",this.vars.disableGoogleAnalytics=0,this.vars.expandOnMessageReceived=0,this.vars.enable_google_analytics=!1,this.vars.google_analytics_domain="auto",this.vars.language="en",this.vars.enableLanguageTranslation=!1,this.vars.expandOnFirstMessageReceived=1,this.vars.close_hides_window=!1,this.vars.plugin_path=a.hblStaticPath+"/plugins/",this.vars.divid="habla_window_div",this.vars.poll=!1,"Opera"==_.getBrowserName()&&(this.vars.poll=!0),this.vars.habla_name_input_text="click here and type your Name",this.vars.habla_offline_email_text="click here and type your Email",this.vars.habla_offline_phone_text="click here and type your Phone",this.vars.habla_offline_body_text="We're not around but we still want to hear from you!  Leave us a note:",this.vars.habla_offline_submit_value="Send",this.vars.habla_offline_sent_text="Thanks for your message!  We'll get back to you shortly.",this.vars.in_chat_text="Now Chatting",this.vars.before_chat_text="Chat with us!",this.vars.not_available_text="Contact us!",this.vars.busy_text="Contact us",this.vars.away_text="Contact us",this.vars.offline_message="We're not around, but we'd love to chat another time.",this.vars.welcome_msg="Questions? We'd love to chat!",this.vars.busy_message="All of our representatives are with other customers at this time. We will be with you shortly.",this.vars.enable_buttons=1,this.vars.hide_min_max_buttons=0,this.vars.local_name_override=void 0,this.vars.url_handler_target_window="_top",this.vars.url_handler=a.hblUrlHandler,this.vars.parse_links=1,this.vars.is_inline=0,this.vars.start_expanded=0,this.vars.start_hidden=0,this.vars.hide_not_available=0,this.vars.append_to_body=1,this.vars.show_away=0,this.vars.hide_when_away=0,this.vars.show_away_as_header=0,this.vars.habla_sizebutton_text_expanded="_",this.vars.habla_sizebutton_text_compressed="^",this.vars.habla_closebutton_text="x",this.vars.habla_popout_text=">",this.vars.habla_end_popout_text="<<",this.vars.start_visible=!1,this.vars.start_habla_window_visible=!1,this.vars.pre_chat_message="Hi, I am around, click 'start chatting' to contact me.",this.vars.pre_chat_submit="Click here to start chatting",this.vars.pre_chat_error_text="Please enter your name and email in case we get disconnected.",this.vars.show_pre_chat=0,this.vars.require_name=2,this.vars.require_email=1,this.vars.require_phone=0,this.vars.require_offline_phone=0,this.vars.show_end_popout=0,this.vars.show_popout=0,this.vars.is_popup=0,this.vars.sending_text="sending",this.vars.email_body_error_text="You must complete all fields and specify a valid email address",this.vars.habla_special_div_show_type="block",this.vars.operator_has_stopped_typing_text="has stopped typing",this.vars.operator_is_typing_text="is typing...",this.vars.flash_icons=1,this.vars.flash_titlebar=1,this.vars.default_flash_off_icon=a.hblStaticPath+"/images/white.ico",this.vars.default_flash_on_icon=a.hblStaticPath+"/images/orange.ico",this.vars.ended_chat_message="This chat has ended, start typing below if you need anything else!",this.style_classes_map={},this.style_id={},this.style_classes={}},t.exports=o},{"./BrowserInfo":10,"./LegacyPluginList":20,"./legacyglobals":32}],18:[function(e,t){function n(){this.registered_events={},this.register=function(e,t,n){void 0==this.registered_events[e]&&(this.registered_events[e]=[]),void 0==n&&(n=999),this.registered_events[e].push({handler:t,priority:n}),this.registered_events[e]=this.registered_events[e].sort(function(e,t){return e.priority-t.priority})},this.handle=function(e,t){if(void 0!=this.registered_events[e]){void 0==t&&(t={}),t.window=this.win,t.event_name=e;var n="";for(var i in t)t.hasOwnProperty(i)&&(n+=i+"="+t[i]+"|");for(var o in this.registered_events[e])this.registered_events[e].hasOwnProperty(o)&&this.registered_events[e][o]&&"function"==typeof this.registered_events[e][o].handler&&this.registered_events[e][o].handler(t)}},this.unregister_all=function(e){this.registered_events[e]=[]},this.setWindow=function(e){this.win=e}}t.exports=n},{}],19:[function(e,t){function n(e){this.todo=[],this.host_obj=e,this.add=function(e,t){void 0==t&&(t=999),this.todo.push({handler:e,priority:t}),this.todo=this.todo.sort(function(e,t){return e.priority-t.priority})},this.run=function(e){for(var t=e,n=0;n<this.todo.length;n++)if(this.todo[n]&&"function"==typeof this.todo[n].handler){if(t=this.todo[n].handler(e,this.host_obj),void 0==t)return void 0;e=t}return t},this.setTarget=function(e){this.host_obj=e}}t.exports=n},{}],20:[function(e,t){function n(){this.todo=[],this.defined={},this.add=function(e,t){void 0==t&&(t=999),void 0!=e&&(this.defined[e.name]||(this.defined[e.name]=1,this.todo.push({handler:e,priority:t}),this.todo=this.todo.sort(function(e,t){return e.priority-t.priority})))}}n.prototype.load=function(e){for(var t=e,n=0;n<this.todo.length;n++)this.todo[n]&&this.todo[n].handler&&"function"==typeof this.todo[n].handler.load&&1==this.defined[this.todo[n].handler.name]&&(this.todo[n].handler.load(e),this.defined[this.todo[n].handler.name]=2);return t},t.exports=n},{}],21:[function(e,t){var n,i,o,a=function(e,t){return function(){return e.apply(t,arguments)}};i=900,n=18e5,o=function(){function e(e,t,n,i,o,r){this.poll=a(this.poll,this);var s=this;this._options=r||{},this._localWindow=e,this._localDocument=t,this._localOlark=n,this._localHabla=i,this._localNavigator=o,this._hlog=this._options._hlog||this._localOlark._.hlog,this.secondsToKeepPollingAsOnline=this._options.secondsToKeepPollingAsOnline||60,this.minDelayWhenLongPolling=this._options.minDelayWhenLongPolling||0,this.activeIntervals={tier_1:{threshold:180,frequency:void 0},tier_2:{threshold:300,frequency:1e4},tier_3:{threshold:1800,frequency:2e4}},this.inactiveIntervals={opIsAvailable:{tier_1:{threshold:120,frequency:4e3},tier_2:{threshold:300,frequency:1e4},tier_3:{threshold:1800,frequency:2e4},tier_4:{threshold:7200,frequency:3e4}},opIsRecentlyOffline:15e3,opIsUnavailable:{tier_1:{threshold:180,frequency:15e3},tier_2:{threshold:300,frequency:45e3},tier_3:{threshold:7200,frequency:9e5}}},this.currentRate=1,this.longPoll=!0,this.running=!1,this.waitingForPollToFinish=!1,this.operatorAvailable=!1,this.nextPollTimer=void 0,this.lastPollStartedTimestamp=void 0,this.lastPollEndedTimestamp=void 0,this.expectedNextPollTime=void 0,this.lastSeenOnline=void 0,this.allowedDelayWhenSlow=this._options.allowedDelayWhenSlow||15,this.minAvailablePollTime=this._options.minAvailablePollTime||0,this.booted=this._options.booted||(new Date).getTime(),this._localOlark("api.chat.onOperatorsAvailable",function(){return s.operatorAvailable=!0,s.lastSeenOnline=(new Date).getTime()}),this._localOlark("api.chat.onOperatorsAway",function(){return s.operatorAvailable=!1}),/irefox/.test(this._localNavigator.userAgent)&&this._localWindow.addEventListener&&this._localWindow.addEventListener("unload",function(){return s.running&&s.waitingForPollToFinish?s._localHabla.client.sendcommand("return_long_poll_now",""):void 0},!1)}return e.prototype.getMinAvailablePollTime=function(){return this.minAvailablePollTime},e.prototype.setMinAvailablePollTime=function(e){return this.minAvailablePollTime=e},e.prototype.reset=function(e){return void 0===e&&(e=(new Date).getTime()),this.booted=e},e.prototype.setLongPoll=function(e){return this.longPoll=e},e.prototype.startNextPollNow=function(){return this.waitingForPollToFinish?void 0:this._startPollWithDelay()},e.prototype.isRunning=function(){return this.running},e.prototype.finishLastPoll=function(){return this.waitingForPollToFinish&&(this.waitingForPollToFinish=!1),this.expectedNextPollTime=void 0},e.prototype._getSecondsSinceLastAction=function(e){var t,n,i;return i=e.secondsSinceLastNotificationToOperator,n=e.secondsSinceLastMessage,t=n,i&&(void 0===n||n>i)&&(t=i),t},e.prototype.getNextPollTime=function(e){var t,n,i=this;return n=void 0,t=function(t){return n=t,e?e(t):void 0},this._localOlark("api.visitor.getDetails",function(e){var n,o;return n={secondsSinceLastAction:i._getSecondsSinceLastAction(e),secondsOnPage:i._timeOnPage(),secondsSinceOnline:i._secondsSinceOnline()},o=i.calculateNextPollTime(n),t(o)}),n},e.prototype.calculateNextPollTime=function(e){var t,n;return n=e.secondsSinceLastAction,t=void 0!==n,t?n<this.activeIntervals.tier_1.threshold?this.activeIntervals.tier_1.frequency:n<this.activeIntervals.tier_2.threshold?this.activeIntervals.tier_2.frequency:n<this.activeIntervals.tier_3.threshold?this.activeIntervals.tier_3.frequency:this._calculateInactivePollTime(e):this._calculateInactivePollTime(e)},e.prototype.scheduleNextPoll=function(){var e=this;return this.waitingForPollToFinish?void 0:this.getNextPollTime(function(t){return e._shouldRunScheduledPoll(t)?t>n?e.stop():e._startPollWithDelay(t):void 0})},e.prototype.stop=function(){return this.running?(this.nextPollTimer=void 0,this.nextPollTimer&&this._localWindow.clearTimeout(this.nextPollTimer),this._localHabla.client.sendcommand("return_long_poll_now","")):void 0},e.prototype.poll=function(){var e;return this.waitingForPollToFinish=!0,e=(new Date).getTime(),this.currentRate===this.minDelayWhenLongPolling&&this.longPoll?this._localHabla.client.proxy2.getmessages(this._localOlark._.identityManager.getConversationId(),this._localHabla.client.last_poll_index,this._localHabla.client.callbacks.getmessages):this._localHabla.client.proxy3.pollmessages(this._localOlark._.identityManager.getConversationId(),this._localHabla.client.last_poll_index,this._localHabla.client.callbacks.pollmessages)},e.prototype._shouldPollImmediately=function(e){return void 0===e},e.prototype._shouldRunScheduledPoll=function(e){var t;return t=this._shouldPollImmediately(e),!this.expectedNextPollTime||t||this.expectedNextPollTime>(new Date).getTime()+e},e.prototype._startPollWithDelay=function(e){return this.running=!0,this.nextPollTimer&&this._localWindow.clearTimeout(this.nextPollTimer),this.nextPollTimer=void 0,void 0===e&&(e=this.longPoll?this.minDelayWhenLongPolling:i),this.nextPollTimer=this._localWindow.setTimeout(this.poll,e),this.expectedNextPollTime=(new Date).getTime()+e,this.currentRate=e},e.prototype._isOperatorAvailable=function(){return this.operatorAvailable},e.prototype._operatorRecentlyWentOffline=function(e){return e&&e<this.secondsToKeepPollingAsOnline},e.prototype._calculateInactivePollTime=function(e){var t,n,i,o,a,r,s;return r=e.secondsOnPage,s=e.secondsSinceOnline,a=this._operatorRecentlyWentOffline(s),this._isOperatorAvailable()?(o=0,n=this.inactiveIntervals.opIsAvailable,o=r<n.tier_1.threshold?n.tier_1.frequency:r<n.tier_2.threshold?n.tier_2.frequency:r<n.tier_3.threshold?n.tier_3.frequency:r<n.tier_4.threshold?n.tier_4.frequency:r/20*1e3,Math.max.apply(this,[o,this.minAvailablePollTime])):a?this.inactiveIntervals.opIsRecentlyOffline:(i=this.inactiveIntervals.opIsUnavailable,r<i.tier_1.threshold?i.tier_1.frequency:r<i.tier_2.threshold?i.tier_2.frequency:r<i.tier_3.threshold?i.tier_3.frequency:(t=r/2*1.3*1e3,Math.max.apply(this,[t,i.tier_3.frequency])))},e.prototype._timeOnPage=function(e){return void 0===e&&(e=(new Date).getTime()),(e-this.booted)/1e3},e.prototype._secondsSinceOnline=function(){return this.lastSeenOnline?((new Date).getTime()-this.lastSeenOnline)/1e3:void 0},e}(),t.exports=o},{}],22:[function(e,t){var n=(e("./data"),e("./logger")),i=900,o=function(e){var t=this,n=e.data;t.__olark=e.olark,t.__browserApi=e.browser,t.__didActionForVisitor=n.getVisitorObject({key:"dafv",initialValue:{},__SPI_forceNamespace:"__rul"}),t.__didActionForConversation=n.getConversationObject({key:"dafc",initialValue:{},__SPI_forceNamespace:"__rul"})};!function(e){function t(e,t,i,o){function a(){"undefined"!=typeof o?o.get()||(o.set(!0),i()):n.warn("[olark] cannot execute rule with didAction undefined.")}"undefined"!=typeof o?o.get()||t(a):n.warn("[olark] cannot execute rule with didAction undefined.")}e.defineRule=function(e){function n(){0===d?t(a,r,s,u):h||(h=setTimeout(function(){h=null,t(a,r,s,u)},i))}var o=this,a=e.id,r=(e.description,e.condition),s=e.action,_=e.perVisit,l=e.perVisitor,c=e.perPage,u={get:function(){if(_||l){var e=_?o.__didActionForConversation:o.__didActionForVisitor;return e.get()[a]}return c?u.value:!1},set:function(e){if(_||l){var t=_?o.__didActionForConversation:o.__didActionForVisitor,n=t.get();n[a]=e,t.set(n)}else c&&(u.value=e)}},d=0,h=null;o.__olark("api.boot.onIdentityReady",n),o.__olark("api.visitor.onChange",n),o.__olark("api.chat.onReady",n),o.__olark("api.chat.onOperatorsAway",n),o.__olark("api.chat.onOperatorsBusy",n),o.__olark("api.chat.onOperatorsAvailable",n),o.__browserApi.onPageChange(function(){c&&u.set(!1),n()})}}(o.prototype),t.exports=o},{"./data":29,"./logger":33}],23:[function(e,t){var n,i,o,a=function(e,t){return function(){return e.apply(t,arguments)}};o=e("underscore"),i=e("linklink"),n=function(){function e(e){this.formatAsHtml=a(this.formatAsHtml,this),this._urlFormatter=e.urlFormatter}return e.prototype.formatAsHtml=function(e){var t,n,a,r,s=this;
return n="__junk_placeholder_workaround__ ",e=e.replace(/\%3C/gi,n),r="__plus_placeholder__",e=e.replace(/\+/g,r),a=[],t=i.linkify(e,a),o.each(a,function(e){var n,i;return s._urlFormatter.refersToLocalDomain(e)?(n='target="_blank" href="'+e,i='href="'+e,t=t.replace(n,i)):void 0}),o.each(a,function(e){var n,i,o,a;return i=0===(null!=(a=e.split(/https?:\/\//)[1])?a.indexOf(r):void 0),i=i||0===e.indexOf(r),i?(n=e.replace(r,""),n=n.replace(new RegExp(r,"g"),"+"),t=t.replace(""+e+'">'+r,""+e+'">'),t=t.replace(e,n),t=t.replace(e,n)):(n=e.replace(new RegExp(r,"g"),"+"),o=s._urlFormatter.getSmartUrl(n),t=t.replace(e,o),t=t.replace(e,o),t=t.replace(new RegExp(r,"g"),"+"))}),t=t.replace(new RegExp(n,"g"),"%3C"),t=t.replace(new RegExp(r,"g"),"+")},e}(),t.exports=n},{linklink:4,underscore:5}],24:[function(e,t){function n(e){this._window=e.window||window,this._identityManager=e.identityManager||olark._.identityManager,this._cookieManager=e.cookieManager||olark._.cookieManager,this._util=e.util||hbl.util,this._config=e.config||hbl.config.vars,this._wrapNonLocalUrls=!0,"undefined"!=typeof this._config.chat_does_not_follow_external_links&&(this._wrapNonLocalUrls=!this._config.chat_does_not_follow_external_links)}n.prototype.refersToLocalDomain=function(e,t){function n(e){return e.replace(/^(?:https?\:\/\/)?(?:www\.)?/,"").split("/")[0]}return t=t||this._window.location.host,n(t)===n(e)},n.prototype.getSmartUrl=function(e){var t=this,n=/^\s*(ftp|file|telnet|ldap|irc|nntp|news|irc|mailto).*/,i=/^\s*(\/).*/,o=/^\s*(https?)\:\/\/.+/,a=function(e){if(t._config.url_handler&&t._wrapNonLocalUrls){for(var n,i=t._window.location.search.replace(/^\?/,""),o={},a=i.split(/&/),r=a.length-1;r>=0;r--)n=a[r].split(/=/),o[n[0]]=n[1];var s=/\?/.test(t._config.url_handler)?"&":"?";return t._config.url_handler+s+"_ok="+t._identityManager.getSiteId()+"&wcsid="+t._identityManager.getConversationId()+"&_oklv="+t._identityManager.getOklvValueForPopout()+"&hblid="+t._identityManager.getVisitorId()+"&_okgid="+t._cookieManager.get("_okgid")+"&olfsk="+t._cookieManager.get("olfsk")+"&url="+t._util.encode_base64(e)+"&host="+t._window.location.host}return e};if(n.test(e))return e;if(i.test(e))return t._window.document.location.protocol+"//"+t._window.document.domain+e;var r=null;return r=o.test(e)?e:this.refersToLocalDomain(e)?t._window.document.location.protocol+"//"+e:"http://"+e,this._wrapNonLocalUrls&&!this.refersToLocalDomain(r)?a(r):r},t.exports=n},{}],25:[function(e,t){var n,i,o,a,r,s;s=e("underscore"),o=e("./logger"),i=function(e){return e+1},a=function(e){var t,n,i,o,a,r,s;try{for(o=/(q|p|query|queryTerms?)\=([^&\#]+)/i.exec(e)[2],t=decodeURIComponent(o).replace(/\+/g," "),a=/(?:\((.+?)\)|"(.+?)"|'(.+?)'|([^\s]+))/g,s=[],i=0,r=a.exec(t);r&&100>i;)s.push(r[2]||r[3]||r[4]),r=a.exec(t),i++;return{text:/^\s*$/.test(t)?null:t,terms:s}}catch(_){return n=_,{text:null,terms:[]}}},r=function(e){var t,n,i,o,a,r,s;try{for(a=/(?:utm_(\w+))\=([^&\#]+)/gi,s={},n=0,r=a.exec(e);r&&100>n;){try{i=r[1],o=r[2],s[i]=decodeURIComponent(o).replace(/\+/g," ")}catch(_){t=_}r=a.exec(e),n++}return s}catch(_){return t=_,{}}},n=function(){function e(e){var t;t=e.data,this.__logger=e.logger||o,this.__visitStats=t.getVisitorObject({key:"vs",initialValue:{},__SPI_forceNamespace:"__vis"})}return e.prototype.isEmpty=function(){return s.isEmpty(this.__visitStats.get())},e.prototype.pageVisit=function(){return this.__update("pageCountAcrossAllVisits",i)},e.prototype.hadConversation=function(){return this.__update("conversationCount",i)},e.prototype.incrementMessageCount=function(){return this.__update("messageCountAcrossAllVisits",i)},e.prototype.increaseTimeSpent=function(e){return this.__update("secondsSpentAcrossAllVisits",function(t){return t+e})},e.prototype.updateStatsFromVisit=function(){var e,t,n;return n={visitCount:i},e=this.__getReferrerInfo(document.referrer.toString()),e.referredByCampaign&&(n.referredByCampaignEver=!0,n.referredByCampaignThisVisit=!0),e.referredByPaidAdvertising&&(n.referredByPaidAdvertisingEver=!0,n.referredByPaidAdvertisingThisVisit=!0),t=this.__getSearchText(document.referrer.toString()),n.searchTextForThisVisit=t,t&&(n.searchTextForPreviousVisits=function(e){return e.push(t)}),this.__update(n)},e.prototype.generateFromHistory=function(e){var t,n,i,o,a,r,_,l,c;if(_=this.__visitStats.get(),!s.isEmpty(_))return this.__logger.warn("[olark] Visitor stats have already been generated."),_;for(r={pageCountAcrossAllVisits:0,messageCountAcrossAllVisits:0,conversationCount:0,secondsSpentAcrossAllVisits:0,referredByCampaignEver:!1,referredByCampaignThisVisit:!1,referredByPaidAdvertisingEver:!1,referredByPaidAdvertisingThisVisit:!1,searchTextForThisVisit:"",searchTextForPreviousVisits:[],visitCount:e.length},t=l=0,c=e.length;c>l;t=++l)i=e[t],n=t===e.length-1,r.pageCountAcrossAllVisits+=i.pageCount,r.messageCountAcrossAllVisits+=i.messageCount||0,i.didChat&&r.conversationCount++,r.secondsSpentAcrossAllVisits+=(i.updatedAt-i.createdAt)/1e3,a=this.__getReferrerInfo(i.referrer),r.referredByCampaignEver||(r.referredByCampaignEver=a.referredByCampaign),n&&(r.referredByCampaignThisVisit=a.referredByCampaign),r.referredByPaidAdvertisingEver||(r.referredByPaidAdvertisingEver=a.referredByPaidAdvertising),n&&(r.referredByPaidAdvertisingThisVisit=a.referredByPaidAdvertising),o=this.__getSearchText(i.referrer),o&&(n?r.searchTextForThisVisit=o:r.searchTextForPreviousVisits.push(o));return this.__visitStats.set(r),r},e.prototype.__update=function(e,t){var n,i,o;if(o=this.__visitStats.get(),s.isObject(e)){n=e;for(i in n)n.hasOwnProperty(i)&&o.hasOwnProperty(i)&&(o[i]=s.isFunction(n[i])?n[i](o[i]):n[i])}else o.hasOwnProperty(e)&&(o[e]=s.isFunction(t)?t(o[e]):t);return this.__visitStats.set(o)},e.prototype.__getReferrerInfo=function(e){var t,n,i,o,a;return t={referredByCampaign:!1,referredByPaidAdvertising:!1},i=r(e),i.campaign&&(t.referredByCampaign=!0),a=/(cpc|ppc)/i.test(i.medium||""),o=i.term,n=/gclid\=/.test(e),(o||n||a)&&(t.referredByPaidAdvertising=!0),t},e.prototype.__getSearchText=function(e){var t,n;return n="",t=a(e),t.text&&(n=t.text),n},e.prototype.__SPI_getStats=function(){return this.__visitStats.get()},e}(),t.exports=n},{"./logger":33,underscore:5}],26:[function(e,t){function n(e){return e?(+new Date-e)/1e3:{}.undefinedValue}function i(e){e=e||function(){};var t="_olark_callback_"+Math.random().toString().replace(".","");return window[t]=function(n){e(n),window[t]=void 0;try{delete window[t]}catch(i){}},t}function o(e,t){var n=t();return e&&e(n),n}var a=e("./framestorewithjson"),r=e("./corehelpers"),s=e("./logger"),_=e("./xdhttp"),l=e("underscore"),c=e("./VisitStats"),u=9e3,d=10,h=1e4,p=14,f=50,g=!1,m=function(e){function t(){i.__SPI_bumpVisitHistoryTimestamp(),setTimeout(t,u)}function n(){var e=i.__visitHistory.get(),t=e[e.length-1]||{};t.messageCount=t.messageCount||0,t.messageCount++,i.__visitHistory.set(e),i.__visitStats.incrementMessageCount()}var i=this;if(i.__corehelpers=e.corehelpers||r,i.__logger=e.logger||s,i.__olark=e.olark,i.__namespace=e.namespace,"undefined"==typeof i.__namespace)throw new Error("'namespace' required");i.__browserInfoObject=e.browserinfo;var o=e.data,a=e.browser;if(i.__geoIp={},i.__visitStats=new c({data:o}),i.__fullNameObject=o.getVisitorObject({key:"visFullName",initialValue:null,__SPI_forceNamespace:"__api"}),i.__emailAddressObject=o.getVisitorObject({key:"visEmailAddress",initialValue:null,__SPI_forceNamespace:"__api"}),i.__phoneNumberObject=o.getVisitorObject({key:"visPhoneNumber",initialValue:null,__SPI_forceNamespace:"__api"}),i.__recentPageHistory=o.getVisitorObject({key:"rph",initialValue:[],__SPI_forceNamespace:"__vis"}),i.__visitHistory=o.getVisitorObject({key:"vh",initialValue:[],__SPI_forceNamespace:"__vis"}),i.__isNewVisit=o.getConversationObject({key:"inv",initialValue:!0,__SPI_forceNamespace:"__vis"}),i.__importance=o.getVisitorObject({key:"imp",initialValue:0,__SPI_forceNamespace:"__vis"}),i.__notes=o.getVisitorObject({key:"nts",initialValue:[],__SPI_forceNamespace:"__vis"}),i.__mostRecentMessage=o.getConversationObject({key:"mrcm",initialValue:void 0,__SPI_forceNamespace:"__vis"}),i.__mostRecentNotificationToOperator=o.getConversationObject({key:"mrno",initialValue:void 0,__SPI_forceNamespace:"__vis"}),i.__mostRecentMessageToOperator=o.getConversationObject({key:"mrcmo",initialValue:void 0,__SPI_forceNamespace:"__vis"}),i.__mostRecentMessageToVisitor=o.getConversationObject({key:"mrcmv",initialValue:void 0,__SPI_forceNamespace:"__vis"}),i.__visitFields=o.getConversationObject({key:"vf",initialValue:{},__SPI_forceNamespace:"__vis"}),i.__didSyncName=o.getConversationObject({key:"dsn",initialValue:!1,__SPI_forceNamespace:"__vis"}),i.__didSyncEmail=o.getConversationObject({key:"dse",initialValue:!1,__SPI_forceNamespace:"__vis"}),i.__didSyncPhone=o.getConversationObject({key:"dsp",initialValue:!1,__SPI_forceNamespace:"__vis"}),i.__conversationBeginPage=o.getConversationObject({key:"cbp",initialValue:void 0,__SPI_forceNamespace:"__vis"}),i.__visitEventSent=o.getConversationObject({key:"ves",initialValue:!1,__SPI_forceNamespace:"__vis"}),i.__landedOnPageTimestamp=+new Date,a.onPageChange(function(){i.__landedOnPageTimestamp=+new Date}),!g){g=!0;var l=i.__recentPageHistory.get(),h=function(){var e=l[l.length-1],t=e?e.url:null;(0===l.length||document.location.href!==t)&&(l.push({title:document.title.length?document.title:null,url:document.location.href,timestamp:+new Date}),l.length>d&&(l=l.slice(l.length-d)),i.__recentPageHistory.set(l))};h(),a.onPageChange(h),i.__visitEventSent.set(!0);var p=_.post("/2.0/sites/"+i.__olark._.siteId+"/visits");p.send({conversation_id:i.__olark._.conversationId}),p.end(function(e){e&&i.__visitEventSent.set(!1)});var m,v=0===i.__visitHistory.get().length,b=i.__isNewVisit.get();(b||v)&&(b||i.__olark._.hlog("got #empty_history, treating as new visit for visit history"),i.__isNewVisit.set(!1),m=i.__visitHistory.get(),m.push({didChat:!1,pageCount:0,messageCount:0,referrer:document.referrer.toString(),createdAt:+new Date,updatedAt:+new Date}),i.__visitHistory.set(m),i.__visitStats.isEmpty()||v?i.__visitStats.generateFromHistory(m):i.__visitStats.updateStatsFromVisit()),m&&m.length>f&&(m=m.slice(m.length-f,m.length),i.__visitHistory.set(m)),t(),m=i.__visitHistory.get(),m=i.__updateMostRecentTimestampOnHistory(m),m[m.length-1].pageCount+=1,i.__visitHistory.set(m),i.__visitStats.pageVisit(),i.__olark("api.chat.onBeginConversation",function(){var e=i.__visitHistory.get(),t=e[e.length-1];t&&t.didChat!==!0&&(t.didChat=!0,i.__visitHistory.set(e),i.__conversationBeginPage.set(document.location.href),i.__visitStats.hadConversation())}),i.__olark("api.chat.onMessageToOperator",function(){i.__mostRecentMessage.set(+new Date),i.__mostRecentMessageToOperator.set(+new Date),n()}),i.__olark("api.chat.onMessageToVisitor",function(){i.__mostRecentMessage.set(+new Date),i.__mostRecentMessageToVisitor.set(+new Date),n()}),i.__olark("api.chat.onNotificationToOperator",function(){i.__mostRecentNotificationToOperator.set(+new Date)}),i.__SPI_prepopulateEmailFields(),i.__SPI_prepopulateFullNameFields(),i.__SPI_prepopulatePhoneNumberFields(),i.__SPI_prepopulateChatNicknameFromBestVisitorInformation(),this.__emailAddressObject.__SPI_onChange(function(){i.__didSyncEmail.set(!1),i.__ensureVisitorDataSynced({emailAddress:!0}),i.__SPI_prepopulateEmailFields(),i.__SPI_prepopulateChatNicknameFromBestVisitorInformation()}),this.__fullNameObject.__SPI_onChange(function(){i.__didSyncName.set(!1),i.__ensureVisitorDataSynced({fullName:!0}),i.__SPI_prepopulateFullNameFields(),i.__SPI_prepopulateChatNicknameFromBestVisitorInformation()}),this.__phoneNumberObject.__SPI_onChange(function(){i.__didSyncPhone.set(!1),i.__ensureVisitorDataSynced({phoneNumber:!0}),i.__SPI_prepopulatePhoneNumberFields()}),i.__ensureVisitorDataSynced({fullName:!0,emailAddress:!0,phoneNumber:!0})}};!function(e){e.__getGeoipKeys=function(e,t){function n(){for(var t={},n=0;n<e.length;n++){var o=e[n];i.__geoIp.hasOwnProperty(o)&&(t[o]=i.__geoIp[o])}return 1===e.length&&(t=t[e[0]]),t}var i=this;return l.isString(e)&&(e=[e]),l.isEmpty(this.__geoIp)?this.__olark("api.chat.whenDataReady",function(){i.__geoIp=i.__olark._.geoip,t&&t(n())}):t&&t(n()),n()};var t=0,r=null;e.__ensureVisitorDataSynced=function(e){var n=this,o=!1;if(!(e.retry&&t>=p)){var a=function(e,a,r,s){if(!a.get()&&e.get()){var _=["site_id="+encodeURIComponent(n.__olark._.identityManager.getSiteId()),"visitor_id="+encodeURIComponent(n.__olark._.identityManager.getVisitorId()),r+"="+encodeURIComponent(e.get()),"cache="+encodeURIComponent(Math.random()),"jsonp="+i(function(e){e.success&&(t=0,a.set(!0))})];o=!0,a.set(!1),n.__corehelpers.async_script_load({url:n.__olark._.apiHost+"/1.0/visitor/"+s+"?"+_.join("&")})}};if(e.fullName&&a(n.__fullNameObject,n.__didSyncName,"full_name","addFullName"),e.emailAddress&&a(n.__emailAddressObject,n.__didSyncEmail,"email_address","addEmailAddress"),e.phoneNumber&&a(n.__phoneNumberObject,n.__didSyncPhone,"phone_number","addPhoneNumber"),o){e.retry&&t++,r||(r={},n.__corehelpers.do_async_call({delay:h},function(){var e=r;e.retry=!0,r=null,n.__ensureVisitorDataSynced(e)}));for(var s in e)e.hasOwnProperty(s)&&(r[s]=e[s])}}},e.__SPI_getBrowser=function(){var e=this.__browserInfoObject,t=e.getBrowserName();return e.isCompatMode()&&(t+=" Compatibility Mode"),t+" "+e.getVersion()},e.__SPI_getOs=function(){var e=this.__browserInfoObject;if(e.isMobile())return"mobile platform "+e.getMobileOS()+" version "+e.getOSVersion();var t=navigator.platform;return/Mac/.test(t)?"Mac OSX":/Linux/.test(t)?"Linux":/Win/.test(t)?"Windows":void 0},e.__SPI_getIp=function(){return this.__olark._.ipaddress},e.__SPI_getRecentPageHistory=function(){return this.__recentPageHistory.get()||[]},e.__SPI_prepopulateEmailFields=function(){var e=this.__emailAddressObject.get();this.__olark("api.box.__SPI_setThemeTextField","habla_pre_chat_email_input",e),this.__olark("api.box.__SPI_setThemeTextField","habla_offline_email_input",e)},e.__SPI_prepopulateFullNameFields=function(){var e=this.__fullNameObject.get();this.__olark("api.box.__SPI_setThemeTextField","habla_pre_chat_name_input",e),this.__olark("api.box.__SPI_setThemeTextField","habla_name_input",e)},e.__SPI_prepopulatePhoneNumberFields=function(){var e=this.__phoneNumberObject.get();this.__olark("api.box.__SPI_setThemeTextField","habla_pre_chat_phone_input",e),this.__olark("api.box.__SPI_setThemeTextField","habla_offline_phone_input",e)},e.__SPI_prepopulateChatNicknameFromBestVisitorInformation=function(){var e,t=this.__fullNameObject.get(),n=this.__emailAddressObject.get();t&&n?e=t+" ("+n+")":t?e=t:n&&(e=n),e&&this.__olark("api.chat.updateVisitorNickname",{snippet:e,hidesDefault:!0})},e.__SPI_getIsInspecting=function(e){var t=this;return o(e,function(){return t.__olark._.cookieManager.get("_okinspect")?!0:!1})},e.__SPI_setIsInspecting=function(e){e?this.__olark._.cookieManager.set("_okinspect",e):this.__olark._.cookieManager.erase("_okinspect")},e.__SPI_bumpVisitHistoryTimestamp=function(){var e=this,t=e.__visitHistory.get();t=e.__updateMostRecentTimestampOnHistory(t),e.__visitHistory.set(t)},e.__updateMostRecentTimestampOnHistory=function(e){var t=e[e.length-1],n=t.updatedAt;return t&&(t.updatedAt=+new Date,this.__visitStats.increaseTimeSpent(t.updatedAt-n)),e},e.addEmailAddress=function(e){this.updateEmailAddress(e)},e.updateEmailAddress=function(e){var t=e.emailAddress||e;if("string"!=typeof t)throw new Error("[olark] emailAddress string expected");var n=hbl.util.strip_whitespace(hbl.util.decode_html_entities(t));if(n=n.split(" ")[0],!hbl.util.is_valid_email(n))throw new Error("[olark] invalid email address: '"+n+"'");this.__emailAddressObject.set(n)},e.addFullName=function(e){this.updateFullName(e)},e.updateFullName=function(e){var t=e.fullName||e;if("string"!=typeof t)throw new Error("[olark] fullName string expected");t=hbl.util.strip_whitespace(hbl.util.decode_html_entities(t)),this.__fullNameObject.set(t)},e.updatePhoneNumber=function(e){var t=e.phoneNumber||e;if("string"!=typeof t)throw new Error("[olark] phoneNumber string expected");t=hbl.util.strip_whitespace(hbl.util.decode_html_entities(t)),this.__phoneNumberObject.set(t)},e.getFullName=function(e){var t=this;return o(e,function(){return t.__fullNameObject.get()})},e.getEmailAddress=function(e){var t=this;return o(e,function(){return t.__emailAddressObject.get()})},e.getPhoneNumber=function(e){var t=this;return o(e,function(){return t.__phoneNumberObject.get()})},e.onChange=function(e){this.__fullNameObject.__SPI_onChange(e),this.__emailAddressObject.__SPI_onChange(e),this.__phoneNumberObject.__SPI_onChange(e),this.__visitHistory.__SPI_onChange(e),this.__recentPageHistory.__SPI_onChange(e),this.__importance.__SPI_onChange(e),this.__notes.__SPI_onChange(e)},e.getCity=function(e){return this.__getGeoipKeys("city",e)},e.getRegion=function(e){return this.__getGeoipKeys("state",e)},e.getCountry=function(e){return this.__getGeoipKeys("country",e)},e.getCountryCode=function(e){return this.__getGeoipKeys("country_code",e)},e.getOrganization=function(e){var t;return this.__getGeoipKeys(["isp","organization"],function(n){t=n.isp!=n.organization?n.organization:{}.undefinedValue,e&&e(t)}),t},e.updateImportance=function(e){var t;try{t=parseInt(e.value||e)}catch(n){t=-1}if(0>t||t>3)throw new Error("[olark] visitor importance must be an integer between 0-3");this.__importance.set(t)},e.addNote=function(e){var t=e.body||e,n=this.__notes.get();if("string"!=typeof t)throw new Error("[olark] visitor notes must be strings");for(var i=!1,o=0;o<n.length;o++)if(n[o]==t){i=!0;break}i||(n.push(t),this.__notes.set(n))},e.updateCustomFields=function(e){var t=a.json,n=t.encode(this.__visitFields.get()),o=t.encode(e);if(n!=o){this.__visitFields.set(e);var r=["conversation_id="+encodeURIComponent(this.__olark._.identityManager.getConversationId()),"site_id="+encodeURIComponent(this.__olark._.identityManager.getSiteId()),"custom_fields_json="+encodeURIComponent(o),"cache="+encodeURIComponent(Math.random()),"jsonp="+i()];this.__corehelpers.async_script_load({url:this.__olark._.apiHost+"/1.0/visitor/updateDetailsForThisVisit?"+r.join("&")})}},e.updateDetailsForThisVisit=function(e){this.updateCustomFields(e)},e.getDetailsForThisVisit=function(e){e(this.__visitFields.get())},e.trackConversion=function(){var e=["conversation_id="+encodeURIComponent(this.__olark._.identityManager.getConversationId()),"site_id="+encodeURIComponent(this.__olark._.identityManager.getSiteId()),"cache="+encodeURIComponent(Math.random()),"jsonp="+i()];this.__corehelpers.async_script_load({url:this.__olark._.apiHost+"/1.0/visitor/trackConversion?"+e.join("&")})},e.getDomain=function(){var e=this.__getGeoipKeys("domain"),t=this.getOrganization();return/(gov|edu|ibm|microsoft)/i.test(e)||t?e:void 0},e.getDetails=function(e){function t(e){var t=i.getRegion(),a=i.getCountry(),r=i.getCountryCode(),s=i.getOrganization(),_=i.getDomain(),l=i.__recentPageHistory.get(),c=i.__visitHistory.get(),u=i.__conversationBeginPage.get();0==c.length&&(c.push({}),i.__olark._.hlog("#history_is_empty in getDetails")),0==l.length&&(l.push({}),i.__olark._.hlog("#page_history_is_empty in getDetails"));var d=c[c.length-1].referrer;d&&d.indexOf(" ")>0&&(d=encodeURI(d)),i.__visitStats.isEmpty()&&i.__visitStats.generateFromHistory(c);var h,p=i.__visitStats.__SPI_getStats(),f=p.pageCountAcrossAllVisits||0,g=p.messageCountAcrossAllVisits||0,m=p.conversationCount||0,v=p.secondsSpentAcrossAllVisits||0,b=p.referredByPaidAdvertisingEver||!1,y=p.referredByPaidAdvertisingThisVisit||!1,w=p.referredByCampaignEver||!1,k=p.referredByCampaignThisVisit||!1,x=p.searchTesxtForThisVisit||"",S=p.searchTextForPreviousVisists||[],C=p.visitCount||0;try{h=i.__visitFields.get()}catch(I){h={}}var T=Math.round(+new Date-c[c.length-1].updatedAt);return o={recentPageHistory:l,currentPage:l[l.length-1],conversationBeginPage:u,referrer:d,referredByPaidAdvertisingEver:b,referredByPaidAdvertisingThisVisit:y,referredByCampaignEver:w,referredByCampaignThisVisit:k,searchTextForThisVisit:x,searchTextForPreviousVisits:S,pageCountForThisVisit:c[c.length-1].pageCount,pageCountAcrossAllVisits:f,messageCountForThisVisit:c[c.length-1].messageCount||0,messageCountAcrossAllVisits:g,visitCount:C,conversationCount:m,isConversing:c[c.length-1].didChat,secondsSpentOnCurrentPage:Math.round((+new Date-i.__landedOnPageTimestamp)/1e3),secondsSpentForThisVisit:Math.round((+new Date-c[c.length-1].createdAt)/1e3),secondsSpentAcrossAllVisits:Math.round((T+v)/1e3),city:e,region:t,country:a,countryCode:r,organization:s,domain:_,fullName:i.getFullName(),emailAddress:i.getEmailAddress(),phoneNumber:i.getPhoneNumber(),importance:i.__importance.get(),notes:i.__notes.get(),browser:i.__SPI_getBrowser(),operatingSystem:i.__SPI_getOs(),ip:i.__SPI_getIp(),secondsSinceLastMessage:n(i.__mostRecentMessage.get()),secondsSinceLastNotificationToOperator:n(i.__mostRecentNotificationToOperator.get()),secondsSinceLastMessageToOperator:n(i.__mostRecentMessageToOperator.get()),secondsSinceLastMessageToVisitor:n(i.__mostRecentMessageToVisitor.get()),customFields:h}}var i=this,o=null;return i.getCity(function(n){var o={};try{o=t(n)}catch(a){i.__logger.error("#error - getDetails",a.message),o={}}e&&e(o)}),o},e.__SPI_getNotes=function(e){var t=this;return o(e,function(){return t.__notes.get()})},e.__SPI_getVisitHistory=function(e){var t=this;return o(e,function(){return t.__visitHistory.get()})}}(m.prototype),t.exports=m},{"./VisitStats":25,"./corehelpers":28,"./framestorewithjson":30,"./logger":33,"./xdhttp":48,underscore:5}],27:[function(e,t){var n,i,o,a,r,s,_,l,c,u,d,h,p,f,g,m,v,b,y={}.hasOwnProperty;_=e("./ExtensionManager"),r=e("./DeveloperInspector"),c=e("./plugins/GoogleAnalyticsPlugin"),g=e("./plugins/VisitorInsightPlugin"),s=e("./plugins/EndConversationPlugin"),a=e("./plugins/CobrowsingPlugin"),p=e("./plugins/SoundsPlugin"),n=e("./plugins/CalloutBubblePlugin"),i=e("./plugins/CartSaverPlugin"),o=e("./plugins/ClickToChatPlugin"),u=e("./plugins/OfflineMessagingPlugin"),d=e("./plugins/PrechatSurveyPlugin"),h=e("./plugins/ShopifyPlugin"),m=e("./plugins/WelcomeAssistPlugin"),f=e("./plugins/ThreeDCartPlugin"),l={attention_grabber:"CalloutBubble",greeter:"WelcomeAssist",feedback:"Feedback",cobrowsing:"Cobrowsing",google_analytics:"GoogleAnalytics",prechat_survey:"PrechatSurvey"},v=function(e){var t,n,i,o,a,r,s,c;a=e.olark||function(){throw Error("olark function required to boot")}(),t=e.conf||function(){throw Error("conf require to boot")}(),o=_.get_instance(),s=t.features,c=[];for(n in s)y.call(s,n)&&(r=s[n],i=l[n],i?r?(a.extend(i),c.push(o.enable_extension(i))):c.push(o.disable_extension(i)):c.push("undefined"!=typeof console&&null!==console?console.warn("[olark] unknown feature '"+n+"'"):void 0));return c},b=function(e){var t,_,l,v,b,w,k;w=e.window||function(){throw Error("window required to boot")}(),b=e.olark||function(){throw Error("olark function required to boot")}(),_=function(e){return b.declare({name:e,version:"1.0",startup:function(){return b._.hlog("#deprecated_plugin_requested "+e)}})},t=function(e,t,n){return null==n&&(n={}),b.declare({name:e,version:"1.0",startup:t}),n.activate?b.extend(e):void 0},k=e.legacyGlobals;for(l in k)y.call(k,l)&&(v=k[l],w[l]=v);return b("api.boot.onIdentityReady",function(){return new r({olark:b})}),t("VisitorInsight",g,{activate:!0}),t("EndConversation",s,{activate:!0}),t("GoogleAnalytics",c),t("Cobrowsing",a),t("Sounds",p),t("CalloutBubble",n),t("CartSaver",i),t("ClickToChat",o),t("OfflineMessaging",u),t("PrechatSurvey",d),t("Shopify",h),t("WelcomeAssist",m),t("ThreeDCart",f),_("Mixpanel"),_("Notify"),_("Reminder"),_("Translator"),_("Wibiya")},t.exports={enableAndDisableFeatures:v,finishStartup:b}},{"./DeveloperInspector":13,"./ExtensionManager":15,"./plugins/CalloutBubblePlugin":34,"./plugins/CartSaverPlugin":35,"./plugins/ClickToChatPlugin":36,"./plugins/CobrowsingPlugin":37,"./plugins/EndConversationPlugin":38,"./plugins/GoogleAnalyticsPlugin":39,"./plugins/OfflineMessagingPlugin":40,"./plugins/PrechatSurveyPlugin":41,"./plugins/ShopifyPlugin":42,"./plugins/SoundsPlugin":43,"./plugins/ThreeDCartPlugin":44,"./plugins/VisitorInsightPlugin":45,"./plugins/WelcomeAssistPlugin":46}],28:[function(e,t){function n(e){return e(window)}var i=e("./logger"),o=50,a=null,r=null,s=null,_=null,l=null,c=null,u=null,d=null,h=null,p=null,f=null,g=null,m=null,v=null,b=[];l=function(e,t){var n=e.delay,i=setTimeout(t,n);return b.push(i),i},c=function(){for(var e=b.length;e--;)clearTimeout(b[e])},a=function(e){var t=!1;return function(){return t?void 0:(t=!0,e.apply(e,arguments))}},r=function(e){for(var t=e.length,n="\n";t--;){var i=e[t];n+=0===t?"- "+i:"- "+i+"\n"}return n},p=function(e){var t=e.url;if("string"!=typeof t)throw new Error("[olark] string 'url' is required");var n=-1!=t.indexOf("http://"),i=-1!=t.indexOf("https://"),o=0!==t.split("/")[0].indexOf(".");return!n&&!i&&!o};var y={};s=function(e){var t=e.url;if("string"!=typeof t)throw new Error("[olark] string 'url' is required");var n="https:"==document.location.protocol?!0:!1,o=-1==t.indexOf("http://")?!1:!0,a=-1==t.indexOf("https://")?!1:!0,r=o||a,s=null;if(s=p({url:t})?t:r?t:(n?"https://":"http://")+t,n&&r&&!a&&i.warn("[olark] you cannot load from ",s," when you are on an SSL page, you will probably get mixed-content warnings"),!y[s]){y[s]=!0;var _=document.createElement("script"),l=document.getElementsByTagName("script")[0];_.setAttribute("async",""),_.setAttribute("defer","true"),_.src=s,l.parentNode.insertBefore(_,l)}},_=function(e,t){var n=!1,i=function(){n||(n=!0,t())},a=function(){e()?i():n||l({delay:o},a)};a()},u=function(e){if(null===e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(t[n]=u(e[n]));return t},d=function(e,t){if(e==t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t))return!0;if("object"==typeof e&&"object"==typeof t&&null!==e&&null!==t){for(var n in e)if(!d(e[n],t[n]))return!1;for(var i in t)if(!d(e[i],t[i]))return!1;return!0}return!1},h=function(e){return e.replace(/\s+$/,"").replace(/^\s+/,"")},f=function(e){if("undefined"==typeof e.list)throw new Error("[olark] 'list' required");if("undefined"==typeof e.separator)throw new Error("[olark] 'separator' required");for(var t=e.list,n=e.separator,i=!0,o="",a=0;a<t.length;a++){var r=t[a];i?(i=!1,o+=r):o+=n+r}return o},g=function(e,t){if(window.olark.__buildinfo.strict)return e();try{return e()}catch(n){return t(n)}};var w={};m=function(e){var t=e.namespace,n=e.type,i=e.callback;if(!t)throw new Error("[olark] namespace required");if(!n)throw new Error("[olark] type required");if(!i)throw new Error("[olark] callback required");w[t]=w[t]||{},w[t][n]=w[t][n]||[],w[t][n].push(i)},v=function(e){var t=e.namespace,n=e.type,o=e.after||null,a=e;if(!t)throw new Error("[olark] namespace required");if(!n)throw new Error("[olark] type required");try{a.namespace=void 0,a.type=void 0,delete a.namespace,delete a.type,delete a.after}catch(r){}w[t]=w[t]||{};for(var s=w[t][n]||[],_=0;_<s.length;){var l=s[_++];l&&g(function(){l(a)},function(e){i.error("[olark] event handler for '"+t+"."+n+"' failed: "+e.toString()),i.showErrorBacktrace(e)})}o&&o()},t.exports={do_async_call:l,cancel_all_async_calls:c,create_idempotent_callback:a,format_bulleted_list_for_logger:r,is_relative_url:p,async_script_load:s,wait_for:_,clone_object:u,deep_equals:d,strip_whitespace:h,join_string_list:f,try_and_optionally_catch:g,listen_for_event:m,trigger_event:v,run_legacy_code:n}},{"./logger":33}],29:[function(e,t){function n(){return t.exports.storejs}function i(e,i){function o(){return olark._.cookieManager.get("olfsk")}function r(){olark._.cookieManager.erase("olfsk")}function _(e){olark._.cookieManager.set("olfsk",e,63072e6)}function l(){f=!1;var e=olark._.isNewConversation?!0:!1;return e||olark._.hlog("already booted once, but lost olfsk #warn #olfsk_regen"),Math.random().toString().replace("0.","olfsk")}function c(o){function l(e){h||(h=!0,t.exports.forceDomain=function(e){r(),d=e,_(o)},t.exports.forcePath=function(e){r(),u=e,_(o)},_(o),t.exports.storejs=e,i())}function c(){var e=a.json;l({set:function(t,n){localStorage.setItem(t,e.encode(n))},get:function(t){return e.decode(localStorage.getItem(t)||"null")},remove:function(e){localStorage.removeItem(e)}})}var f=!1,g=!1,m=function(){n().reject(function(e){return"vsession"==e||e==olark._.identityManager.getConversationId()?!1:!0}),n().reclaim(1),n().flush()},v=!1,b=document.referrer||"";"https:"===location.protocol&&/^http\:/.test(b)&&(v=!0),"http:"===location.protocol&&/^https\:/.test(b)&&(v=!0),""===b&&"http:"===location.protocol&&(v=!0),v&&olark._.hlog("switching from HTTP to HTTPS #ssl_protocol_switch");var y={server:p,key:o,onDisabled:function(){"localStorage"in window&&(s.warn("[olark] persistent storage disabled, chat will restart when crossing over into SSL or other subdomains"),olark._.hlog("data persistence lowered due to #local_storage_disabled"),c())},onOverflow:function(){f?(olark._.hlog("storage overflow, #overflow_cleared_convo_storage"),n().clear()):(olark._.hlog("storage overflow, #eliminated_convo_data"),f=!0,m())},onReadTimeout:function(){olark._.hlog("reads taking too long #storage_read_timeout"),m()},onWriteTimeout:function(){olark._.hlog("writes taking too long #storage_write_timeout"),m()},onFailure:function(e){g?(olark._.hlog("storage failure, #failure_cleared_convo_storage"),n().clear()):(g=!0,s.warn("[olark] dumping storage cache due to unexpected issue:",e),olark._.hlog("unable to persist storage #storage_failure"),n().dump())}};e?c():t.exports.storejs=a.framestore.connect(y,l,{onDownloaded:function(){olark._.P("storedownloaded")},onFirstPullReceived:function(){olark._.P("storereceived")},onFirstPullParsed:function(){olark._.P("storeparsed")}})}var u="/",d=null,h=!1,p=olark._&&olark._.storage?olark._.storage:"https://static.olark.com/jsclient/storage.html?v=1411749984876",f=!0;(olark._.storage?1:0)||olark._.hlog("no storage URL specified in loader, falling back #warn #no_storage_url"),c(o()||l()),setTimeout(function(){h||olark._.hlog("slow data connection (>8s) #slow_framestore_connection")},8e3)}function o(e,t,n){i(t,n)}var a=e("./framestorewithjson"),r=e("./corehelpers"),s=e("./logger"),_=null,l="prev-",c=900,u=864e5,d=/^\s*(__.*|chatNickname|chatStatus)\s*$/,h=function(e,t){e=e||{};for(var n=t.length;n--;){var i=t[n],o=e[i];if("undefined"==typeof o)throw new Error("[olark] '"+i+"' is a required argument")}return e},p=function(e){e=h(e,["key"]),_.remove(e.key)},f=function(e){e=h(e,["key","value","expiration_in_milliseconds"]);var t=e.key,n=(new Date).getTime(),i={value:e.value,unix_timestamp:n,expiration_in_milliseconds:e.expiration_in_milliseconds};if(e.expiration_access_tag){var o=_.get(l+t);o&&o.expiration_access_tag===e.expiration_access_tag&&(t="prev-"+t),i.expiration_access_tag=e.expiration_access_tag}_.set(t,i)},g=function(e){return e=h(e,["key"]),r.try_and_optionally_catch(function(){var t=_.get(e.key);if(t&&t.expiration_access_tag&&t.expiration_access_tag!==e.expiration_access_tag){var n=_.get(l+e.key);n&&n.expiration_access_tag===e.expiration_access_tag?t=n:(olark._.hlog("new session started, #returning_visitor_session"),_.set(l+e.key,t),_.remove(e.key),t=_.get(e.key))}if(t){var i=(new Date).getTime(),o=i-t.unix_timestamp;return o<t.expiration_in_milliseconds?t.value:(p({key:e.key}),e.defaultValue)}return e.defaultValue},function(t){s.error("[olark] problem retrieving '"+e.key+"' from storejs: "+t.toString()),s.showErrorBacktrace(t)})},m=function(e){var t=this;if(t.__key=e.key,t.__keystore=e.keystore,t.__link_to_conversation=e.link_to_conversation,t.__link_to_visitor=e.link_to_visitor,t.__initial_value=e.initial_value,t.__backup=e.backup,t.__backupTransform=e.backupTransform,t.__link_to_visitor&&t.__link_to_conversation)throw new Error("cannot link object reference to both the visitor and conversation");if(t.__event_object_string="PersistentObjectReference."+t.__key,"undefined"==typeof t.get()&&"undefined"!=typeof t.__initial_value&&t.set(t.__initial_value),t.__link_to_conversation&&t.__keystore.isLinkedToVisitor({key:t.__key}))throw new Error("this object is already linked to the visitor, cannot link it to the conversation");
if(t.__link_to_visitor&&t.__keystore.isLinkedToConversation({key:t.__key}))throw new Error("this object is already linked to the conversation, cannot link it to the visitor")};m.prototype.get=function(){var e=this,t=e.__keystore.get({key:e.__key,backup:e.__backup,backupTransform:e.__backupTransform});return"undefined"==typeof t?(e.set(e.__initial_value),r.clone_object(e.__initial_value)):r.clone_object(t)},m.prototype.set=function(e){var t=this;if("undefined"==typeof e)throw new Error("'value' required for object set");var n=t.__keystore.get({key:t.__key,backup:t.__backup,backupTransform:t.__backupTransform});r.deep_equals(n,e)||(t.__keystore.set({key:t.__key,value:e,link_to_conversation:t.__link_to_conversation,link_to_visitor:t.__link_to_visitor,backup:t.__backup}),r.trigger_event({namespace:t.__event_object_string,type:"keyChange",key:t.__key,newValue:e,oldValue:n}))},m.prototype.edit=function(e){var t=this,n=t.get();e(n),t.set(n)},m.prototype.change=function(e){s.warn("[olark] 'change' is deprecated, use __SPI_onChange instead"),this.__SPI_onChange(e)},m.prototype.__SPI_onChange=function(e){var t=this;r.listen_for_event({namespace:t.__event_object_string,type:"keyChange",callback:e})};var v=function(){};v.prototype.get=function(){throw new Error},v.prototype.set=function(){throw new Error},v.prototype.clearConversationData=function(){throw new Error},v.prototype.clearVisitorData=function(){throw new Error},v.prototype.isLinkedToConversation=function(){throw new Error},v.prototype.isLinkedToVisitor=function(){throw new Error};var b=function(e){e=e||{};var t=this;t.__conversation_expiration_delta_in_days=.1,t.__visitor_expiration_delta_in_days=365;var n=g({key:"csession",defaultValue:null,expiration_access_tag:olark._.identityManager.getConversationId()});n||f({key:"csession",value:{},expiration_in_milliseconds:t.__conversation_expiration_delta_in_days*u,expiration_access_tag:olark._.identityManager.getConversationId()});var i=g({key:"vsession",defaultValue:null,expiration_access_tag:olark._.identityManager.getVisitorId()});i||f({key:"vsession",value:{},expiration_in_milliseconds:t.__visitor_expiration_delta_in_days*u,expiration_access_tag:olark._.identityManager.getVisitorId()}),t.set({key:"siteId",value:olark._.siteId,link_to_visitor:!0})};b.prototype=new v,b.prototype.constructor=b,b.prototype.get=function(e){e=e||{};{var t=e.key,n=e.backup;e.backupTransform}if("undefined"==typeof t)throw new Error("'key' required");var i,o=g({key:"vsession",defaultValue:{},expiration_access_tag:olark._.identityManager.getVisitorId()}),a=g({key:"csession",defaultValue:{},expiration_access_tag:olark._.identityManager.getConversationId()}),r=o[t],_=a[t];if("undefined"!=typeof _?"undefined"!=typeof r?s.warn("[olark]",t,"was stored as associated with both the visitor and conversation, falling back to the conversation value"):i=_:i=r,"undefined"==typeof i&&n){var l,c,u,d,h=(olark._.cookieManager.getAllowingNullAndUndefinedAndEmptyString("_okbk")||"").split(",");for(d=0;d<h.length;d++)l=h[d].split("="),c=l[0],u=unescape(l[1]),c==n&&(i=u)}return i},b.prototype.set=function(e){e=e||{};var t=this,n=e.key,i=e.value,o=e.link_to_visitor,a=e.link_to_conversation,r=e.backup;if("undefined"==typeof n)throw new Error("'key' required");if("undefined"==typeof i)throw new Error("'value' required for key store set");if(o&&a)throw new Error("cannot link data to both a visitor and conversation");if(!o&&!a)throw new Error("currently, you must link to either a conversation or visitor");var s=g({key:"vsession",defaultValue:{},expiration_access_tag:olark._.identityManager.getVisitorId()}),_=g({key:"csession",defaultValue:{},expiration_access_tag:olark._.identityManager.getConversationId()});if(o){if(_[n])throw new Error("[error] cannot link "+n+" to the visitor, it is already associated with the conversation");s[n]=i,f({key:"vsession",value:s,expiration_in_milliseconds:t.__visitor_expiration_delta_in_days*u,expiration_access_tag:olark._.identityManager.getVisitorId()})}if(a){if(s[n])throw new Error("cannot link this value to the conversation, it is already associated with the visitor");_[n]=i,f({key:"csession",value:_,expiration_in_milliseconds:t.__conversation_expiration_delta_in_days*u,expiration_access_tag:olark._.identityManager.getConversationId()})}if(r){var l,c,d,h,p=(olark._.cookieManager.get("_okbk")||"").split(","),m=[r+"="+escape(i)];for(h=0;h<p.length;h++)l=p[h].split("="),c=l[0],d=unescape(l[1]),c!=r&&m.push(p[h]);olark._.cookieManager.setAllowingNullAndUndefinedAndEmptyString("_okbk",m.join(",")||null)}},b.prototype.clearConversationData=function(){p({key:"csession"}),olark._.cookieManager.erase("_okbk")},b.prototype.clearVisitorData=function(){p({key:"vsession"})},b.prototype.isLinkedToConversation=function(e){e=e||{};var t=e.key;if("undefined"==typeof t)throw new Error("'key' required");var n=g({key:"csession",defaultValue:{},expiration_access_tag:olark._.identityManager.getConversationId()});return"undefined"!=typeof n[t]},b.prototype.isLinkedToVisitor=function(e){e=e||{};var t=e.key;if("undefined"==typeof t)throw new Error("'key' required");var n=g({key:"vsession",defaultValue:{},expiration_access_tag:olark._.identityManager.getVisitorId()});return"undefined"!=typeof n[t]};var y=function(e){e=e||{};var t=this;if("undefined"==typeof e.namespace)throw new Error("'namespace' required");t.__namespace=e.namespace,t.__keystore=new b};y.prototype.__SPI_clearVisitorAndConversationData=function(){var e=this;e.__keystore.clearVisitorData(),e.__keystore.clearConversationData()},y.prototype.__SPI_clearOnlyConversationData=function(){var e=this;e.__keystore.clearConversationData()},function(){var e=y.prototype;e.declareConversationObject=function(e){var t=this;return s.warn("[olark] api.data.declareConversationObject is deprecated, please use api.data.getConversationObject instead"),t.getConversationObject(e)},e.declareVisitorObject=function(e){var t=this;return s.warn("[olark] api.data.declareVisitorObject is deprecated, please use api.data.getVisitorObject instead"),t.getVisitorObject(e)}}(),y.prototype.getConversationObject=function(e){e=e||{};var t=this;if("undefined"==typeof e.key)throw new Error("'key' required for getConversationObject");if("undefined"==typeof e.initialValue&&(e.initialValue=null),d.test(e.key))throw new Error("[olark] '"+e.key+"' is a protected key name, please choose something else");var n=e.initialValue,i=(e.__SPI_forceNamespace||t.__namespace)+"."+e.key,o=new m({key:i,keystore:t.__keystore,initial_value:n,link_to_conversation:!0,backup:e.backup,backupTransform:e.backupTransform});return o},y.prototype.getVisitorObject=function(e){e=e||{};var t=this;if("undefined"==typeof e.key)throw new Error("'key' required for getVisitorObject");if("undefined"==typeof e.initialValue&&(e.initialValue=null),d.test(e.key))throw new Error("[olark] '"+e.key+"' is a protected key name, please choose something else");var n=e.initialValue,i=(e.__SPI_forceNamespace||t.__namespace)+"."+e.key,o=new m({key:i,keystore:t.__keystore,initial_value:n,link_to_visitor:!0,backup:e.backup,backupTransform:e.backupTransform});return o},function(){var e={},t={get:function(t){var i=(new Date).getTime(),o=e[t];if(o&&i-o.timestamp<c)return o.val;var a=n().get(t);return e[t]={val:a,timestamp:i},a},set:function(t,i){var o=(new Date).getTime(),a={val:i,timestamp:o};n().set(t,i),e[t]=a},remove:function(t){n().remove(t),e[t]=void 0;try{delete e[t]}catch(i){}}};_=t}(),t.exports={AbstractKeyStore:v,StorejsKeyStore:b,DataApi:y,prepare:o,storejs:null}},{"./corehelpers":28,"./framestorewithjson":30,"./logger":33}],30:[function(e,t){t.exports=function(t,n,i,o){return t=e("./json"),n=function(){function e(){try{return k in g&&g[k]}catch(e){return!1}}function t(){try{return x in g&&g[x]&&g[x][g.location.hostname]}catch(e){return!1}}function n(){function e(e){var t=e.key;t?o(t):a()}window.addEventListener?window.addEventListener("storage",e,!1):window.attachEvent("onstorage",e)}function i(){setInterval(a,b)}function o(e){var t=w[e],n=c(e);if(v[e]=v[e]||[],w[e]=n,t!=n)for(var i=0;i<v[e].length;i++)try{v[e][i]({newValue:n})}catch(o){window.console&&window.console.error&&window.console.error(o)}}function a(){for(var e in v)v.hasOwnProperty(e)&&o(e)}function r(e){return function(){var t=Array.prototype.slice.call(arguments||[],0);t.unshift(u),m.body.appendChild(u),u.addBehavior("#default#userData"),u.load(k);var n=e.apply(f,t);return m.body.removeChild(u),n}}function s(){var e=Array.prototype.slice.call(arguments||[],0),t=e.shift();try{return h[t].apply(h,e),p[t].apply(p,e)}catch(n){return h[t].apply(h,e)}}function _(){for(var e=document.cookie.split(";"),t=0;t<e.length;t++){var n=e[t].replace(/^\s*/,"").replace(/\s*$/,"");if(0==n.indexOf(C))return f.deserialize(unescape(n.slice(C.length)))}return{}}function l(e){document.cookie=C+escape(f.serialize(e))+S,document.cookie.length>y&&(window.console&&window.console.warn&&window.console.warn("cookie is too large, clearing storejs"),l({}))}var c,u,d,h,p,f={},g=window,m=g.document,v={},b=750,y=4e3,w={},k="localStorage",x="globalStorage";if(f.set=function(){},f.get=function(){},f.remove=function(){},f.clear=function(){},f.transact=function(e,t){var n=f.get(e);"undefined"==typeof n&&(n={}),t(n),f.set(e,n)},f.listen=function(e,t){w[e]=c(e),v[e]=v[e]||[],v[e].push(t)},f.serialize=function(e){return JSON.stringify(e)},f.deserialize=function(e){return"string"!=typeof e?void 0:JSON.parse(e)},e())u=g[k],f.set=function(e,t){u.setItem(e,f.serialize(t))},f.get=function(e){return f.deserialize(u.getItem(e))},f.remove=function(e){u.removeItem(e)},f.clear=function(){u.clear()},c=function(e){return u.getItem(e)},n();else if(t())u=g[x][g.location.hostname],f.set=function(e,t){u[e]=f.serialize(t)},f.get=function(e){return f.deserialize(u[e]&&u[e].value)},f.remove=function(e){delete u[e]},f.clear=function(){for(var e in u)delete u[e]},c=function(e){return u[e]},i();else if(m.documentElement.addBehavior)u=m.createElement("div"),d={},h={},p={},p.set=r(function(e,t,n){e.setAttribute(t,f.serialize(n)),e.save(k)}),p.get=r(function(e,t){return f.deserialize(e.getAttribute(t))}),p.remove=r(function(e,t){e.removeAttribute(t),e.save(k)}),p.clear=r(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(k);for(var n,i=0;n=t[i];i++)e.removeAttribute(n.name);e.save(k)}),h.set=function(e,t){d[e]=t},h.get=function(e){return d[e]},h.remove=function(e){delete d[e]},h.clear=function(){d={}},f.set=function(e,t){return s("set",e,t)},f.get=function(e){return s("get",e)},f.remove=function(e){return s("remove",e)},f.clear=function(){return s("clear")},c=function(e){try{return r(function(e,t){return e.getAttribute(t)})(e)}catch(t){return d[e]}},i();else{var S="; path="+document.location.pathname,C="storejs=";f.set=function(e,t){{var n=_();n[e]}n[e]=t,l(n)},f.get=function(e){return _()[e]},f.remove=function(e){var t=_();try{delete t[e]}catch(n){t[e]=void 0}l(t)},f.clear=function(){l({})},c=function(e){return f.serialize(_()[e])}}return f}(),i=function(e,t){function n(){if(e.console&&e.console.error)try{e.console.error.apply(e.console,arguments)}catch(t){try{e.console.error(Array.prototype.slice.call(arguments||[]).join(" "))}catch(t){}}}function i(){if(e.console&&e.console.warn)try{e.console.warn.apply(e.console.warn,arguments)}catch(t){try{e.console.warn(Array.prototype.slice.call(arguments||[]).join(" "))}catch(t){}}}function o(e){return e.contentWindow?e.contentWindow:e.contentDocument.window}function a(){return Math.random().toString().replace("0.","TK")}function r(){var t=e.ActiveXObject;if(!t)return-1;try{var n,i=new t("ShockwaveFlash.ShockwaveFlash");return i?(n=i.GetVariable("$version"),parseInt(/([0-9]+)/.exec(n)[1])):-1}catch(o){return-1}}function s(e){return/^\s*(file\:|[a-zA-Z]\:).*/.test(e)}function _(e){var t;return e?""==e.length?null:s(e)?"file:":(t=e.split("//"),t.length>1?t[0]+"//"+t[1].split("/")[0]:t[0]):null}function l(n,i){var o,a,r=Math.floor(99999*Math.random()).toString(),s=t.createElement("span"),_="_olark_framesocket"+r,l="_olark_framesocket"+r,c=t.getElementsByTagName("body")[0],u=!1,d="try{window."+l+"()}catch(e){"+l+"()}";return c?a=function(){c.appendChild(s)}:(c=t.getElementsByTagName("script")[0],a=function(){c.parentNode.insertBefore(s,c)}),e[l]=function(){i&&!u&&(u=!0,i(o))},s.style.display="none",/(Firefox)/.test(navigator.userAgent)?(s.innerHTML='<iframe style="display: none !important" id="'+_+'" onload="'+d+'"></iframe>',a(),o=t.getElementById(_),o.src=n):(s.innerHTML='<iframe style="display: none !important" id="'+_+'" src="'+n+'" onload="'+d+'"></iframe>',a(),o=t.getElementById(_)),o}function c(e){setTimeout(e,0)}function u(e){return _("file:"==e?null:e)}function d(e,t){function n(){if(e()){var i=o.shift();a=!1,"undefined"!=typeof i&&t(i),o.length>0&&!a&&(a=!0,c(n))}}function i(e){o.push(e),n()}var o=[],a=!1,r=null;return r={queuedSend:i,attemptDequeue:n}}function h(){function n(){function t(t,n){e.postMessage?l.postMessage(t,n):l.document.postMessage(t,n)}function n(e){null==c||s(c)?t(e,"*"):t(e,_(c))}function i(){return"undefined"!=typeof l&&"undefined"!=typeof c?!0:!1}function o(e){l=e,u.attemptDequeue()}function a(e){c=e,u.attemptDequeue()}function r(e){u.queuedSend(e)}var l,c,u,h;return u=d(i,n),h={setPostMessageTargetWindow:o,setPostMessageTargetOrigin:a,send:r}}function r(n){function i(e){var i,r=_(e.origin||e.uri),l=null;"null"==e.origin&&(r="file:"),r&&!s(r)&&(e.uri&&0==e.uri.toString().indexOf(r)?l=e.uri.toString().slice(r.length):t.referrer&&0==t.referrer.toString().indexOf(r)&&(l=t.referrer.toString().slice(r.length))),i=u(r),("undefined"==typeof o||o==i)&&("undefined"==typeof a||a==e.source)&&n({data:e.data,origin:i})}var o,a,r={};return e.addEventListener?e.addEventListener("message",i,!1):e.attachEvent("onmessage",i),r.setExpectedOrigin=function(e){o=u(e)},r.setExpectedWindow=function(e){a=e},r}m.connect=function(e,t){function i(e){d.send(h+v+e)}var s,c=e.server||e,u=null,d=n(),h=a(),p=c.replace(/\#[^?]*/,"")+"#"+h;return t=t||function(){},d.setPostMessageTargetOrigin(c),l(p,function(e){var n=o(e);s=r(t),s.setExpectedOrigin(_(p)),s.setExpectedWindow(n),d.setPostMessageTargetWindow(n)}),i(b),u={send:i}},m.accept=function(t){function o(e){var n=e.data.split(v),o=n[0],r=n[1];o==l?r==b?u||(u=!0,a.setExpectedOrigin(e.origin),_.setPostMessageTargetOrigin(e.origin)):c(function(){t({data:r,origin:e.origin})}):i("[framesocket] received a message from an origin with an invalid identity")}var a,s=null,_=n(),l=(e.location.hash||"").slice(1),u=!1;return t=t||function(){},_.setPostMessageTargetWindow(e.parent),a=r(o),a.setExpectedWindow(e.parent),s={send:_.send}}}function p(){m.connect=function(t,n){function i(){return g}function o(e){h.frameElementContext.sendToChild(e,m)}function r(e){_.queuedSend(e)}function s(t,n){return t!=m?(e.console&&e.console.warn&&e.console.warn("[framesocket] invalid security token given to client in frameElement transport"),null):void n()}var _,h,p,f=t.server||t,g=!1,m=a(),v=f.replace(/\#[^?]*/,"")+"#"+m;return n=n||function(){},_=d(i,o),h=l(v),h.frameElementContext=function(){},h.frameElementContext.markChildAsReady=function(e){s(e,function(){c(function(){g=!0,_.attemptDequeue()})})},h.frameElementContext.sendToParent=function(e,t){s(t,function(){n({data:e,origin:u(f)})})},p={send:r}},m.accept=function(n){function i(){return!0}function o(t){e.frameElement.frameElementContext.sendToParent(t,l)}function a(e){s.queuedSend(e)}function r(t,n){return t!=l?(e.console&&e.console.warn&&e.console.warn("[framesocket] invalid security token given to server in frameElement transport"),null):void n()}var s,_,l=(e.location.hash||"").slice(1);return n=n||function(){},e.frameElement.frameElementContext(),e.frameElement.frameElementContext.sendToChild=function(e,i){r(i,function(){n({data:e,origin:u(t.referrer)})})},e.frameElement.frameElementContext.markChildAsReady(l),s=d(i,o),_={send:a}}}function f(){function n(){for(;l.length;)l.shift()(o())}function i(e){var n=t.getElementsByTagName("script")[0],i=t.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,n.parentNode.insertBefore(i,n)}function o(){var t=null;return e.minixdm&&(t=e.minixdm.easyXDM),t||e.easyXDM}function a(e,t){l.push(t),o()?n():r||(r=!0,i(e),s=setInterval(function(){o()&&(n(),clearInterval(s))},100))}var r=!1,s=null,l=[];m.connect=function(t,n){var i,o=t.server||t,r=o.replace(/(\/[^\/]+)$/,""),s=r+"/minixdm.swf",l=r+"/minixdm.js";"http:"==e.location.protocol&&(s=s.replace("https","http")),a(l,function(e){i=new e.Socket({protocol:y,lazy:!1,swf:s,remote:o.replace(/\#[^?]*/,"")+"#basepath="+encodeURIComponent(r),onMessage:function(e,t){n({data:e,origin:_(t)})}})});var c={send:function(e){a(l,function(){i.postMessage(e)})}};return c},m.accept=function(t){var n,i=decodeURIComponent(/basepath=([^?&]+)/.exec(e.location.href.slice(1))[1]),o=i+"/minixdm.swf",r=i+"/minixdm.js";"http:"==e.location.protocol&&(o=o.replace("https","http")),a(r,function(e){n=new e.Socket({protocol:y,swf:o,onMessage:function(e,n){t({data:e,origin:_(n)})}})});var s={send:function(e){a(r,function(){n.postMessage(e)})}};return s}}function g(){n("[framesocket] unsupported browser")}var m={},v="~:DATA:~",b="~:INIT:~",y="6";return e.postMessage||t.postMessage?h():"Gecko"==navigator.product&&"frameElement"in e&&-1==navigator.userAgent.indexOf("WebKit")?p():r()>6?f():(m.connect=function(){return g(),{send:g}},m.accept=function(){return g(),{send:g}},m.isCompatible=function(){return!1}),m.isCompatible=m.isCompatible||function(){return!0},m}(window,document),o=function(e,t,n,i,o){function a(){if(e.console&&e.console.error)try{e.console.error.apply(e.console,arguments)}catch(t){try{e.console.error(Array.prototype.slice.call(arguments||[]).join(" "))}catch(t){}}}function r(){if(e.console&&e.console.warn)try{e.console.warn.apply(e.console.warn,arguments)}catch(t){try{e.console.warn(Array.prototype.slice.call(arguments||[]).join(" "))}catch(t){}}}function s(){this.name="ReadTimeoutError"}function _(){this.name="WriteTimeoutError"}function l(){return(new Date).getTime()}function c(e,t){for(var i=Array.prototype.slice.call(arguments||[]).slice(2),o=t.toString(),a=0;a<i.length;a++)o+="undefined"==typeof i[a]?k+escape(x):k+escape(n.encode(i[a]));e.send(o)}function u(e,t){for(var i,o=e.split(k),a=o[0],s=o.slice(1),_=t[a],l=[],c=0;c<s.length;c++)i=unescape(s[c]),l.push(i==x?{}.undefinedValue:n.decode(i));_?_.apply(_,l):r("[framestore] unknown command type:",a)}function d(e,t){try{i.remove("__framestore__.locks."+e)}catch(n){}t(function(){})}function h(e){var t=f(),n=null,i=l(),o=null;for(var a in t)a!=e&&t.hasOwnProperty(a)&&(o=t[a],(null===n||o===!0||i>o)&&(n=a,i=o===!0?0:o));n&&m(n)}function p(e,t){for(;e;)e--,h(t)}function f(){var e="__framestore__.index";try{return i.get(e)||{}}catch(t){return r("[framestore] index capture failed, resetting"),i.set(e,{}),{}}}function g(e){var t="__framestore__.index";try{return i.set(t,e)}catch(n){r("[framestore] index capture failed, clearing entire storage"),i.clear(),i.set(t,e)}}function m(e){var t=f();i.remove(b(e)),delete t[e],g(t)}function v(e){var t=f();t[e]=l(),g(t)}function b(e){return"__framestore__.stores."+e}function y(e,n,o){v(e),d("stores."+e,function(a){function r(e,t){(e||t)&&(e&&(s.data=e),t&&(s.metadata=t),s.metadata.lastUpdated=l(),i.set(_,s)),a()}var s,_=b(e),c={metadata:{creator:t.referrer,lastUpdated:l()},data:{}};try{s=i.get(_)||c}catch(u){if(!o)throw u;s=c}n(s.data,s.metadata,r)})}var w={},k=",",x="~UNDEFINED",S="~DELETEDKEY",C=100,I=2100;return w.connect=function(t,n,i){function a(){k||(k=setTimeout(l,C))}function l(){f.flush()}function d(e){22===e.code||/QUOTA/.test(e.name||"")?v?P&&P():E&&E():e instanceof _?A&&A():e instanceof s?O&&O():v||b?T&&T(e):(r("[framestore] failed to boot, trying to dump storage"),b=!0,f.dump(),f.pull())}function h(e){x=!1,d(e)}var p,f={},g=t.server,m=t.key,v=!1,b=!1,y={},w=[],k=null,x=!1,T=t.onFailure,E=t.onDisabled,P=t.onOverflow,O=t.onReadTimeout,A=t.onWriteTimeout,M=!1,N=null,B=null,F=null,L=t.maxMillisecondsForResponse||I;return p=o.connect(g,function(t){u(t.data,{DOWNLOADED:function(){i&&i.onDownloaded()},FLUSHDONE:function(e){N==e&&(x=!1,w=[],M&&l())},FLUSHFAIL:function(e,t){N==e&&h(t)},PULLFAIL:function(e){F&&(clearTimeout(F),F=null),d(e)},PUSH:function(t,o,a){i&&!v&&i.onFirstPullReceived();var r,s,_,c;if(a)r=o;else for(r=o,s=0;s<w.length;s++)_=w[s],c=y[_],r[_]=c;y=r,F&&(clearTimeout(F),F=null),t=t,v||(v=!0,e.addEventListener?e.addEventListener("beforeunload",l,!1):e.attachEvent("onbeforeunload",l),i&&i.onFirstPullParsed(),n(f))}})}),f.pull=function(){F=setTimeout(function(){r("[framesocket] timed out while pulling from persistent storage"),d(new s)},L),c(p,"PULL",m)},f.flush=function(){if(x)return void(M=!0);if(k&&(clearTimeout(k),k=null),B&&(clearTimeout(B),B=null),M=!1,v&&w.length>0){var e,t,n,i={};for(e=0;e<w.length;e++)t=w[e],n=y[t],i[t]="undefined"==typeof n?S:n;N=(+new Date).toString(),x=!0,B=setTimeout(function(){x&&(r("[framesocket] timed out while flushing to persistent storage"),h(new _))},L),c(p,"FLUSH",m,i,N)}},f.get=function(e){return y[e]},f.set=function(e,t){y[e]=t,w.push(e),a()},f.remove=function(e){try{y[e]=void 0,delete y[e]}catch(t){}w.push(e),a()},f.clear=function(){y={},k&&(clearTimeout(k),k=null),c(p,"CLEAR",m)},f.dump=function(){c(p,"DUMP",m,y)},f.reclaim=function(e){c(p,"RECLAIM",m,e)},f.reject=function(e){for(var t in y){var n;try{n=e(t)?!0:!1}catch(i){n=!1}if(y.hasOwnProperty(t)&&n){try{y[t]=void 0,delete y[t]}catch(i){}w.push(t)}}a()},f.pull(),f},w.accept=function(){function e(e){c(s,"FLUSHDONE",e)}function t(e,t){r("[framestore] unable to flush to persistent storage"),a(e),c(s,"FLUSHFAIL",t,e)}function n(e){r("[framestore] unable to pull from persistent storage"),a(e),c(s,"PULLFAIL",e)}var s,_={};s=o.accept(function(o){u(o.data,{PULL:function(e){function t(t){try{y(e,function(n,i,o){c(s,"PUSH",e,n,t),o(null,null)})}catch(i){n(i)}}_[e]?t():(_[e]=!0,i.listen(b(e),t),i.listen("__framestore__.index",function(){var n=f();for(var i in n)if(i==e)return;r("[framestore] storage reclaimed, pushing cleared contents"),t(!0)}),t())},FLUSH:function(n,i,o){try{y(n,function(n,a,r){var s,_,l={};for(s in i)if(i.hasOwnProperty(s))if(_=i[s],l[s]=n[s],_==S)try{n[s]=void 0,delete n[s]}catch(c){}else n[s]=_;try{r(n,null),e(o)}catch(c){for(var u in l)l.hasOwnProperty(u)&&(n[u]=l[u]);t(c,o)}})}catch(a){t(a,o)}},CLEAR:function(e){m(e)},DUMP:function(e,t){y(e,function(e,n,i){i(t,null)},!0)},RECLAIM:function(e,t){t&&t>0?p(t,e):r("[framestore] number of reclaimed entries must be nonzero")}})}),c(s,"DOWNLOADED")},i.serialize=function(e){return n.encode(e)},i.deserialize=function(e){return"string"!=typeof e?void 0:n.decode(e)},w}(window,document,t,n,i),{framestore:o,json:t,framesocket:i}}()},{"./json":31}],31:[function(e,t){var n;n=e("json3"),t.exports={encode:function(){return n.stringify.apply(n,arguments)},decode:function(){return n.parse.apply(n,arguments)}}},{json3:3}],32:[function(e,t){var n,i,o,a,r,s;a=/.*https:.*/.test(document.location.protocol)?"https":"http",i=a+"://static.olark.com/js",n=("undefined"!=typeof olark&&null!==olark?null!=(r=olark._)?r.popout:void 0:void 0)||i+"client/popout.html?v=1411749984876",o=("undefined"!=typeof olark&&null!==olark?null!=(s=olark._)?s.follow:void 0:void 0)||i+"client/follow.html?v=1411749984876",t.exports={hblJavaScriptVersion:"0.5m",hbl_hostname:"olark.com/nrpc",hblHasinit:void 0,hblrpcTrick:1,hblName:"Olark Chat",hbl_ext:a,hblStaticPath:i,hblPostURL:a+"://www.olark.com/emails/create",hblPopupURL:n,hblUrlHandler:o}},{}],33:[function(e,t){function n(e){return function(){var t=function(){},n={};window.console?(n=window.console,t=window.console[e]||window.console.info||t):window.opera&&(n=window.opera,t=window.opera.postError||t);try{t.apply(n,arguments)}catch(i){try{t(arguments.join(" "))}catch(i){}}}}if("undefined"==typeof window)return void(t.exports=console);var i,o=window.olark._.hlog,a=window.olark.__buildinfo?window.olark.__buildinfo.dev:!1;if(a)i={log:n("log"),info:n("info"),warn:n("warn"),error:n("error"),debug:n("debug"),showErrorBacktrace:n("error")};else{i={log:n("log"),info:n("info"),warn:n("warn"),error:n("error"),debug:function(){},showErrorBacktrace:function(){}};var r=i.error,s=i.warn,_=null;try{_=navigator.appName+" - "+navigator.appVersion}catch(l){}i.error=function(){try{var e=Array.prototype.slice.call(arguments||[]);o(e.join(" "),"#error")}catch(t){}try{r.apply(i,arguments)}catch(t){}},i.warn=function(){try{var e=Array.prototype.slice.call(arguments||[]);o(e.join(" "),"#warn")}catch(t){}try{s.apply(i,arguments)}catch(t){}}}t.exports=i},{}],34:[function(e,t){function n(e,t){function n(t){var n=document.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t)),e.box.__SPI_injectStyleIntoPage(n)}function o(){return g(),["#habla_window_div {","z-index:5000;","}","#habla_window_div #habla-callout-bubble-anchor,","#habla_window_div #habla-callout-bubble-anchor-offline {","margin: 0px;","padding: 0px;","border: 0px;","}","#habla_compressed_div {","position: relative;","}","#habla_window_div .olark-callout-bubble-close-button {","height: 20px;","width: 20px;","position: absolute;","top: 0px;","right: 0px;","background: transparent url("+v.CLOSE_BUTTON_IMAGE_PATH+") top right no-repeat;","z-index:5001","}","#habla_window_div #olark-callout-bubble,","#habla_window_div #olark-callout-bubble-offline {","position: absolute;","cursor: pointer;","}","#habla_window_div #olark-callout-bubble {","height: "+parseInt(v.BUBBLE_HEIGHT)+"px;","width: "+parseInt(v.BUBBLE_WIDTH)+"px;","}",".olrk-fixed-bottom #olark-callout-bubble {",v.BUBBLE_IMAGE_URL?"background: transparent url("+v.BUBBLE_IMAGE_URL+") center top no-repeat;":"","z-index:5000;","position:relative;","}",".olrk-fixed-top #olark-callout-bubble {",v.BUBBLE_IMAGE_URL?"background: transparent url("+v.BUBBLE_IMAGE_URL+") center bottom no-repeat;":"","z-index:5000;","position:relative;","}","#habla_window_div #olark-callout-bubble-offline {","height: "+parseInt(v.BUBBLE_HEIGHT_OFFLINE)+"px;","width: "+parseInt(v.BUBBLE_WIDTH_OFFLINE)+"px;","}",".olrk-fixed-bottom #olark-callout-bubble-offline {",v.BUBBLE_IMAGE_URL_OFFLINE?"background: transparent url("+v.BUBBLE_IMAGE_URL_OFFLINE+") center top no-repeat;":"","z-index:5000;","position:relative;","}",".olrk-fixed-top #olark-callout-bubble-offline {",v.BUBBLE_IMAGE_URL_OFFLINE?"background: transparent url("+v.BUBBLE_IMAGE_URL_OFFLINE+") center bottom no-repeat;":"","z-index:5000;","position:relative;","}",".olrk-fixed-top #olark-callout-bubble {","top: "+parseInt(v.BUBBLE_TOP_OFFSET)+"px;","}",".olrk-fixed-bottom #olark-callout-bubble {","bottom: "+parseInt(v.BUBBLE_BOTTOM_OFFSET)+"px;","}",".olrk-fixed-left #olark-callout-bubble {","right: "+parseInt(v.BUBBLE_LEFT_OFFSET)+"px;","}",".olrk-fixed-right #olark-callout-bubble {","left: "+parseInt(v.BUBBLE_RIGHT_OFFSET)+"px;","}",".olrk-fixed-left .olrk-left-align #olark-callout-bubble {","left: "+parseInt(v.BUBBLE_RIGHT_OFFSET)+"px;","}",".olrk-fixed-top #olark-callout-bubble-offline {","top: "+parseInt(v.BUBBLE_TOP_OFFSET_OFFLINE)+"px;","}",".olrk-fixed-bottom #olark-callout-bubble-offline {","bottom: "+parseInt(v.BUBBLE_BOTTOM_OFFSET_OFFLINE)+"px;","}",".olrk-fixed-left #olark-callout-bubble-offline {","right: "+parseInt(v.BUBBLE_LEFT_OFFSET_OFFLINE)+"px;","}",".olrk-fixed-right #olark-callout-bubble-offline {","left: "+parseInt(v.BUBBLE_RIGHT_OFFSET_OFFLINE)+"px;","}",".olrk-fixed-left .olrk-left-align #olark-callout-bubble-offline {","left: "+parseInt(v.BUBBLE_RIGHT_OFFSET_OFFLINE)+"px;","}","#habla_window_div a:hover {","background-color:transparent;","}","#habla_available_div {","display: none;","}"].join("")}function a(e,t){function n(){e.style.height=parseInt(r.shift())+"px"}var i,o=function(e,t,n){var i=n,o=0,a=1,r=a-o,s=0;return s=(i/=r)<1/2.75?7.5625*a*i*i+o:2/2.75>i?a*(7.5625*(i-=1.5/2.75)*i+.75)+o:2.5/2.75>i?a*(7.5625*(i-=2.25/2.75)*i+.9375)+o:a*(7.5625*(i-=2.625/2.75)*i+.984375)+o,e+(t-e)*s},a={duration:1e3,interval:10,from:0,to:100,easingFunc:o};for(i in t)t.hasOwnProperty(i)&&(a[i]=t[i]);var r=[],s=a.duration/a.interval;for(i=0;s>i;++i)r.push(a.easingFunc(a.from,a.to,i/s));for(i=0;i<r.length;++i)!function(t){setTimeout(function(){n(e,t)},a.interval*i)}(r[i])}function r(e,t,n,i){function o(){n=parseInt(a.height),t=parseInt(a.width),!r&&n&&t&&(i(t,n),r=!0)}if(e)if(t||n)t&&n&&i(t,n);else{var a=new Image,r=!1;a.onload=o,a.src=e,o()}else i(t,n)}function s(e){r(v.BUBBLE_IMAGE_URL,v.BUBBLE_WIDTH,v.BUBBLE_HEIGHT,function(t,n){v.BUBBLE_HEIGHT=n||v.DEFAULT_HEIGHT,v.BUBBLE_WIDTH=t||v.DEFAULT_WIDTH,r(v.BUBBLE_IMAGE_URL_OFFLINE,v.BUBBLE_WIDTH_OFFLINE,v.BUBBLE_HEIGHT_OFFLINE,function(t,n){v.BUBBLE_HEIGHT_OFFLINE=n||v.DEFAULT_HEIGHT,v.BUBBLE_WIDTH_OFFLINE=t||v.DEFAULT_WIDTH,v.BUBBLE_BOTTOM_OFFSET=v.BUBBLE_BOTTOM_OFFSET||0,v.BUBBLE_TOP_OFFSET=v.BUBBLE_TOP_OFFSET||0,v.BUBBLE_LEFT_OFFSET=v.BUBBLE_LEFT_OFFSET||v.OFFSET.left,v.BUBBLE_RIGHT_OFFSET=v.BUBBLE_RIGHT_OFFSET||v.OFFSET.right,v.BUBBLE_BOTTOM_OFFSET_OFFLINE=0,v.BUBBLE_TOP_OFFSET_OFFLINE=0,v.BUBBLE_LEFT_OFFSET_OFFLINE=v.BUBBLE_LEFT_OFFSET_OFFLINE||v.OFFSET_OFFLINE.left,v.BUBBLE_RIGHT_OFFSET_OFFLINE=v.BUBBLE_RIGHT_OFFSET_OFFLINE||v.OFFSET_OFFLINE.right,e()})})}function _(){y.id="habla-callout-container",w.id="habla-callout-bubble-anchor",k.id="habla-callout-bubble-anchor-offline",x.id="olark-callout-bubble",S.id="olark-callout-bubble-offline",w.href="#",k.href="#",function(t){t=t||function(){return!1},w.onclick=function(){return v.CLICKED.set(!0),e.box.expand(),v.HIDE_WHEN_CLICKED&&v.CLICKED.get()&&d(),t()}}(w.onclick),function(e){e=e||function(){return!1},C.onclick=function(t){return v.X_CLICKED.set(!0),v.HIDE_WHEN_X_CLICKED&&v.X_CLICKED.get()&&(d(),t||(t=window.event),t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation()),e()}}(C.onclick),function(t){t=t||function(){return!1},k.onclick=function(){return v.CLICKED.set(!0),e.box.expand(),v.HIDE_WHEN_CLICKED&&v.CLICKED.get()&&d(),t()}}(k.onclick),function(e){e=e||function(){return!1},I.onclick=function(t){return v.X_CLICKED.set(!0),v.HIDE_WHEN_X_CLICKED&&v.X_CLICKED.get()&&(d(),t||(t=window.event),t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation()),e()}}(I.onclick),window.addEventListener&&!window.opera?(x.addEventListener("mouseover",function(){C.className="olark-callout-bubble-close-button"},!1),S.addEventListener("mouseover",function(){I.className="olark-callout-bubble-close-button"},!1)):window.attachEvent?(x.attachEvent("onmouseover",function(){C.className="olark-callout-bubble-close-button"}),S.attachEvent("onmouseover",function(){I.className="olark-callout-bubble-close-button"})):(x.onmouseover=function(){C.className="olark-callout-bubble-close-button"},S.onmouseover=function(){I.className="olark-callout-bubble-close-button"}),window.addEventListener&&!window.opera?(x.addEventListener("mouseout",function(){C.className=""},!1),S.addEventListener("mouseout",function(){I.className=""},!1)):window.attachEvent?(x.attachEvent("onmouseout",function(){C.className=""}),S.attachEvent("onmouseout",function(){I.className=""})):(S.onmouseout=function(){I.className=""},x.onmouseout=function(){C.className=""}),w.appendChild(x),x.appendChild(C),k.appendChild(S),S.appendChild(I)}function l(){var e=!v.BUBBLE_IMAGE_URL||""==v.BUBBLE_IMAGE_URL;v.HIDE_WHEN_CLICKED&&v.CLICKED.get()||e?d():v.HIDE_WHEN_X_CLICKED&&v.X_CLICKED.get()?d():u();var t=w.firstChild;!v.SLID.get()&&v.BUBBLE_SLIDE_EFFECT&&(t.style.visibility="hidden",t.style.height=0),x.style.display="block",S.style.display="none",!v.SLID.get()&&v.BUBBLE_SLIDE_EFFECT&&h()}function c(){var e=!v.BUBBLE_IMAGE_URL_OFFLINE||""==v.BUBBLE_IMAGE_URL_OFFLINE;v.HIDE_WHEN_CLICKED&&v.CLICKED.get()||e?d():v.HIDE_WHEN_X_CLICKED&&v.X_CLICKED.get()?d():(w.style.display="none",k.style.display="block")}function u(){w.style.display="block",k.style.display="none"}function d(){w.style.display="none",k.style.display="none",m()}function h(){var e=w.firstChild,t={to:parseInt(v.BUBBLE_HEIGHT),duration:750};
setTimeout(function(){e.style.visibility="visible",a(e,t),p()},2e3),v.SLID.set(!0)}function p(){clearTimeout(v.IDLE_TIMEOUT),v.IDLE_TIMEOUT=setTimeout(function(){f(),p()},2e4)}function f(){var e={from:parseInt(v.BUBBLE_HEIGHT)+20,to:parseInt(v.BUBBLE_HEIGHT),duration:750},t=w.firstChild;a(t,e)}function g(){var e=document.getElementById("habla_compressed_div"),t=document.getElementById("habla_panel_div");window.opera&&(e.style.height=parseInt(v.BUBBLE_HEIGHT)+"px"),b&&(e.style.height=parseInt(v.BUBBLE_HEIGHT+10)+"px",e.style.width=parseInt(t.offsetWidth)+"px")}function m(){var e=document.getElementById("habla_compressed_div");e.style.height=null,e.style.width=null}if(i("CalloutBubblePlugin.activated"),t.system.enable_attention_grabber!==!1){var v={};v.DEFAULT_WIDTH=164,v.DEFAULT_HEIGHT=153,v.PROTOCOL="https:"==document.location.protocol?"https:":"http:",v.DEFAULT_IMAGE_PATH=v.PROTOCOL+"//static.olark.com/images/thisisolark-trans.png",v.CLOSE_BUTTON_IMAGE_PATH=v.PROTOCOL+"//static.olark.com/images/close.png",v.BUBBLE_IMAGE_URL=void 0!=t.CalloutBubble.bubble_image_url?t.CalloutBubble.bubble_image_url:v.DEFAULT_IMAGE_PATH,v.BUBBLE_IMAGE_URL_OFFLINE=t.CalloutBubble.offline_bubble_image_url||t.CalloutBubble.bubble_image_url_offline||void 0,v.BUBBLE_HEIGHT=t.CalloutBubble.bubble_height||void 0,v.BUBBLE_WIDTH=t.CalloutBubble.bubble_width||void 0,v.BUBBLE_HEIGHT_OFFLINE=t.CalloutBubble.bubble_height_offline||void 0,v.BUBBLE_WIDTH_OFFLINE=t.CalloutBubble.bubble_width_offline||void 0,v.BUBBLE_BOTTOM_OFFSET=t.CalloutBubble.bubble_bottom_offset||void 0,v.BUBBLE_TOP_OFFSET=t.CalloutBubble.bubble_top_offset||void 0,v.BUBBLE_RIGHT_OFFSET=t.CalloutBubble.bubble_right_offset||void 0,v.BUBBLE_LEFT_OFFSET=t.CalloutBubble.bubble_left_offset||void 0,v.BUBBLE_BOTTOM_OFFSET_OFFLINE=t.CalloutBubble.bubble_bottom_offset_offline||void 0,v.BUBBLE_TOP_OFFSET_OFFLINE=t.CalloutBubble.bubble_top_offset_offline||void 0,v.BUBBLE_RIGHT_OFFSET_OFFLINE=t.CalloutBubble.bubble_right_offset_offline||void 0,v.BUBBLE_LEFT_OFFSET_OFFLINE=t.CalloutBubble.bubble_left_offset_offline||void 0,v.OFFSET=t.CalloutBubble.offset||{},v.OFFSET_OFFLINE=t.CalloutBubble.offset_offline||{},v.OFFSET.top=v.OFFSET.top||0,v.OFFSET.bottom=v.OFFSET.bottom||0,v.OFFSET.left=v.OFFSET.left||0,v.OFFSET.right=v.OFFSET.right||0,v.OFFSET_OFFLINE.top=v.OFFSET_OFFLINE.top||0,v.OFFSET_OFFLINE.bottom=v.OFFSET_OFFLINE.bottom||0,v.OFFSET_OFFLINE.left=v.OFFSET_OFFLINE.left||0,v.OFFSET_OFFLINE.right=v.OFFSET_OFFLINE.right||0,v.BUBBLE_SLIDE_EFFECT=t.CalloutBubble.slide||!1,v.HIDE_WHEN_CLICKED=t.CalloutBubble.hide_when_clicked||!1,v.HIDE_WHEN_X_CLICKED=t.CalloutBubble.hide_when_x_clicked||!0,v.IDLE_TIMEOUT=void 0,v.CLICKED=e.data.getConversationObject({key:"bubble-clicked",initialValue:!1}),v.X_CLICKED=e.data.getConversationObject({key:"bubble-x-clicked",initialValue:!1}),v.LOADED=!1,v.SLID=e.data.getConversationObject({key:"bubble-slid",initialValue:!1}),v.SSL_PAGE="https:"==v.PROTOCOL,v.SSL_PAGE&&(v.BUBBLE_IMAGE_URL&&(v.BUBBLE_IMAGE_URL=v.BUBBLE_IMAGE_URL.replace("http:","https:")),v.BUBBLE_IMAGE_URL_OFFLINE&&(v.BUBBLE_IMAGE_URL_OFFLINE=v.BUBBLE_IMAGE_URL_OFFLINE.replace("http:","https:")));var b="BackCompat"==document.compatMode,y=document.createElement("div"),w=document.createElement("a"),k=document.createElement("a"),x=document.createElement("div"),S=document.createElement("div"),C=document.createElement("div"),I=document.createElement("div");e.chat.onOperatorsAvailable(function(){v.LOADED&&(v.HIDE_WHEN_CLICKED&&v.CLICKED.set(!1),v.BUBBLE_SLIDE_EFFECT&&v.SLID.set(!1),l())}),e.chat.onOperatorsAway(function(){c()}),e.chat.onReady(function(){_(),s(function(){var e=o();if(n(e),!v.SLID.get()&&v.BUBBLE_SLIDE_EFFECT){var t=w.firstChild;t.style.visibility="hidden",t.style.height=0}var i=document.getElementById("habla_compressed_div");if(i.appendChild(w),i.appendChild(k),hbl.client.opavailable&&"away"!=hbl.client.opstatus?l():c(),v.BUBBLE_SLIDE_EFFECT)try{window.addEventListener("mousemove",p,!1)}catch(a){try{document.attachEvent("onmousemove",p)}catch(a){}}v.LOADED=!0})})}}var i=e("../testlog");t.exports=n},{"../testlog":47}],35:[function(e,t){function n(e,t,n){function i(e){e=e||{};var n=e.olark||window.olark,i=e.storage||s("CartSaver"),o=_(e.conf||t.CartSaver||{}),a=e.logger||r(),c=l(n,i,o);return c?(h(n,c,o),p(n,c),f(n,c),g(n,c,o,i),m(n,c,o,i),void 0):void a.warn("[olark] CartSaver disabled")}function o(e,t){for(var n=0;n<e.length;n++)t(n,e[n])}function a(e,t){for(var n=[],i=0;i<e.length;i++)n.push(t(i,e[i]));return n}function r(){return"undefined"!=typeof window&&window.console&&window.console.info&&window.console.error&&window.console.warn?window.console:{log:function(){},info:function(){},warn:function(){},error:function(){}}}function s(t){var n=e.data.getConversationObject({key:t,initialValue:{}});return{getItem:function(e){return n.get()[e]},setItem:function(e,t){var i=n.get();i[e]=t,n.set(i)}}}function _(e){return e.minimum_cart_value_for_notification=e.minimum_cart_value_for_notification||0,e.send_cart_value_notifications=!!e.send_cart_value_notifications,e.send_cart_removal_notifications=!!e.send_cart_removal_notifications,e.send_cart_addition_notifications=!!e.send_cart_addition_notifications,e.send_checkout_success_notifications=!!e.send_checkout_success_notifications,e.send_checkout_cancellation_notifications=!!e.send_checkout_cancellation_notifications,e.send_checkout_begin_notifications=!!e.send_checkout_begin_notifications,e.show_sku=!!e.show_sku,e}function l(e,t,n){return/^Magento\@/.test(n.version)?new v(e,t,n):void 0}function c(e,t){var n=t.show_sku?" ["+e.sku+"]":"",i="("+e.formattedPrice()+" x "+e.quantity+")";return"* "+e.name+n+" "+i}function u(e,t,n){var i=[],a=0,r=0;return o(e,function(e,n){a+=n.quantity,r+=n.quantity*n.price,i.push(c(n,t))}),n&&(i=[n(a,r)].concat(i)),i.join("\n")}function d(e,t,n,i){return u(n,t,function(t){return""+t+(1==t?" item ":" items ")+i+" (total now: "+e.formattedTotal()+")"})}function h(e,t,n){var i="has "+t.formattedTotal()+" of items in cart",o=a(t.items(),function(e,t){return c(t,n)});e("api.chat.updateVisitorStatus",{snippet:[i].concat(o)})}function p(e,t){e("api.chat.updateVisitorNickname",{snippet:t.formattedTotal(),source:"CartSaver"})}function f(e,t){t.customerName()&&e("api.visitor.updateFullName",{fullName:t.customerName()}),t.customerEmail()&&e("api.visitor.updateEmailAddress",{emailAddress:t.customerEmail()})}function g(e,t,n,i){n.send_cart_value_notifications&&(i.getItem("notifiedForCartBalance")?(n.send_cart_addition_notifications&&t.itemsAdded().length>0&&e("api.chat.sendNotificationToOperator",{body:d(t,n,t.itemsAdded(),"added to their cart")}),n.send_cart_removal_notifications&&t.itemsRemoved().length>0&&!t.currentlyHasEvent("clear_cart")&&e("api.chat.sendNotificationToOperator",{body:d(t,n,t.itemsRemoved(),"removed from their cart")})):t.total()>=n.minimum_cart_value_for_notification&&t.total()>0&&(i.setItem("notifiedForCartBalance",!0),e("api.chat.sendNotificationToOperator",{body:u(t.items(),n,function(){return"This customer now has "+t.quantity()+" items worth "+t.formattedTotal()+" in their cart"})})),0===t.quantity()&&i.setItem("notifiedForCartBalance",!1))}function m(e,t,n){(n.send_checkout_begin_notifications||n.send_checkout_success_notifications||n.send_checkout_cancellation_notifications)&&(n.send_checkout_begin_notifications&&t.currentlyHasEvent("checking_out")&&!t.previouslyHadEvent("checking_out")&&e("api.chat.sendNotificationToOperator",{body:u(t.items(),n,function(){return"Checking out with "+t.quantity()+" items worth "+t.formattedTotal()})}),n.send_checkout_success_notifications&&t.currentlyHasEvent("order_complete")?e("api.chat.sendNotificationToOperator",{body:"Order complete! Good job."}):n.send_checkout_cancellation_notifications&&t.currentlyHasEvent("clear_cart")&&e("api.chat.sendNotificationToOperator",{body:"Order cancelled and cart emptied."}))}function v(e,t,n){this._storage=t,this._currentState=n,this._previousState=this._storage.getItem("previousState")||{customer:{},items:[],magento:{}},this._cartDifferenceCache=null,this._mappedTypes={checkout_quote_destroy:"clear_cart",controller_action_predispatch_checkout_onepage_index:"checking_out",controller_action_predispatch_checkout_multishipping_index:"checking_out",controller_action_predispatch_checkout_controller_action_index:"checking_out",controller_action_layout_render_before_onestepcheckout_index_index:"checking_out",googlecheckout_checkout_before:"googlecheckout_begin",paypal_prepare_line_items:"paypal_begin",sales_order_place_after:"order_complete",checkout_submit_all_after:"order_complete",order_cancel_after:"order_cancelled",checkout_type_onepage_save_order:"order_complete",controller_action_predispatch_checkout_onepage_success:"order_complete",sales_quote_delete_after:"order_cancelled",sales_order_payment_cancel_invoice:"order_cancelled",sales_order_payment_void:"order_cancelled",sales_order_payment_refund:"order_cancelled",sales_order_payment_cancel:"order_cancelled",sales_order_invoice_cancel:"order_cancelled",sales_order_item_cancel:"order_cancelled"},this._saveState()}v.prototype._saveState=function(){this._storage.setItem("previousState",{customer:this._currentState.customer||this._previousState.customer,items:this._currentState.items,magento:this._currentState.magento})},v.prototype._getNonEmptyValue=function(e,t){return"string"!=typeof e||/^\s*$/.test(e)?t:e},v.prototype._containsEvent=function(e,t){if(!e)return!1;var n=this,i=!1;return o(e,function(e,o){var a=n._mappedTypes[o.type];a===t&&(i=!0)}),i},v.prototype._mapItems=function(e){return a(e||[],function(e,t){return{name:t.name||"Unknown Item",sku:t.sku,quantity:t.quantity||1,price:t.price||0,formattedPrice:function(){return t.magento.formatted_price||t.price||0}}})},v.prototype._cartDifference=function(){if(!this._cartDifferenceCache){var e={};o(this._currentState.items,function(t,n){e[n.name]=n}),o(this._previousState.items,function(t,n){var i=e[n.name]?e[n.name].quantity:0;e[n.name]=n,e[n.name].quantity=i-n.quantity});var t=[],n=[];for(var i in e)if(e.hasOwnProperty(i)){var a=e[i];a.quantity>0?t.push(a):a.quantity<0&&(a.quantity=-1*a.quantity,n.push(a))}this._cartDifferenceCache={additions:t,removals:n}}return this._cartDifferenceCache},v.prototype.customerName=function(){var e=this._currentState.customer.name||this._previousState.customer.name;return this._getNonEmptyValue(e)},v.prototype.customerEmail=function(){var e=this._currentState.customer.email||this._previousState.customer.email;return this._getNonEmptyValue(e)},v.prototype.total=function(){return this._currentState.magento.total||0},v.prototype.formattedTotal=function(){return this._currentState.magento.formatted_total||"0.00"},v.prototype.items=function(){return this._mapItems(this._currentState.items)},v.prototype.itemsAdded=function(){return this._mapItems(this._cartDifference().additions)},v.prototype.itemsRemoved=function(){return this._mapItems(this._cartDifference().removals)},v.prototype.currentlyHasEvent=function(e){return this._containsEvent(this._currentState.magento.recent_events,e)},v.prototype.previouslyHadEvent=function(e){return this._containsEvent(this._previousState.magento.recent_events,e)},v.prototype.quantity=function(){if(!this._calculatedQuantity&&0!==this._calculatedQuantity){this._calculatedQuantity=0;var e=this;o(this.items(),function(t,n){e._calculatedQuantity+=n.quantity})}return this._calculatedQuantity},n?(n.run=i,n.MagentoCart=v):i()}n.run=function(e){var t={};n(null,null,t),t.run(e)},t.exports=n},{}],36:[function(e,t){function n(e,t){var n=function(e,t){return"undefined"!=typeof e?e:t},i=n(t.ClickToChat.use_title_text_for_notifications,!0),o=t.ClickToChat.hide_chatbox?!0:!1,a=n(t.ClickToChat.show_as_tab,!1),r=n(t.ClickToChat.use_default_images,!1),s=e.data.getConversationObject({key:"boxWasShown",initialValue:!1}),_=function(e){var t=document.createElement("style");t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e));var n=document.getElementsByTagName("head")[0];n.insertBefore(t,n.firstChild)};if(o&&!s.get()&&e.box.hide(),e.box.onShow(function(){s.set(!0)}),e.box.onExpand(function(){s.set(!0)}),a){var l=function(e){return e+="#olark-click-to-chat-tab {",e+="position: fixed;",e+="left: 0;",e+="bottom:40%;  ",e+="z-index:5000;",e+="}",e+="#olark-click-to-chat-tab div {",e+="height: 150px;",e+="width: 150px;",e+="float: left;",e+="filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);",e+="-webkit-transform: rotate(-90deg); ",e+="-moz-transform: rotate(-90deg);",e+="}",e+="#olark-click-to-chat-tab a {",e+="background-color: black;",e+="color: white;",e+='font: bold 18px "century gothic";',e+="height: 20px;",e+="padding: 6px;",e+="border: 2px solid #363636;",e+="display: block;",e+="text-decoration: none;",e+="text-align: center;",e+="width: auto;",e+="-webkit-border-bottom-right-radius:9px;",e+="-webkit-border-bottom-left-radius:9px;",e+="-moz-border-radius-bottomleft:9px;",e+="-moz-border-radius-bottomright:9px;",e+="border-top-style: none;",e+="border-top-width: 0;",e+="}",e+="#olark-click-to-chat-tab a:hover{",e+="background-color: white;",e+="color: black;",e+="}"},c=l("");_(c);var u=document.createElement("div"),d=document.createElement("div"),h=document.createElement("a");u.id="olark-click-to-chat-tab",h.target="olark",h.href="#",h.title="Olark Chat Tab",h.innerText="chat online",d.appendChild(h),u.appendChild(d),document.getElementsByTagName("body")[0].appendChild(u)}for(var p=document.getElementsByTagName("a"),f=p.length,g=function(n){!function(n,o){o=o||function(){return!1};var a=function(e,t){t=t||[];var n=e.childNodes;if(/.*(un)?available.*/.test(e.className))t.push(e);else if(n.length)for(var i=n.length;i--;){var o=n[i];a(o,t)}return t},s=a(n);if(s.length>0||r){for(var _="http://static.olark.com/images/image-orangelark-available.png",l="http://static.olark.com/images/image-orangelark-unavailable.png",c=s.length;c--;){var u=s[c--];"available"==u.cssClass?_=u.src:"unavailable"==u.cssClass&&(l=u.src)}var d=t.system.olark_key,h=document.createElement("img");h.border="0",h.src="http://images-async.olark.com/status/"+d+"/image.png?online="+_+"&offline="+l,n.appendChild(h)}var p=function(){};p=t.ClickToChat.launch_with_popout?function(){e.box.popout()}:function(){e.box.expand()},n.onclick=function(){p();var t=n.title;return i&&t&&t.length&&e.chat.sendNotificationToOperator({body:"clicked to chat from '"+t+"'"}),o()}}(n,n.onclick)};f--;){var m=p[f];"olark"==m.target&&(m.href="#",g(m))}}t.exports=n},{}],37:[function(e,t){function n(e,t){function n(e){return t.locale.hasOwnProperty(e)&&t.locale[e]?t.locale[e]:h.hasOwnProperty(e)?h[e]:"MISSING TRANSLATION: "+e}function a(e){return hbl.util.encode_html_entities(n(e))}function r(e){var t=this;e=e||{},this._api=e.legacyOlarkAPI,this._win=e.window||window,this._doc=this._win.document,this._accountToken=e.accountToken,this._apiToken=e.apiToken,this._libraryURL=e.libraryURL,this._silent=e.silent,this._maskedSelectors=e.maskedSelectors,this._showSecureElements=e.showSecureElements,this._conversationId=e.conversationId,this._calls=[],this._fireflyLoadTimeout=null,this._didTimeout=!1,this._currentSessionName=this._api.data.getConversationObject({key:"currentSessionName"}),this._currentSessionName.get()||this._currentSessionName.set((new Date).getTime()),this._connectionTimer=null,this._connecting=!1,this._waitingForAccept=!1,this._active=this._api.data.getConversationObject({key:"active"}),this._active.get()&&this._ensureFireflyIsAvailable(),this._declined=this._api.data.getConversationObject({key:"declined"}),this._ended=this._api.data.getConversationObject({key:"ended"}),this._lastURL=this._api.data.getConversationObject({key:"lastURL"}),this._operatorName=null,this._api.chat.onMessageToVisitor(function(e){t._operatorName=e.message.nickname}),this.on("cobrowsingEnded",function(){t._notifyOperator(n("cobrowsing_notify_operator_end_text")),t._notifyVisitor(a("cobrowsing_notify_visitor_end_text")),t._clearConnection()}),this.on("repControlRequested",function(){if(t._silent)t.grantRepControl(!0);else{var e=window.confirm(n("cobrowsing_confirm_control_text"));e&&t._notifyVisitor(a("cobrowsing_notify_visitor_control_text")),t.grantRepControl(e)}}),this.set("theme","black"),this.set("whitelabel",!0),this._maskSecureFields(),this._api.chat.__SPI_onInterfaceElementReady(function(e){t._populateInterface(e.key,e.dom)}),this._api.chat.__SPI_onEndedStateChanged(function(){t._active.get()&&t._endSession()})}i("CobrowsingPlugin.activated");var s="507dd5f988a1113547000001",_="507dd5f985dbad354701c5b6",l="https://firefly-071591.s3.amazonaws.com/scripts/loaders/loader.js",c=15e3,u=15e3,d=["on","set","start","startAPI","grantRepControl"],h={cobrowsing_notify_visitor_end_text:"Cobrowsing has ended.",cobrowsing_confirm_control_text:"Would you like the operator to take control of your browser?",cobrowsing_notify_visitor_control_text:"The operator is now controlling your browser.",cobrowsing_visitor_confirm_allow_message:"Do you want to allow the operator to view your browser window?",cobrowsing_visitor_confirm_allow_button_start:"Start sharing.",cobrowsing_visitor_confirm_allow_button_decline:"Decline.",cobrowsing_visitor_allow_approve_message:"You're now sharing your browser.",cobrowsing_allow_approve_button_stop:"End sharing.",cobrowsing_notify_visitor_decline_text:"Cobrowsing declined.",cobrowsing_notify_visitor_browser_not_supported:"We are sorry, but it looks like your internet browser does not support cobrowsing. Cobrowsing is currently only available in modern browsers.",cobrowsing_notify_operator_browser_not_supported:"We are sorry, but it looks like the visitor's internet browser does not support cobrowsing. Cobrowsing is currently only available in modern browsers.",cobrowsing_notify_operator_end_text:"Visitor has ended cobrowsing.",cobrowsing_notify_operator_decline_text:"The visitor has declined the cobrowse session.",cobrowsing_notify_operator_slow_connection_text:"Looks like connecting with the browser is going slowly, please contact us if this happens often",cobrowsing_notify_operator_start_conversation_text:"Please start a conversation before requesting to share the visitors browser window.",cobrowsing_notify_operator_share_link_text:"See what they see",cobrowsing_notify_operator_waiting_to_accept_text:"Waiting for visitor to accept cobrowsing...",cobrowsing_notify_operator_connecting_text:"Connecting with the visitor's browser...",cobrowsing_notify_operator_decline_share_text:"The visitor declined the cobrowsing session.",cobrowsing_notify_operator_unable_to_start_text:"Unable to start cobrowsing session, please contact us if this happens often"};!function(t){for(var i in d)!function(e){t[e]=function(){this._calls.push({method:e,args:arguments}),this._dequeueCalls()}}(d[i]);t._isSupported=function(){return window.document.querySelector&&window.document.querySelectorAll},t.debug=function(e){return this._debugMode=e,this._debugMode},t.share=function(){e.chat.__SPI_isConversing()||this._debugMode?(this._declined.set(!1),this._ended.set(!1),this._ensureSharing(),this._debugMode&&this._startSharing()):this._notifyOperator(n("cobrowsing_notify_operator_start_conversation_text"))},t._ensureSharing=function(){return this._ensureFireflyIsAvailable(),this._lastURL.get()?void this._notifyOperator(n("cobrowsing_notify_operator_share_link_text")+" ==> "+this._lastURL.get()):void(this._isSupported()?(this._notifyOperator(n("cobrowsing_notify_operator_waiting_to_accept_text")),this._waitingForAccept||(this._waitingForAccept=!0,this._createInterface("confirmation-box-"+this._currentSessionName.get()))):(olark._.hlog("#cobrowsing_not_supported"),this._notifyOperator(n("cobrowsing_notify_operator_browser_not_supported")),this._notifyVisitor(a("cobrowsing_notify_visitor_browser_not_supported"))))},t._startSharing=function(){var e=this;this._ensureFireflyIsAvailable(),this._currentSessionName.set((new Date).getTime()),this._notifyOperator(n("cobrowsing_notify_operator_connecting_text")),this._startConnection();try{var t={suppressUI:!0,partnerSessionID:this._conversationId};this.start(this._apiToken,t,function(t){var i=(new Date).getTime()-e._startConnectionTime;if(olark._.hlog("#cobrowsing_session_starting"),e._clearConnection(),e._active.set(!0),t){var o=t.replace(/.*olark\.usefirefly\.com\//,"https://static.olark.com/view/#");e._notifyOperator(n("cobrowsing_notify_operator_share_link_text")+" ==> "+o),e._lastURL.set(t),e._createInterface("cobrowse-terminate-"+e._currentSessionName.get()),olark._.hlog("#cobrowsing_session_started"),olark._.hlog("#cobrowsing_connection_time="+i),e._debugMode&&console.log("[olark] Cobrowsing connected in",i,"ms")}else e._notifyOperator(n("cobrowsing_notify_operator_decline_share_text"))})}catch(i){window.console&&window.console.warn&&(window.console.warn("[olark] unable to start cobrowsing session: "+i),olark._.hlog("#cobrowsing_exception "+i)),this._notifyOperator(n("cobrowsing_notify_operator_unable_to_start_text")+": beta+cobrowsing@olark.com")}},t._notifyOperator=function(e){this._debugMode?window.console&&console.info&&console.info("[cobrowse] would have notified operator:",e):this._api.chat.sendNotificationToOperator({body:e})},t._notifyVisitor=function(e){this._api.chat.sendNotificationToVisitor({body:e})},t._createInterface=function(e){this._api.chat.__SPI_sendInterfaceElementToVisitor({key:e})},t._populateInterface=function(e,t){var n=this,i=e.split("-").pop();switch(!0){case/^confirmation\-box\-/i.test(e):t.innerHTML=a("cobrowsing_visitor_confirm_allow_message")+" <span style='display:block;text-align:right;'><button data-action='start'>"+a("cobrowsing_visitor_confirm_allow_button_start")+"</button><button data-action='decline'>"+a("cobrowsing_visitor_confirm_allow_button_decline")+"</button></span>";for(var o=t.querySelectorAll("button"),r=function(){for(var e=0;e<o.length;e++)o[e].disabled=!0},s=0;s<o.length;s++){var _=o[s];(n._declined.get()||n._active.get()||n._ended.get())&&(_.disabled=!0),i!=n._currentSessionName.get()&&(_.disabled=!0),_.onclick=function(e){e=e||window.event;var t=e.target||e.srcElement,i=t.attributes["data-action"].value;"start"===i?n._lastURL.get()||n._handleConfirmation.apply(n,[e]):n._handleDecline.apply(n,[e]),r()}}break;case/^cobrowse\-terminate\-/i.test(e):t.innerHTML=a("cobrowsing_visitor_allow_approve_message")+"<span style='display:block;text-align:right;'><button>"+a("cobrowsing_allow_approve_button_stop")+"</button></span>";var l=t.querySelector("button");!this._declined.get()&&this._active.get()&&this._ended.get()||(l.disabled=!0),i!=n._currentSessionName.get()&&(l.disabled=!0),l.onclick=function(e){e=e||window.event;var t=e.target||e.srcElement;n._handleStop.apply(n,[e]),t.disabled=!0}}},t._handleConfirmation=function(){return olark._.hlog("#cobrowsing_session_requested"),this._waitingForAccept=!1,this._startSharing(),!1},t._handleDecline=function(){return olark._.hlog("#cobrowsing_session_declined"),this._waitingForAccept=!1,this._notifyOperator(n("cobrowsing_notify_operator_decline_text")),this._notifyVisitor(a("cobrowsing_notify_visitor_decline_text")),this._declined.set(!0),this._currentSessionName.set((new Date).getTime()),!1},t._handleStop=function(){return olark._.hlog("#cobrowsing_session_stopped"),this._endSession(),!1},t._endSession=function(){var e=this._firefly();e&&this._active.get()&&(e.endSession(),this._clearConnection())},t._ensureFireflyIsAvailable=function(){var e=this._firefly();if(!e||e.token!==this._accountToken&&!e.hasOwnProperty("ready")){window.fireflyAPI={token:this._accountToken,ready:function(e){"function"==typeof e&&(e=[e]);var t=null;if(window.fireflyAPI.onLoaded=window.fireflyAPI.onLoaded||[],window.fireflyAPI.isLoaded)for(t in e)e.hasOwnProperty(t)&&e[t]();else for(t in e)e.hasOwnProperty(t)&&window.fireflyAPI.onLoaded.push(e[t])}};var t=this._doc.createElement("script");t.type="text/javascript",t.src=this._libraryURL,t.async=!0;var n=this._doc.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);var i=this;this._fireflyLoadTimeout=setTimeout(function(){i._checkFireflyHasLoaded()},u),this._startLoadTime=(new Date).getTime(),this._firefly().ready(function(){i._checkFireflyHasLoaded()})}},t._firefly=function(){return window.fireflyAPI},t._ready=function(){var e=this._firefly();return e&&e.start?!0:!1},t._dequeueCalls=function(){if(this._ready())for(var e=this._firefly();this._calls.length;){var t=this._calls.shift();e[t.method].apply(e,t.args)}},t._checkFireflyHasLoaded=function(){if(this._ready()){var e=(new Date).getTime()-this._startLoadTime;if(olark._.hlog("#cobrowsing_load_time="+e),this._debugMode&&console.log("[olark] Cobrowsing API loaded in",e,"ms"),this._didTimeout)olark._.hlog("#cobrowsing_loaded_after_timeout");else if(clearTimeout(this._fireflyLoadTimeout),this._debugMode){var t=this;setTimeout(function(){t._dequeueCalls()},1)}else this._dequeueCalls()}else this._didTimeout=!0,window.console&&window.console.warn&&window.console.warn("[olark] unable to load cobrowsing javascript"),olark._.hlog("#cobrowsing_not_loaded"),this._notifyOperator(n("cobrowsing_notify_operator_unable_to_start_text")+": support@olark.com")},t._startConnection=function(){function e(){t._connecting&&(t._notifyOperator(n("cobrowsing_notify_operator_slow_connection_text")+": beta+cobrowsing@olark.com"),t._clearConnection(),olark._.hlog("#cobrowsing_session_timeout"))}var t=this;this._connecting=!0,this._startConnectionTime=(new Date).getTime(),this._connectionTimer=setTimeout(e,c)},t._clearConnection=function(){this._connecting=!1,clearTimeout(this._connectionTimer),this._connectionTimer=null,this._lastURL.set(null),this._active.set(!1),this._declined.set(!1),this._ended.set(!0)},t._forEachDomElement=function(e,t){for(var n=document.querySelectorAll(e),i=0;i<n.length;i++)t(n[i])},t._maskSecureFields=function(){function e(e,t){var n=t.toLowerCase(),i=t.toUpperCase(),o=t.replace(/([^a-z0-9]|\b)([a-z0-9])/gi,function(e,t,n){return t+n.toUpperCase()});return["["+e+"*="+n+"]","["+e+"*="+i+"]","["+e+"*="+o+"]"].join(",")}var t=this._maskedSelectors;t=t.concat([e("name","Ecom_Payment"),e("name","credit_card"),e("name","creditcard"),e("type","hidden"),e("type","password"),e("name","hidden"),e("name","password"),e("name","secret"),e("name","auth"),e("name","token")]),this._showSecureElements&&this._forEachDomElement(t.join(","),function(e){e.style.boxShadow="0 0 8px yellow"}),this.set("masking",{"*":t})}}(r.prototype);var p=new o({idStorageKey:"olark.activeBrowserTab"}),f=new r({legacyOlarkAPI:e,accountToken:t.system.firefly_account_token||_,apiToken:t.system.firefly_api_token||s,libraryURL:t.system.firefly_library_url||l,silent:t.system.prompt_visitor_for_cobrowsing||!1,maskedSelectors:t.system.masked_selectors_for_cobrowsing||[],showSecureElements:t.system.show_secure_cobrowsing_elements,conversationId:olark._.conversationId});olark("api.chat.onCommandFromOperator",function(e){"see"===e.command.name&&p.primary()&&(olark._.hlog("#cobrowsing_session_requested"),f.debug(!1),f.share())}),olark._.triggerFireflyDebug=function(){f.debug(!0),f.share()}}var i=e("../testlog"),o=e("browsertab");t.exports=n},{"../testlog":47,browsertab:2}],38:[function(e,t){function n(e,t){function n(e,t){var n=document.createElement("input");return n.type="submit",n.value=e,n.onclick=t,n.className="habla_offline_submit_input",n}function i(){var e=document.getElementById("habla_end_convo_div");if(!e){var t=document.getElementById("habla_conversation_div");e=document.createElement("div"),e.id="habla_end_convo_div",t.appendChild(e)}var i=document.createElement("p"),o=document.createElement("em");o.innerText=_.end_conversation_placeholder,i.appendChild(o);var r=document.createElement("hr"),s=document.createElement("div"),l=n(_.restart_conversation_input_text,a);s.id="habla_pre_chat_div",e.className="hbl_panel habla_offline_message_div hbl_pal_control_border hbl_pal_main_fg",s.appendChild(l),e.appendChild(i),e.appendChild(r),e.appendChild(s),e.style.clear="both",e.style.display="block"}function o(){var e=document.getElementById("habla_end_convo_div");e&&(e.style.display="none")}function a(){olark._.identityManager.deleteConversationId(),setTimeout(function(){window.location.reload()},1)}function r(){olark._.identityManager.deleteConversationId(),e.box.hide(),olark._.hlog("disabling chatbox due to #convo_ended_before_begin"),window.console&&console.warn&&window.console.warn("[olark] conversation expired, disabling chatbox"),e.box.__SPI_disableUserInterface(),e.chat.__SPI_disableChatConnection()}function s(e){e.is_ended?e.is_conversing?(i(),olark._.identityManager.keepConversationIdAlive()):r():o()}var _={end_conversation_placeholder:t.locale.end_conversation_placeholder||"Conversation ended",restart_conversation_input_text:t.locale.restart_conversation_input_text||"Start a new chat"};t.system.allow_end_conversation&&e.chat.onReady(function(){setTimeout(function(){e.chat.__SPI_getEndedState(function(t){t.is_ended?s(t):e.chat.__SPI_onEndedStateChanged(s)})})})}t.exports=n},{}],39:[function(e,t){var n=e("../testlog"),i=function(e,t){function i(e,t){N&&window.console&&window.console[e]&&window.console[e](t)}function o(e){return e.replace(/[^\w\)\(\d]/g,"_").replace(/\_[\_]*/,"_")}function a(e){window.console&&window.console.warn&&window.console.warn(e)}function r(e,t){if(i("log",arguments),E){if("send"==e)if("pageview"==t)_([V+"_trackPageview"]);else if("event"==t){var n=[V+"_trackEvent"].concat(Array.prototype.slice.call(arguments,2));_(n)}else i("log","unknown command: "+t)}else{var o=Array.prototype.slice.call(arguments,0),a="";C&&(a=C+"."),o[0]=a+o[0],x.apply(x,o)}}function s(e){if(!x)return void i("error","GA_OBJECT not found");var t=x,n=function(){var n=C;if(t.getByName(n))return void i("debug","trackingId already found, using it");var o=t.getAll();if(!e&&o.length>0){var a=o[0];e=a.get("trackingId")}e?(i("debug","creating tracking ID for prefix "+n),t.create(e,{name:n})):i("error","GA trackingId couldn't be found")};t(n)}function _(e){i("log",e);try{window._gaq.push(e)}catch(t){}}function l(e){window._gaq=window._gaq||[],e&&(_([V+"_setAccount",e]),null!=v&&_([V+"_setAllowLinker",v]),null!=b&&_([V+"_setAllowHash",b]),null!=y&&_([V+"_setDomainName",y]),null!=w&&_(w))}function c(e){if(e._getAccount)return e._getAccount();var t=void 0;for(var n in e)"string"==typeof e[n]&&e[n].match(/UA\-/)&&(t=e[n]);return t}function u(){var e=["_getTracker","ByName"].join(""),t=window._gat&&window._gat[e],n=window.pageTracker,o=!t&&window._gaq,r=p&&!t&&!o&&E;if(h&&(V="olark."),r)m?(!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}(),l(m),_([V+"_trackPageview"])):i("error","Cannot load Google Analytics Tracking without Tracking ID");else if(E)if(h)m?l(m):i("error","Cannot create Custom Google Analytics Tracker without Tracking ID");else if(n){var u=c(window.pageTracker);"UA-XXXXX-X"!=u&&u&&f?l(u):i("error","Cannot determine Tracking ID for Google Analytics legacy tracker id is: "+u)}else if(t){var d=c(window._gat[e]()),g="UA-XXXXX-X"==d;g&&i("error","Cannot determine Tracking ID for Google Analytics, _gat is loaded")}else if(o){for(var v=!1,b=0;b<window._gaq.length;b++){var y=window._gaq[b];if(y&&"_setAccount"==y[0]){v=y[1];break}}v||i("error","Cannot determine Tracking ID for Google Analytics _gaq")}else a("Olark Google Analytics Integration is unable to detect Google Analytics on this page");else S||s(I||m),i("log","using new analytics.js api")}function d(){var e=W.get(),t=D.get(),n=H.get(),i=t>n?!0:!1,s="automated"==q.get(),l="";l=i?e+" initiated":s?"Olark Targeted Chat initiated":"Visitor initiated with "+e,P&&(E?(null!=M&&_([V+"_setCustomVar",M,o(o(R)+":(Visitor) Had Conversation"),o(l),B]),null!=O&&_([V+"_setCustomVar",O,o(o(R)+":(Session)_Had_Conversation"),o(l),F]),null!=A&&_([V+"_setCustomVar",A,o(o(R)+":(Page) Had Conversation"),o(l),L]),g&&r("send","pageview")):a("Olark: Google Analytics Custom variables are not supported when using analytics.js"));
var c;i||s?(c=Math.floor((t-n)/1e3),(0>c||c>j)&&(c=0),r("send","event",o(o(R)),"Conversation",o(l),k?c:0)):(c=Math.floor((n-t)/1e3),(0>c||c>j)&&(c=0),r("send","event",o(o(R)),"Conversation",o(l),k?c:0))}n("GoogleAnalyticsPlugin.activated");var h=t.GoogleAnalytics.create_custom_tracker||null,p=t.GoogleAnalytics.load_ga_if_missing||null,f=void 0===t.GoogleAnalytics.legacy_compatibility?!0:t.GoogleAnalytics.legacy_compatibility,g=t.GoogleAnalytics.track_chat_start_page||null,m=(t.GoogleAnalytics.track_widget_events||null,t.GoogleAnalytics.tracking_id||null),v=t.GoogleAnalytics.allow_linker||null,b=t.GoogleAnalytics.allow_hash||null,y=t.GoogleAnalytics.domain||null,w=t.GoogleAnalytics.custom_config||null,k=t.GoogleAnalytics.track_message_delays||null,x=t.GoogleAnalytics.google_analytics_object||window.ga;!x&&window.hasOwnProperty("GoogleAnalyticsObject")&&(x=window[window.GoogleAnalyticsObject]);var S=t.GoogleAnalytics.use_default_tracker||!1,C=S?"":"olark",I=t.GoogleAnalytics.custom_tracking_id||null,T=t.GoogleAnalytics.force_legacy_mode||!1,E=T||!x,P=t.GoogleAnalytics.enable_custom_variables||null,O=t.GoogleAnalytics.had_conversation_session_slot_number||null,A=t.GoogleAnalytics.had_conversation_page_slot_number||null,M=t.GoogleAnalytics.had_conversation_visitor_slot_number||null,N=t.GoogleAnalytics.debug||document.location.toString().match(/__debug_ga/)||null,B=1,F=2,L=3,j=1200,V="",R="Olark Chat",D=e.data.getConversationObject({key:"lastMessageToOperatorSent",initialValue:null}),H=e.data.getConversationObject({key:"lastMessageToVisitorSent",initialValue:null}),q=e.data.getConversationObject({key:"lastMessageSent",initialValue:null}),U=e.data.getConversationObject({key:"isConversation",initialValue:null}),W=e.data.getConversationObject({key:"lastOperatorNickname",initialValue:""});N&&(window.olark._.ga_debug=this),e.chat.onReady(function(){u(),e.chat.onMessageToVisitor(function(e){var t=D.get(),n=e.message.nickname,i=e.message.automated;if("visitor"==q.get()||null==H.get()){var a=0;D.get()&&(a=Math.floor((+new Date-D.get())/1e3),(0>a||a>j)&&(a=0)),i?r("send","event",o(R),o("Olark Targeted Chat Sent a Message"),o("Targeted"),k?a:0):r("send","event",o(R),o("Operator Sent a Message"),o(n),k?a:0),H.set(+new Date)}null==H.get()&&H.set(+new Date),W.set(n),t&&!U.get()&&d(),U.set(t),q.set(i?"automated":"operator")}),e.chat.onMessageToOperator(function(){var e=H.get();if("operator"==q.get()||"automated"==q.get()||null==D.get()){var t=0;D.get()&&(t=Math.floor((+new Date-D.get())/1e3),(0>t||t>j)&&(t=0)),r("send","event",o(R),o("Visitor Sent a Message"),o("true"),k?t:0),D.set(+new Date)}null==D.get()&&D.set(+new Date),e&&!U.get()&&d(),U.set(e),q.set("visitor")}),olark("api.chat.onOfflineMessageToOperator",function(){r("send","event",o(R),o("Visitor Sent an Offline Message"),o("true"),0)})})};t.exports=i},{"../testlog":47}],40:[function(e,t){function n(e,t){t.system.offline_msg_mode=1,t.system.habla_name_input_text=t.OfflineMessaging.field_text_for_name||"click here and type your Name",t.system.habla_offline_email_text=t.OfflineMessaging.field_text_for_email||"click here and type your Email",t.system.habla_offline_body_text=t.OfflineMessaging.field_for_offline_message_body||"We are offline, send us a message",t.system.habla_offline_submit_value=t.OfflineMessaging.button_text_for_send||"Send",t.system.habla_offline_sent_text=t.OfflineMessaging.thankyou_text||"Thank you for your message.  We will get back to you as soon as we can."}t.exports=n},{}],41:[function(e,t){function n(e,t){t.system.require_name="undefined"==typeof t.PrechatSurvey.require_name?!0:t.PrechatSurvey.require_name,t.system.require_phone="undefined"==typeof t.PrechatSurvey.require_phone?!1:t.PrechatSurvey.require_phone,t.system.require_email="undefined"==typeof t.PrechatSurvey.require_email?!0:t.PrechatSurvey.require_email,t.PrechatSurvey.field_text_for_name&&(t.system.habla_name_input_text=t.PrechatSurvey.field_text_for_name),t.PrechatSurvey.field_text_for_email&&(t.system.habla_offline_email_text=t.PrechatSurvey.field_text_for_email),t.PrechatSurvey.error_text&&(t.system.pre_chat_error_text=t.PrechatSurvey.error_text),t.system.show_pre_chat=1,t.system.require_name=t.system.require_name?2:0,t.system.require_phone=t.system.require_phone?2:0,t.system.require_email=t.system.require_email?2:0}t.exports=n},{}],42:[function(require,module,exports){function ShopifyPlugin(api,conf){function thisFunctionWasCalledByShopifyApi(){var e=parentWindow.Shopify||{};for(var t in e)try{if(e[t]==arguments.callee.caller.caller)return!0}catch(n){}return!1}function handleNoteCommand(e){var t="put",n=void 0,i=void 0,o=notes.get();if(/^\s*\d+\s*$/i.test(e.body)){t="get";try{n=/^\s*(\d+)\s*$/i.exec(e.body)[1]}catch(a){}}if(/^remove\s+\d+\s*$/i.test(e.body)){t="remove";try{n=/^remove\s+(\d+)\s*$/i.exec(e.body)[1]}catch(a){}}"undefined"!=typeof n&&(i=n-1);var r;switch(t){case"get":void 0!==i&&i>-1&&i<o.length?(r=o[i],r="Note "+n+": "+r,api.chat.sendNotificationToOperator({body:r})):api.chat.sendNotificationToOperator({body:"No note found"});break;case"remove":void 0!==i&&i>-1&&i<o.length&&(o.splice(i,1),r="Note "+n+" removed",api.chat.sendNotificationToOperator({body:r}));break;default:if(e.body)o.push(e.body),r="Note "+o.length+" added",api.chat.sendNotificationToOperator({body:r});else{var s=renderPrettyNotes(o);r=s.length?s.join("\n").replace(/^(.*)/,"\n$1"):"No Notes",api.chat.sendNotificationToOperator({body:r})}}}var parentWindow=window,SHOPIFY_SITE_URL=conf.Shopify.store_url||"",SHOPIFY_JQUERY_API_URL=conf.Shopify.shopify_api_jquery_url||SHOPIFY_SITE_URL+"/shopify/api.jquery.js",SHOPIFY_PROTOTYPE_API_URL=conf.Shopify.shopify_api_prototype_url||SHOPIFY_SITE_URL+"/shopify/api.js",JQUERY_URL="http://ajax.googleapis.com/ajax/libs/jquery/1.4.1/jquery.min.js",DEFAULT_MINIMUM_CART_VALUE_THRESHOLD=50,minimumCartValueForNotification=conf.Shopify.minimum_cart_value_for_notification||DEFAULT_MINIMUM_CART_VALUE_THRESHOLD,sendCartValueNotifications=conf.Shopify.send_cart_value_notifications;"undefined"==typeof sendCartValueNotifications&&(sendCartValueNotifications=!0);var sendCartRemovalNotifications=conf.Shopify.send_cart_removal_notifications;"undefined"==typeof sendCartRemovalNotifications&&(sendCartRemovalNotifications=!0);var operatorNickname=api.data.getConversationObject({key:"operatorNickname",initialValue:!1}),lastState=api.data.getConversationObject({key:"lastState",initialValue:{}}),notes=api.data.getConversationObject({key:"notes",initialValue:[]}),handleCommands=api.chat.onCommandFromOperator(function(e){var t=e.command;switch(t.name){case"note":handleNoteCommand(t),syncOlarkOperatorCartAttributes()}}),loadScript=null,do_async_call=null;!function(){var e=200,t=1e4;do_async_call=function(e,t){var n=e.delay,i=setTimeout(t,n);return i};var n={};loadScript=function(i,o){if("string"!=typeof i.url)throw new Error("[olark] string 'url' is required");var a=i.url,r=i.existenceCheck?function(){return i.existenceCheck()?!0:!1}:function(){return!1};if(o=o||function(){},!r()&&1!=n[a]){n[a]=!0;var s=!1;parentWindow.opera&&(s=!0);var _=document.createElement("script"),l=function(){},c=function(e){setTimeout(e.callback,e.delay)};if(s){var u=0;l=function(){var n=u>t?!0:!1;r()||n?o():(u+=e,c({delay:e,callback:l}))}}else _.onreadystatechange=function(){("loaded"==_.readyState||"complete"==_.readyState)&&(_.onreadystatechange=null,o())},_.onload=function(){o()};_.type="text/javascript",_.src=a,_.setAttribute("async",""),_.setAttribute("defer","true");var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(_,d),l()}}}();var withExternalDependenciesMet=function(e){var t=function(){return!((parentWindow.Shopify?0:1)||"object"!=typeof parentWindow.Shopify||("function"==typeof parentWindow.Shopify.getCart?0:1)||(parentWindow.Shopify.updateCartAttributes?0:1))},n=function(){return!((parentWindow.Shopify?0:1)||"object"!=typeof parentWindow.Shopify||("function"==typeof parentWindow.Shopify.getCart?0:1)||(parentWindow.Shopify.updateCartAttributes?1:0)||(parentWindow.ajaxifyShopify?0:1))},i=function(){return!((parentWindow.Shopify?0:1)||"object"!=typeof parentWindow.Shopify||("function"==typeof parentWindow.Shopify.getCart?0:1)||(parentWindow.Shopify.updateCartAttributes?1:0))},o=function(){return parentWindow.jQuery?!0:!1},a=function(){return parentWindow.Prototype?!0:!1};a()&&!t()?i()?e():loadScript({url:SHOPIFY_PROTOTYPE_API_URL,existenceCheck:i},function(){e()}):o()?t()?e():n()?(parentWindow.Shopify.updateCartAttributes=function(e,t){var n="";parentWindow.jQuery.isArray(e)?parentWindow.jQuery.each(e,function(e,t){var i=parentWindow.attributeToString(t.key);""!==i&&(n+="attributes["+i+"]="+parentWindow.attributeToString(t.value)+"&")}):"object"==typeof e&&null!==e&&parentWindow.jQuery.each(e,function(e,t){n+="attributes["+parentWindow.attributeToString(e)+"]="+parentWindow.attributeToString(t)+"&"});var i={type:"POST",url:"/cart/update.js",data:n,dataType:"json",success:function(e){"function"==typeof t?t(e):parentWindow.Shopify.onCartUpdate(e)},error:function(e,t){parentWindow.Shopify.onError(e,t)}};parentWindow.jQuery.ajax(i)},e()):loadScript({url:SHOPIFY_JQUERY_API_URL,existenceCheck:t},function(){e()}):loadScript({url:JQUERY_URL,existenceCheck:o},function(){loadScript({url:SHOPIFY_JQUERY_API_URL,existenceCheck:t},function(){e()})})},operatorNotified=api.data.getConversationObject({key:"operatorNotified",initialValue:!1,backup:"sh1",backupTransform:function(e){return"true"==e?!0:!1}}),setOnCartUpdateCallback=function(e,t){if(e)parentWindow.Shopify.onCartUpdate=t;else{var n=parentWindow.Shopify.onCartUpdate,i=t;try{var o=parentWindow.alert;parentWindow.alert=function(){if(thisFunctionWasCalledByShopifyApi())try{console.warn.apply(console,arguments)}catch(e){}else o.apply(parentWindow,arguments)}}catch(a){}parentWindow.Shopify.onCartUpdate=function(e,t){n(e,t),i(e)}}},renderPrettyPrice=function(e){var t=conf.Shopify.money_format||parentWindow.Shopify.money_format,n=parentWindow.Shopify.formatMoney(e,t).replace(/\.00$/,"").replace(/(\d)(\s*)(\d)/,"$1$3").replace(/([^\w\.]+)\s+(\d+)/,"$1$2");if(-1!==n.indexOf("<span")){var i=/\>([^\>]+)\<\//.exec(n);i&&(n=i[1].replace(/\s*$/,"").replace(/^\s*/,""))}return n},renderPrettyNotes=function(e){var t=[];if(e&&e.length)for(var n=0;n<e.length;n++)t.push("Note "+(n+1)+": "+e[n]);return t},renderPrettyShopifyCartContents=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],o="* "+i.title.substr(0,15)+" ("+renderPrettyPrice(i.price);i.quantity>1&&(o+=" x "+i.quantity),o+=")",t.push(o)}return t},processShopifyCart=function(e){function t(e){var t=lastState.get().items,n=e.items,i=[],o={},a=!1;for(var r in t)if(t.hasOwnProperty(r)){a=!1;for(var s in n)if(n.hasOwnProperty(s)&&t[r].id==n[s].id&&(a=!0,t[r].line_price-n[s].line_price>0)){o={};for(var _ in n[s])n[s].hasOwnProperty(_)&&(o[_]=n[s][_]);o.changedPrice=t[r].line_price-n[s].line_price,o.changedQuantity=t[r].quantity-n[s].quantity,i.push(o)}if(!a){o={};for(var l in t[r])t[r].hasOwnProperty(l)&&(o[l]=t[r][l]);o.changedPrice=t[r].line_price,o.changedQuantity=t[r].quantity,o.quantity=0,o.line_price=0,i.push(o)}}return i}function n(e){return["	-",renderPrettyPrice(e.changedPrice)," (",e.changedQuantity," ",e.handle,")\n"].join("")}var i=e.total_price,o=renderPrettyPrice(i),a=renderPrettyShopifyCartContents(e.items),r=renderPrettyNotes(notes.get()),s=i/100;if(sendCartValueNotifications){if(0==operatorNotified.get()&&s>=minimumCartValueForNotification){operatorNotified.set(!0);var _=renderPrettyPrice(100*minimumCartValueForNotification);api.chat.sendNotificationToOperator({body:"just increased cart balance above "+_+" (now has "+o+" of items in the cart)"})}minimumCartValueForNotification>s&&operatorNotified.set(!1)}if(e.item_count<lastState.get().item_count&&sendCartRemovalNotifications){var l=t(e),c=[" "+renderPrettyPrice(lastState.get().total_price-i)+" removed from cart\n"];for(var u in l)l.hasOwnProperty(u)&&c.push(n(l[u]));api.chat.sendNotificationToOperator({body:c.join("")})}lastState.set(e);var d=a.concat(r);if(d.unshift("has "+o+" of items in cart"),api.chat.updateVisitorStatus({snippet:d}),api.chat.updateVisitorNickname(i>0?{snippet:o}:{snippet:null}),operatorNickname.get()&&void 0==e.attributes&&e.items.length>0){{operatorNickname.get()}syncOlarkOperatorCartAttributes()}},syncOlarkOperatorCartAttributes=function(){var e="https://www.olark.com/transcripts/show/"+olark._.conversationId,t=operatorNickname.get(),n=renderPrettyNotes(notes.get()).join("\n"),i={"olark-conversation-url":e.replace(/^(.*)/,"\n$1"),"olark-operator":t,"olark-notes":n.replace(/^(.*)/,"\n$1")};parentWindow.Shopify.updateCartAttributes&&parentWindow.Shopify.updateCartAttributes(i,function(){})},prototype_updateCartAttributes=function(e){var t="";for(var n in e)"string"==typeof n&&"string"==typeof e[n]&&(t+="attributes["+n+"]="+e[n]+"&");new parentWindow.Ajax.Request("/cart/update.js",parentWindow.Shopify.params("post",t,function(){}))};api.chat.onReady(function(){var okayToOverrideCartEvents=parentWindow.Shopify?!1:!0,legacy_minimum_cart_value=hbl.config.vars.minimum_cart_value_for_notification;minimumCartValueForNotification=legacy_minimum_cart_value||minimumCartValueForNotification;var monkeyPatchPrototypeShopifyAPI=function(Shopify){Shopify.onError=function(){},Shopify.params=function(method,parameters,callback){var hash={method:method||"post",parameters:parameters||"",evalScripts:!1,asynchronous:!0,requestHeaders:{"If-Modified-Since":"Sat, 1 Jan 2000 00:00:00 GMT"}};return null==callback&&(callback=this.onDebug.bind(this)),hash.onSuccess=function(t){try{callback(parentWindow.$(eval("("+t.responseText+")")))}catch(e){}}.bind(this),hash.onFailure=function(t){try{this.onError(parentWindow.$(eval("("+t.responseText+")")))}catch(e){}}.bind(this),hash}};withExternalDependenciesMet(function(){var e=!parentWindow.Shopify.updateCartAttributes;e&&(parentWindow.Shopify.updateCartAttributes=prototype_updateCartAttributes,monkeyPatchPrototypeShopifyAPI(parentWindow.Shopify)),parentWindow.mockOutShopifyForTestingPurposes&&parentWindow.mockOutShopifyForTestingPurposes(parentWindow.Shopify),parentWindow.Shopify.getCart(processShopifyCart),setOnCartUpdateCallback(okayToOverrideCartEvents,processShopifyCart),api.chat.onMessageToVisitor(function(e){operatorNickname.get()||operatorNickname.set(e.message.nickname),api.visitor.getDetails(function(e){e.isConversing&&syncOlarkOperatorCartAttributes()})})})})}module.exports=ShopifyPlugin},{}],43:[function(e,t){function n(e,t){function n(){var e=void 0;try{var t=new Audio,n=!!t.canPlayType,i=(!!(n?!1:t.play),!1),o=!1;t.canPlayType&&(i="no"!=t.canPlayType("audio/ogg")&&""!=t.canPlayType("audio/ogg"),o="no"!=t.canPlayType("audio/mpeg")&&""!=t.canPlayType("audio/mpeg")),e=new Audio(i?_+"monopop.ogg":_+"monopop.mp3")}catch(a){}return e}function i(){l="blurred"}function o(){l="focused"}function a(e,t,n){var i=new Date;i.setDate(i.getDate()+n);var o=escape(t)+(null==n?"":"; expires="+i.toUTCString());document.cookie=e+"="+o}function r(e){var t,n,i,o=document.cookie.split(";");for(t=0;t<o.length;t++)if(n=o[t].substr(0,o[t].indexOf("=")),i=o[t].substr(o[t].indexOf("=")+1),n=n.replace(/^\s+|\s+$/g,""),n==e)return unescape(i)}var s=t.Sounds.play_sound_on_every_message||!1,_="static.olark.com/sounds/",l=null;_="https:"==location.protocol?"https://"+_:"http://"+_;var c=n();if(c){olark("api.chat.onMessageToVisitor",function(){var e="false"!=r("olrk_sound_disable");e&&("blurred"==l||s)&&c.play()}),olark("api.chat.onCommandFromOperator",function(e){var t="false"!=r("olrk_sound_disable");"sound"==e.command.name&&(t?(a("olrk_sound_disable",!0,30),olark("api.chat.sendNotificationToOperator",{body:"Disabled sound for the visitor"})):(a("olrk_sound_disable",!1,30),olark("api.chat.sendNotificationToOperator",{body:"Enabled sound for the visitor"})))});var u=window.onfocus;window.onfocus=function(){u&&u(),o()};var d=window.onblur;window.onblur=function(){d&&d(),i()}}}t.exports=n},{}],44:[function(e,t){function n(){olark("api.chat.onReady",function(){var e=document.getElementById("admin_bar_controls"),t=document.getElementById("habla_window_div");if(e){var n=t.getAttribute("style");t.className.match(/bottom/i)&&(n=n.replace(/bottom: [^\;]+/,"bottom: 41px !important"),t.setAttribute("style",n))}})}t.exports=n},{}],45:[function(e,t){function n(e,t){function n(e){return"true"==e?!0:!1}function i(){olark("api.visitor.getDetails",function(t){for(var n="",i=0;3>i;i++)n+=t.importance>i?T:E;e.chat.updateVisitorNickname({snippet:n})})}var o=function(t){return t?e.__SPI_browser.__SPI_getSafeUrl(t):null},a=function(e){return(t.VisitorInsight||{})[e]||t.system[e]},r=2,s=6e4,_=3e4,l=2,c=18e5,u=5,d=t.chat.visitor_nickname||t.system.force_nickname||null,h=!0;(a("prechat_contains_referrer")===!1||t.chat.notify_operator_of_referrer===!1)&&(h=!1);var p=!0;(a("prechat_contains_location")===!1||t.chat.notify_operator_of_location===!1)&&(p=!1);var f=a("disable_default_visitor_information")?!0:!1,g=a("status_contains_referrer")===!1?!1:!0,m=a("status_contains_location")===!1?!1:!0,v=a("give_location_to_operator")===!1?!1:!0,b=a("max_location_notifs_when_not_conversing")||r,y=a("max_idle_milliseconds_for_location_notifs")||s,w=a("custom_visitor_ip")||null,k="undefined"==typeof a("clickpath_entries")?u:a("clickpath_entries"),x=t.system.disable_time_based_status_updates?!0:!1,S=null,C=+new Date,I=1==t.system.show_importance_in_nickname?!0:!1,T=t.system.filled_icon||String.fromCharCode(9733),E=t.system.unfilled_icon||String.fromCharCode(9734),P=e.data.getConversationObject({key:"didGivePrechatInsight",initialValue:!1,backup:"vi1",backupTransform:n}),O=e.data.getConversationObject({key:"isConversation",initialValue:!1,backup:"vi2",backupTransform:n}),A=e.data.getConversationObject({key:"referrer",initialValue:document.referrer&&""!==document.referrer?document.referrer:null}),M=e.data.getConversationObject({key:"locationNotificationState",initialValue:"active",backup:"vi3",backupTransform:n}),N=e.data.getConversationObject({key:"locationNotifsWithoutConversing",initialValue:0}),B=e.data.getConversationObject({key:"timestampOfLastActivity",initialValue:(new Date).getTime(),backup:"vi4",backupTransform:parseInt}),F=e.data.getConversationObject({key:"pagesCount",initialValue:0}),L=e.data.getVisitorObject({key:"visitCount",initialValue:0}),j=e.data.getConversationObject({key:"visitorMessageCount",initialValue:0}),V=e.data.getConversationObject({key:"operatorMessageCount",initialValue:0}),R=e.data.getConversationObject({key:"operatorNotificationCount",initialValue:0,backup:"vi5",backupTransform:parseInt}),D=e.data.getConversationObject({key:"initialArrivalTimestamp",initialValue:(new Date).getTime()});d&&e.chat.updateVisitorNickname({snippet:d,hidesDefault:!0}),function(){e.chat.onMessageToOperator(function(){j.set(j.get()+1)}),e.chat.onMessageToVisitor(function(){V.set(V.get()+1)}),e.chat.onNotificationToOperator(function(){R.set(R.get()+1)}),e.__SPI_browser.onPageChange(function(){F.set(F.get()+1)}),F.__SPI_onChange(function(e){1==e.newValue&&L.set(L.get()+1)})}(),function(){var e=function(){j.get()>0&&V.get()>0&&O.set(!0)};j.__SPI_onChange(e),V.__SPI_onChange(e)}(),function(){var t=function(){B.set((new Date).getTime()),N.set(0),"disabled"!=M.get()&&M.set("active")};e.chat.onMessageToVisitor(function(){t()}),e.chat.onMessageToOperator(function(){t()}),N.__SPI_onChange(function(e){e.newValue>=b&&M.set("inactive")}),e.box.onDismiss(function(){M.set("inactive")}),e.chat.onCommandFromOperator(function(e){var t=e.command.name.toLowerCase();("unfollow"==t||"nofollow"==t)&&(M.set("disabled"),olark("api.chat.sendNotificationToOperator",{body:"turned off URL notifications from this visitor"})),"end"===t&&M.set("inactive")})}(),function(){var t=function(){var e=(new Date).getTime(),t=e-B.get();return t>y?!0:!1},n=function(){var t=o(olark._.overrideWindowHref||document.location.href);e.chat.sendNotificationToOperator({body:"looking at "+t})},i=function(){v&&!t()&&"active"==M.get()&&(n(),N.set(N.get()+1))},a=function(){if(P.get()===!1&&!f){P.set(!0);var t=e.chat.getVisitorNickname();if(e.chat.sendNotificationToOperator({body:"talking to "+t}),p&&n(),h){var i=o(A.get());i&&e.chat.sendNotificationToOperator({body:"referred from "+i})}/{\s*geolocation\s*}/.test(t)||e.chat.sendNotificationToOperator({body:"located in {{geolocation}}"});var a=H();if(a)for(var r=0;r<a.length;r++)e.chat.sendNotificationToOperator({body:a[r]});e.chat.sendNotificationToOperator({body:"to see additional options, simply type !help"})}};e.__SPI_browser.onPageChange(function(){P.get()===!0&&i()}),j.__SPI_onChange(function(e){1==e.newValue&&a()}),R.__SPI_onChange(function(e){1==e.newValue&&a()})}();var H=function(){var t=[],n=e.visitor.getOrganization();return n&&t.push("might be affiliated with "+n),t},q=function(){var t=+new Date-C;if(!(t>c)){var n=function(e){return e>=864e5?"one day":e>=36e5?Math.floor(e/36e5)+" hours":e>=6e4?Math.floor(e/6e4)+" minutes":e>=1e3?Math.floor(e/1e3)+" seconds":null},i=o(document.location.href.toString()),a=o(A.get()),r=F.get(),s=L.get(),u=w||e.visitor.__SPI_getIp()||"{{ipaddress}}",d=(new Date).getTime()-D.get(),h=n(d),p=e.visitor.getFullName(),f=e.visitor.getEmailAddress(),v=e.visitor.getPhoneNumber(),b=e.visitor.__SPI_getNotes(),y=e.visitor.__SPI_getRecentPageHistory();S=b;var I=b.slice(0)||[];if(p&&I.push("speaking with "+p),f&&I.push(f),v&&I.push("phone number is "+v),i&&m&&I.push("looking at "+i),y&&y.length>1){var T=y.length-1,E=y.length-1-k;1>E&&(E=1),I.push("already looked at:");for(var P=T;P>=E;P--){var O=y[P];O.url?I.push("  "+o(O.url)):O.title&&I.push("  "+O.title)}}if(a&&g&&I.push("referred from "+a),I.push("located in {{geolocation}}"),I.push("{num_pages} pages viewed".replace(/{num_pages}/,r)),I.push(s>1?s+" visits":"first visit"),G>1?I.push("has had "+G+" conversations"):1==G&&I.push("first conversation"),I.push("using "+e.visitor.__SPI_getBrowser()+" on "+e.visitor.__SPI_getOs()),u&&I.push(u),h&&d>_)I.push("spent at least "+h+" so far");else{var M=n(_);M&&I.push("arrived within the last "+M)}var N=H();if(N)for(var B=0;B<N.length;B++)I.push(N[B]);e.chat.updateVisitorStatus({snippet:I});var j=d*l;_>j&&(j=_),e.chat.__SPI_isConversing()||x||setTimeout(q,j)}};e.chat.onReady(q),e.__SPI_browser.onPageChange(function(){setTimeout(q,100)});var U,W,$,G;e.visitor.getDetails(function(e){U=e.fullName,W=e.emailAddress,$=e.phoneNumber,G=e.conversationCount}),e.visitor.onChange(function(){e.visitor.getDetails(function(e){var t=!1;U!==e.fullName&&(U=e.fullName,t=!0),W!==e.emailAddress&&(W=e.emailAddress,t=!0),$!==e.phoneNumber&&($=e.phoneNumber,t=!0),G!==e.conversationCount&&(G=e.conversationCount,t=!0),t&&q()})}),e.visitor.onChange(function(){if(null!==S){var t=e.visitor.__SPI_getNotes();t.join("")!=S.join("")&&q()}}),I&&(i(),e.visitor.onChange(i))}t.exports=n},{}],46:[function(e,t){function n(e,t){function n(e){return/^\s*$/.test(e)}function i(){var e,t=Math.floor(Math.random()*d.length);for(e=d[t],t=d.length;t&&("undefined"==typeof e||null==e||n(e));)t--,e=d[t];return e||"hi, can I help you?"}function o(){function e(e){return e.replace(/https?\:\/\//g,"").replace(/\/$/,"")}function t(t){t=e(t);var n=["^",t.replace(/\./g,"\\.").replace(/\*/g,".*"),"$"];return new RegExp(n.join(""))}var i=e(window.location.href);for(var o in r){var a=r[o],s=a&&!n(a)?!0:!1;try{a=a.replace(/\s*$/,"").replace(/^\s*/,"")}catch(_){olark._.hlog("experienced #error_cleaning_validpathstring "+_)}if(r.hasOwnProperty(o)&&s&&t(a).test(i))return!0}return!1}function a(){o()&&e.chat.operatorsAreAvailable()&&h.get()!==!0&&(h.set(!0),l&&(e.box.expand(),e.box.__SPI_setPrechatWelcomeMessage(p)),u&&e.chat.sendNotificationToOperator({body:"this is a new visitor, you might want to welcome him or her"}))}var r,s=t.WelcomeAssist,_=t.Greeter||{},l=s.welcome_new_visitors||_.welcome_new_visitors?!0:!1,c=s.welcome_delay_in_seconds||_.welcome_delay_in_seconds||5,u=s.notify_operator_of_new_visitors||_.notify_operator_of_new_visitors?!0:!1,d=s.welcome_messages||_.welcome_messages||["hi, can I help you?"];r=_.urls?_.urls&&_.urls.length>0?_.urls:["*"]:s.urls&&s.urls.length>0?s.urls:["*"];var h=e.data.getVisitorObject({key:"did_initiate_ever",initialValue:!1,backup:"wa1",backupTransform:function(e){return"true"==e?!0:!1}}),p=i();e.chat.onBeginConversation(function(){h.set(!0)});var f=!1,g=!1;(l||u)&&setTimeout(function(){f?a():g=!0,e.chat.connect()},1e3*c),e.chat.onReady(function(){f=!0,g&&a()})}t.exports=n},{}],47:[function(e,t){t.exports=function(e){var t,n;return null!=(t=olark._)?null!=(n=t.testlog)?n.push(e):void 0:void 0}},{}],48:[function(e,t){function n(e){this._window=e.window||window;var t=this._olark=e.olark||this._window.olark;this._path=e.path||"/",this._method=e.method||"GET",this._host=e.host||this._olark._.apiHost,this._query={},this._data={},this._logger=e.logger||t.__core.logger,this._loadScript=e.loadScript||function(e){t.__core.async_script_load({url:e})},this._methodKey=e.methodKey||"_method",this._dataKey=e.dataKey||"_data",this._callbackKey=e.callbackKey||"_callback"}var i=e("json3");n.prototype.send=function(e){this._data=e},n.prototype.query=function(e){this._query=e},n.prototype.end=function(e){var t=this,n="_olark_callback_"+(new Date).getTime();this._window[n]=function(i){t._window[n]=void 0;try{delete t._window[n]}catch(o){}if(this._logger&&i.code<200||i.code>399)return this._logger.warn(["[olark]",i.code,i.body,r].join(" ")),e(i.code);var a={status:i.code,body:i.body};return e(null,a)},this._query[this._methodKey]=this._method,this._data&&(this._query[this._dataKey]=i.stringify(this._data));var o=[];for(var a in this._query)this._query.hasOwnProperty(a)&&o.push("&"+a+"="+encodeURIComponent(this._query[a]));var r=[this._host,this._path,"?"+this._callbackKey+"="+n].concat(o).join("");this._loadScript(r)},t.exports={post:function(e,t){t=t||{},t.path=e,t.method="POST";var i=new n(t);return i},get:function(e,t){t=t||{},t.path=e,t.method="GET";var i=new n(t);return i}}},{json3:3}],49:[function(e){(function(t){function n(e){if(!W.started){if(W.started=1,e&&"function"==typeof e)try{e()}catch(t){}F||W.util.simple_load_js_async(V),W.eventmgr.handle("habla_called_wc_init")}}function i(e){"invalid_site_id"==e.etype?(W.client.eventmgr=new g,habla_window.setTheme(W.config.vars.theme_obj),habla_window.config.vars.offline_message="<em>"+olark._.identityManager.getSiteId()+"</em> is not a valid <a href='"+R+"'>"+d.hblName+"</a> site ID.<p> Your "+d.hblName+" Site ID is in the format '###-##-###-##' and can be found on your <a href='"+R+"' target='_blank'>Dashboard</a>.</p>",habla_window.config.vars.not_available_text=d.hblName+": Site ID Error",habla_window.setHeader(habla_window.config.vars.not_available_text),habla_window.show(1),habla_window.theme.habla_conversation_div.scrollTop=0):"invalid_site_link"==e.etype?(W.client.eventmgr=new g,habla_window.setTheme(W.config.vars.theme_obj),habla_window.config.vars.offline_message="Unable to determine your site-id.  Please make sure you have copied and pasted all the code as it appears on your <a href='"+R+"' target='_blank'>"+d.hblName+" Dashboard</a>.",habla_window.config.vars.not_available_text=d.hblName+": Site ID Error",habla_window.setHeader(habla_window.config.vars.not_available_text),habla_window.show(1),habla_window.theme.habla_conversation_div.scrollTop=0):"operator_is_busy"==e.etype&&(W.client.opbusy=!0,habla_window.opbusy=!0,habla_window.setWindowText())}function o(){var e=function(e,t){var n=e.className||"";return-1!=n.indexOf(t)},t=document.getElementById("olark-data");if(t&&t.childNodes)for(var n=t.childNodes.length;n--;){var i=t.childNodes[n];if(e(i,"olark-key"))return i.id.replace("olark-","")}for(var o=document.getElementsByTagName("a"),a=o.length;a--;){var r=o[a];if(e(r,"olark-key"))return r.id.replace("olark-","")}return null}function a(){return new b}function r(e,t){if(!(d.hblHasinit||document.URL.search("hblNoInit")>-1)){if(d.hblHasinit=1,e=e||o(),"undefined"==typeof e||!e){var i=document.getElementById("hbl_code");if(i){var a=i.href.split("#");e=a[1],i.style.display="none"}else e="missing-site-id"}if(olark._.identityManager.setSiteId(e),W.config=t,t&&t.palette)for(var r in t.palette)"string"==typeof t.palette[r]&&(W.need_ugly_backwards_palette_hack=!0);W.started=0,W.prev_onload=window.onload,window.onload=function(){n(W.prev_onload)},window.setTimeout(function(){n(W.prev_onload)},2500)}}function s(){if(!W.post_started){if(W.post_started=1,olark._.identityManager.getSiteId()?"missing-site-id"==olark._.identityManager.getSiteId()&&olark._.identityManager.setSiteId(o()):olark._.identityManager.setSiteId(o()),window.habla_window||(habla_window=new W._hwindow(W.client,W.config,W.eventmgr),W.eventmgr.setWindow(habla_window),habla_window.register_handlers()),W.config.vars.local_mode)return W.client.start(olark._.identityManager.getConversationId(),olark._.identityManager.getVisitorId(),olark._.identityManager.getSiteId(),W.eventmgr,W.config),habla_window.setTheme(W.config.vars.theme_obj),habla_window.config.vars.welcome_msg="Hab.la is in testing mode. set <em>config.vars['local_mode'] = false;</em> to go back to normal.",habla_window.config.vars.in_chat_text="Hab.la Local Mode",habla_window.config.vars.before_chat_text="Hab.la Local Mode",habla_window.config.vars.not_available_text="Hab.la Local Mode",habla_window.setHeader(habla_window.config.vars.not_available_text),void habla_window.show(1);var e=olark._.identityManager.getSiteId();if(e&&(e.match(/(olark|\@)/i)||!e.match(/\d\d*\-\d/))&&W.config.vars.theme_obj)return void i({etype:"invalid_site_id"});if(!e&&W.config.vars.theme_obj)return void i({etype:"invalid_site_link"});W.eventmgr.register("habla_error",i,10),W.client.start(olark._.identityManager.getConversationId(),olark._.identityManager.getVisitorId(),olark._.identityManager.getSiteId(),W.eventmgr,W.config),W.eventmgr.handle("habla_started")}}function _(e){if(W.config=W.config||new b,!W.config.merge){var t=W.config;W.config=new b,W.config.merge(t,!0)}(W.config.vars.disable_get_cookies||W.config.vars.wcsid)&&(W.config.vars.wcsid&&olark._.identityManager.setConversationId(W.config.vars.wcsid),W.config.vars.hblid&&olark._.identityManager.setVisitorId(W.config.vars.hblid)),W.config.plugins||(W.config.plugins=new m),e=e||["incoming_notification","away_div_handler","expand_on_receive_message","google_translate","auto_initiate"];for(var n=0;n<e.length;n++){var i=e[n],o=new W.plugins[i];W.config.plugins.add(o)}W.eventmgr.handle("habla_preload_done"),s()}var l=e("underscore"),c=e("../../chatbox/logger"),u=e("../../chatbox/corehelpers"),d=e("../../chatbox/legacyglobals"),h=e("../../chatbox/boot"),p=e("../../chatbox/xdhttp"),f=e("../../chatbox/data"),g=e("../../chatbox/LegacyEventManager"),m=e("../../chatbox/LegacyPluginList"),v=e("../../chatbox/LegacyPipeline"),b=e("../../chatbox/LegacyConfig"),y=e("../../chatbox/Extension"),w=e("../../chatbox/ExtensionSpec"),k=e("../../chatbox/ExtensionManager"),x=e("../../chatbox/PollingManager"),S=e("../../chatbox/Conversation"),C=e("../../chatbox/TextFormatter"),I=e("../../chatbox/UrlFormatter"),T=e("../../chatbox/RulesApi"),E=e("../../chatbox/BoxApi"),P=e("../../chatbox/VisitorApi"),O=e("../../chatbox/ChatApi"),A=e("../../chatbox/BrowserApi"),M=e("../../chatbox/ApiInstance"),N=e("../../targeting/TargetingManager"),B=e("../../chatbox/BrowserInfo"),F=!0,L="application",j="static.olark.com",V=d.hblStaticPath+"/wc_post.js?"+L,F=!0,R="http://www.olark.com/dashboard/install",D=window.__olark_external_start,H=window.__olark_iframe_wrapper,q=window.__olark_popout,U=new B({userAgent:window.navigator.userAgent,compatMode:document.compatMode});!function(){function e(e){switch(e){case"api.chat.getVisitorNickname":case"api.chat.getVisitorStatus":case"api.chat.operatorsAreAvailable":case"api.chat.operatorsAreBusy":case"api.chat.operatorsAreAway":case"api.chat.onNotificationToVisitor":case"api.chat.getVisitorNickname":case"api.chat.getVisitorNickname":return!0;default:return!1
}}olark._.P("application"),olark("api.chat.onBeginConversation",function(){olark._.hlog("started chatting #begin_conversation #begin_conversation."+olark._.chatboxBucket)});var n=/.*YOUR-SITE-ID-HERE.*/,i="0000-0000-0000-0000",o=6,a=5;!function(){window.olark.__buildinfo=window.olark.__buildinfo||{olarkfile:"/javascript/olark.js",jshost:window.olark.__version?"static.olark.com":"olarkdev:8001",dev:!0}}(),window.olark.__legacy_shim=window.olark.__legacy_shim||{};var r=function(e,t){var n=window[e];if(!n)throw new Error("[lightloader] stub library not defined: "+e);var i=n.__lightload,o={publicMethods:{}},a=[],r=[];o.getLightloaderVersion=function(){return i.V},o.isDocumentReady=function(){return i.A||0},o.isWindowLoaded=function(){return i.B||0},o.whenDocumentReady=function(e){o.isDocumentReady()?e():a.push(e)},o.whenWindowLoaded=function(e){o.isWindowLoaded()?e():r.push(e)},o.reloadLibrary=function(){i.D=[],i.l()};var s=function(e){for(var t=e.length>0?e.shift():void 0;t;)t(),t=e.shift()},_=function(){var e=i.D;e.reverse();for(var t=e.length;t-->0;){var o=e[t],a=o[0],r=o[1],s=n[a];s?s.apply(n,r):window.console&&window.console.error&&window.console.error("[lightloader] missing method '"+a+"'")}e.reverse()};i.a=function(){i.A=!0,s(a)},i.b=function(){i.B=!0,s(r)},t(n,o),olark.extend=o.publicMethods.extend,olark.declare=o.publicMethods.declare,olark.configure=o.publicMethods.configure,olark.ready=o.publicMethods.ready,_()},s=function(t,n){function i(e,t){s.push([e,t]),_()}function o(){for(var t,n,o,s,_,l=a.callstack;l.length;)if(t=l.shift(),t&&t.length)try{o=Array.prototype.slice.call(t||[]),n=o.length?o.shift():void 0,_=/api\.[a-zA-Z]+\.(__SPI_)?[a-zA-Z]+/.test(n),"debug"==n?!function(){var e=document.createElement("script");e.src="https://static.olark.com/record.js",document.getElementsByTagName("head")[0].appendChild(e)}():_?e(n)?c.warn("[olark] the API call '"+n+"' is deprecated"):i(n,o):r.publicMethods.hasOwnProperty(n)?(s=r.publicMethods[n],s.apply(s,o)):c.warn("[olark] unknown method 'olark."+n+"'")}catch(u){c.error("[olark] unknown exception in dequeueCallbacks: method: "+n+" ",u.message)}else c.warn("[olark] empty method call in dequeueCallbacks #empty_dequeue_call")}var a=olark._,r=(a.P,{publicMethods:{}});r.getLightloaderVersion=function(){return a.v},r.whenDocumentReady=function(e){e()},r.reloadLibrary=function(){olark._=null,olark=null,a.i()};var s=[],_=function(){};olark.extend(function(e){_=function(){for(var t;s.length;){t=s.shift();var n=t[0],i=t[1],o=n.split("."),a=o[1],r=o[2];if(e[a]&&e[a][r])try{e[a][r].apply(e[a],i)}catch(_){c.error(_.toString())}else c.warn("[olark] unknown API call '"+n+"'")}},s.length>0&&_()}),n(olark,r),r.publicMethods.call=function(e,t){var n=r.publicMethods[e];n?n.apply(n,t):c.warn("[olark] unknown method 'olark."+e+"'")},olark._.s={push:function(e){a.callstack.push(e),o()}},o()};!function(){var e=window.olark;if(e.__v){c.warn("[olark] you are using an old version of the Olark Code on your page, please check your dashboard to get the new code.");var t=olark.__v[0],n=olark.__v[1],i=olark.__v[2],o=olark.__v[3];for(var a in t)"function"!=typeof t[a]&&e.configure.apply(e,t[a]);for(var r in n)"function"!=typeof n[r]&&e.extend.apply(e,n[r]);for(var s in i)"function"!=typeof i[s]&&e.declare.apply(e,i[s]);for(var _ in o)"function"!=typeof o[_]&&e.ready.apply(e,o[_]);e.__lightload.A=!0}}();var _=function(e,t){olark._?s(e,t):r(e,t)};_("olark",function(e,r){var s=function(){var e=this;e.__configuration_callbacks=[],u.listen_for_event({namespace:"ExtensionManager",type:"registeredExtensionSpec",callback:function(){e.__check_for_olark_key()}})};!function(t){function o(t){var n,i,o=e._?e._.defaults:null;if(o)for(n in o)if(o.hasOwnProperty(n)){t[n]||(t[n]={});for(i in o[n])o[n].hasOwnProperty(i)&&(t[n][i]=o[n][i])}return t}var a=null;s.get_instance=function(){return a=a||new s},t.register_configure_callback=function(e){var t=this,n=e.callback;if("undefined"==typeof n)throw new Error("[olark] 'callback' required");t.__configuration_callbacks.push(n),t.__check_for_olark_key()},t.read_configuration=function(){var e=this,t=e.__read_configuration({ignore_errors:!1});return t.system.olark_key=e.get_olark_key(),t},t.get_olark_key=function(){var e=this,t=e.__read_configuration({ignore_errors:!0});t.chat.legacy_site_id&&(t.system.legacy_site_id=t.system.legacy_site_id||t.chat.legacy_site_id,c.warn("[olark] conf.chat.legacy_site_id is deprecated, please use conf.system.legacy_site_id instead"));var o=e.__parse_olark_site_id_from_dom(),a=t.system.site_id||t.system.olark_key||t.system.legacy_site_id||window.olark.__k||o;return a&&(a=a.replace(/^\s*/,"").replace(/\s*$/,""),n.test(a)&&(a=i)),a},t.__parse_olark_site_id_from_dom=function(){var e=document.getElementById("olark-key");if(e&&e.className)return u.strip_whitespace(e.className.replace("site-",""));var t=document.getElementsByTagName("a");for(var n in t)if("function"!=typeof t[n]){var i=t[n];if(i&&"olark-key"==i.className)return i.style.display="none",i.id.replace("olark-","")}return null},t.__read_configuration=function(e){var t=this;e=e||{};var n=e.ignore_errors?!0:!1,i={box:{},chat:{},data:{},browser:{},extensions:{},features:{},system:{},locale:{}};i=o(i),k.get_instance().for_each_extension_spec(function(e){i[e.get_name()]=i[e.get_name()]||{}});for(var a=0;a<t.__configuration_callbacks.length;){if("function"==typeof t.__configuration_callbacks[a]){var r=t.__configuration_callbacks[a];if(n)try{r(i)}catch(s){}else u.try_and_optionally_catch(function(){r(i)},function(e){c.error("[olark] error with your configuration, overall configuration may be incomplete now: "+e.toString()),c.showErrorBacktrace(e)})}a++}return i},t.__check_for_olark_key=function(){var e=this;e.get_olark_key()&&u.trigger_event({namespace:"ConfigurationManager",type:"olarkKeyAvailable"})}}(s.prototype);var _=function(e){var t=e.extension_name;if("undefined"==typeof t)throw new Error("[olark] 'extension_name' required");var n=!1;return k.get_instance().for_each_extension_spec(function(e){e.get_name()==t&&(n=!0)}),n},l=function(e){var t=!1,n=function(){var n=!0;k.get_instance().for_each_extension_spec(function(e){e.is_downloaded()||(n=!1)}),n&&!t&&(t=!0,e())};n(),u.listen_for_event({namespace:"ExtensionManager",type:"registeredExtension",callback:n}),u.do_async_call({delay:1e3*o},function(){if(!t){t=!0,e();var n=[];k.get_instance().for_each_extension_spec(function(e){e.is_downloaded()||n.push(e.get_pretty_string()+" #plugin_download_failed."+e.get_name())}),c.warn("[olark] unable to download some extensions:",n.join(","))}})},f=function(e){var t=!1;u.wait_for(function(){return window.olark&&window.olark.__core&&window.olark.__core.api&&window.olark.__core.box&&window.olark.__core.chat&&window.olark.__core.data&&window.olark.__core.framestorewithjson&&window.olark.__legacy_shim&&window.olark.__legacy_shim.legacy_stub_is_loaded&&window.olark.__legacy_shim.legacy_post_stub_is_loaded},function(){t||(t=!0,e())}),u.do_async_call({delay:1e3*a},function(){t||(t=!0,e(),c.warn("[olark] unable to download core libraries."))})},g=function(e){var t={};k.get_instance().for_each_extension_spec(function(n,i){var o=k.get_instance().search_for_extension({extension_spec:n}),a=null;if(0===o.length){var r="";for(var s in i)i.hasOwnProperty(s)&&(r+=s+": "+i[s]+" ");r=r.slice(0,150),c.error("[olark] no loaded extensions matched:"+n.get_pretty_string(),"#no_loaded_extension."+n.get_name(),r)}else if(1==o.length)a=o[0];else{a=o[0];for(var _=o.slice(1),l=[],d=_.length;d--;){var h=_[d].get_pretty_string();l.push(h)}c.warn("[olark] more than one extension matched for "+n.get_pretty_string(),", so we used the first one:",a.get_pretty_string(),"\nYou might want to be more specific. These extensions were also found:",u.format_bulleted_list_for_logger(l))}var p=t[n.get_name()];p?c.warn("[olark] we already loaded an extension by the name of "+n.get_name(),"(",p.get_pretty_string(),")",i):a&&(a.activate({configuration:e}),t[n.get_name()]=a)}),u.trigger_event({namespace:"core",type:"extensionsActivated"})},m=function(){r.publicMethods.extend=function(e){c.warn("[olark] you cannot do olark.extend() once Olark is already starting up (dropping extension:"+e+")")},r.publicMethods.configure=function(){c.warn("[olark] you cannot do olark.configure() once Olark is already starting up.")}},v=function(e){var t=s.get_instance().get_olark_key(),n=u.create_idempotent_callback(e);t?n():u.listen_for_event({namespace:"ConfigurationManager",type:"olarkKeyAvailable",callback:n})},b=function(e){/Chrome/.test(navigator.userAgent)&&e.chat.onReady(function(){try{for(var e=document.styleSheets,t=e.length-1;t>=0;t--){var n=e[t].cssRules;if(n){var i=n[0],o=i.selectorText;i.selectorText="#olark-workaround",i.selectorText=o;break}}}catch(a){c.warn("[olark] Chrome stylesheet workaround not active")}})},x=function(t,n){try{N.activate(e,n)}catch(i){c.warn("[olark] unable to activate Targeting",i);var o="#targeting_error #error";i.hasOwnProperty("message")&&(o+=" message: "+i.message),i.hasOwnProperty("stack")&&(o+=" stack: "+i.stack),e._.hlog(o.slice(0,150))}S(t,n)},S=function(t,n){b(t),n.system.force_ssl&&(d.hbl_ext="https",d.hblStaticPath=d.hblStaticPath.replace("http:","https:"),d.hblPostURL=d.hblPostURL.replace("http:","https:"));var i=n.system.deferred_chat_connection!==!0||t.chat.__SPI_hasConnectedAlready();1!=e._.preventBoot&&i&&n.system.disable_event_connection!==!0&&t.chat.connect()},C=function(){var e="#habla_beta_container_do_not_rely_on_div_classes_or_names",t="@media print {"+e+" {display: none !important}}",n=document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),n.appendChild(i)},I=function(){h.enableAndDisableFeatures({olark:e,conf:s.get_instance().read_configuration()}),e._.P("bootstart"),f(function(){r.whenDocumentReady(function(){e._.P("domready"),v(function(){e._.P("keyready");var t=s.get_instance().get_olark_key(),n=s.get_instance().read_configuration();e._.P("getstorage"),window.olark.__core.data.prepare(t,n.system.force_localstorage_fallback,function(){e._.P("storage");var t=new window.olark.__core.data.StorejsKeyStore;e._.isNewConversation&&(t.clearConversationData(),window.olark.__legacy_shim.isNewConversation=!0),m(),l(function(){e._.P("extready");var t=s.get_instance().read_configuration();if(t.system.allow_end_conversation&&(e.__legacy_shim.allowEndConversation=!0),t.system.domain)try{window.olark.__core.data.forceDomain(t.system.domain),window.olark.__legacy_shim.forced_cookie_domain=t.system.domain}catch(n){c.warn("[olark] unable to use domain '"+t.system.domain+"' ("+n+")")}if(t.system.path)try{window.olark.__core.data.forcePath(t.system.path)}catch(n){c.warn("[olark] unable to use path '"+t.system.path+"' ("+n+")")}g(t);var i=new e.__core.api.ApiInstance({conf:t,namespace:"__bootprocessplugin",extension_name:"__bootprocessplugin"});i.chat.onReady(C);for(var o=t.system.rules||[],a=e._.rulesLookup={},r=!1,_=0;_<o.length;_++){var l=o[_];l.enabled&&(r=!0,a[l.id]=l)}r?x(i,t):S(i,t)})})})})})};e.__core={listen_for_event:u.listen_for_event,trigger_event:u.trigger_event,async_script_load:u.async_script_load,logger:c,xdhttp:p,format_bulleted_list_for_logger:u.format_bulleted_list_for_logger,wait_for:u.wait_for,is_extension_required:_,create_idempotent_callback:u.create_idempotent_callback,trigger_olark_boot_process:I,when_document_is_ready:function(e){r.whenDocumentReady(e)},when_corelib_is_available:f,do_async_call:u.do_async_call,run_legacy_code:u.run_legacy_code,clone_object:u.clone_object,deep_equals:u.deep_equals,join_string_list:u.join_string_list,try_and_optionally_catch:u.try_and_optionally_catch,ConfigurationManager:s},r.publicMethods.extend=function(n,i){t.nextTick(function(){u.try_and_optionally_catch(function(){var t=null,o=null,a=null;if("function"==typeof n){t=k.get_next_extension_name();var r=n;e.declare({name:t,startup:r})}else{if("string"!=typeof n)throw new Error("[olark] extend requires either an extension name or an inline startup function");t=n,o=i?i.version:null,a=i?i.source:null,k.get_instance().assert_extension_name_is_valid(t)}var s=new w({name:t,version:o,source:a});k.get_instance().register_extension_spec({extension_spec:s})},function(e){c.error("[olark] failed in olark.extend: "+e.toString()),c.showErrorBacktrace(e)})})},r.publicMethods.declare=function(e,t){u.try_and_optionally_catch(function(){var n=null,i=null,o=null;if("string"==typeof e){c.warn("[olark] old-style extension declarations are no longer supported");var a=e.split("@");n=a[0],i=2==a.length?a[1]:null,o=t}else n=e.name,i=e.version,o=e.startup;k.get_instance().assert_extension_name_is_valid(n);var r=new y({name:n,version:i,startup:o});k.get_instance().register_declared_extension({extension:r})},function(e){c.error("[olark] failed in olark.declare: "+e.toString()),c.showErrorBacktrace(e)})},r.publicMethods.configure=function(e,t){var n,i;"string"==typeof e?(i=e.split("."),n=function(e){var n=i[0],o=e[i[0]];if(o){var a=i[1];o[a]=t,"_"==a[0]&&c.warn("[olark] cannot configure private key:",a)}else c.warn("[olark] unknown configuration namespace:",n)}):n=e,s.get_instance().register_configure_callback({callback:n})},r.publicMethods.ready=function(e){e()},r.publicMethods.identify=function(){},r.publicMethods.load=function(){}});try{window.olark.__core.trigger_olark_boot_process()}catch(l){u.async_script_load({url:""})}}();var W={util:{},pipelines:{},themes:{},hwindow_util:{},plugins:{},hwindow:{config:function(){this.vars={},this.palette={},this.style_id={},this.style={},this.style_classes={},this.style_classes_map={}}},jsoncallback_norv:function(){}};W.eventmgr=new g,habla_window=void 0,W.get_current_page=function(){return document.URL},W.get_current_referrer=function(){return document.referrer},W.util.pluginlist=function(){this.todo=[],this.defined={},this.add=function(e,t){void 0==t&&(t=999),void 0!=e&&(this.defined[e.name]||(this.defined[e.name]=1,this.todo.push({handler:e,priority:t}),this.todo=this.todo.sort(function(e,t){return e.priority-t.priority})))}},W.util.get_body=function(){var e=document.getElementsByTagName("html"),t=null;e.length<1?(t=document.createElement("html"),document.appendChild(t)):t=e[0],e=document.getElementsByTagName("body");var n=null;return e.length>0?n=document.getElementsByTagName("body").item(0):(n=document.createElement("body"),t.appendChild(n)),n},W.util.get_head=function(){var e=document.getElementsByTagName("html"),t=null;e.length<1?(t=document.createElement("html"),document.appendChild(t)):t=e[0],e=document.getElementsByTagName("head");var n=null;return e.length>0?n=document.getElementsByTagName("head").item(0):(n=document.createElement("head"),t.appendChild(n)),n},W.util.generate_script_js_pollid=function(){return"undefined"==typeof W.util.last_js_pollid&&(olark.__core.logger.error("[olark] 'get_polling_script_id' requires hbl.util.last_js_pollid to be defined"),W.util.last_js_pollid=0),"olark-"+W.util.last_js_pollid+(new Date).getTime()},W.util.simple_load_js_async=function(e){var t=W.util.get_body(),n=document.createElement("script");n.setAttribute("language","javascript"),n.setAttribute("type","text/javascript"),n.setAttribute("data-cfasync","false"),n.setAttribute("async",""),n.setAttribute("defer","true"),n.setAttribute("src",e),t.appendChild(n)},D&&D();var $=document.getElementById("hbl_code");$&&($.style.display="none"),function(){try{var e=".olark-key,#hbl_code,#olark-data{display: none !important;}",t=document.getElementsByTagName("head")[0],n=document.createElement("style"),i=document.createTextNode(e);n.type="text/css",n.styleSheet?n.styleSheet.cssText=i.nodeValue:n.appendChild(i),t.appendChild(n)}catch(o){}}(),window.olark&&window.olark.__legacy_shim&&(window.olark.__legacy_shim.legacy_stub_is_loaded=!0),W||(W={}),W.__ie6_floating_div_monitor=void 0,W.util.last_js_id=0,W.util.last_js_pollid=0,W.util.listenForEvent=function(e,t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):(e["on"+t]=n,n)},W.util.pluginloader=function(e,t,n){W.pluginArgs={conf:e,client:t,hwindow:n},e.plugins.load({conf:e,client:t,hwindow:n})},W.util.timestamp=function(){var e=new Date;return e.toUTCString()},W.util.reportException=function(e){olark._.hlog("exception:",e,"#error")},W.util.urlencode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t+=n+"="+encodeURIComponent(e[n])+"&");return t},W.util.load_js_async=function(e){W.util.last_js_id+=1,W.util.last_js_pollid+=1;var t="jscript"+W.util.last_js_id;if(e+=e.indexOf("?")>-1?"&"+t:"?"+t,W.util.last_js_id>1900){if(!e.match(/sendmessage/i)&&!e.match(/begin/i))return;W.util.last_js_id=1}var n=W.util.get_body(),i=document.createElement("script");i.setAttribute("language","javascript"),i.setAttribute("id",t),i.setAttribute("type","text/javascript"),i.setAttribute("data-cfasync","false"),i.setAttribute("async",""),i.setAttribute("defer","true"),i.setAttribute("src",e),n.appendChild(i)},W.util.remove_element=function(e){var t=document.getElementById(e);void 0!=t&&void 0!=t.parentNode&&t.parentNode.removeChild(t)},W.util.calculate_retry_delay=function(e,t,n){var i=e*(1+t);return i>n?n:i},W.util.append_script=function(e,t,n){var i=W.util.append_script,o=n.scriptid,a=n.url,r=n.tries,s=n.previous_tries||0,_=n.timeout,l=n.error_callback,c=n.success_callback,u=n.cache,d=n.retryid?n.retryid:"",h=100,p=1200,f=15e3;e.opera&&!_&&(_=200);var g=function(n){var h=t.getElementById(o+d);h?(h.loaded=!0,void 0!=h.parentNode&&h.parentNode.removeChild(h),l&&l({status:n}),r>0?e.setTimeout(function(){i(e,t,{scriptid:o,retryid:"r"+r,url:a,tries:r,previous_tries:s+1,timeout:_,error_callback:l,cache:u})},W.util.calculate_retry_delay(p,s,f)):window.olark&&window.olark._.hlog&&olark._.hlog("#rpc_call_error-"+n+" url:"+a)):c&&c()},m=a;if(!u){var v=m.length>0&&"&"!=m.charAt(m.length-1)&&"?"!=m.charAt(m.length-1);m.match(/\?/)?v&&(m+="&"):m+="?",m+="_rnd="+Math.random()}m=m.replace("?","?j="+o+d+"&");var b=t.createElement("script");b.setAttribute("language","javascript"),b.setAttribute("id",o+d),b.setAttribute("type","text/javascript"),b.setAttribute("data-cfasync","false"),b.setAttribute("async",""),b.setAttribute("defer","true"),b.setAttribute("src",m),b.loaded=!1,r&&(r-=1),_&&(b.timeout=e.setTimeout(function(){g("timeout")},_)),b.readyState?b.onreadystatechange=function(){"loaded"!=b.readyState&&"complete"!=b.readyState||b.loaded||(b.onreadystatechange=function(){},b.loaded=!0,b.timeout&&e.clearTimeout(b.timeout),e.setTimeout(function(){g("error")},h))}:(b.onload=function(){b.loaded||(b.loaded=!0,b.timeout&&e.clearTimeout(b.timeout),e.setTimeout(function(){g("error")},h))},b.onerror=function(){b.loaded||(b.loaded=!0,b.timeout&&e.clearTimeout(b.timeout),e.setTimeout(function(){g("error")},h))});var y=t.getElementsByTagName("script")[0];y.parentNode.insertBefore(b,y),olark._.internalLog&&olark._.internalLog.logHttpRequest(m)},W.util.as_dom=function(e){var t;return"object"==typeof e?e:(t=document.createElement("span"),t.innerHTML=e,t)},W.util.getCommonTextFormatter=function(){return W.util._commonTextFormatter||(W.util._commonTextFormatter=new C({urlFormatter:W.util.getCommonUrlFormatter()})),W.util._commonTextFormatter},W.util.getCommonUrlFormatter=function(){return W.util._commonUrlFormatter||(W.util._commonUrlFormatter=new I({window:window,identityManager:olark._.identityManager,cookieManager:olark._.cookieManager,util:W.util,config:W.config.vars})),W.util._commonUrlFormatter},W.util.set_inner_text=function(e,t){null!==e.textContent&&void 0!==e.textContent?e.textContent=t:e.innerText=t},W.util.encode_html_entities=function(e,t){t||(t=[]);var n={ampersand:{regex:/&/gi,replaceValue:"&amp;"},lessThan:{regex:/\</gi,replaceValue:"&lt;"},greaterThan:{regex:/\>/gi,replaceValue:"&gt;"},doubleQuote:{regex:/\"/gi,replaceValue:"&quot;"},singleQuote:{regex:/\'/gi,replaceValue:"&#x27;"},slash:{regex:/\//gi,replaceValue:"&#x2F;"}};for(var i in n)n.hasOwnProperty(i)&&l.indexOf(t,i)<=-1&&(e=e.replace(n[i].regex,n[i].replaceValue));return e},W.util.decode_html_entities=function(e){try{var t=W.util.encode_html_entities(e,["ampersand"]),n=document.createElement("div");n.innerHTML=t;var i=0===n.childNodes.length?"":n.childNodes[0].nodeValue;return i&&!/^\s*$/.test(i)?i:e}catch(n){return e}},W.util.find_or_create_el=function(e,t,n){var i=document.getElementById(e);return(!i||i.length<0)&&(void 0==t&&(t="div"),i=document.createElement(t),i.setAttribute("id",e),void 0!=n&&n.appendChild(i)),("input"==t||"textarea"==t)&&(i.name=e),i},W.util.find_or_create_div=function(e,t){return W.util.find_or_create_el(e,"div",t)},W.util.hide_div=function(e){return"object"!=typeof e&&(e=document.getElementById(e)),void 0!=e?(e.style.display="none",!0):!1},W.util.show_div=function(e,t){return void 0==t&&(t="block"),"object"!=typeof e&&(e=document.getElementById(e)),void 0!=e?(e.style.display=t,!0):!1},W.util.clean_whitespace=function(e){return e=e.replace(/^\s*/,""),e=e.replace(/\s*$/,""),e=e.replace("'","")},W.util.decode_base64=function(e){var t="";try{t=window.atob(e)}catch(n){var i,o,a,r,s,_,l,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do r=c.indexOf(e.charAt(u++)),s=c.indexOf(e.charAt(u++)),_=c.indexOf(e.charAt(u++)),l=c.indexOf(e.charAt(u++)),i=r<<2|s>>4,o=(15&s)<<4|_>>2,a=(3&_)<<6|l,t+=String.fromCharCode(i),64!=_&&(t+=String.fromCharCode(o)),64!=l&&(t+=String.fromCharCode(a));while(u<e.length)}return t},W.util.encode_base64=function(e){var t,n,i,o,a,r,s,_,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=0,u=0,d="",h=[];if(!e)return e;e=W.util.utf8_encode(e+"");do t=e.charCodeAt(c++),n=e.charCodeAt(c++),i=e.charCodeAt(c++),_=t<<16|n<<8|i,o=_>>18&63,a=_>>12&63,r=_>>6&63,s=63&_,h[u++]=l.charAt(o)+l.charAt(a)+l.charAt(r)+l.charAt(s);while(c<e.length);switch(d=h.join(""),e.length%3){case 1:d=d.slice(0,-2)+"==";break;case 2:d=d.slice(0,-1)+"="}return d},W.util.strip_whitespace=function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")},W.util.is_valid_email=function(e){if(!e)return!1;var t=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,22}$/i;return t.test(e)},W.util.is_valid_phone=function(e){if(!e)return!1;var t=e.replace(/[^\+\d]/g,""),n=/[\+01]{0,4}(9[976]\d|8[987530]\d|6[987]\d|5[90]\d|42\d|3[875]\d|2[98654321]\d|9[8543210]|8[6421]|6[6543210]|5[87654321]|4[987654310]|3[9643210]|2[70]|7|1)\d{0,14}(x\d{1,5})?$/;return n.test(t)},W.util.utf8_encode=function(e){e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n");var t,n,i="",o=0;t=n=0,o=e.length;for(var a=0;o>a;a++){var r=e.charCodeAt(a),s=null;128>r?n++:s=r>127&&2048>r?String.fromCharCode(r>>6|192)+String.fromCharCode(63&r|128):String.fromCharCode(r>>12|224)+String.fromCharCode(r>>6&63|128)+String.fromCharCode(63&r|128),null!==s&&(n>t&&(i+=e.substring(t,n)),i+=s,t=n=a+1)}return n>t&&(i+=e.substring(t,e.length)),i},W.util.css={},W.util.getElementsByClass=function(e,t){e||(e=document.getElementsByTagName("body")[0]);for(var n=[],i=new RegExp("\\b"+t+"\\b"),o=e.getElementsByTagName("*"),a=0,r=o.length;r>a;a++)i.test(o[a].className)&&n.push(o[a]);return n},W._pollevents_errors=0,W.client={SENDMESSAGE_DELAY:100,incoming_pipeline:new v,first_time:!0,recorded_ssl_ip:!1,op_nickname_map:{},_seen_unique_ids:[],pollingmanager:new x(window,document,olark,W,navigator),_hasSeenID:function(e){if(e.unique_id)for(var t=0;t<this._seen_unique_ids.length;t++)if(this._seen_unique_ids[t]===e.unique_id)return!0;return!1},addLineIfUnique:function(e){return this._hasSeenID(e)?!1:(this._seen_unique_ids.push(e.unique_id),!0)},is_conversation:function(){for(var e=!1,t=!1,n=0;n<W.client.buffer.length;++n)W.client.buffer[n]&&("you"==W.client.buffer[n][0]&&(e=!0),"you"!=W.client.buffer[n][0]&&(t=!0));return e&&t},current_operator:function(){for(var e="",t=0;t<W.client.buffer.length;++t)W.client.buffer[t]&&"you"!=W.client.buffer[t][0]&&(e=W.client.buffer[t][0]);return e},noop:function(){},geolocation_ready:function(e){W.client.eventmgr.handle("geolocation_ready",e)},callbacks:{begin:function(e){W.client.jsoncallback(e,W.client.begin_call_back)},sendmessage:function(e){W.client.msg_callback(e)},sendpresence:function(){},sendcommand:function(){},pollevents:function(e){W._pollevents_errors=0,W.client.pollingmanager.finishLastPoll(),W.client.pollingmanager.isRunning()&&W.client.jsoncallback(e,W.client.callbacks.pollmessages1)},pollmessages1:function(e){var t=e;if(setTimeout(function(){W.client.eventmgr.handle("handled_nrpc_response")}),t.is_new_conversation&&W.client.eventmgr.handle("session_was_not_in_memcache",{}),t.ipaddress_lookup_needed&&W.client.record_ssl_ip(),W.client.site_is_online=t.site_is_online,W.client.conversation_has_slot=t.conversation_has_slot,e={sid:t.conversation_id,hblid:t.visitor_id,chatting:t.in_active_conversation,opstatus:t.status_state,opavailable:t.site_is_online,geoip:t.geolocation_data,ipaddress:t.ipaddress,pop_out:t.is_popup,ssl:t.ssl,box_visible:!0,opbusy:!1,operator_composing_state:e.operator_composing_state,operator_nickname:e.operator_nickname},t.operator_has_sent_message&&t.site_is_online&&(e.opstatus="available"),!t.operator_has_sent_message&&t.site_is_online&&"available"!=e.opstatus&&(e.opavailable=!1),W.client.chatting=e.chatting,e.disconnected);else{if(W.client.first_time&&(W.client.first_time=!1),"no session found"==e.exception)return;(e.opavailable!=W.client.opavailable||W.client.opmessage!=e.opmessage||W.client.opstatus!=e.opstatus||W.client.opbusy!=e.opbusy||W.client.pop_out!=e.pop_out)&&(W.client.eventmgr.handle("operator_status_change",{available:e.opavailable,opavailable:e.opavailable,status:e.opstatus,opstatus:e.opstatus,message:e.opmessage,busy:e.opbusy,pop_out:e.pop_out,pop_out_change:W.client.pop_out!=e.pop_out,chatting:W.client.chatting,box_visible:W.client.box_visible,opbusy:e.opbusy}),W.client.first_time=!1,W.client.opavailable=e.opavailable,W.client.opmessage=e.opmessage,W.client.opstatus=e.opstatus,W.client.opbusy=e.opbusy,W.client.pop_out=e.pop_out),W.client.composing!=e.operator_composing_state&&(W.client.eventmgr.handle("operator_composing",{composing_type:e.operator_composing_state,operator_nickname:e.operator_nickname}),W.client.composing=e.operator_composing_state);for(var n,i=[],o=!1,a=t.new_events||[],r=0;r<a.length;r++){var s=a[r][0];s>W.client.last_poll_index&&(W.client.last_poll_index=s);var _=a[r][1],l=W.client.addLineIfUnique(_);_.body&&l&&"you"!=_.nickname&&(i.push([_.nickname,_.body,s]),W.client.op_nickname_map[_.nickname]=_.operator_id),"site_config_changed"==_.type&&(o=!0,n=_.md5)}W.client.append1(i),o&&(olark._.setSiteAssetHash(n),olark._.setLoaderUseAssets("1")),W.client.whenNicknameAndPresenceAreAllowed(function(){t.resend_nickname&&W.client.eventmgr.handle("resend_nickname",{}),t.resend_status&&W.client.eventmgr.handle("resend_status",{})}),W.client.pollingmanager.scheduleNextPoll()}}},siteid:"",wc_sid:"",sid:"",proxy:null,buffer:[],myname:"you",jsoncallback:function(e,t){return e.http_traffic_blocked?(olark("api.box.hide"),W.util.append_script=function(){},window.console&&window.console.warn&&window.console.warn("[olark] Olark Chat is turned off for this website, if you own this website please contact Olark via support@olark.com"),!1):(e.ended&&W.client.eventmgr.handle("conversation_ended",{next_conversation_id:e.ended.next_conversation_id}),void(e.conversation_does_not_exist?W.client.restart_session():e.retry?W.client.pollingmanager.startNextPollNow():null==t||e.duplicate_session_id||t(e)))},begin_call_back:function(e){function t(){olark._.identityManager.deleteIdentityFromCookies()}var n=olark._.hlog,i=e;if(e.error){var o=[];return"fatal_boot_exception"==e.error&&(t(),o.push("#fatal_boot_exception")),i.invalid_id_format&&(t(),o.push("#invalid_id_format")),i.conversation_does_not_exist&&(t(),o.push("#conversation_does_not_exist")),void n("stopped begin call:",e.error,"#error #begin_call_error",o.join(" "))}if(i.invalid_id_format||i.conversation_does_not_exist)return t(),void n("RPC reported no errors, but gave error flags #error #unexpected_rpc_output");i.conversation_id!=olark._.identityManager.getConversationId()&&n("RPC reported new conversationId:",i.conversation_id,"!=",olark._.identityManager.getConversationId(),"#error #new_rpc_wcsid"),i.visitor_id!=olark._.identityManager.getVisitorId()&&(n("RPC reported new visitorId, re-storing to cookie:",i.visitor_id,"!=",olark._.identityManager.getVisitorId(),"#error #new_rpc_hblid"),i.visitor_id&&olark._.identityManager.setVisitorId(i.visitor_id));var a=function(){olark("api.box.__SPI_getLegacyState",function(t){olark._.needsFirstTimeOperatorLogin=!1;var n=e;if(e.site_config_changed&&(olark._.setSiteAssetHash(e.site_md5||e.assets_config_md5),olark._.setLoaderUseAssets("1")),e={sid:n.conversation_id,hblid:n.visitor_id,chatting:n.in_active_conversation,opstatus:n.status_state,opavailable:n.site_is_online,geoip:n.geolocation_data,ipaddress:n.ipaddress,pop_out:n.is_popup,ssl:n.ssl,opbusy:!1,operator_composing_state:e.operator_composing_state,operator_nickname:e.operator_nickname,habla_message:e.habla_message,box_visible:t.box_visible,box_open:t.box_open},n.operator_has_sent_message&&n.site_is_online&&(e.opstatus="available"),!n.operator_has_sent_message&&n.site_is_online&&"available"!=e.opstatus&&(e.opavailable=!1),null==e||e.error)e&&e.error&&W.client.eventmgr.handle("habla_error",{etype:e.error});else{olark._.identityManager.setConversationId(e.sid),olark._.identityManager.setVisitorId(e.hblid),W.client.chatting=e.chatting,W.client.site_is_online=n.site_is_online,W.client.conversation_has_slot=n.conversation_has_slot,W.client.opavailable=e.opavailable,W.client.opmessage=e.opmessage,W.client.opstatus=e.opstatus,W.client.opbusy=e.opbusy,W.client.pop_out=e.pop_out,W.client.ssl=e.ssl,W.client.box_visible=e.box_visible;var i=function(e){return{available:e.opavailable,opavailable:e.opavailable,opstatus:e.opstatus,status:e.opstatus,message:e.opmessage,busy:e.opbusy,pop_out:e.pop_out,pop_out_change:W.client.pop_out!=e.pop_out,chatting:W.client.chatting,box_visible:W.client.box_visible,opbusy:e.opbusy}};if(olark._.geoip=e.geoip,olark._.ipaddress=e.ipaddress,W.client.eventmgr.handle("nrpc_data_ready",i(e)),W.client.eventmgr.handle("chat_started",{chatting:e.chatting,box_open:e.box_open,box_visible:e.box_visible,opstatus:e.opstatus,opavailable:e.opavailable,opmessage:e.opmessage,opbusy:e.opbusy,pop_out:e.pop_out,config:e.config,dconfig:e.dconfig,habla_message:e.habla_message,browser_ip:e.ipaddress,geolocation:e.geocode_ip}),W.client.last_poll_index=0,n.conversation_history){for(var o=[],a=0;a<n.conversation_history.length;a++){var r=n.conversation_history[a][0];r>W.client.last_poll_index&&(W.client.last_poll_index=r);var s=n.conversation_history[a][1],_=W.client.addLineIfUnique(s);s.body&&_&&("visitor_message"==s.type&&(r=0),o.push([s.nickname,s.body,r]),W.client.op_nickname_map[s.nickname]=s.operator_id)}W.client.setContents(o)}W.client.eventmgr.handle("operator_status_change",i(e)),W.client.opavailable=e.opavailable,W.client.opmessage=e.opmessage,W.client.opstatus=e.opstatus,W.client.opbusy=e.opbusy,W.client.pop_out=e.pop_out,W.client.eventmgr.handle("operator_composing",{composing_type:e.operator_composing_state,operator_nickname:e.operator_nickname}),W.client.composing=e.composing_type,W.client.whenNicknameAndPresenceAreAllowed(function(){n.resend_nickname&&W.client.eventmgr.handle("resend_nickname",{}),n.resend_status&&W.client.eventmgr.handle("resend_status",{})}),n.is_new_conversation&&W.client.eventmgr.handle("session_was_not_in_memcache",{}),W.client.pollingmanager.scheduleNextPoll()}})};"fatal exception"!=e.error?e.ipaddress_lookup_needed?(olark._.identityManager.setConversationId(e.conversation_id),W.client.record_ssl_ip(),W.client.eventmgr.register("geolocation_ready",function(t){e.geolocation_data=t.geolocation,e.ipaddress=t.geolocation.ipaddress,a()})):a():olark._.hlog("#boot #spoof detected")},start:function(e,t,n,i,o){olark._.identityManager.setSiteId(n),olark._.identityManager.setConversationId(e),olark._.identityManager.setVisitorId(t),W.client.eventmgr=i,W.client.config=o,W.client.opstatus=null,W.client.opavailable=null,W.client.opmessage=null,W.client.chatting=!1,W.client.pop_out=!1,W.client.buffer=[],W.client.the_count=0,W.client.newlinecount=0,W.client.lastindex=0,W.client.last_getmessages=new Date,W.client.jsondata=null,W.client.datareadycallback=null,W.client.getmsgcallback=null,W.client.first_time=!0,W.client.incoming_pipeline.setTarget(this);
try{var a=new W.client.jsonproxy(olark._.nrpcBaseUrl);W.client.proxy=W.client.proxy3=W.client.proxy2=a,W.config&&W.config.vars&&!W.config.vars.local_mode&&(olark._.P("begin"),W.client.proxy.begin(olark._.identityManager.getConversationId(),olark._.identityManager.getVisitorId(),olark._.identityManager.getSiteId(),W.get_current_page(),W.get_current_referrer(),o.vars.start_passive,o.vars.force_nickname,o.vars.no_system_messages,W.client.begin_call_back))}catch(r){throw W.client.chatting=!1,W.util.reportException(r),r}},jsoncallback_norv:function(){},jsonproxy:function(e,t){this.uri=e,this.callq=[],this.rnd=t},check_getmsg:function(){},setContents:function(e){if(!e||0==e.length){if(!(window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.has_messages_in_history))return;e=[[null,"  ",.2]]}W.client.lastindex=0;for(var t=0;t<e.length;++t)W.client.buffer[W.client.buffer.length]=new Array(e[t][0],e[t][1],e[t][2]),e[t][2]>W.client.lastindex&&(W.client.lastindex=e[t][2]);W.client.newlinecount=1,window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.load_missed_messages&&window.olark.__legacy_shim.load_missed_messages(e),W.client.eventmgr.handle("receive_message",{type:"start",msg:e})},append:function(e){if(e&&e.length>0){for(var t=0;t<e.length;++t)W.client.buffer[W.client.buffer.length]=new Array(e[t][0],e[t][1],e[t][2]);W.client.newlinecount+=e.length,W.client.chatting=!0,W.client.eventmgr.handle("send_message",{type:"local_update",msg:e})}},append1:function(e){if(e&&e.length>0){for(var t=[],n=0,i=0;i<e.length;++i)if(e[i][2]>W.client.lastindex){W.client.lastindex=e[i][2];var o=W.client.incoming_pipeline.run(e[i]);void 0!=o&&(W.client.buffer[W.client.buffer.length]=o,t.push(o)),e[i]&&(n+=1)}W.client.newlinecount+=e.length,n>0&&(W.client.chatting=!0),t.length>0&&W.client.eventmgr.handle("receive_message",{type:"remote_update",msg:t})}},msg_callback:function(e){"operator_is_busy"==e.error&&W.eventmgr.handle("habla_error",{etype:"operator_is_busy"})},sendmessage:function(e,t,n,i,o,a){W.client.lastNickname=o,W.client.lastStatusMessage=a;var r=!t,s=new Array(new Array(W.client.myname,e,r,n));if(r&&W.client.append(s),i){var _="chat";W.client.proxy.setnickname(olark._.identityManager.getConversationId(),o),W.client.proxy.sendpresence(olark._.identityManager.getConversationId(),a,_)}setTimeout(function(){W.client.proxy.sendmessage(olark._.identityManager.getConversationId(),e,r,n,W.client.msg_callback)},W.client.SENDMESSAGE_DELAY),W.client.pollingmanager.startNextPollNow()},sendofflinemessage:function(e,t){var n="chat";W.client.proxy.setnickname(olark._.identityManager.getConversationId(),W.client.lastNickname),W.client.proxy.sendpresence(olark._.identityManager.getConversationId(),W.client.lastStatusMessage,n),setTimeout(function(){W.client.proxy.sendofflinemessage(olark._.identityManager.getConversationId(),e,t)},W.client.SENDMESSAGE_DELAY)},setnickname:function(e){W.client.lastNickname=e,W.client.whenNicknameAndPresenceAreAllowed(function(){W.client.proxy.setnickname(olark._.identityManager.getConversationId(),e)})},sendcommand:function(e,t){W.client.proxy.sendcommand(olark._.identityManager.getConversationId(),e,t)},record_ssl_ip:function(){W.client.recorded_ssl_ip||(W.client.proxy.geolocation(olark._.identityManager.getConversationId(),olark._.identityManager.getVisitorId()),W.client.recorded_ssl_ip=!0)},restart_session:function(){W.client.proxy.noop(olark._.identityManager.getConversationId(),olark._.identityManager.getVisitorId())},setvcard:function(){},sendpresence:function(e,t){W.client.lastStatusMessage=e,W.client.whenNicknameAndPresenceAreAllowed(function(){W.client.proxy.sendpresence(olark._.identityManager.getConversationId(),e,t)})},log_event:function(e,t){W.client.proxy&&W.client.proxy.log_event(olark._.identityManager.getConversationId(),e,t)},sendexpand:function(){},sendcompress:function(){},sendend:function(){},sendhide:function(){},sendshow:function(){},popout:function(){W.client.proxy&&W.client.proxy.popout(olark._.identityManager.getConversationId())},end_popout:function(){W.client.proxy&&W.client.proxy.end_popout(olark._.identityManager.getConversationId())},whenNicknameAndPresenceAreAllowed:function(e){olark("api.visitor.getDetails",function(t){var n=void 0!=t.secondsSinceLastMessage||void 0!=t.secondsSinceLastNotificationToOperator;if(n)e();else if("chatting"==W.config.vars.show_in_buddy_list);else{var i=W.client.conversation_has_slot,o=W.client.site_is_online;i&&o&&e()}})}},W.client.map={command:"c",callback:"cb",group_id:"g",group_idstring:"g",conversation_id:"i",script_id:"j",site_idstring:"s",sequence_id:"q",status_message:"m",status_state:"p",current_url:"u",visitor_id:"v",referrer_url:"r"},W.client.jsonproxy.prototype.__build_nrpc_arguments=function(e){var t="";e.command&&(t+="&c="+encodeURIComponent(e.command+"")),e.sequence_id&&(t+="&q="+e.sequence_id);var n=W.client.map,i=[];for(var o in e)if(i.push(o),e.hasOwnProperty(o)&&e[o]&&"append_settings"!=o&&"throttle"!=o&&"sequence_id"!=o&&"command"!=o){var a=encodeURIComponent(e[o]+"");n[o]&&(o=n[o]),t+="&"+o+"="+a}return""==t&&(t="?command=invalid_buffer&buffer_is_empty="+escape(i.join(","))),t},W.client.jsonproxy.prototype.do_nrpc_call=function(e){var t=this,n=W.client.pollingmanager.getNextPollTime();n&&(e.next_poll_time=n);var i=W._pollevents_errors;i&&(e.num_retries=W._pollevents_errors),t.do_raw_nrpc_call(e)},W.client.jsonproxy.prototype.do_raw_nrpc_call=function(e){var t=e.command,n=e.append_settings,i="",o=d.hbl_ext;if(olark.__legacy_shim.allowEndConversation&&(e.end_conversation=1,olark._.identityManager.isNewConversation()&&"create"===t&&(e.is_new_conversation=1)),e.visitor_id=e.visitor_id||olark._.identityManager.getVisitorId(),("create"==t||"sendmessage"==t)&&(W.util.last_js_id=1),W.util.last_js_id+=1,W.util.last_js_id<1900){W.util.last_js_pollid+=1,this.rnd&&(i=parseInt(10*Math.random()).toString()+"-");var a="/"+t.charAt(0)+"?";"geolocation"==t&&d.hblrpcTrick?(i="start-"+parseInt(3*Math.random()).toString()+"."+d.hbl_hostname,i+=a,o="https"):i+=this.uri+a;var r=parseInt(1e4*Math.random())+"."+ +new Date%1e5+"."+W.util.last_js_pollid;e.sequence_id=r,e.version=d.hblJavaScriptVersion,e.pretty=!0,e.throw_exceptions=window.olark.__buildinfo.strict?!0:!1,i+=this.__build_nrpc_arguments(e),W.util.append_script(window,document,{scriptid:W.util.generate_script_js_pollid(),url:o+"://"+i,tries:n.tries,timeout:n.timeout,cache:!1,error_callback:n.error_callback})}},W.client.jsonproxy.prototype.begin=function(e,t,n,i,o){(e?1:0)||olark._.hlog("missing sid #no_begin_wcsid_input"),(t?1:0)||olark._.hlog("missing hblid #no_begin_hblid_input");var a="ALL",r=olark.__legacy_shim.currentGroupIdstring||a,s=this,_=function(){s.do_nrpc_call({command:"create",conversation_id:e,visitor_id:t,site_idstring:n,current_url:i,referrer_url:o,callback:"hbl.client.callbacks.begin",group_id:r,throttle:!1,append_settings:{tries:3,timeout:2e4}})},l=function(e){e.status?_():W.client.callbacks.begin(e)},c=olark._.nrpcPrecache;c?c.response?l(c.response):c.responseCallback=l:_()},W.client.jsonproxy.prototype.sendmessage=function(e,t,n,i){var o=olark.__legacy_shim.currentGroupIdstring;this.do_nrpc_call({command:"sendmessage",conversation_id:e,site_idstring:olark._.identityManager.getSiteId(),body:t,no_history:!n,notification:i,callback:"hbl.client.callbacks.sendmessage",group_idstring:o,version:d.hblJavaScriptVersion,append_settings:{tries:3,timeout:45e3}})},W.client.jsonproxy.prototype.sendofflinemessage=function(e,t,n){var i=olark.__legacy_shim.currentGroupIdstring,o={command:"sendofflinemessage",conversation_id:e,site_idstring:olark._.identityManager.getSiteId(),body:t,callback:"hbl.client.noop",group_idstring:i,version:d.hblJavaScriptVersion,append_settings:{tries:3,timeout:45e3}};for(var a in n)n.hasOwnProperty(a)&&(o["form_"+a]=n[a]);this.do_nrpc_call(o)},W.client.jsonproxy.prototype.sendcommand=function(e,t,n){var i=olark.__legacy_shim.currentGroupIdstring;if("disconnectchat"==t)this.do_nrpc_call({command:"destroy",conversation_id:e,callback:"hbl.client.noop",group_idstring:i,append_settings:{tries:3,timeout:45e3}});else if("send_compose_state"==t)this.do_nrpc_call({command:"sendcomposing",conversation_id:e,callback:"hbl.client.noop",state:n,group_idstring:i,append_settings:{tries:3,timeout:45e3}});else if("return_long_poll_now"==t)this.do_nrpc_call({command:"finishlongpoll",conversation_id:e,callback:"hbl.client.noop",state:n,group_idstring:i,append_settings:{tries:3,timeout:45e3}});else{if("unlock_operator"!=t)throw"Unsupported command: "+t;this.do_nrpc_call({command:"sendunlock",conversation_id:e,callback:"hbl.client.noop",message:n,group_idstring:i,append_settings:{tries:3,timeout:45e3}})}},W.client.jsonproxy.prototype.setnickname=function(e,t){var n=olark.__legacy_shim.currentGroupIdstring;this.do_nrpc_call({command:"sendnickname",conversation_id:e,callback:"hbl.client.noop",nickname:t,group_idstring:n,append_settings:{tries:3,timeout:45e3}})},W.client.jsonproxy.prototype.noop=function(e,t){this.do_nrpc_call({command:"noop",conversation_id:e,visitor_id:t,site_idstring:olark._.identityManager.getSiteId(),callback:"hbl.client.noop",append_settings:{tries:3,timeout:45e3}})},W.client.jsonproxy.prototype.geolocation=function(e,t){this.do_nrpc_call({command:"geolocation",conversation_id:e,visitor_id:t,site_idstring:olark._.identityManager.getSiteId(),callback:"hbl.client.geolocation_ready",append_settings:{tries:3,timeout:45e3}})},W.client.jsonproxy.prototype.sendpresence=function(e,t,n){var i=olark.__legacy_shim.currentGroupIdstring;this.do_nrpc_call({command:"sendpresence",conversation_id:e,callback:"hbl.client.noop",status_message:t,status_state:n,group_idstring:i,append_settings:{tries:5,timeout:45e3}})},W._exponential_backoff_pollevents_error_handler=function(){var e=1e3*W._pollevents_errors*W._pollevents_errors,t=45e3;e>t&&(e=t),setTimeout(function(){W.client.pollingmanager.finishLastPoll(),W.client.pollingmanager.startNextPollNow()},e),W._pollevents_errors+=1},W.client.jsonproxy.prototype.getmessages=function(e,t){W.client.the_count++,W.client.last_getmessages=new Date,this.do_nrpc_call({command:"pollevents",throttle:!1,conversation_id:e,callback:"hbl.client.callbacks.pollevents",timeout:29,after:t,append_settings:{timeout:4e4,error_callback:W._exponential_backoff_pollevents_error_handler}})},W.client.jsonproxy.prototype.pollmessages=function(e,t){W.client.the_count++,this.do_nrpc_call({command:"pollevents",throttle:!1,conversation_id:e,callback:"hbl.client.callbacks.pollevents",timeout:0,after:t,append_settings:{timeout:1e4,error_callback:W._exponential_backoff_pollevents_error_handler}})},W.client.jsonproxy.prototype.popout=function(e){this.do_nrpc_call({command:"popout",conversation_id:e,callback:"hbl.client.noop",append_settings:{tries:3,timeout:45e3}})},W.client.jsonproxy.prototype.end_popout=function(e){this.do_nrpc_call({command:"endpopout",conversation_id:e,callback:"hbl.client.noop",append_settings:{tries:3,timeout:45e3}})},W.client.jsonproxy.prototype.log_event=function(e,t,n){this.do_nrpc_call({command:"logevent",conversation_id:e,site_idstring:olark._.identityManager.getSiteId(),callback:"hbl.client.noop",event_type:t,body:n,append_settings:{tries:3,timeout:45e3}})},W._hwindow=function(e,t,n){return this.config=t,this.client=e,this.handlers=!1,this.theme=void 0,this.eventmgr=n,this.loaded=!1,this.expanded_textbox=!1,this.has_typed=!1,this.offline_msg_started=!1,this.offline_msg_visible=!1,this.pop_out=!1,this.setTheme=function(e){this.theme&&this.theme.remove(),this.theme=e,this.theme.build(this.config,this.client,this.config.vars.start_visible,this.config.vars.start_habla_window_visible),this.check_theme_for_link_div(),W.util.pluginloader(this.config,this.client,this)},this.check_theme_for_link_div=function(){this.theme&&(this.config.vars.hkey&&(this.config.vars.special_link=W.util.decode_base64(this.config.vars.hkey).replace("href",'style="'+this.config.vars._habla_link_a+'" href')),(!this.theme.habla_link_div||this.theme.habla_link_div.style&&"none"==this.theme.habla_link_div.style.display||this.theme.habla_link_div.innerHTML.indexOf("http://hab.la")<0&&this.theme.habla_link_div.innerHTML.indexOf("http://www.olark.com")<0||!this.theme.habla_link_div.parentNode)&&(this.theme.habla_link_div=document.createElement("div"),this.config.vars.force_name_habla_link_div&&this.theme.habla_link_div.setAttribute("id","habla_link_div"),this.config.vars.special_link&&(this.theme.habla_link_div.innerHTML=this.config.vars.special_link.replace("hblink1","hblink9")),this.theme.config.vars.append_middle?this.theme.habla_middle_div.appendChild(this.theme.habla_link_div):this.theme.habla_expanded_div.appendChild(this.theme.habla_link_div)),document.getElementById("hblink9")||(this.theme.habla_link_div.innerHTML=W.util.decode_base64("RnJlZSA8YSBocmVmPSJodHRwOi8vd3d3Lm9sYXJrLmNvbS8/ZnJlZV9saXZlaGVscCIgaWQ9ImhibGluazkiIHRhcmdldD0iX2JsYW5rIj5PbGFyazwvYT4gbGl2ZWhlbHAgfCA8YSBocmVmPSJodHRwOi8vd3d3Lm9sYXJrLmNvbS8/bW9yZSIgaWQ9ImhibGluazk5IiB0YXJnZXQ9Il9ibGFuayI+R2V0IGl0ITwvYT48IS0taHR0cDovL3d3dy5vbGFyay5jb20tLT4=")),this.set_link(document.getElementById("hblink9")),this.set_link(document.getElementById("hblink99")),this.theme.habla_link_div.setAttribute("style",this.config.vars._habla_link_div),this.theme.habla_link_div.style.clear="both",document.getElementById("hblink9")&&document.getElementById("hblink9").setAttribute("style",this.config.vars._habla_link_a),document.getElementById("hblink99")&&document.getElementById("hblink99").setAttribute("style",this.config.vars._habla_link_a))},this.set_link=function(e){if(e&&e.href){var t=e.href.split(/[\?\#]/);e.href=t[0]+"?rid="+olark._.identityManager.getSiteId()+"&"+t[1],e.href=e.href.replace("olark.com/","olark.com/welcome/"),e.target="_blank",e.rel="nofollow";var n="expanded"==window.olark.__legacy_shim.box_state?!0:!1;olark("api.box.onExpand",function(){setTimeout(function(){n=!0},2e3)}),e.onclick=function(){return n?!0:!1}}},this.register_handlers=function(){this.handlers||(this.handlers=!0,this.eventmgr.register("window_focus",this.events.onWindowFocus,0),this.eventmgr.register("window_click",this.events.onWindowFocus,0),this.eventmgr.register("window_submit",this.events.onWindowSubmit,0),this.eventmgr.register("window_form_submit",this.events.onWindowFormSubmit,0),this.eventmgr.register("window_topbar_clicked",this.events.topBarClicked,0),this.eventmgr.register("habla_closebutton_a_onclick",this.events.closeClicked,0),this.eventmgr.register("habla_sizebutton_a_onclick",this.events.topBarClicked,0),this.eventmgr.register("habla_oplink_a_onclick",this.events.topBarClicked,0),this.eventmgr.register("operator_status_change",this.events.onOpstatusStatusChanged,0),this.eventmgr.register("receive_message",this.events.onChatUpdated,0),this.eventmgr.register("send_message",this.events.onChatUpdated,0),this.eventmgr.register("chat_started",this.events.onChatStarted,0),this.eventmgr.register("theme_loaded",this.events.onThemeLoaded,0))},this.get_operator_state=function(){return this.config.vars.local_mode?this.config.vars.local_operator_state||"available":this.opavailable?this.opbusy?this.config.vars.show_busy_message?"busy":"available":"chat"!=this.opstatus&&"available"!=this.opstatus&&this.opstatus&&""!=this.opstatus?"notavailable":"available":"notavailable"},this.determine_window_status=function(e){var t={};if(window.olark&&window.olark.__legacy_shim){t=window.olark.__legacy_shim,null!=t.box_state&&(e.box_open="expanded"==t.box_state?!0:!1),null!=t.box_visible&&(e.window.theme.visible=t.box_visible?!0:!1,e.box_visible=t.box_visible?!0:!1);var n=e.window.config.vars.close_hides_window;n&&"closed"==t.box_state&&(e.box_visible=!1),e.window.theme.state=t.box_state||e.window.theme.state}if(e.pop_out&&!e.window.config.vars.is_popup)return!1;if(e.pop_out_change&&!e.pop_out)return!0;if(e.chatting||W.client.buffer.length>0&&!e.window.config.vars.close_hides_window)return!0;if(e.box_open||"expanded"==e.window.theme.state)return!0;if(e.window.config.vars.start_hidden&&!e.window.theme.visible)return!1;if(e.window.config.vars.close_hides_window&&!e.box_visible)return!1;if(e.window.config.vars.hide_not_available&&!e.opavailable)return!1;var i=e.opavailable&&"chat"!=e.opstatus&&void 0!=e.opstatus&&""!=e.opstatus&&"available"!=e.opstatus;return e.window.config.vars.hide_not_available&&i?!1:!0},this.setInputBox=function(e,t,n){this.theme.setInputBox(e,t,n)},this.setWindowText=function(){var e=this.get_operator_state();if(("notavailable"==e||this.offline_msg_started)&&this.config.vars.offline_msg_mode)return this.setHeader(this.config.vars.not_available_text),void this.setOfflineWindow(this.config.vars.offline_message||" ");if(this.setOfflineWindow(!1),"notavailable"==e)return this.setHeader(this.config.vars.not_available_text),void(W.client.buffer.length<1&&this.setBody(this.config.vars.offline_message));if("away"==e)return this.config.vars.show_away_as_header&&this.opmessage?this.setHeader(this.opmessage,!0):this.setHeader(this.config.vars.busy_text||this.config.vars.away_text),void(0==this.client.buffer.length&&this.setBody(this.config.vars.away_message||this.config.vars.busy_message||this.config.vars.offline_message));if("busy"==e)return this.setHeader(this.config.vars.busy_text),void this.setBody(this.config.vars.busy_message);var t=new S({client:W.client}),n=t.needsPrechat()&&!this.theme.pre_chat_sent&&this.config.vars.show_pre_chat;n&&this.setShowPreChat(!0),t.didBegin()?this.setHeader(this.config.vars.in_chat_text):(n||this.setBody(this.config.vars.welcome_msg),this.setHeader(this.config.vars.before_chat_text))},this.appendFromBuffer=function(e){if(!this.offline_msg_started)if(this.theme)for(var t=0;t<e.length;t++)e[t]&&this.theme.appendNiceMessage(e[t][0],e[t][1],!0);else W.hwindow_last_buffer=e,this.eventmgr.register("theme_loaded",function(e){e.window.appendFromBuffer(W.hwindow_last_buffer),W.hwindow_last_buffer=""},100)},this.setHeader=function(e,t){void 0!=e&&(t&&(e=".."+e.substr(0,10)+".."),this.theme.setHeader(e))},this.events={onOpstatusStatusChanged:function(e){e.window.opstatus=e.status,e.window.opmessage=e.message,e.window.opbusy=e.busy,e.window.pop_out=e.pop_out,e.window.opavailable||!e.available||e.window.config.vars.offline_msg_mode&&e.window.offline_msg_mode||e.window.reloadBuffer(),e.window.opavailable=e.available,e.window.setWindowText();var t=e.window.determine_window_status(e),n=window.olark&&window.olark.__legacy_shim,i=!e.pop_out&&e.pop_out_change;if(n&&i&&window.olark.__legacy_shim.populate_message_history_from_chat_api){var o=document.getElementById("habla_conversation_div");o.innerHTML="",window.olark.__legacy_shim.populate_message_history_from_chat_api()}t||(e.available||!e.window.config.vars.hide_not_available)&&e.window.theme.visible?e.window.show():e.window.hide(1)},onChatUpdated:function(e){e.window.appendFromBuffer(e.msg)},onChatStarted:function(e){if(e.window.opavailable=e.opavailable,e.window.opbusy=e.busy,null==e.nick||e.nick.match(/webuser\d\d/)||e.window.setnickname(e.nick,1),W.chat_started_arg=e,e.window.theme)e.window.theme.build(e.window.config,e.window.client,!0),e.window.events.onThemeLoaded(e);else if(e.window.config.vars.theme_obj)e.window.setTheme(t.vars.theme_obj),e.window.events.onThemeLoaded(e);else{W.chat_started_arg=e;var n="";e.window.config.vars.theme_path&&(n="http://"+j+"/"+e.window.config.vars.theme_path),e.window.config.vars.theme_url&&(n=e.window.config.vars.theme_url),W.util.simple_load_js_async(n)}W.client.eventmgr.handle("chat_loaded",e)},onThemeLoaded:function(e){e.window.theme||e.window.setTheme(e.obj),U.shouldUsePositionAbsolute()&&W.config.render_ie_hacks();var t=W.chat_started_arg,n=t.window.determine_window_status(t);n?(t.window.show(1),t.pop_out&&!t.window.config.vars.is_popup||!(t.box_open||t.window.config.vars.start_expanded||window.olark&&window.olark.__legacy_shim&&"expanded"==olark.__legacy_shim.box_state)||t.window.expand()):t.window.hide(1),t.habla_message&&(t.window.config.vars.offline_message=t.habla_message.msg,t.habla_message.header&&(t.window.config.vars.not_available_text=t.habla_message.header,t.window.setHeader(habla_window.config.vars.not_available_text)),t.window.show(1),t.habla_message.expand&&t.window.expand(),t.window.theme.habla_conversation_div.scrollTop=0)},onWindowFocus:function(e){e.window.normal(),e.window.setWindowText()},topBarClicked:function(e){return e.window.normal(),e.window.expanded?(e.window.compress(),W.client.eventmgr.handle("window_compressed")):(e.window.expand(),W.client.eventmgr.handle("window_expanded")),!1},closeClicked:function(e){return e.window.close(),W.client.eventmgr.handle("window_closed"),!1},onWindowFormSubmit:function(e){e.window.send()},onWindowSubmit:function(e){e.window.send()}},this.send_pipeline=new v(this),this.send_pipeline.add(W.pipelines.nickname,999),this},W._hwindow.prototype.setnickname=function(e,t){void 0==t&&this.client.setnickname(e)},W._hwindow.prototype.show=function(e){"closed"==this.theme.state&&this.theme.__set_css_window_state("compressed"),this.theme.show(),this.visible=!0,e||this.config.vars.disable_rpc_state||this.client.sendshow(),W.eventmgr.handle("habla_window_changed",{type:"show"})},W._hwindow.prototype.popout=function(e){var t=/\?/.test(d.hblPopupURL)?"&":"?",n=window.open(d.hblPopupURL+t+"_ok="+olark._.identityManager.getSiteId()+"&wcsid="+olark._.identityManager.getConversationId()+"&_oklv="+olark._.identityManager.getOklvValueForPopout()+"&hblid="+olark._.identityManager.getVisitorId()+"&_okgid="+olark._.cookieManager.get("_okgid")+"&olfsk="+olark._.cookieManager.get("olfsk")+"&host="+window.location.host,"habla_popout","width=300,height=400,scrollbars=no,location=no,status=no,menubar=no,toolbar=no,directories=no,resizable=yes");n&&(e||this.client.popout(),this.pop_out=!0,W.client.pop_out=!0,n.focus(),this.hide(e),W.eventmgr.handle("habla_window_changed",{type:"popout"}))},W._hwindow.prototype.end_popout=function(e){this.pop_out=!1,e||this.client.end_popout(),W.eventmgr.handle("habla_window_changed",{type:"endpop_out"})},W._hwindow.prototype.close=function(e){this.theme.close(),e||this.config.vars.disable_rpc_state||this.client.sendend(),this.config.vars.close_hides_window&&this.hide(),W.eventmgr.handle("habla_window_changed",{type:"close"})},W._hwindow.prototype.hide=function(e){this.theme.hide(),this.visible=!1,e||this.config.vars.disable_rpc_state||this.client.sendhide(),W.eventmgr.handle("habla_window_changed",{type:"hide"})},W._hwindow.prototype.setWidth=function(e){this.theme&&this.theme.setWidth(e),W.eventmgr.handle("habla_window_changed",{type:"resize"})},W._hwindow.prototype.setInputHeight=function(e){this.theme.setInputHeight(e),W.eventmgr.handle("habla_window_changed",{type:"resize"})},W._hwindow.prototype.setHeight=function(e){this.theme&&this.theme.setHeight(e),W.eventmgr.handle("habla_window_changed",{type:"resize"})},W._hwindow.prototype.compress=function(){this.expanded=!1,this.theme.compress(),U.shouldUsePositionAbsolute()&&this.visible&&W.__ie6_floating_div_monitor&&W.__ie6_floating_div_monitor.__move_to_correct_location(),W.eventmgr.handle("habla_window_changed",{type:"compress"}),this.config.vars.disable_rpc_state||this.client.sendcompress()},W._hwindow.prototype.expand=function(){this.expanded=!0,U.shouldUsePositionAbsolute()&&"bottom"==this.config.vars.ycorner&&this.theme.setXY(this.theme.habla_window_div.style.left.match(/\d\d*/),this.theme.habla_window_div.style.top.match(/\d\d*/)-this.config.vars.convo_height-this.config.vars.panel_offset),this.theme&&this.theme.expand(),this.config.vars.disable_rpc_state||this.client.sendexpand(),W.eventmgr.handle("habla_window_changed",{type:"expand"})},W._hwindow.prototype.setPosition=function(e){this.theme.setPosition(e)},W._hwindow.prototype.setInline=function(e){this.theme.setInline(e)},W._hwindow.prototype.setMargins=function(e,t,n,i){this.theme.setMargins(e,t,n,i)},W._hwindow.prototype.getHeader=function(){return this.theme.getHeader()},W._hwindow.prototype.reloadBuffer=function(){this.theme.setBody(""),this.appendFromBuffer(this.client.buffer)},W._hwindow.prototype.setBody=function(e){this.setOfflineWindow(!1),this.theme.setBody(e||"")},W._hwindow.prototype.setOfflineWindow=function(e){this.theme.setOfflineWindow(e)},W._hwindow.prototype.setShowPreChat=function(e){this.theme.setShowPreChat(e)},W._hwindow.prototype.highlight=function(){this.theme.highlight()},W._hwindow.prototype.normal=function(){this.theme.normal()},W._hwindow.prototype.send=function(){var e=this.theme.getMessageInputField(),t=this.theme.getMessageInputFieldValue();if(t==this.config.vars.say_text)this.theme.setMessageInputFieldValue("");else if(t&&t.length>0)try{var n=t;this.theme.setMessageInputFieldValue(""),n=this.send_pipeline.run(n),n&&this.client.sendmessage(n),this.normal()}catch(i){throw i}return this.config.vars.disableFocus||(e.focus(),setTimeout(function(){habla_window.theme.getMessageInputField().focus()},10)),!1},W.pipelines.nickname=function(e,t){if("/nick "==e.substr(0,6)){var n=e.substr(6);return void t.client.setnickname(n)}return e},W.pipelines.push_url=function(e){var t=e;if(e=e[1],"!push "==e.substr(0,6)){var n="";if(e=e.replace(/&lt;/gi,"["),e=e.replace(/\/*&gt;/gi,"]"),e.match(/<a/)){var i=e.match(/src\s*=\s*"*([^\"]+)\"*/i);i.length>1&&(n=i[1])}else if(e.match(/\[(http[^\]]+)\s*\]/i)){var o=e.match(/\[(http[^\]]+)\]/i);n=o[1]}else n=e.substr(6,e.length-6);if(n=n.split(" ")[0],n=n.split("%20")[0],""!=n){var a=W.util.getCommonUrlFormatter(),r=a.getSmartUrl(n);return void setTimeout(function(){window.location=r},0)}}return t},W.client.incoming_pipeline.add(W.pipelines.push_url,999),W.plugins.incoming_notification_vars={},W.plugins.incoming_notification=function(){this.name="incoming_notification",this.load=function(e){var t=this;W.plugins.incoming_notification_vars.freq=3e3,W.plugins.incoming_notification_vars.flashicon=!1,W.plugins.incoming_notification_vars.flashing=!1,W.plugins.incoming_notification_vars.original_favicon=!1;var n=W.util.find_or_create_el("habla_wcsend_input","textarea");W.plugins.incoming_notification_vars.windowTextCleared=!0,e.hwindow.config.vars.flash_titlebar&&(e.hwindow.eventmgr.register("receive_message",this.onReceiveMessage),e.hwindow.eventmgr.register("send_message",this.onWindowFocus),e.hwindow.eventmgr.register("window_focus",this.onWindowFocus),e.hwindow.eventmgr.register("window_click",this.onWindowFocus)),e.hwindow.config.vars.flash_icons&&(W.plugins.incoming_notification_vars.default_flash_on_icon=e.hwindow.config.vars.default_flash_off_icon,W.oldtitle||(W.oldtitle=/Message Received/i.test(document.title)?"":document.title||""),W.plugins.incoming_notification_vars.originalFavicon||(W.plugins.incoming_notification_vars.originalFavicon=W.plugins.incoming_notification_vars.remove_current_icon(!0)||e.hwindow.config.vars.default_flash_on_icon),W.plugins.incoming_notification_vars.default_flash_off_icon=W.plugins.incoming_notification_vars.originalFavicon,n.onkeypress=function(){t.onWindowFocus({window:e.hwindow}),W.plugins.incoming_notification_vars.windowTextCleared=!0})},this.onReceiveMessage=function(e){var t=e.msg[e.msg.length-1][1];/^\s*!/.test(t)||"remote_update"==e.type&&(e.window.highlight(),W.plugins.incoming_notification_vars.last_msg="",W.client.buffer&&W.client.buffer[W.client.buffer.length-1]&&(W.plugins.incoming_notification_vars.last_msg=W.client.buffer[W.client.buffer.length-1][1].substr(0,10),e.window.setHeader(".."+W.plugins.incoming_notification_vars.last_msg+"..")),W.plugins.incoming_notification_vars.windowTextCleared=!1,W.plugins.incoming_notification_vars.flashOlarkFavicon())},this.onWindowFocus=function(e){if(W.plugins.incoming_notification_vars.resetFavicon(),!W.plugins.incoming_notification_vars.windowTextCleared){e.window.setWindowText(),W.plugins.incoming_notification_vars.windowTextCleared=!0;var t=document.getElementById("habla_topbar_div");t.className=t.className.replace(/habla_topbar_div_highlighted/,"habla_topbar_div_normal")}},W.plugins.incoming_notification_vars.flashOlarkFavicon=function(){document.title="(Message Received: "+W.plugins.incoming_notification_vars.last_msg+") "+W.oldtitle,W.plugins.incoming_notification_vars.set_icon(W.plugins.incoming_notification_vars.default_flash_on_icon);var e=!0;W.plugins.incoming_notification_vars.flashingInterval=setInterval(function(){W.plugins.incoming_notification_vars.set_icon(e?W.plugins.incoming_notification_vars.originalFavicon:W.plugins.incoming_notification_vars.default_flash_on_icon),e=!e},W.plugins.incoming_notification_vars.freq)},W.plugins.incoming_notification_vars.resetFavicon=function(){document.title=W.oldtitle,clearInterval(W.plugins.incoming_notification_vars.flashingInterval);var e=W.plugins.incoming_notification_vars.originalFavicon||"";W.plugins.incoming_notification_vars.remove_current_icon(),W.plugins.incoming_notification_vars.set_icon(e),W.plugins.incoming_notification_vars.flashing=!1},W.plugins.incoming_notification_vars.remove_current_icon=function(e){if(document.getElementsByTagName("head")&&0!=document.getElementsByTagName("head").length){for(var t=document.getElementsByTagName("head")[0].getElementsByTagName("link"),n=0;n<t.length;n++){var i=t[n];if("image/x-icon"==i.type&&/favicon|favico|shortcut|icon|shortcut\s*icon/i.test(i.rel)){var o=i.href;return e||document.getElementsByTagName("head")[0].removeChild(i),o}}return void 0}},W.plugins.incoming_notification_vars.set_icon=function(e){var t=document.createElement("link");t.type="image/x-icon",t.rel="shortcut icon",t.href=e,W.plugins.incoming_notification_vars.remove_current_icon(),document.getElementsByTagName("head")&&0!=document.getElementsByTagName("head").length&&document.getElementsByTagName("head")[0].appendChild(t)}},W.plugins.messages_received=0,W.plugins.expand_on_receive_message=function(){this.name="expand_on_receive_message",this.load=function(e){e.hwindow.eventmgr.register("receive_message",this.onReceiveMessage,-1)},this.onReceiveMessage=function(e){var t=e.msg[e.msg.length-1][1];/^\s*!/.test(t)||(W.plugins.messages_received+=1,e.window.pop_out||("start"==e.type||e.window.config.vars.expandOnFirstMessageReceived&&!e.window.config.vars.expandOnMessageReceived&&1!=W.plugins.messages_received?"start"!=e.type&&e.window.theme&&"closed"==e.window.theme.state&&(e.window.theme.state="compressed",e.window.show()):(W.client.eventmgr.handle("window_expanded"),e.window.expand(),e.window.show())))}},W.plugins.away_div_handler=function(){this.name="away_div_handler",this.load=function(e){W.util.hide_div("habla_unavailable_div"),W.util.hide_div("habla_available_div"),W.util.show_div("habla_loading_div",e.hwindow.config.vars.habla_special_div_show_type)||W.util.show_div("habla_unavailable_div",e.hwindow.config.vars.habla_special_div_show_type),(void 0!=document.getElementById("habla_available_div")||void 0!=document.getElementById("habla_unavailable_div"))&&e.hwindow.eventmgr.register("operator_status_change",this.onOperatorStatusChange)},this.onOperatorStatusChange=function(e){{var t=e.available,n=e.status;e.message}!t||n&&"chat"!=n&&e.window.config.vars.hide_when_away?(W.util.hide_div("habla_available_div"),W.util.show_div("habla_unavailable_div",e.window.config.vars.habla_special_div_show_type),W.util.hide_div("habla_loading_div")):(W.util.show_div("habla_available_div",e.window.config.vars.habla_special_div_show_type),W.util.hide_div("habla_unavailable_div"),W.util.hide_div("habla_loading_div"))}},W.plugins.auto_initiate=function(){this.load=function(e){e.hwindow.config.vars.auto_initiate_allowed&&e.hwindow.config.vars.auto_initiate&&e.hwindow.eventmgr.register("chat_loaded",this.onChatLoad)},this.onChatLoad=function(e){e.session_start&&!e.opbusy&&e.opavailable&&(habla_window.auto_initiated=!1,setTimeout(function(){if(0==W.client.buffer.length&&W.client.opavailable){habla_window.show(),habla_window.expand(),habla_window.auto_initiated=!0;var t=e.window.config.vars.auto_initiate_message;habla_window.theme.appendNiceMessage(e.window.config.vars.auto_initiate_name,t[Math.floor(Math.random()*t.length)],!0,!1,!0),habla_window.highlight(),W.client.buffer=[" "],habla_window.send_pipeline.add(function(e){return habla_window.auto_initiated&&(W.client.sendmessage(habla_window.config.vars.auto_initiate_response_notify,!0),habla_window.auto_initiated=!1),e
},1e4),habla_window.config.vars.auto_initiate_notify&&W.client.sendmessage(habla_window.config.vars.auto_initiate_notify_msg,!0)}},parseInt(1e3*e.window.config.vars.auto_initiate_period)))}},W.plugins.google_translate=function(){this.name="googletranslate",this.load=function(){}},W.plugins.sounds=function(){this.name="sounds",this.load=function(e){1==e.conf.vars.enableSounds&&W.util.simple_load_js_async(e.conf.vars.plugin_path+"contributed/sounds.js")}},W.plugins.smileys=function(){this.name="smileys",this.load=function(e){1==e.conf.vars.enableSmileys&&W.util.simple_load_js_async(e.conf.vars.plugin_path+"contributed/smileys.js")}},W.themes.default_theme=function(){this.appended=!0,this.last_msg=-1,this.visible=!1,this.highlighted=!1,this.state="compressed",this.message_sent=!1,this.offline_window=!1,this.pre_chat_sent=!1,this.ready=!1,this.position="BR",this.build=function(e,t,n){this.client=t,this.config=e,this.set_config(),this.load_styles(),this.div=void 0,this.divid=e.vars.divid,this.build_dom(n),this.set_dom_event_handlers(),this.config.init_from_config(this),this.palette_hack(),this.render_styles(),this.config.vars.disableJSStyles||this.config.vars.no_palette||this.render_palette(),this.set_default_text(),this.register_handlers(),this.ready=!0,this.config.vars.disableJSStyles&&!this.config.vars.start_hidden&&this.show(),W.eventmgr.handle("post_theme_loaded")},this.palette_hack=function(){if(W.need_ugly_backwards_palette_hack){var e={};for(var t in this.config.style_classes_map)if(this.config.style_classes_map.hasOwnProperty(t))for(var n in this.config.style_classes_map[t])if(this.config.style_classes_map[t].hasOwnProperty(n))for(var i in this.config.palette)this.config.palette.hasOwnProperty(i)&&"hbl_pal_"+i==this.config.style_classes_map[t][n]&&(this.config.style_classes_map[t][n]="hbl_pal_"+i+"_local",e[i+"_local"]=this.config.palette[i]);this.config.palette=e}},this.set_config=function(){var e=new b;e.style_classes={};var t="habla_button",n="habla_button_a_normal",i="habla_wcsend_input_pre",o="habla_wcsend_field",a="hbl_pal_main_font_size",r="hbl_pal_main_font_family",s="hbl_pal_header_font_size",_="hbl_pal_control_border",l="habla_pre_chat_form_field",c="hbl_pal_button_bg",u="habla_wcsend_input_normal",d="hbl_pal_input_font_size";e.style_classes_map={habla_window_div:["habla_window_div_position","habla_window_div_base","hbl_pal_main_width"],habla_closebutton_a:[t,n,s,r,c,"hbl_pal_button_fg"],habla_sizebutton_a:[t,n,s,r,c,"hbl_pal_button_fg"],habla_popout_a:[t,n,s,r,c,"hbl_pal_button_fg"],habla_end_popout_a:[t,n,s,r,c,"hbl_pal_button_fg"],habla_button_normal:[t,n,s,c,"hbl_pal_button_fg"],habla_button_highlighted:[t,"habla_button_a_highlighted","hbl_pal_header_font_size","hbl_pal_button_bg_highlight","hbl_pal_button_fg_highlight"],habla_button_hover:[t,"habla_button_a_hover","hbl_pal_header_font_size","hbl_pal_button_bg_hover","hbl_pal_button_fg_hover"],habla_panel_div:["habla_panel_border","hbl_pal_main_bg","hbl_pal_panel_border",r,a],habla_oplink_a:["habla_oplink_a_normal","hbl_pal_header_font_size","hbl_pal_title_fg"],habla_oplink_hover:["habla_oplink_a_hover","hbl_pal_header_font_size","hbl_pal_title_fg"],habla_wcsend_input_pre:[o,i,u,"hbl_pal_input_pre_fg",r,d,_],habla_wcsend_input_post:[o,"habla_wcsend_input_post",u,"hbl_pal_main_fg",r,d],habla_wcsend_input:[o,i,u,_,r,d],habla_wcsend_input_highlighted:[o,i,"habla_wcsend_input_highlighted","hbl_pal_control_highlight_border",r,d],habla_name_input:[o,i,u,r,_,d],habla_offline_email_input:[o,i,u,r,_,d],habla_offline_phone_input:[o,i,u,r,_,d],habla_offline_body_input:[i,u,r,_,d],habla_offline_clear_div:["clear_style"],habla_chatform_form:["habla_chatform_form"],habla_input_div:["habla_input_div"],habla_pre_chat_email_input:[l,o,i,u,r,_,d],habla_pre_chat_name_input:[l,o,i,u,r,_,d],habla_pre_chat_phone_input:[l,o,i,u,r,_,d],habla_offline_message_sent_div:["hbl_panel","habla_offline_message_sent_div","hbl_pal_main_height",_,"hbl_pal_main_fg"],habla_pre_chat_div:["hbl_panel","habla_pre_chat_div","hbl_pal_main_height","hbl_pal_main_fg"],habla_offline_message_div:["hbl_panel","habla_offline_message_div",_,"hbl_pal_main_fg"],habla_conversation_div:["hbl_panel","habla_conversation_div","hbl_pal_main_height",_,"hbl_pal_main_fg","hbl_pal_main_bg"],habla_say_text_span:["habla_say_text_span","hbl_pal_main_fg"],habla_submit_button:["habla_submit_button"],habla_offline_submit_input:["habla_offline_submit_input","hbl_pal_offline_submit_fg",_,"hbl_pal_offline_submit_bg"],habla_pre_chat_submit_input:[l,"habla_offline_submit_input","hbl_pal_offline_submit_fg",_,"hbl_pal_offline_submit_bg"],habla_offline_error_span:["habla_offline_error_span"],habla_pre_chat_clear_div:["clear_style"],habla_conversation_p_item:["habla_conversation_p_item","hbl_pal_main_fg"],habla_conversation_person1:["habla_conversation_person1","hbl_pal_local_fg"],habla_conversation_person2:["habla_conversation_person2","hbl_pal_remote_fg"],habla_conversation_text_span:["habla_conversation_text_span","hbl_pal_main_fg"],habla_conversation_notification_nickname:["habla_conversation_person2","hbl_pal_remote_fg","habla_conversation_notification_nickname"],habla_conversation_notification_text_span:["habla_conversation_text_span","hbl_pal_main_fg","habla_conversation_notification"],habla_topbar_div_compressed:["habla_topbar_div_normal","hbl_pal_title_fg","hbl_pal_title_bg","habla_topbar_div_compressed"],habla_topbar_div:["habla_topbar_div_normal","hbl_pal_title_fg","hbl_pal_title_bg","habla_topbar_div_expanded"],habla_topbar_div_highlighted:["habla_topbar_div_highlighted","hbl_pal_title_fg_highlight","hbl_pal_title_bg_highlight","habla_topbar_div_expanded"]},e.vars={habla_sizebutton_text_expanded:"_",habla_sizebutton_text_compressed:"^",habla_closebutton_text:"x",habla_popout_text:">",habla_end_popout_text:"&lt;&lt;",_habla_link_div:"padding: 3px 0 5px 0 !important; font-family: helvetica, sans-serif; text-align: center; text-transform: uppercase; font-size: 9px; letter-spacing: 2px; font-weight: bold; color: #aaa !important;",_habla_link_a:"font-family: helvetica, sans-serif; text-transform: uppercase; font-size: 9px !important; letter-spacing: 2px; font-weight: bold; color: #e75917 !important;"},this.config.merge(e);var h=new b;h.load_defaults(),this.config.merge(h),W.client.pollingmanager.setLongPoll(!this.config.vars.poll),this.config.remap_palette(),this.config.remap_palette(),this.config.vars.right_to_left&&(this.config.vars.local_user_display_name="&larr;"),this.config.vars.enable_buttons&&(this.config.style_classes_map.habla_topbar_div=["habla_topbar_div_normal","habla_topbar_clickable","hbl_pal_title_fg","hbl_pal_title_bg","habla_topbar_div_expanded"]),this.config.vars.corner_position&&(this.config.vars.corner_position=this.__getAdjustedPosition(this.config.vars.corner_position))},this.build_dom=function(e,t){document.getElementById(this.divid)&&(this.appended=!1),this.habla_container=W.util.find_or_create_div(this.divid,void 0==this.config.vars.not_append?W.util.get_body():void 0),this.habla_container.id="habla_beta_container_do_not_rely_on_div_classes_or_names",this.habla_container.className=this.__get_browser_class()+" "+this.__get_mobile_class()+" "+("BackCompat"==document.compatMode?"olrk-quirks":"olrk-noquirks");var n=W.util.find_or_create_div("hbl_operator_state_div",this.habla_container);n.className="olrk-unknown",olark("api.chat.onOperatorsAvailable",function(){n.className="olrk-available"}),olark("api.chat.onOperatorsAway",function(){n.className="olrk-away"});var i=W.util.find_or_create_div("hbl_region",n);i.className=this.config.vars.right_to_left?"olrk-rtl":"olrk-normal",this.window_state_div=W.util.find_or_create_div("habla_window_state_div",i),this.window_state_div.className=this.config.vars.show_end_popout?"olrk-state-popout":" olrk-state-compressed",this.habla_window_div=W.util.find_or_create_div(this.divid,this.window_state_div),t||W.util.hide_div(this.habla_window_div);var o=this.config.vars.corner_position&&this.config.vars.corner_position.match(/B/);o&&(this.habla_compressed_div=W.util.find_or_create_div("habla_compressed_div",this.habla_window_div)),this.habla_panel_div=W.util.find_or_create_div("habla_panel_div",this.habla_window_div),this.habla_both_div=W.util.find_or_create_div("habla_both_div",this.habla_panel_div),W.util.hide_div(this.habla_panel_div),this.habla_topbar_div=W.util.find_or_create_div("habla_topbar_div",this.habla_both_div),this.config.vars.add_tab_closure_span&&(this.olrk_tab_closure_span=W.util.find_or_create_el("olrk_tab_closure_span","span"),this.habla_both_div.appendChild(this.olrk_tab_closure_span)),this.habla_expanded_div=W.util.find_or_create_div("habla_expanded_div",this.habla_panel_div),o||(this.habla_compressed_div=W.util.find_or_create_div("habla_compressed_div",this.habla_window_div)),this.config.vars.left_align_widget&&(this.habla_compressed_div.className="olrk-left-align"),this.habla_closed_div=W.util.find_or_create_div("habla_closed_div",this.habla_window_div),e||this.hide(),this.habla_oplink_a=W.util.find_or_create_el("habla_oplink_a","a"),this.config.vars.append_oplink_before_buttons&&this.habla_topbar_div.appendChild(this.habla_oplink_a),this.config.vars.show_end_popout?(this.habla_end_popout_a=W.util.find_or_create_el("habla_end_popout_a","a"),this.habla_topbar_div.appendChild(this.habla_end_popout_a)):this.config.vars.show_popout&&(this.habla_popout_a=W.util.find_or_create_el("habla_popout_a","a"),this.habla_topbar_div.appendChild(this.habla_popout_a)),this.config.vars.enable_buttons&&(this.config.vars.hide_min_max_buttons||(this.habla_closebutton_a=W.util.find_or_create_el("habla_closebutton_a","a"),this.config.vars.close_hides_window&&this.habla_topbar_div.appendChild(this.habla_closebutton_a),this.habla_sizebutton_a=W.util.find_or_create_el("habla_sizebutton_a","a"),this.habla_topbar_div.appendChild(this.habla_sizebutton_a))),this.config.vars.append_oplink_before_buttons||this.habla_topbar_div.appendChild(this.habla_oplink_a);var a=function(e){var t=document.createElement("div");return t.className="hbl_txt_wrapper",t.appendChild(e),t};this.habla_middle_div=W.util.find_or_create_div("habla_middle_div",this.habla_expanded_div);var r=W.util.find_or_create_div("habla_middle_wrapper_div",this.habla_middle_div);this.habla_conversation_div=W.util.find_or_create_div("habla_conversation_div",r),this.habla_offline_message_sent_div=W.util.find_or_create_div("habla_offline_message_sent_div",r),this.habla_offline_message_sent_div.style.display="none",this.habla_offline_message_span=W.util.find_or_create_el("habla_offline_message_span","span"),this.habla_offline_message_div=W.util.find_or_create_div("habla_offline_message_div",r),this.habla_offline_message_div.style.display="none",this.habla_name_input=W.util.find_or_create_el("habla_name_input","textarea"),this.habla_offline_phone_input=W.util.find_or_create_el("habla_offline_phone_input","textarea"),this.habla_offline_email_input=W.util.find_or_create_el("habla_offline_email_input","textarea"),this.habla_offline_body_input=W.util.find_or_create_el("habla_offline_body_input","textarea"),this.habla_offline_clear_div=W.util.find_or_create_el("habla_offline_clear_div","div"),this.habla_offline_submit_input=W.util.find_or_create_el("habla_offline_submit_input","input");try{this.habla_offline_submit_input.setAttribute("type","submit")}catch(s){}this.habla_offline_error_span=W.util.find_or_create_el("habla_offline_error_span","span"),this.habla_offline_message_div.appendChild(this.habla_offline_message_span),this.habla_offline_message_div.appendChild(a(this.habla_name_input)),this.habla_offline_message_div.appendChild(a(this.habla_offline_email_input)),W.config.vars.require_offline_phone>0&&this.habla_offline_message_div.appendChild(a(this.habla_offline_phone_input)),this.habla_offline_message_div.appendChild(a(this.habla_offline_body_input)),W.config.vars.disable_extra_br||this.habla_offline_message_div.appendChild(W.util.find_or_create_el("habla_br","br")),this.habla_offline_message_div.appendChild(this.habla_offline_error_span),this.habla_offline_message_div.appendChild(this.habla_offline_submit_input),this.habla_offline_message_div.appendChild(this.habla_offline_clear_div),this.habla_pre_chat_span=W.util.find_or_create_el("habla_pre_chat_span","span"),this.habla_pre_chat_div=W.util.find_or_create_div("habla_pre_chat_div",r),this.habla_pre_chat_div.style.display="none",this.habla_pre_chat_name_input=W.util.find_or_create_el("habla_pre_chat_name_input","textarea"),this.habla_pre_chat_clear_div=W.util.find_or_create_el("habla_pre_chat_clear_div","div"),this.habla_pre_chat_email_input=W.util.find_or_create_el("habla_pre_chat_email_input","textarea"),this.habla_pre_chat_phone_input=W.util.find_or_create_el("habla_pre_chat_phone_input","textarea"),this.habla_pre_chat_submit_input=W.util.find_or_create_el("habla_pre_chat_submit_input","input");try{this.habla_pre_chat_submit_input.setAttribute("type","submit")}catch(s){}if(this.habla_pre_chat_error_span=W.util.find_or_create_el("habla_pre_chat_error_span","span"),this.habla_pre_chat_div.appendChild(this.habla_pre_chat_span),this.habla_pre_chat_div.appendChild(a(this.habla_pre_chat_name_input)),this.habla_pre_chat_div.appendChild(a(this.habla_pre_chat_email_input)),this.habla_pre_chat_div.appendChild(a(this.habla_pre_chat_phone_input)),W.config.vars.disable_extra_br||this.habla_pre_chat_div.appendChild(W.util.find_or_create_el("habla_br_2","br")),this.habla_pre_chat_div.appendChild(this.habla_pre_chat_error_span),this.habla_pre_chat_div.appendChild(this.habla_pre_chat_submit_input),this.habla_pre_chat_div.appendChild(this.habla_pre_chat_clear_div),this.habla_chatform_form=W.util.find_or_create_el("habla_chatform_form","form"),this.habla_chatform_form.setAttribute("action","#"),this.habla_chatform_form.setAttribute("method","GET"),this.habla_chatform_form.setAttribute("autocomplete","off"),this.habla_input_div=W.util.find_or_create_el("habla_input_div","div"),this.habla_wcsend_input=W.util.find_or_create_el("habla_wcsend_input","textarea"),this.habla_wcsend_input.setAttribute("size",this.config.vars.input_box_size),this.habla_input_div.appendChild(a(this.habla_wcsend_input)),U.needsSubmitButton()){this.habla_submit_button=W.util.find_or_create_el("habla_submit_button","input");try{this.habla_submit_button.setAttribute("type","button")}catch(s){}this.habla_input_div.appendChild(this.habla_submit_button)}this.habla_chatform_form.appendChild(this.habla_input_div),this.habla_middle_div.appendChild(this.habla_chatform_form)},this.set_events=function(e,t){function n(t,n,i){return function(o){var a;return o||(o=window.event),o.target?a=o.target:o.srcElement&&(a=o.srcElement),3==a.nodeType&&(a=a.parentNode),a==e&&(habla_window.eventmgr.handle(t+"_"+n,{target:a,event:o}),i&&(o.cancelBubble=!0,o.stopPropagation))?(o.stopPropagation(),!1):void 0}}"undefined"!=typeof e&&(e.onblur=n(t,"onblur"),e.onfocus=n(t,"onfocus"),e.onclick=n(t,"onclick",!0),e.onmouseover=n(t,"onmouseover"),e.onmouseout=n(t,"onmouseout"))},this.set_dom_event_handlers=function(){this.habla_submit_button&&(this.habla_submit_button.onclick=function(){habla_window.eventmgr.handle("window_form_submit",{event:void 0})}),this.set_events(this.habla_wcsend_input,"habla_wcsend_input",!0),this.set_events(this.habla_name_input,"habla_name_input"),this.set_events(this.habla_offline_email_input,"habla_offline_email_input"),this.set_events(this.habla_offline_phone_input,"habla_offline_phone_input"),this.set_events(this.habla_offline_body_input,"habla_offline_body_input"),this.set_events(this.habla_offline_submit_input,"habla_offline_submit_input"),this.set_events(this.habla_pre_chat_email_input,"habla_pre_chat_email_input"),this.set_events(this.habla_pre_chat_phone_input,"habla_pre_chat_phone_input"),this.set_events(this.habla_pre_chat_name_input,"habla_pre_chat_name_input"),this.set_events(this.habla_pre_chat_submit_input,"habla_pre_chat_submit_input"),this.habla_conversation_div.onclick=function(){return habla_window.eventmgr.handle("habla_conversation_div_onclick")},this.habla_chatform_form.onfocus=function(){habla_window.eventmgr.handle("habla_chatform_form_onfocus")},this.habla_chatform_form.onsubmit=function(e){return habla_window.eventmgr.handle("window_form_submit",{event:e}),!1},this.habla_pre_chat_phone_input.onkeypress=function(e){e||(e=window.event);var t=void 0;return window.event?(e=window.event,t=e.keyCode):e.which&&(t=e.which),13==t||10==t?(habla_window.eventmgr.handle("habla_pre_chat_submit_input_onclick"),!1):void 0},this.habla_pre_chat_email_input.onkeypress=function(e){e||(e=window.event);var t=void 0;return window.event?(e=window.event,t=e.keyCode):e.which&&(t=e.which),13==t||10==t?(habla_window.eventmgr.handle("habla_pre_chat_submit_input_onclick"),!1):void 0},this.habla_pre_chat_name_input.onkeypress=function(e){e||(e=window.event);var t=void 0;return window.event?(e=window.event,t=e.keyCode):e.which&&(t=e.which),13==t||10==t?(habla_window.eventmgr.handle("habla_pre_chat_submit_input_onclick"),!1):void 0},this.habla_wcsend_input.onkeydown=function(e){if(e||(e=window.event),function(t){function n(e){olark.__legacy_shim.disableComposing||W.client.chatting&&W.client.sendcommand("send_compose_state",e)}function i(){t.visitorHasStartedTyping||(t.visitorHasStartedTyping=!0,n(_.COMPOSING))}function o(){clearTimeout(t.visitorHasPausedTyping),t.visitorHasPausedTyping=setTimeout(function(){a(),n(_.PAUSED)},l)}function a(){clearTimeout(t.visitorHasPausedTyping),n(_.ACTIVE),t.visitorHasStartedTyping=!1}function r(){a()}function s(){""==habla_window.theme.habla_wcsend_input.value?a():(i(),o())}var _={ACTIVE:"active",INACTIVE:"inactive",COMPOSING:"composing",PAUSED:"paused"},l=3e3;switch(t.visitorHasStartedTyping=t.visitorHasStartedTyping||!1,t.visitorHasPausedTyping=t.visitorHasPausedTyping||-1,e.keyCode){case 10:case 13:r();break;default:s()}}(this),!habla_window.theme.habla_wcsend_input.has_typed)return 13!=e.keyCode&&10!=e.keyCode?habla_window.setInputBox(habla_window.theme.habla_wcsend_input,String.fromCharCode(e.keyCode),"highlight"):habla_window.setInputBox(habla_window.theme.habla_wcsend_input,"","highlight"),habla_window.theme.habla_wcsend_input.has_typed=!0,!1;if(function(){function e(e,n){function o(){i=!1}if(i)return!1;var a=n.parentNode||document.body||document.documentElement;i=!0,setTimeout(o,600),"undefined"==typeof t&&(t=document.createElement("olark"),t.style.display="block",t.style.visibility="hidden",t.style.position="absolute",a.appendChild(t));var r=e.replace(/(\<|\>)/g,"^");t.innerHTML=r;var s=parseInt(t.offsetWidth)>=parseInt(n.offsetWidth);return a.removeChild(t),s}var t,n,i=!1;habla_window.config.vars.disable_expand_text_input||habla_window.expanded_textbox||!e(habla_window.theme.getMessageInputFieldValue(),habla_window.theme.getMessageInputField())||(habla_window.expanded_textbox=!0,habla_window.setInputHeight(habla_window.config.vars.resize_input_height),n=habla_window.theme.habla_wcsend_input.parentNode,n.className=n.className.replace("hbl_long_text_entered","")+" hbl_long_text_entered"),!habla_window.config.vars.disable_expand_text_input&&habla_window.expanded_textbox&&habla_window.theme.getMessageInputFieldValue().length<habla_window.config.vars.resize_length&&(habla_window.expanded_textbox=!1,habla_window.setInputHeight(habla_window.config.vars.input_height),n=habla_window.theme.habla_wcsend_input.parentNode,n.className=n.className.replace("hbl_long_text_entered","")+" hbl_long_text_entered")}(),13==e.keyCode||10==e.keyCode){if(""==habla_window.theme.getMessageInputFieldValue().replace(/^\s*|\s*$/g,""))return;return habla_window.expanded_textbox=!1,habla_window.setInputHeight(habla_window.config.vars.input_height),habla_window.eventmgr.handle("window_submit",{event:e}),!1}return!0},this.set_events(this.habla_oplink_a,"habla_oplink_a"),this.config.vars.show_end_popout?this.set_events(this.habla_end_popout_a,"habla_end_popout_a"):this.config.vars.show_popout&&this.set_events(this.habla_popout_a,"habla_popout_a"),this.config.vars.enable_buttons?(this.habla_topbar_div.onclick=function(e){return habla_window.eventmgr.handle("window_topbar_clicked"),e||(e=window.event),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),!1},this.config.vars.hide_min_max_buttons||(this.set_events(this.habla_closebutton_a,"habla_closebutton_a"),this.set_events(this.habla_sizebutton_a,"habla_sizebutton_a"))):this.habla_oplink_a.onclick=function(){return!1}},this.styles=[],this.set_css_style=function(e){if(e){e=e.replace("static.olark.com",j);var t=/^\s*http/i.test(e);if(t||(e=d.hbl_ext+"://"+e),e+="?"+d.hbl_ext,this.style_div){var n=W.util.find_or_create_el("habla_style_div_alternative","link");n.setAttribute("type","text/css"),n.setAttribute("rel","alternative stylesheet"),W.util.get_head().appendChild(n),n.setAttribute("href",e);var i=document.getElementById("habla_style_div"),o=document.getElementById("habla_style_div_alternative");i.setAttribute("rel","alternative stylesheet"),o.setAttribute("rel","stylesheet"),i.id="habla_style_div_alternative",o.id="habla_style_div"}else this.style_div=W.util.find_or_create_el("habla_style_div","link"),this.style_div.setAttribute("type","text/css"),this.style_div.setAttribute("rel","stylesheet"),W.util.get_head().appendChild(this.style_div),this.style_div.setAttribute("href",e)}},this.load_styles=function(){var e=this.config.vars.legacy_css_for_linkfollow;if(H&&e)this.set_css_style(e);else if(!this.config.vars.disableJSStyles||this.config.vars.force_olark_css){var t=j+"/themes/defaults/base.css?"+L,n=j+"/themes/defaults/base.ie.css?"+L,i=U.shouldUsePositionAbsolute(),o=U.isCompatMode(),a=j+"/themes/azul_popout/preview_theme.css?"+L,r=void 0;r=q?this.config.vars.popout_css_url?this.config.vars.popout_css_url:a:this.config.vars.inline_css_url?i?o&&this.config.vars.inline_css_url_quirks?this.config.vars.inline_css_url_quirks:this.config.vars.inline_css_url_ie?this.config.vars.inline_css_url_ie:this.config.vars.inline_css_url:o&&this.config.vars.inline_css_url_quirks?this.config.vars.inline_css_url_quirks:this.config.vars.inline_css_url:i?n:t,this.set_css_style(r)}},this.render_styles=function(){this.config.vars.require_name||(this.habla_pre_chat_name_input.style.display="none",this.habla_pre_chat_name_input.parentNode.style.display="none"),this.config.vars.require_phone||(this.habla_pre_chat_phone_input.style.display="none",this.habla_pre_chat_phone_input.parentNode.style.display="none"),this.config.vars.require_email||(this.habla_pre_chat_email_input.style.display="none",this.habla_pre_chat_email_input.parentNode.style.display="none"),this.config.render_all_styles(this)},this.setInputBox=function(e,t,n,i){e.value=t,this.setInputBoxStyle(e,n,i)},this.setInputBoxStyle=function(e,t,n){n?this.config.set_element_classes(e,"habla_wcsend_input_post"):this.config.set_element_classes(e,"habla_wcsend_input_pre"),"normal"==t?this.config.set_element_classes(e,"habla_wcsend_input"):"highlight"==t&&this.config.set_element_classes(e,"habla_wcsend_input_highlighted")},this.set_default_text=function(){this.set_default_text_event(this.habla_name_input,"habla_name_input",this.config.vars.habla_name_input_text),this.set_default_text_event(this.habla_offline_email_input,"habla_offline_email_input",this.config.vars.habla_offline_email_text),this.set_default_text_event(this.habla_offline_phone_input,"habla_offline_phone_input",this.config.vars.habla_offline_phone_text),this.set_default_text_event(this.habla_offline_body_input,"habla_offline_body_input",this.config.vars.habla_offline_body_text),this.set_default_text_event(this.habla_pre_chat_name_input,"habla_pre_chat_name_input",this.config.vars.habla_name_input_text),this.set_default_text_event(this.habla_pre_chat_email_input,"habla_pre_chat_email_input",this.config.vars.habla_offline_email_text),this.set_default_text_event(this.habla_pre_chat_phone_input,"habla_pre_chat_phone_input",this.config.vars.habla_offline_phone_text),this.set_default_text_event(this.habla_wcsend_input,"habla_wcsend_input",this.config.vars.textbox_message||this.config.vars.say_text),this.habla_offline_submit_input.value=this.config.vars.habla_offline_submit_value,this.set_events(this.habla_wcsend_input,"habla_wcsend_input"),this.set_events(this.habla_offline_email_input,"habla_offline_email_input"),this.set_events(this.habla_offline_phone_input,"habla_offline_phone_input"),this.set_events(this.habla_offline_body_input,"habla_offline_body_input"),this.set_events(this.habla_offline_submit_input,"habla_offline_submit_input"),this.habla_offline_message_sent_div.innerHTML=this.config.vars.habla_offline_sent_text,this.habla_closebutton_a&&(this.habla_closebutton_a.innerHTML=this.config.vars.habla_closebutton_text),this.habla_sizebutton_a&&(this.habla_sizebutton_a.innerHTML=this.config.vars.habla_sizebutton_text_compressed),this.habla_popout_a&&(this.habla_popout_a.innerHTML=this.config.vars.habla_popout_text),this.habla_end_popout_a&&(this.habla_end_popout_a.innerHTML=this.config.vars.habla_end_popout_text),this.habla_submit_button&&(this.habla_submit_button.value=this.config.vars.send_text),this.habla_pre_chat_submit_input&&(this.habla_pre_chat_submit_input.value=this.config.vars.pre_chat_submit),this.habla_pre_chat_span.innerHTML=this.config.vars.pre_chat_message,this.setHeader(this.config.vars.check_for_status),1!=window.olark.__legacy_shim.has_messages_in_history&&this.setBody(this.config.vars.welcome_msg)},this.set_default_text_event=function(e,t,n){var i="placeholder"in e;if(i){this.setInputBox(e,""),e.placeholder=n,e.has_typed=!1,W.eventmgr.register(t+"_onblur",function(e){e.target.has_typed=""==e.target.value?!1:!0});var o=function(e){e.target.has_typed=!0};W.eventmgr.register(t+"_onfocus",o),W.eventmgr.register(t+"_onclick",o)}else this.setInputBox(e,n),e.default_text=n,e.has_typed=!1,W.eventmgr.register(t+"_onblur",function(e){e.window.theme.setInputBoxStyle(e.target,"normal"),""==e.target.value&&(e.target.value=e.target.default_text,e.target.has_typed=!1)},0),W.eventmgr.register(t+"_onclick",function(e){e.target.has_typed||(e.target.has_typed=!0,e.window.setInputBox(e.target,"","highlight")),e.window.theme.setInputBoxStyle(e.target,"highlight")},0),W.eventmgr.register(t+"_onfocus",function(e){e.target.has_typed||(e.target.has_typed=!0,e.window.setInputBox(e.target,"","highlight")),e.window.theme.setInputBoxStyle(e.target,"highlight")},0)},this.set_rollover_event=function(e,t,n,i){e&&(e.on_class=i,e.off_class=n,W.eventmgr.register(t+"_onmouseover",function(e){e.window.config.set_element_classes(e.target,e.target.on_class)},0),W.eventmgr.register(t+"_onmouseout",function(e){e.window.config.set_element_classes(e.target,e.target.off_class)},0),W.eventmgr.register(t+"_onclick",function(e){e.window.config.set_element_classes(e.target,e.target.off_class)},0))},this.register_handlers=function(){this.set_rollover_event(this.habla_popout_a,"habla_popout_a","habla_button_normal","habla_button_hover"),this.set_rollover_event(this.habla_end_popout_a,"habla_end_popout_a","habla_button_normal","habla_button_hover"),this.set_rollover_event(this.habla_sizebutton_a,"habla_sizebutton_a","habla_button_normal","habla_button_hover"),this.set_rollover_event(this.habla_closebutton_a,"habla_closebutton_a","habla_button_normal","habla_button_hover"),this.set_rollover_event(this.habla_oplink_a,"habla_oplink_a","habla_oplink_a","habla_oplink_hover"),W.eventmgr.register("habla_conversation_div_onclick",function(){habla_window.eventmgr.handle("window_click")},0),W.eventmgr.register("habla_chatform_form_onfocus",function(){habla_window.eventmgr.handle("window_focus")},0),W.eventmgr.register("habla_popout_a_onclick",function(e){e.window.popout()},0),W.eventmgr.register("habla_end_popout_a_onclick",function(e){e.window.end_popout(),setTimeout(function(){window.close()},2)},0),W.eventmgr.register("habla_wcsend_input_onclick",function(e){e.window.eventmgr.handle("window_focus")},0),W.eventmgr.register("habla_pre_chat_submit_input_onclick",function(e){var t=e.window.config,n=e.window.theme.habla_pre_chat_email_input,i=e.window.theme.habla_pre_chat_name_input,o=e.window.theme.habla_pre_chat_phone_input,a=n.value?W.util.strip_whitespace(n.value):void 0,r=i.value?W.util.strip_whitespace(i.value):void 0,s=o.value?W.util.strip_whitespace(o.value):void 0,_=i.has_typed?!0:!1,l=o.has_typed&&W.util.is_valid_phone(s)?!0:!1,c=n.has_typed&&W.util.is_valid_email(a)?!0:!1;if(!c&&_&&W.util.is_valid_email(r)){var u=r;r=a,a=u,c=!0,_=n.has_typed?!0:!1}(t.vars.require_name<=1||_)&&(t.vars.require_phone<=1||l)&&(t.vars.require_email<=1||c)?(e.window.theme.habla_pre_chat_error_span.innerHTML="",window.olark.__legacy_shim.send_prechat_info({name:r,email:W.util.is_valid_email(a)?a:null,phone:W.util.is_valid_phone(s)?s:null}),e.window.theme.pre_chat_sent=!0,e.window.setShowPreChat(!1)):e.window.theme.habla_pre_chat_error_span.innerHTML=e.window.config.vars.pre_chat_error_text},0),W.eventmgr.register("habla_offline_submit_input_onclick",function(e){var t=e.window.theme.habla_offline_body_input,n=e.window.theme.habla_offline_email_input,i=e.window.theme.habla_offline_phone_input,o=e.window.theme.habla_name_input,a=e.window.theme.config.vars.require_offline_phone;if(e.window.theme.message_sent)e.window.theme.setOfflineWindow(e.window.theme.config.vars.habla_offline_sent_text||" ");else{var r=W.util.strip_whitespace(n.value);if(t.has_typed&&n.has_typed&&W.util.is_valid_email(r)&&(1>=a||W.util.is_valid_phone(i.value))){e.window.theme.message_sent=!0;var s=d.hblPostURL+"?site_id="+olark._.identityManager.getSiteId()+"&"+W.util.urlencode({body:t.value,email:n.value,name:o.value,phone:i.value,location:document.location,referrer:document.referrer});e.window.theme.habla_offline_error_span.innerHTML=e.window.config.vars.sending_text,W.util.load_js_async(s),olark("api.visitor.updateEmailAddress",r),olark("api.visitor.updateFullName",o.value),olark("api.visitor.updatePhoneNumber",i.value),W.client.sendofflinemessage(t.value,{email:r,name:o.value,phone:i.value,location:document.location,referrer:document.referrer}),e.window.eventmgr.handle("offlineMessageToOperator",{body:t.value,nickname:o.value}),e.window.theme.setOfflineWindow(e.window.theme.config.vars.habla_offline_sent_text||" ")}else e.window.theme.habla_offline_error_span.innerHTML=e.window.config.vars.email_body_error_text}},0),W.eventmgr.register("habla_wcsend_input_onmouseover",function(e){e.window.eventmgr.handle("window_focus")},0),W.eventmgr.register("habla_wcsend_input_onfocus",function(){W.client.pollingmanager.reset()},0),W.eventmgr.register("habla_window_changed",function(e){"expand"===e.type&&(W.client.pollingmanager.reset(),W.client.pollingmanager.startNextPollNow())})},this.remove=function(){this.appended&&W.util.remove_element(this.divid)},this.setShowPreChat=function(e){window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.ignore_prechat_status||this.showOnlyThisDiv(e?this.habla_pre_chat_div:this.habla_conversation_div)},this.showOnlyThisDiv=function(e){var t=this.habla_conversation_div,n=this.habla_offline_message_div,i=this.habla_offline_message_sent_div,o=this.habla_pre_chat_div,a=this.habla_chatform_form,r=this.habla_wcsend_input;if(e==t){t.style.display="block",n.style.display="none",i.style.display="none",o.style.display="none";var s="notavailable"!=habla_window.get_operator_state();s&&(a.style.display="block",r.style.display="block",this.pre_chat_sent&&this.focus_on_the_input_box())}else e==n?(t.style.display="none",n.style.display="block",i.style.display="none",o.style.display="none",a.style.display="none",r.style.display="none"):e==i?(t.style.display="none",n.style.display="none",i.style.display="block",o.style.display="none",a.style.display="none",r.style.display="none"):e==o&&(t.style.display="none",n.style.display="none",i.style.display="none",o.style.display="block",a.style.display="none",r.style.display="none");olark._.needsFirstTimeOperatorLogin?(this.habla_name_input.style.display="none",this.habla_offline_email_input.style.display="none",this.habla_offline_phone_input.style.display="none",this.habla_offline_body_input.style.display="none",this.habla_offline_submit_input.style.display="none"):(this.habla_name_input.style.display="block",this.habla_offline_email_input.style.display="block",this.habla_offline_phone_input.style.display="block",this.habla_offline_body_input.style.display="block",this.habla_offline_submit_input.style.display="block")
},this.setOfflineWindow=function(e){if(!(window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.ignore_prechat_status)){var t=this.config.vars.show_pre_chat&&1!=this.config.vars.disable_offline_messaging_fallback&&"notavailable"==habla_window.get_operator_state();e||t?(this.habla_offline_message_span.innerHTML=e||this.config.vars.offline_message,this.message_sent?(this.showOnlyThisDiv(this.habla_offline_message_sent_div),this.offline_window=!1):(this.offline_window=!0,this.showOnlyThisDiv(this.habla_offline_message_div))):(this.offline_window=!1,this.showOnlyThisDiv(this.habla_conversation_div))}},this.scroll_conversation_history_to_most_recent=function(){var e=this;setTimeout(function(){e.habla_conversation_div.scrollTop=e.habla_conversation_div.scrollHeight},10)},this.setBody=function(e){W.client.buffer.length&&W.client.is_conversation()||(this.habla_conversation_div.innerHTML="",this.config.render_class(this.habla_conversation_div,"habla_conversation_message_off","habla_conversation_message_on"),""!=e&&(e=W.util.as_dom(e),this.config.render_class(this.habla_conversation_div,"habla_conversation_message_on","habla_conversation_message_off"),this.habla_conversation_div.appendChild(e),e.id="hbl_body_message"),this.scroll_conversation_history_to_most_recent())},this.disableMessageInput=function(e){this.habla_wcsend_input.disabled=!0,this.habla_wcsend_input.value=e||""},this.getBody=function(){return this.habla_conversation_div.innerHTML};var e={},t=null,n=function(e){var t=document.createElement("div");t.appendChild(document.createTextNode(e));var n=t.innerHTML;return n};this.appendNiceMessage=function(i,o,a,r){if(void 0!=o&&void 0!=i){if(o&&(o=n(o)),r||(o=this.display_pipeline.run(o)),o){o=W.util.getCommonTextFormatter().formatAsHtml(o);var s=W.client.op_nickname_map[i],_=null;W.config.vars.operators&&s&&W.config.vars.operators[s.toString()]&&(_=W.config.vars.operators[s.toString()].avatar_url),"https:"===document.location.protocol&&"string"==typeof _&&(_=_.replace("http://","https://"));var l=document.createElement("p");if(_&&!e[i]){e[i]=!0;var c=document.createElement("img");c.className="olrk_avatar",c.src=_,l.appendChild(c)}this.config.set_element_classes(l,"habla_conversation_p_item"),null!=t&&t!=i&&(l.className=l.className+" olrk_new_sender"),t=i;var u=document.createElement("span"),d=document.createElement("span");if(i===this.config.vars.myname){this.config.set_element_classes(u,"habla_conversation_person1"),this.config.set_element_classes(d,"habla_conversation_text_span");var h=this.config.vars.local_user_display_name;"&rarr;"===h||"&larr;"===h?u.innerHTML=h:W.util.set_inner_text(u,h)}else if(/^INTERNAL_NOTIFICATION/.test(i)){this.config.set_element_classes(u,"habla_conversation_notification_nickname"),this.config.set_element_classes(d,"habla_conversation_notification_text_span"),W.util.set_inner_text(u,"");var p=i.split("-"),f=p.slice(2).join("-");p=p.slice(0,2),p.push(f),3===p.length&&setTimeout(function(){olark.__core.trigger_event({namespace:"chat",type:"interfaceElementReady",extensionName:p[1],key:p[2],dom:d})},0)}else{this.config.set_element_classes(u,"habla_conversation_person2"),this.config.set_element_classes(d,"habla_conversation_text_span");var g=this.config.vars.local_name_override?this.config.vars.local_name_override:i;g&&!/^\s*$/.test(g)?W.util.set_inner_text(u,g+": "):W.util.set_inner_text(u,g)}d.innerHTML=o,l.appendChild(u),l.appendChild(d),this.appendMessage(l,a)}window.habla_window.theme.scroll_conversation_history_to_most_recent()}},this.appendMessage=function(e,t){-1==this.last_msg&&t&&this.setBody(""),e=W.util.as_dom(e),this.last_msg+=1,e.setAttribute("id","habla_msg_"+this.last_msg),this.habla_conversation_div.appendChild(e),this.scroll_conversation_history_to_most_recent()},this.setHeader=function(e){this.habla_oplink_a.innerHTML=e},this.getHeader=function(){return this.habla_oplink_a.innerHTML},this.hide=function(){this.visible=!1,this.habla_conversation_div&&(this.habla_conversation_div.style.overflow="hidden"),W.util.hide_div(this.habla_window_div),W.util.hide_div(this.habla_panel_div),W.util.hide_div(this.habla_both_div),W.util.hide_div(this.habla_closed_div),W.util.hide_div(this.habla_expanded_div),W.util.hide_div(this.habla_compressed_div)},this.focus_on_the_input_box=function(){var e=this,t=document.activeElement&&document.activeElement.tagName?document.activeElement.tagName:null;t&&/^(input|textarea|select|option|button|optgroup|form)$/i.test(t)||e.config.vars.disable_input_focusing||window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.disable_input_focusing||e.config.vars.is_inline||e.config.vars.disableFocus||!e.habla_wcsend_input||"none"==e.habla_chatform_form.style.display||setTimeout(function(){if("none"!=e.habla_chatform_form.style.display)try{e.habla_wcsend_input.focus()}catch(t){}},20)},this.expand=function(){this.__set_css_window_state("expanded"),this.habla_sizebutton_a&&this.config.vars.habla_sizebutton_text_expanded&&(this.habla_sizebutton_a.innerHTML=this.config.vars.habla_sizebutton_text_expanded),this.show(),this.focus_on_the_input_box()},this.compress=function(){this.__set_css_window_state("compressed"),this.habla_sizebutton_a&&this.config.vars.habla_sizebutton_text_compressed&&(this.habla_sizebutton_a.innerHTML=this.config.vars.habla_sizebutton_text_compressed),this.show()},this.show=function(){this.ready&&(this.visible=!0,this.config.vars.disableJSStyles&&W.util.show_div(this.habla_window_div),"closed"==this.state?(W.util.hide_div(this.habla_expanded_div),W.util.hide_div(this.habla_panel_div),W.util.hide_div(this.habla_compressed_div),this.habla_conversation_div.style.overflow="hidden",W.util.show_div(this.habla_closed_div)):"expanded"==this.state?(W.util.hide_div(this.habla_compressed_div),W.util.hide_div(this.habla_closed_div),W.util.show_div(this.habla_panel_div),W.util.show_div(this.habla_expanded_div),W.util.show_div(this.habla_both_div),this.habla_conversation_div.style.overflow="auto",this.scroll_conversation_history_to_most_recent(),this.habla_sizebutton_a&&(this.habla_sizebutton_a.innerHTML=this.config.vars.habla_sizebutton_text_expanded),this.focus_on_the_input_box(),this.normal()):"compressed"==this.state&&(W.util.hide_div(this.habla_expanded_div),W.util.hide_div(this.habla_closed_div),W.util.show_div(this.habla_panel_div),W.util.show_div(this.habla_both_div),W.util.show_div(this.habla_compressed_div),this.habla_conversation_div.style.overflow="hidden",this.config.set_element_classes(this.habla_topbar_div,"habla_topbar_div_compressed"),this.habla_sizebutton_div&&(this.habla_sizebutton_div.innerHTML=this.config.vars.habla_sizebutton_text_compressed)))},this.close=function(){this.__set_css_window_state("closed"),this.show()},this.__set_css_window_state=function(e){this.state;this.state=e,this.window_state_div.className=(this.config.vars.show_end_popout?"olrk-state-popout":"")+"olrk-state-"+e},this.__get_browser_class=function(){return"habla-browser-"+U.getBrowserName().toLowerCase()},this.__get_mobile_class=function(){return navigator.userAgent.match(/Android/i)&&navigator.userAgent.match(/Mobile/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)?"habla-mobile":navigator.userAgent.match(/iPad/)?"habla-ipad":"habla-desktop"},this.setWidth=function(e){if(!this.config.vars.disable_width){var t=e;this.habla_panel_div.style.width=e+"px",t=U.isCompatMode()||U.getBrowser().msie&&U.isCompatMode()?e-this.config.vars.input_width_offset_compat+"px":U.getBrowser().msie?e-this.config.vars.input_width_offset_ie+"px":e-this.config.vars.input_width_offset_normal+"px",this.habla_wcsend_input.style.width=t,this.habla_name_input.style.width=t,this.habla_offline_body_input.style.width=t,this.habla_offline_email_input.style.width=t,this.habla_offline_phone_input.style.width=t,this.habla_pre_chat_name_input.style.width=t,this.habla_pre_chat_email_input.style.width=t,this.habla_pre_chat_phone_input.style.width=t}},this.setInputHeight=function(e){W.config.vars.disable_height||(e=e>18?e:18,U.isCompatMode()&&(e=e>24?e:24),"undefined"==typeof this.originalHeight&&(this.originalHeight=e,this.habla_wcsend_input.style.lineHeight=e+"px"),this.habla_wcsend_input.style.height=e+"px")},this.setFormInputHeight=function(e){W.config.vars.disable_height||(e=e>18?e:18,U.isCompatMode()&&(e=e>24?e:24),e+="px",this.habla_name_input.style.height=e,this.habla_offline_email_input.style.height=e,this.habla_offline_phone_input.style.height=e,this.habla_pre_chat_name_input.style.height=e,this.habla_pre_chat_name_input.style.lineHeight=e,this.habla_pre_chat_email_input.style.height=e,this.habla_pre_chat_email_input.style.lineHeight=e,this.habla_pre_chat_phone_input.style.height=e,this.habla_pre_chat_phone_input.style.lineHeight=e)},this.render_palette=function(){var e=this.config.palette;this.config.vars.limited_palette&&(e=this.config.vars.limited_palette);for(var t in e)if(e.hasOwnProperty(t)&&"string"==typeof this.config.palette[t]){var n=W.util.getElementsByClass(this.habla_window_div,"hbl_pal_"+t);for(var i in n)n.hasOwnProperty(i)&&n[i]&&n[i].style&&(t.match("_fg")?n[i].style.color=this.config.palette[t]:t.match("_bg")?n[i].style.backgroundColor=this.config.palette[t]:t.match("_border")&&(n[i].style.borderColor=this.config.palette[t]))}},this.getX=function(){return this.habla_window_div.style.left.match(/\d\d*/)},this.getY=function(){return this.habla_window_div.style.top.match(/\d\d*/)},this.setXY=function(e,t){this.habla_window_div.style.top=t,this.habla_window_div.style.left=e},this.setHeight=function(e){function t(e,t){e&&(e.style.height=t+"px")}W.config.vars.disable_height||(e=parseInt(e),t(this.habla_conversation_div,e),t(this.habla_pre_chat_div,e),t(this.habla_offline_body_input,e-85>0?e-85:0))},this.setMargins=function(e,t,n,i){this.config.vars.disable_javascript_position||(this.habla_window_div.style.marginTop=t+"px",this.habla_window_div.style.marginLeft=e+"px",this.habla_window_div.style.marginRight=n+"px",this.habla_window_div.style.marginBottom=i+"px")},this.setInline=function(e){if(e){var t=this.habla_window_div.style.display;this.habla_window_div.setAttribute("style",""),this.config.style_classes_map.habla_window_div=["habla_window_div_position_inline","habla_window_div_base","hbl_pal_main_width"],this.habla_window_div.style.display=t,this.config.render_element_classes(this,"habla_window_div")}else this.setPosition(this.config.vars.corner_position)},this.__getAdjustedPosition=function(e){return e=e.toUpperCase(),this.config.vars.theme_requires_position&&(this.config.vars.theme_requires_position.match(/B/)?e=e.replace("T","B")+"B":this.config.vars.theme_requires_position.match(/T/)&&(e=e.replace("B","T")),this.config.vars.theme_requires_position.match(/R/)?e=e.replace("L","R")+"R":this.config.vars.theme_requires_position.match(/L/)&&(e=e.replace("R","L"))),e},this.setPosition=function(e){var t=this.habla_window_div.style.display;this.config.style_classes_map.habla_window_div=["habla_window_div_base","hbl_pal_main_width"],e=this.__getAdjustedPosition(e),this.habla_window_div.setAttribute("style",""),e.match(/B/)?(this.config.vars.disable_javascript_position||(this.habla_window_div.style.marginBottom=this.config.vars.bottom_margin+"px",this.habla_window_div.style.bottom="0px"),this.config.style_classes_map.habla_window_div.push("olrk-fixed-bottom")):(this.config.vars.disable_javascript_position||(this.habla_window_div.style.marginTop=this.config.vars.top_margin+"px",this.habla_window_div.style.top="0px"),this.config.style_classes_map.habla_window_div.push("olrk-fixed-top")),e.match(/R/)?(this.config.vars.disable_javascript_position||(this.habla_window_div.style.marginRight=this.config.vars.right_margin+"px",this.habla_window_div.style.right="0px"),this.config.style_classes_map.habla_window_div.push("olrk-fixed-right")):(this.config.vars.disable_javascript_position||(this.habla_window_div.style.marginLeft=this.config.vars.left_margin+"px",this.habla_window_div.style.left="0px"),this.config.style_classes_map.habla_window_div.push("olrk-fixed-left")),this.habla_window_div.style.display=t,this.config.vars.disable_javascript_position||(this.habla_window_div.style.position=U.shouldUsePositionAbsolute()?"absolute":"fixed"),this.config.render_element_classes(this,"habla_window_div"),this.position=e},this.highlight=function(){this.highlighted||(this.config.set_element_classes(this.habla_closebutton_a,"habla_button_highlighted"),this.config.set_element_classes(this.habla_sizebutton_a,"habla_button_highlighted"),this.config.set_element_classes(this.habla_topbar_div,"habla_topbar_div_highlighted"),this.config.set_element_classes(this.habla_wcsend_input,"habla_wcsend_input_highlighted"),this.highlighted=!0)},this.normal=function(){this.highlighted&&(this.config.set_element_classes(this.habla_closebutton_a,"habla_button_normal"),this.config.set_element_classes(this.habla_sizebutton_a,"habla_button_normal"),this.config.set_element_classes(this.habla_topbar_div,"habla_button_normal"),this.config.set_element_classes(this.habla_topbar_div,"habla_topbar_div"),this.config.set_element_classes(this.habla_wcsend_input,"habla_wcsend_input"),this.highlighted=!1)},this.getMessageInputField=function(){return this.habla_wcsend_input},this.getMessageInputFieldValue=function(){return this.habla_wcsend_input.value},this.setMessageInputFieldValue=function(e){this.habla_wcsend_input.value=e};var i=W.util.getCommonTextFormatter(),o=i.formatAsHtml;this.display_pipeline=new v(this),this.display_pipeline.add(o,999),this.display_pipeline.add(window.olark.__legacy_shim.pipeline_disabler,1001)},W.eventmgr.register("habla_preload_done",function(){W.config.vars.theme_path||W.config.vars.theme_obj||(W.config.vars.theme_obj=new W.themes.default_theme)},0),(!window.olark||window.olark&&!window.olark.__legacy_shim)&&(window.olark&&window.olark.__internal&&window.olark.__internal.skip_wc_init_post||(F?W.eventmgr.register("habla_called_wc_init",function(){_()}):_())),window.olark&&window.olark.__internal&&window.olark.__internal.declare("__internal.legacy",function(){}),window.olark&&window.olark.__legacy_shim&&(window.olark.__legacy_shim.legacy_post_stub_is_loaded=!0),window.olark.__core.framestorewithjson=e("../../chatbox/framestorewithjson"),window.olark.__core.data=f,window.olark.__core.rules={RulesApi:T},window.olark.__core.box={BoxApi:E},window.olark.__core.visitor={VisitorApi:P},window.olark.__core.chat={ChatApi:O},window.olark.__core.browser={BrowserApi:A},window.olark.__core.api={ApiInstance:M},h.finishStartup({window:window,olark:window.olark,legacyGlobals:{hbl:W,wc_config:a,wc_init:r,wc_init_post:_,habla_window:habla_window}})}).call(this,e("qvMYcC"))},{"../../chatbox/ApiInstance":7,"../../chatbox/BoxApi":8,"../../chatbox/BrowserApi":9,"../../chatbox/BrowserInfo":10,"../../chatbox/ChatApi":11,"../../chatbox/Conversation":12,"../../chatbox/Extension":14,"../../chatbox/ExtensionManager":15,"../../chatbox/ExtensionSpec":16,"../../chatbox/LegacyConfig":17,"../../chatbox/LegacyEventManager":18,"../../chatbox/LegacyPipeline":19,"../../chatbox/LegacyPluginList":20,"../../chatbox/PollingManager":21,"../../chatbox/RulesApi":22,"../../chatbox/TextFormatter":23,"../../chatbox/UrlFormatter":24,"../../chatbox/VisitorApi":26,"../../chatbox/boot":27,"../../chatbox/corehelpers":28,"../../chatbox/data":29,"../../chatbox/framestorewithjson":30,"../../chatbox/legacyglobals":32,"../../chatbox/logger":33,"../../chatbox/xdhttp":48,"../../targeting/TargetingManager":50,qvMYcC:6,underscore:5}],50:[function(e,t,n){"use strict";var i=e("underscore"),o=e("json3"),a=e("./helpers/rulemaker");n.activate=function(e,t){var n=o.stringify(t.system.rules),r=o.parse(n,a.reviveJSON);i.each(r,function(n){n.activate(e,t)})}},{"./helpers/rulemaker":53,json3:3,underscore:5}],51:[function(e,t,n){"use strict";var i=e("underscore"),o=function(e,t,n){var i=e.prototype=new t;i.constructor=e,i.$$super=t.prototype,n&&n(i)},a=function(){};o(a,Object,function(e){e.evaluate=function(){throw new Error("evaluate() must be defined on every clause")}});var r=function(e){this.$$clauses=e};r.reviveJSON=function(e,t){return t&&"AndClause"===t.kind?new r(t.clauses):t},o(r,a,function(e){e.evaluate=function(e){return i.reduceRight(this.$$clauses,function(t,n){return t instanceof a&&(t=t.evaluate(e)),n instanceof a&&(n=n.evaluate(e)),t&&n?!0:!1},!0)},e.toJSON=function(){return{kind:"AndClause",clauses:this.$$clauses}}});var s=function(e){this.$$clauses=e};s.reviveJSON=function(e,t){return t&&"OrClause"===t.kind?new s(t.clauses):t},o(s,a,function(e){e.evaluate=function(e){return i.reduceRight(this.$$clauses,function(t,n){return t instanceof a&&(t=t.evaluate(e)),n instanceof a&&(n=n.evaluate(e)),t||n?!0:!1},!1)},e.toJSON=function(){return{kind:"OrClause",clauses:this.$$clauses}}});var _=function(e,t){this.$$left=e,this.$$right=t};o(_,a,function(e){e.evaluate=function(e){var t=this.$$left,n=this.$$right;return t instanceof a&&(t=t.evaluate(e)),n instanceof a&&(n=n.evaluate(e)),this.$$compare(t,n)}});var l=function(){_.apply(this,arguments)};l.reviveJSON=function(e,t){return t&&"EqualsClause"===t.kind?new l(t.left,t.right):t},o(l,_,function(e){e.$$compare=function(e,t){return e===t},e.toJSON=function(){return{kind:"EqualsClause",left:this.$$left,right:this.$$right}}});var c=function(){_.apply(this,arguments)};c.reviveJSON=function(e,t){return t&&"NotEqualsClause"===t.kind?new c(t.left,t.right):t},o(c,_,function(e){e.$$compare=function(e,t){return e!==t},e.toJSON=function(){return{kind:"NotEqualsClause",left:this.$$left,right:this.$$right}}});var u=function(){_.apply(this,arguments)};u.reviveJSON=function(e,t){return t&&"LessThanClause"===t.kind?new u(t.left,t.right):t},o(u,_,function(e){e.$$compare=function(e,t){return t>e},e.toJSON=function(){return{kind:"LessThanClause",left:this.$$left,right:this.$$right}}});var d=function(){_.apply(this,arguments)};d.reviveJSON=function(e,t){return t&&"GreaterThanClause"===t.kind?new d(t.left,t.right):t},o(d,_,function(e){e.$$compare=function(e,t){return e>t},e.toJSON=function(){return{kind:"GreaterThanClause",left:this.$$left,right:this.$$right}}});var h=function(){_.apply(this,arguments)};h.reviveJSON=function(e,t){return t&&"RegExClause"===t.kind?new h(t.left,t.right):t},o(h,_,function(e){e.$$compare=function(e,t){return new RegExp(t).test(e)},e.toJSON=function(){return{kind:"RegExClause",left:this.$$left,right:this.$$right}}});var p=function(){_.apply(this,arguments)};p.reviveJSON=function(e,t){return t&&"NegativeRegExClause"===t.kind?new p(t.left,t.right):t},o(p,_,function(e){e.$$compare=function(e,t){return new RegExp(t).test(e)?!1:!0},e.toJSON=function(){return{kind:"NegativeRegExClause",left:this.$$left,right:this.$$right}}});var f=function(){_.apply(this,arguments)};f.reviveJSON=function(e,t){return t&&"WildcardClause"===t.kind?new f(t.left,t.right):t},o(f,_,function(e){e.$$compare=function(e,t){var n=t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),i="^"+n.replace(/\\\*/g,".*")+"$";return new RegExp(i).test(e)},e.toJSON=function(){return{kind:"WildcardClause",left:this.$$left,right:this.$$right}}});var g=function(e,t){var n="*"+t+"*";f.call(this,e,n)};g.reviveJSON=function(e,t){return t&&"ContainsClause"===t.kind?new g(t.left,t.right):t},o(g,f,function(e){e.toJSON=function(){return{kind:"ContainsClause",left:this.$$left,right:this.$$right}}});var m=function(){g.apply(this,arguments)};m.reviveJSON=function(e,t){return t&&"DoesNotContainClause"===t.kind?new m(t.left,t.right):t},o(m,g,function(e){e.$$compare=function(){return!g.prototype.$$compare.apply(this,arguments)},e.toJSON=function(){return{kind:"DoesNotContainClause",left:this.$$left,right:this.$$right}}});var v=function(e){this.$$varname=e};v.reviveJSON=function(e,t){return t&&"VariableClause"===t.kind?new v(t.varname):t},o(v,a,function(e){e.evaluate=function(e){e=e||{};for(var t=this.$$varname.split(".");t.length&&e;){var n=t.shift();e=n in e?e[n]:void 0}return e},e.toJSON=function(){return{kind:"VariableClause",varname:this.$$varname}}});var b={AndClause:r,OrClause:s,EqualsClause:l,VariableClause:v,LessThanClause:u,GreaterThanClause:d,RegExClause:h,WildcardClause:f,ContainsClause:g,DoesNotContainClause:m,NegativeRegExClause:p,NotEqualsClause:c};i.each(i.keys(b),function(e){n[e]=b[e]});var y=function(e,t){return i.each(i.values(b),function(n){t=n.reviveJSON(e,t)}),t};n.reviveJSON=y},{underscore:5}],52:[function(e,t,n){"use strict";var i=e("underscore"),o=function(e,t){if(i.isFunction(e))return t(e);if(i.isArray(e))return i.map(e,function(e){return o(e,t)});var n=e;if(e&&"object"==typeof e)try{var a=function(){};a.prototype=e,n=new a}catch(r){throw new Error("mapTree expects constructors to be callable without arguments")}var s;try{s=i.keys(e)}catch(r){s=[]}return i.each(s,function(i){n[i]=o(e[i],t)}),t(n)};n.mapTree=o},{underscore:5}],53:[function(e,t,n){"use strict";var i=e("underscore"),o=e("./boolmaker"),a=e("./stringmaker"),r=e("./overscore").mapTree,s=function(e,t,n,i,o,a,r,s){this.$$id=e,this.$$description=t,this.$$clause=n,this.$$actions=i,this.$$perPage=o,this.$$perVisit=a,this.$$perVisitor=r,this.$$enabled=s?!0:!1};s.reviveJSON=function(e,t){return t&&"Rule"===t.kind?new s(t.id,t.description,t.clause,t.actions,t.perPage,t.perVisit,t.perVisitor,t.enabled):t},s.prototype={activate:function(e){if(this.$$enabled!==!1){var t=this.$$clause,n=this.$$actions;e("api.rules.defineRule",{id:this.$$id,description:this.$$description,condition:function(n){e("api.chat.__SPI_getLastOperatorPresence",function(i){"available"===i&&e("api.visitor.getDetails",function(e){t.evaluate({visitor:e})&&n()})})},action:function(){e("api.visitor.getDetails",function(t){i.each(n,function(n){n.execute(e,{visitor:t})})})},perPage:this.$$perPage,perVisit:this.$$perVisit,perVisitor:this.$$perVisitor})}},toJSON:function(){return{kind:"Rule",id:this.$$id,description:this.$$description,clause:this.$$clause,actions:this.$$actions,perPage:this.$$perPage,perVisit:this.$$perVisit,perVisitor:this.$$perVisitor,enabled:this.$$enabled}}};var _=function(e,t){this.$$methodName=e,this.$$methodOptions=t,this.$$templatedMethodOptions=r(this.$$methodOptions,function(e){return i.isString(e)?a.compile(e):e})};_.reviveJSON=function(e,t){return t&&"Action"===t.kind?new _(t.method,t.options):t},_.prototype={execute:function(e,t){var n={};this.$$templatedMethodOptions&&(n=r(this.$$templatedMethodOptions,function(e){return e.render?e.render(t):e}));var i=this.$$methodName;"api.chat.sendMessageToVisitor"===i&&(i="api.box.__SPI_setPrechatWelcomeMessage",n=n.body),"api.box.hide"===i&&(i="api.box.__SPI_hideForDuration",n={forVisit:!0});var o=[i,n];e.apply(e,o)},toJSON:function(){return{kind:"Action",method:this.$$methodName,options:this.$$methodOptions}}};var l=function(e,t){return s.reviveJSON(e,_.reviveJSON(e,o.reviveJSON(e,t)))};n.reviveJSON=l,n.Rule=s,n.Action=_},{"./boolmaker":51,"./overscore":52,"./stringmaker":54,underscore:5}],54:[function(e,t,n){"use strict";var i=e("underscore"),o=function(e){var t=function(t){return e.replace(/\{\{([a-zA-Z0-9\._]+)\}\}/g,function(e,n){var o=t;return i.forEach(n.split("."),function(e){try{o=e in o?o[e]:""}catch(t){}}),o})};return{render:t}};n.compile=o},{underscore:5}]},{},[49]);}).call(this);