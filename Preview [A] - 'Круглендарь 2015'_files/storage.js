;(function(require,define,global,self,_,Backbone,ActiveXObject,require){ActiveXObject=window.ActiveXObject;;!function e(n,t,r){function o(a,c){if(!t[a]){if(!n[a]){var u="function"==typeof require&&require;if(!c&&u)return u(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var f=t[a]={exports:{}};n[a][0].call(f.exports,function(e){var t=n[a][1][e];return o(t?t:e)},f,f.exports,e,n,t,r)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,n,t){(function(e){(function(){function r(e,n){function t(e){if(t[e]!==h)return t[e];var r;if("bug-string-char-index"==e)r="a"!="a"[0];else if("json"==e)r=t("json-stringify")&&t("json-parse");else{var i,c='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var u=n.stringify,s="function"==typeof u&&w;if(s){(i=function(){return 1}).toJSON=i;try{s="0"===u(0)&&"0"===u(new o)&&'""'==u(new a)&&u(y)===h&&u(h)===h&&u()===h&&"1"===u(i)&&"[1]"==u([i])&&"[null]"==u([h])&&"null"==u(null)&&"[null,null,null]"==u([h,y,null])&&u({a:[i,!0,!1,null,"\x00\b\n\f\r	"]})==c&&"1"===u(null,i)&&"[\n 1,\n 2\n]"==u([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==u(new f(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==u(new f(864e13))&&'"-000001-01-01T00:00:00.000Z"'==u(new f(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==u(new f(-1))}catch(l){s=!1}}r=s}if("json-parse"==e){var d=n.parse;if("function"==typeof d)try{if(0===d("0")&&!d(!1)){i=d(c);var p=5==i.a.length&&1===i.a[0];if(p){try{p=!d('"	"')}catch(l){}if(p)try{p=1!==d("01")}catch(l){}if(p)try{p=1!==d("1.")}catch(l){}}}}catch(l){p=!1}r=p}}return t[e]=!!r}e||(e=c.Object()),n||(n=c.Object());var o=e.Number||c.Number,a=e.String||c.String,u=e.Object||c.Object,f=e.Date||c.Date,s=e.SyntaxError||c.SyntaxError,l=e.TypeError||c.TypeError,d=e.Math||c.Math,p=e.JSON||c.JSON;"object"==typeof p&&p&&(n.stringify=p.stringify,n.parse=p.parse);var m,g,h,v=u.prototype,y=v.toString,w=new f(-0xc782b5b800cec);try{w=-109252==w.getUTCFullYear()&&0===w.getUTCMonth()&&1===w.getUTCDate()&&10==w.getUTCHours()&&37==w.getUTCMinutes()&&6==w.getUTCSeconds()&&708==w.getUTCMilliseconds()}catch(b){}if(!t("json")){var E="[object Function]",C="[object Date]",T="[object Number]",S="[object String]",A="[object Array]",O="[object Boolean]",x=t("bug-string-char-index");if(!w)var j=d.floor,_=[0,31,59,90,120,151,181,212,243,273,304,334],M=function(e,n){return _[n]+365*(e-1970)+j((e-1969+(n=+(n>1)))/4)-j((e-1901+n)/100)+j((e-1601+n)/400)};if((m=v.hasOwnProperty)||(m=function(e){var n,t={};return(t.__proto__=null,t.__proto__={toString:1},t).toString!=y?m=function(e){var n=this.__proto__,t=e in(this.__proto__=null,this);return this.__proto__=n,t}:(n=t.constructor,m=function(e){var t=(this.constructor||n).prototype;return e in this&&!(e in t&&this[e]===t[e])}),t=null,m.call(this,e)}),g=function(e,n){var t,r,o,a=0;(t=function(){this.valueOf=0}).prototype.valueOf=0,r=new t;for(o in r)m.call(r,o)&&a++;return t=r=null,a?g=2==a?function(e,n){var t,r={},o=y.call(e)==E;for(t in e)o&&"prototype"==t||m.call(r,t)||!(r[t]=1)||!m.call(e,t)||n(t)}:function(e,n){var t,r,o=y.call(e)==E;for(t in e)o&&"prototype"==t||!m.call(e,t)||(r="constructor"===t)||n(t);(r||m.call(e,t="constructor"))&&n(t)}:(r=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],g=function(e,n){var t,o,a=y.call(e)==E,c=!a&&"function"!=typeof e.constructor&&i[typeof e.hasOwnProperty]&&e.hasOwnProperty||m;for(t in e)a&&"prototype"==t||!c.call(e,t)||n(t);for(o=r.length;t=r[--o];c.call(e,t)&&n(t));}),g(e,n)},!t("json-stringify")){var L={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},k="000000",U=function(e,n){return(k+(n||0)).slice(-e)},D="\\u00",N=function(e){for(var n='"',t=0,r=e.length,o=!x||r>10,i=o&&(x?e.split(""):e);r>t;t++){var a=e.charCodeAt(t);switch(a){case 8:case 9:case 10:case 12:case 13:case 34:case 92:n+=L[a];break;default:if(32>a){n+=D+U(2,a.toString(16));break}n+=o?i[t]:e.charAt(t)}}return n+'"'},P=function(e,n,t,r,o,i,a){var c,u,f,s,d,p,v,w,b,E,x,_,L,k,D,I;try{c=n[e]}catch(F){}if("object"==typeof c&&c)if(u=y.call(c),u!=C||m.call(c,"toJSON"))"function"==typeof c.toJSON&&(u!=T&&u!=S&&u!=A||m.call(c,"toJSON"))&&(c=c.toJSON(e));else if(c>-1/0&&1/0>c){if(M){for(d=j(c/864e5),f=j(d/365.2425)+1970-1;M(f+1,0)<=d;f++);for(s=j((d-M(f,0))/30.42);M(f,s+1)<=d;s++);d=1+d-M(f,s),p=(c%864e5+864e5)%864e5,v=j(p/36e5)%24,w=j(p/6e4)%60,b=j(p/1e3)%60,E=p%1e3}else f=c.getUTCFullYear(),s=c.getUTCMonth(),d=c.getUTCDate(),v=c.getUTCHours(),w=c.getUTCMinutes(),b=c.getUTCSeconds(),E=c.getUTCMilliseconds();c=(0>=f||f>=1e4?(0>f?"-":"+")+U(6,0>f?-f:f):U(4,f))+"-"+U(2,s+1)+"-"+U(2,d)+"T"+U(2,v)+":"+U(2,w)+":"+U(2,b)+"."+U(3,E)+"Z"}else c=null;if(t&&(c=t.call(n,e,c)),null===c)return"null";if(u=y.call(c),u==O)return""+c;if(u==T)return c>-1/0&&1/0>c?""+c:"null";if(u==S)return N(""+c);if("object"==typeof c){for(k=a.length;k--;)if(a[k]===c)throw l();if(a.push(c),x=[],D=i,i+=o,u==A){for(L=0,k=c.length;k>L;L++)_=P(L,c,t,r,o,i,a),x.push(_===h?"null":_);I=x.length?o?"[\n"+i+x.join(",\n"+i)+"\n"+D+"]":"["+x.join(",")+"]":"[]"}else g(r||c,function(e){var n=P(e,c,t,r,o,i,a);n!==h&&x.push(N(e)+":"+(o?" ":"")+n)}),I=x.length?o?"{\n"+i+x.join(",\n"+i)+"\n"+D+"}":"{"+x.join(",")+"}":"{}";return a.pop(),I}};n.stringify=function(e,n,t){var r,o,a,c;if(i[typeof n]&&n)if((c=y.call(n))==E)o=n;else if(c==A){a={};for(var u,f=0,s=n.length;s>f;u=n[f++],c=y.call(u),(c==S||c==T)&&(a[u]=1));}if(t)if((c=y.call(t))==T){if((t-=t%1)>0)for(r="",t>10&&(t=10);r.length<t;r+=" ");}else c==S&&(r=t.length<=10?t:t.slice(0,10));return P("",(u={},u[""]=e,u),o,a,r,"",[])}}if(!t("json-parse")){var I,F,z=a.fromCharCode,J={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},W=function(){throw I=F=null,s()},q=function(){for(var e,n,t,r,o,i=F,a=i.length;a>I;)switch(o=i.charCodeAt(I)){case 9:case 10:case 13:case 32:I++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=x?i.charAt(I):i[I],I++,e;case 34:for(e="@",I++;a>I;)if(o=i.charCodeAt(I),32>o)W();else if(92==o)switch(o=i.charCodeAt(++I)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=J[o],I++;break;case 117:for(n=++I,t=I+4;t>I;I++)o=i.charCodeAt(I),o>=48&&57>=o||o>=97&&102>=o||o>=65&&70>=o||W();e+=z("0x"+i.slice(n,I));break;default:W()}else{if(34==o)break;for(o=i.charCodeAt(I),n=I;o>=32&&92!=o&&34!=o;)o=i.charCodeAt(++I);e+=i.slice(n,I)}if(34==i.charCodeAt(I))return I++,e;W();default:if(n=I,45==o&&(r=!0,o=i.charCodeAt(++I)),o>=48&&57>=o){for(48==o&&(o=i.charCodeAt(I+1),o>=48&&57>=o)&&W(),r=!1;a>I&&(o=i.charCodeAt(I),o>=48&&57>=o);I++);if(46==i.charCodeAt(I)){for(t=++I;a>t&&(o=i.charCodeAt(t),o>=48&&57>=o);t++);t==I&&W(),I=t}if(o=i.charCodeAt(I),101==o||69==o){for(o=i.charCodeAt(++I),(43==o||45==o)&&I++,t=I;a>t&&(o=i.charCodeAt(t),o>=48&&57>=o);t++);t==I&&W(),I=t}return+i.slice(n,I)}if(r&&W(),"true"==i.slice(I,I+4))return I+=4,!0;if("false"==i.slice(I,I+5))return I+=5,!1;if("null"==i.slice(I,I+4))return I+=4,null;W()}return"$"},H=function(e){var n,t;if("$"==e&&W(),"string"==typeof e){if("@"==(x?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(n=[];e=q(),"]"!=e;t||(t=!0))t&&(","==e?(e=q(),"]"==e&&W()):W()),","==e&&W(),n.push(H(e));return n}if("{"==e){for(n={};e=q(),"}"!=e;t||(t=!0))t&&(","==e?(e=q(),"}"==e&&W()):W()),(","==e||"string"!=typeof e||"@"!=(x?e.charAt(0):e[0])||":"!=q())&&W(),n[e.slice(1)]=H(q());return n}W()}return e},R=function(e,n,t){var r=B(e,n,t);r===h?delete e[n]:e[n]=r},B=function(e,n,t){var r,o=e[n];if("object"==typeof o&&o)if(y.call(o)==A)for(r=o.length;r--;)R(o,r,t);else g(o,function(e){R(o,e,t)});return t.call(e,n,o)};n.parse=function(e,n){var t,r;return I=0,F=""+e,t=H(q()),"$"!=q()&&W(),I=F=null,n&&y.call(n)==E?B((r={},r[""]=t,r),"",n):t}}}return n.runInContext=r,n}var o="function"==typeof define&&define.amd,i={"function":!0,object:!0},a=i[typeof t]&&t&&!t.nodeType&&t,c=i[typeof window]&&window||this,u=a&&i[typeof n]&&n&&!n.nodeType&&"object"==typeof e&&e;if(!u||u.global!==u&&u.window!==u&&u.self!==u||(c=u),a&&!o)r(c,a);else{var f=c.JSON,s=c.JSON3,l=!1,d=r(c,c.JSON3={noConflict:function(){return l||(l=!0,c.JSON=f,c.JSON3=s,f=s=null),d}});c.JSON={parse:d.parse,stringify:d.stringify}}o&&define(function(){return d})}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,n){n.exports=function(n,t,r,o){return n=e("./json"),t=function(){function e(){try{return C in h&&h[C]}catch(e){return!1}}function n(){try{return T in h&&h[T]&&h[T][h.location.hostname]}catch(e){return!1}}function t(){function e(e){var n=e.key;n?o(n):i()}window.addEventListener?window.addEventListener("storage",e,!1):window.attachEvent("onstorage",e)}function r(){setInterval(i,w)}function o(e){var n=E[e],t=s(e);if(y[e]=y[e]||[],E[e]=t,n!=t)for(var r=0;r<y[e].length;r++)try{y[e][r]({newValue:t})}catch(o){window.console&&window.console.error&&window.console.error(o)}}function i(){for(var e in y)y.hasOwnProperty(e)&&o(e)}function a(e){return function(){var n=Array.prototype.slice.call(arguments||[],0);n.unshift(l),v.body.appendChild(l),l.addBehavior("#default#userData"),l.load(C);var t=e.apply(g,n);return v.body.removeChild(l),t}}function c(){var e=Array.prototype.slice.call(arguments||[],0),n=e.shift();try{return p[n].apply(p,e),m[n].apply(m,e)}catch(t){return p[n].apply(p,e)}}function u(){for(var e=document.cookie.split(";"),n=0;n<e.length;n++){var t=e[n].replace(/^\s*/,"").replace(/\s*$/,"");if(0==t.indexOf(A))return g.deserialize(unescape(t.slice(A.length)))}return{}}function f(e){document.cookie=A+escape(g.serialize(e))+S,document.cookie.length>b&&(window.console&&window.console.warn&&window.console.warn("cookie is too large, clearing storejs"),f({}))}var s,l,d,p,m,g={},h=window,v=h.document,y={},w=750,b=4e3,E={},C="localStorage",T="globalStorage";if(g.set=function(){},g.get=function(){},g.remove=function(){},g.clear=function(){},g.transact=function(e,n){var t=g.get(e);"undefined"==typeof t&&(t={}),n(t),g.set(e,t)},g.listen=function(e,n){E[e]=s(e),y[e]=y[e]||[],y[e].push(n)},g.serialize=function(e){return JSON.stringify(e)},g.deserialize=function(e){return"string"!=typeof e?void 0:JSON.parse(e)},e())l=h[C],g.set=function(e,n){l.setItem(e,g.serialize(n))},g.get=function(e){return g.deserialize(l.getItem(e))},g.remove=function(e){l.removeItem(e)},g.clear=function(){l.clear()},s=function(e){return l.getItem(e)},t();else if(n())l=h[T][h.location.hostname],g.set=function(e,n){l[e]=g.serialize(n)},g.get=function(e){return g.deserialize(l[e]&&l[e].value)},g.remove=function(e){delete l[e]},g.clear=function(){for(var e in l)delete l[e]},s=function(e){return l[e]},r();else if(v.documentElement.addBehavior)l=v.createElement("div"),d={},p={},m={},m.set=a(function(e,n,t){e.setAttribute(n,g.serialize(t)),e.save(C)}),m.get=a(function(e,n){return g.deserialize(e.getAttribute(n))}),m.remove=a(function(e,n){e.removeAttribute(n),e.save(C)}),m.clear=a(function(e){var n=e.XMLDocument.documentElement.attributes;e.load(C);for(var t,r=0;t=n[r];r++)e.removeAttribute(t.name);e.save(C)}),p.set=function(e,n){d[e]=n},p.get=function(e){return d[e]},p.remove=function(e){delete d[e]},p.clear=function(){d={}},g.set=function(e,n){return c("set",e,n)},g.get=function(e){return c("get",e)},g.remove=function(e){return c("remove",e)},g.clear=function(){return c("clear")},s=function(e){try{return a(function(e,n){return e.getAttribute(n)})(e)}catch(n){return d[e]}},r();else{var S="; path="+document.location.pathname,A="storejs=";g.set=function(e,n){{var t=u();t[e]}t[e]=n,f(t)},g.get=function(e){return u()[e]},g.remove=function(e){var n=u();try{delete n[e]}catch(t){n[e]=void 0}f(n)},g.clear=function(){f({})},s=function(e){return g.serialize(u()[e])}}return g}(),r=function(e,n){function t(){if(e.console&&e.console.error)try{e.console.error.apply(e.console,arguments)}catch(n){try{e.console.error(Array.prototype.slice.call(arguments||[]).join(" "))}catch(n){}}}function r(){if(e.console&&e.console.warn)try{e.console.warn.apply(e.console.warn,arguments)}catch(n){try{e.console.warn(Array.prototype.slice.call(arguments||[]).join(" "))}catch(n){}}}function o(e){return e.contentWindow?e.contentWindow:e.contentDocument.window}function i(){return Math.random().toString().replace("0.","TK")}function a(){var n=e.ActiveXObject;if(!n)return-1;try{var t,r=new n("ShockwaveFlash.ShockwaveFlash");return r?(t=r.GetVariable("$version"),parseInt(/([0-9]+)/.exec(t)[1])):-1}catch(o){return-1}}function c(e){return/^\s*(file\:|[a-zA-Z]\:).*/.test(e)}function u(e){var n;return e?""==e.length?null:c(e)?"file:":(n=e.split("//"),n.length>1?n[0]+"//"+n[1].split("/")[0]:n[0]):null}function f(t,r){var o,i,a=Math.floor(99999*Math.random()).toString(),c=n.createElement("span"),u="_olark_framesocket"+a,f="_olark_framesocket"+a,s=n.getElementsByTagName("body")[0],l=!1,d="try{window."+f+"()}catch(e){"+f+"()}";return s?i=function(){s.appendChild(c)}:(s=n.getElementsByTagName("script")[0],i=function(){s.parentNode.insertBefore(c,s)}),e[f]=function(){r&&!l&&(l=!0,r(o))},c.style.display="none",/(Firefox)/.test(navigator.userAgent)?(c.innerHTML='<iframe style="display: none !important" id="'+u+'" onload="'+d+'"></iframe>',i(),o=n.getElementById(u),o.src=t):(c.innerHTML='<iframe style="display: none !important" id="'+u+'" src="'+t+'" onload="'+d+'"></iframe>',i(),o=n.getElementById(u)),o}function s(e){setTimeout(e,0)}function l(e){return u("file:"==e?null:e)}function d(e,n){function t(){if(e()){var r=o.shift();i=!1,"undefined"!=typeof r&&n(r),o.length>0&&!i&&(i=!0,s(t))}}function r(e){o.push(e),t()}var o=[],i=!1,a=null;return a={queuedSend:r,attemptDequeue:t}}function p(){function t(){function n(n,t){e.postMessage?f.postMessage(n,t):f.document.postMessage(n,t)}function t(e){null==s||c(s)?n(e,"*"):n(e,u(s))}function r(){return"undefined"!=typeof f&&"undefined"!=typeof s?!0:!1}function o(e){f=e,l.attemptDequeue()}function i(e){s=e,l.attemptDequeue()}function a(e){l.queuedSend(e)}var f,s,l,p;return l=d(r,t),p={setPostMessageTargetWindow:o,setPostMessageTargetOrigin:i,send:a}}function a(t){function r(e){var r,a=u(e.origin||e.uri),f=null;"null"==e.origin&&(a="file:"),a&&!c(a)&&(e.uri&&0==e.uri.toString().indexOf(a)?f=e.uri.toString().slice(a.length):n.referrer&&0==n.referrer.toString().indexOf(a)&&(f=n.referrer.toString().slice(a.length))),r=l(a),("undefined"==typeof o||o==r)&&("undefined"==typeof i||i==e.source)&&t({data:e.data,origin:r})}var o,i,a={};return e.addEventListener?e.addEventListener("message",r,!1):e.attachEvent("onmessage",r),a.setExpectedOrigin=function(e){o=l(e)},a.setExpectedWindow=function(e){i=e},a}v.connect=function(e,n){function r(e){d.send(p+y+e)}var c,s=e.server||e,l=null,d=t(),p=i(),m=s.replace(/\#[^?]*/,"")+"#"+p;return n=n||function(){},d.setPostMessageTargetOrigin(s),f(m,function(e){var t=o(e);c=a(n),c.setExpectedOrigin(u(m)),c.setExpectedWindow(t),d.setPostMessageTargetWindow(t)}),r(w),l={send:r}},v.accept=function(n){function o(e){var t=e.data.split(y),o=t[0],a=t[1];o==f?a==w?l||(l=!0,i.setExpectedOrigin(e.origin),u.setPostMessageTargetOrigin(e.origin)):s(function(){n({data:a,origin:e.origin})}):r("[framesocket] received a message from an origin with an invalid identity")}var i,c=null,u=t(),f=(e.location.hash||"").slice(1),l=!1;return n=n||function(){},u.setPostMessageTargetWindow(e.parent),i=a(o),i.setExpectedWindow(e.parent),c={send:u.send}}}function m(){v.connect=function(n,t){function r(){return h}function o(e){p.frameElementContext.sendToChild(e,v)}function a(e){u.queuedSend(e)}function c(n,t){return n!=v?(e.console&&e.console.warn&&e.console.warn("[framesocket] invalid security token given to client in frameElement transport"),null):void t()}var u,p,m,g=n.server||n,h=!1,v=i(),y=g.replace(/\#[^?]*/,"")+"#"+v;return t=t||function(){},u=d(r,o),p=f(y),p.frameElementContext=function(){},p.frameElementContext.markChildAsReady=function(e){c(e,function(){s(function(){h=!0,u.attemptDequeue()})})},p.frameElementContext.sendToParent=function(e,n){c(n,function(){t({data:e,origin:l(g)})})},m={send:a}},v.accept=function(t){function r(){return!0}function o(n){e.frameElement.frameElementContext.sendToParent(n,f)}function i(e){c.queuedSend(e)}function a(n,t){return n!=f?(e.console&&e.console.warn&&e.console.warn("[framesocket] invalid security token given to server in frameElement transport"),null):void t()}var c,u,f=(e.location.hash||"").slice(1);return t=t||function(){},e.frameElement.frameElementContext(),e.frameElement.frameElementContext.sendToChild=function(e,r){a(r,function(){t({data:e,origin:l(n.referrer)})})},e.frameElement.frameElementContext.markChildAsReady(f),c=d(r,o),u={send:i}}}function g(){function t(){for(;f.length;)f.shift()(o())}function r(e){var t=n.getElementsByTagName("script")[0],r=n.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,t.parentNode.insertBefore(r,t)}function o(){var n=null;return e.minixdm&&(n=e.minixdm.easyXDM),n||e.easyXDM}function i(e,n){f.push(n),o()?t():a||(a=!0,r(e),c=setInterval(function(){o()&&(t(),clearInterval(c))},100))}var a=!1,c=null,f=[];v.connect=function(n,t){var r,o=n.server||n,a=o.replace(/(\/[^\/]+)$/,""),c=a+"/minixdm.swf",f=a+"/minixdm.js";"http:"==e.location.protocol&&(c=c.replace("https","http")),i(f,function(e){r=new e.Socket({protocol:b,lazy:!1,swf:c,remote:o.replace(/\#[^?]*/,"")+"#basepath="+encodeURIComponent(a),onMessage:function(e,n){t({data:e,origin:u(n)})}})});var s={send:function(e){i(f,function(){r.postMessage(e)})}};return s},v.accept=function(n){var t,r=decodeURIComponent(/basepath=([^?&]+)/.exec(e.location.href.slice(1))[1]),o=r+"/minixdm.swf",a=r+"/minixdm.js";"http:"==e.location.protocol&&(o=o.replace("https","http")),i(a,function(e){t=new e.Socket({protocol:b,swf:o,onMessage:function(e,t){n({data:e,origin:u(t)})}})});var c={send:function(e){i(a,function(){t.postMessage(e)})}};return c}}function h(){t("[framesocket] unsupported browser")}var v={},y="~:DATA:~",w="~:INIT:~",b="6";return e.postMessage||n.postMessage?p():"Gecko"==navigator.product&&"frameElement"in e&&-1==navigator.userAgent.indexOf("WebKit")?m():a()>6?g():(v.connect=function(){return h(),{send:h}},v.accept=function(){return h(),{send:h}},v.isCompatible=function(){return!1}),v.isCompatible=v.isCompatible||function(){return!0},v}(window,document),o=function(e,n,t,r,o){function i(){if(e.console&&e.console.error)try{e.console.error.apply(e.console,arguments)}catch(n){try{e.console.error(Array.prototype.slice.call(arguments||[]).join(" "))}catch(n){}}}function a(){if(e.console&&e.console.warn)try{e.console.warn.apply(e.console.warn,arguments)}catch(n){try{e.console.warn(Array.prototype.slice.call(arguments||[]).join(" "))}catch(n){}}}function c(){this.name="ReadTimeoutError"}function u(){this.name="WriteTimeoutError"}function f(){return(new Date).getTime()}function s(e,n){for(var r=Array.prototype.slice.call(arguments||[]).slice(2),o=n.toString(),i=0;i<r.length;i++)o+="undefined"==typeof r[i]?C+escape(T):C+escape(t.encode(r[i]));e.send(o)}function l(e,n){for(var r,o=e.split(C),i=o[0],c=o.slice(1),u=n[i],f=[],s=0;s<c.length;s++)r=unescape(c[s]),f.push(r==T?{}.undefinedValue:t.decode(r));u?u.apply(u,f):a("[framestore] unknown command type:",i)}function d(e,n){try{r.remove("__framestore__.locks."+e)}catch(t){}n(function(){})}function p(e){var n=g(),t=null,r=f(),o=null;for(var i in n)i!=e&&n.hasOwnProperty(i)&&(o=n[i],(null===t||o===!0||r>o)&&(t=i,r=o===!0?0:o));t&&v(t)}function m(e,n){for(;e;)e--,p(n)}function g(){var e="__framestore__.index";try{return r.get(e)||{}}catch(n){return a("[framestore] index capture failed, resetting"),r.set(e,{}),{}}}function h(e){var n="__framestore__.index";try{return r.set(n,e)}catch(t){a("[framestore] index capture failed, clearing entire storage"),r.clear(),r.set(n,e)}}function v(e){var n=g();r.remove(w(e)),delete n[e],h(n)}function y(e){var n=g();n[e]=f(),h(n)}function w(e){return"__framestore__.stores."+e}function b(e,t,o){y(e),d("stores."+e,function(i){function a(e,n){(e||n)&&(e&&(c.data=e),n&&(c.metadata=n),c.metadata.lastUpdated=f(),r.set(u,c)),i()}var c,u=w(e),s={metadata:{creator:n.referrer,lastUpdated:f()},data:{}};try{c=r.get(u)||s}catch(l){if(!o)throw l;c=s}t(c.data,c.metadata,a)})}var E={},C=",",T="~UNDEFINED",S="~DELETEDKEY",A=100,O=2100;return E.connect=function(n,t,r){function i(){C||(C=setTimeout(f,A))}function f(){g.flush()}function d(e){22===e.code||/QUOTA/.test(e.name||"")?y?_&&_():j&&j():e instanceof u?L&&L():e instanceof c?M&&M():y||w?x&&x(e):(a("[framestore] failed to boot, trying to dump storage"),w=!0,g.dump(),g.pull())}function p(e){T=!1,d(e)}var m,g={},h=n.server,v=n.key,y=!1,w=!1,b={},E=[],C=null,T=!1,x=n.onFailure,j=n.onDisabled,_=n.onOverflow,M=n.onReadTimeout,L=n.onWriteTimeout,k=!1,U=null,D=null,N=null,P=n.maxMillisecondsForResponse||O;return m=o.connect(h,function(n){l(n.data,{DOWNLOADED:function(){r&&r.onDownloaded()},FLUSHDONE:function(e){U==e&&(T=!1,E=[],k&&f())},FLUSHFAIL:function(e,n){U==e&&p(n)},PULLFAIL:function(e){N&&(clearTimeout(N),N=null),d(e)},PUSH:function(n,o,i){r&&!y&&r.onFirstPullReceived();var a,c,u,s;if(i)a=o;else for(a=o,c=0;c<E.length;c++)u=E[c],s=b[u],a[u]=s;b=a,N&&(clearTimeout(N),N=null),n=n,y||(y=!0,e.addEventListener?e.addEventListener("beforeunload",f,!1):e.attachEvent("onbeforeunload",f),r&&r.onFirstPullParsed(),t(g))}})}),g.pull=function(){N=setTimeout(function(){a("[framesocket] timed out while pulling from persistent storage"),d(new c)},P),s(m,"PULL",v)},g.flush=function(){if(T)return void(k=!0);if(C&&(clearTimeout(C),C=null),D&&(clearTimeout(D),D=null),k=!1,y&&E.length>0){var e,n,t,r={};for(e=0;e<E.length;e++)n=E[e],t=b[n],r[n]="undefined"==typeof t?S:t;U=(+new Date).toString(),T=!0,D=setTimeout(function(){T&&(a("[framesocket] timed out while flushing to persistent storage"),p(new u))},P),s(m,"FLUSH",v,r,U)}},g.get=function(e){return b[e]},g.set=function(e,n){b[e]=n,E.push(e),i()},g.remove=function(e){try{b[e]=void 0,delete b[e]}catch(n){}E.push(e),i()},g.clear=function(){b={},C&&(clearTimeout(C),C=null),s(m,"CLEAR",v)},g.dump=function(){s(m,"DUMP",v,b)},g.reclaim=function(e){s(m,"RECLAIM",v,e)},g.reject=function(e){for(var n in b){var t;try{t=e(n)?!0:!1}catch(r){t=!1}if(b.hasOwnProperty(n)&&t){try{b[n]=void 0,delete b[n]}catch(r){}E.push(n)}}i()},g.pull(),g},E.accept=function(){function e(e){s(c,"FLUSHDONE",e)}function n(e,n){a("[framestore] unable to flush to persistent storage"),i(e),s(c,"FLUSHFAIL",n,e)}function t(e){a("[framestore] unable to pull from persistent storage"),i(e),s(c,"PULLFAIL",e)}var c,u={};c=o.accept(function(o){l(o.data,{PULL:function(e){function n(n){try{b(e,function(t,r,o){s(c,"PUSH",e,t,n),o(null,null)})}catch(r){t(r)}}u[e]?n():(u[e]=!0,r.listen(w(e),n),r.listen("__framestore__.index",function(){var t=g();for(var r in t)if(r==e)return;a("[framestore] storage reclaimed, pushing cleared contents"),n(!0)}),n())},FLUSH:function(t,r,o){try{b(t,function(t,i,a){var c,u,f={};for(c in r)if(r.hasOwnProperty(c))if(u=r[c],f[c]=t[c],u==S)try{t[c]=void 0,delete t[c]}catch(s){}else t[c]=u;try{a(t,null),e(o)}catch(s){for(var l in f)f.hasOwnProperty(l)&&(t[l]=f[l]);n(s,o)}})}catch(i){n(i,o)}},CLEAR:function(e){v(e)},DUMP:function(e,n){b(e,function(e,t,r){r(n,null)},!0)},RECLAIM:function(e,n){n&&n>0?m(n,e):a("[framestore] number of reclaimed entries must be nonzero")}})}),s(c,"DOWNLOADED")},r.serialize=function(e){return t.encode(e)},r.deserialize=function(e){return"string"!=typeof e?void 0:t.decode(e)},E}(window,document,n,t,r),{framestore:o,json:n,framesocket:r}}()},{"./json":3}],3:[function(e,n){var t;t=e("json3"),n.exports={encode:function(){return t.stringify.apply(t,arguments)},decode:function(){return t.parse.apply(t,arguments)}}},{json3:1}],4:[function(e){var n=e("../../chatbox/framestorewithjson");n.framestore.accept()},{"../../chatbox/framestorewithjson":2}]},{},[4]);}).call(this);